Project Structure:
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ codefetch.config.mjs
â”œâ”€â”€ components.json
â”œâ”€â”€ coverage
â”‚   â”œâ”€â”€ base.css
â”‚   â”œâ”€â”€ block-navigation.js
â”‚   â”œâ”€â”€ coverage-final.json
â”‚   â”œâ”€â”€ coverage-summary.json
â”‚   â”œâ”€â”€ favicon.png
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ prettify.css
â”‚   â”œâ”€â”€ prettify.js
â”‚   â”œâ”€â”€ sort-arrow-sprite.png
â”‚   â””â”€â”€ sorter.js
â”œâ”€â”€ dev.log
â”œâ”€â”€ eslint.config.mjs
â”œâ”€â”€ html
â”‚   â”œâ”€â”€ bg.png
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ favicon.svg
â”‚   â”œâ”€â”€ html.meta.json.gz
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ lint-errors.txt
â”œâ”€â”€ lint.json
â”œâ”€â”€ lint.txt
â”œâ”€â”€ logs
â”‚   â””â”€â”€ client-logs.json
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.ts
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.mjs
â”œâ”€â”€ prisma
â”‚   â”œâ”€â”€ schema.master.prisma
â”‚   â”œâ”€â”€ schema.postgresql.prisma
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â”œâ”€â”€ schema.production.prisma
â”‚   â”œâ”€â”€ schema.sqlite.prisma
â”œâ”€â”€ public
â”‚   â”œâ”€â”€ file.svg
â”‚   â”œâ”€â”€ globe.svg
â”‚   â”œâ”€â”€ next.svg
â”‚   â”œâ”€â”€ vercel.svg
â”‚   â””â”€â”€ window.svg
â”œâ”€â”€ scripts
â”‚   â”œâ”€â”€ check-port.js
â”‚   â”œâ”€â”€ coverage-report.js
â”‚   â”œâ”€â”€ create-user.js
â”‚   â”œâ”€â”€ pre-deploy.js
â”‚   â”œâ”€â”€ run-tests.sh
â”‚   â”œâ”€â”€ schema-sync.js
â”‚   â”œâ”€â”€ select-db.js
â”‚   â”œâ”€â”€ test-db.js
â”‚   â””â”€â”€ update-file-dates.js
â”œâ”€â”€ server.pid
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ middleware.ts
â”œâ”€â”€ supabase
â”‚   â”œâ”€â”€ config.toml
â”‚   â””â”€â”€ schema.sql
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tsc.txt
â”œâ”€â”€ tsconfig.jest.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.tsbuildinfo
â”œâ”€â”€ types
â”‚   â””â”€â”€ vitest.d.ts
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ vitest
â”‚   â””â”€â”€ failed-files-reporter.js
â”œâ”€â”€ vitest.config.ts
â””â”€â”€ yarn.lock


next-env.d.ts
```
1 | /// <reference types="next" />
2 | /// <reference types="next/image-types/global" />
3 | 
4 | // NOTE: This file should not be edited
5 | // see https://nextjs.org/docs/app/api-reference/config/typescript for more information.
```

next.config.ts
```
1 | import type { NextConfig } from "next";
2 | 
3 | const nextConfig: NextConfig = {
4 |   /* config options here */
5 |   compiler: {
6 |     reactRemoveProperties: process.env.NODE_ENV === 'production' ? 
7 |       { properties: ['^data-testid$'] } : undefined,
8 |   },
9 |   // ë¹ ë¥¸ ë°°í¬ë¥¼ ìœ„í•´ ESLint ê²€ì‚¬ ë¹„í™œì„±í™”
10 |   eslint: {
11 |     ignoreDuringBuilds: true,
12 |   },
13 |   // ë¹ ë¥¸ ë°°í¬ë¥¼ ìœ„í•´ íƒ€ì… ê²€ì‚¬ ë¹„í™œì„±í™”
14 |   typescript: {
15 |     ignoreBuildErrors: true,
16 |   },
17 |   // React Flow ë° ê´€ë ¨ íŒ¨í‚¤ì§€ íŠ¸ëœìŠ¤íŒŒì¼ ì„¤ì •
18 |   transpilePackages: ['@xyflow/react', 'zustand'],
19 | };
20 | 
21 | export default nextConfig;
```

tailwind.config.js
```
1 | /** @type {import('@tailwindcss/postcss').TailwindConfig} */
2 | export default {
3 |   mode: "css", // CSS ëª¨ë“œ ì‚¬ìš©
4 |   inputPath: "./src/app/globals.css", // ì…ë ¥ CSS íŒŒì¼ ê²½ë¡œ
5 |   plugins: [
6 |     "tailwindcss-animate", // ì• ë‹ˆë©”ì´ì…˜ í”ŒëŸ¬ê·¸ì¸ (ì´ë¯¸ ì„¤ì¹˜ë¨)
7 |   ],
8 |   font: {
9 |     sans: ["Pretendard", "sans-serif"], // ê¸°ë³¸ í°íŠ¸ ì„¤ì •
10 |   },
11 |   colors: {
12 |     // ê¸°ë³¸ ìƒ‰ìƒ ì„¤ì •
13 |     primary: "oklch(0.208 0.042 265.755)",
14 |     secondary: "oklch(0.968 0.007 247.896)",
15 |     background: "oklch(1 0 0)",
16 |     foreground: "oklch(0.129 0.042 264.695)",
17 |   },
18 |   colorMode: {
19 |     default: "light", // ê¸°ë³¸ ì»¬ëŸ¬ ëª¨ë“œ
20 |     selector: ".dark", // ë‹¤í¬ ëª¨ë“œ ì„ íƒì
21 |   },
22 |   rules: [
23 |     // ì»¤ìŠ¤í…€ ë³€í˜• ê·œì¹™
24 |     ["dark", "&:is(.dark *)"],
25 |   ],
26 | } 
```

vite.config.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: vite.config.ts
3 |  * ëª©ì : Vite ë¹Œë“œ ë„êµ¬ ì„¤ì •
4 |  * ì—­í• : í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë° ê°œë°œ í™˜ê²½ ì„¤ì • ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-03-31
6 |  * ìˆ˜ì •ì¼: 2025-04-11
7 |  */
8 | 
9 | import { dirname, resolve } from 'path';
10 | import { fileURLToPath } from 'url';
11 | 
12 | import react from '@vitejs/plugin-react';
13 | import { defineConfig } from 'vite';
14 | 
15 | // ESMì—ì„œ __dirname ëŒ€ì²´
16 | const __filename = fileURLToPath(import.meta.url);
17 | const __dirname = dirname(__filename);
18 | 
19 | export default defineConfig({
20 |   plugins: [react()],
21 |   resolve: {
22 |     alias: {
23 |       '@': resolve(__dirname, './src'),
24 |     },
25 |   },
26 | }); 
```

vitest.config.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: viconfig.ts
3 |  * ëª©ì : Vitest í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì„ ìœ„í•œ Vite ì„¤ì •ê³¼ í†µí•©ëœ ì„¤ì • ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-03-31
6 |  * ìˆ˜ì •ì¼: 2025-04-11
7 |  */
8 | 
9 | import { dirname, resolve } from 'path';
10 | import { fileURLToPath } from 'url';
11 | 
12 | import { loadEnv } from 'vite';
13 | import { defineConfig, mergeConfig } from 'vitest/config';
14 | 
15 | import viteConfig from './vite.config.js';
16 | 
17 | // ESMì—ì„œ __dirname ëŒ€ì²´
18 | const __filename = fileURLToPath(import.meta.url);
19 | const __dirname = dirname(__filename);
20 | 
21 | export default mergeConfig(
22 |   viteConfig,
23 |   defineConfig({
24 |     test: {
25 |       // í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
26 |       env: loadEnv('test', process.cwd(), ''),
27 |       
28 |       // í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
29 |       environment: 'jsdom',
30 |       globals: true,
31 |       setupFiles: ['./src/tests/setup.ts'],
32 |       
33 |       // ì„±ëŠ¥ ìµœì í™” ì„¤ì •
34 |       testTimeout: 2000, // ì „ì—­ íƒ€ì„ì•„ì›ƒ ì„¤ì • (2ì´ˆë¡œ ë³€ê²½)
35 |       hookTimeout: 2000, // í›… íƒ€ì„ì•„ì›ƒ ì„¤ì • (2ì´ˆë¡œ ë³€ê²½)
36 |       pool: 'threads',
37 |       poolOptions: {
38 |         threads: {
39 |           singleThread: true,
40 |         },
41 |       },
42 |       // isolate: true,
43 |       
44 |       // Node.js v20ì˜ Undici íƒ€ì„ì•„ì›ƒ ë¬¸ì œ ì²˜ë¦¬
45 |       environmentOptions: {
46 |         // jsdom í™˜ê²½ì—ì„œ ê¸€ë¡œë²Œ ë³€ìˆ˜ ì„¤ì •
47 |         jsdom: {
48 |           // JS íƒ€ì´ë¨¸ ì´ë²¤íŠ¸ê°€ ì¦‰ì‹œ ì²˜ë¦¬ë˜ë„ë¡ ì„¤ì •
49 |           // Undiciì˜ íƒ€ì„ì•„ì›ƒ ì´ìŠˆ í•´ê²°
50 |           pretendToBeVisual: true,
51 |         }
52 |       },
53 |       
54 |       // í…ŒìŠ¤íŠ¸ íŒŒì¼ íŒ¨í„´ ì„¤ì •
55 |       include: ['src/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
56 |       exclude: [
57 |         '**/node_modules/**',
58 |         '**/dist/**',
59 |         '**/.next/**', // Next.js ë¹Œë“œ ê²°ê³¼ë¬¼
60 |         '**/coverage/**', // ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ í´ë”
61 |         '**/.{idea,git,cache,output,temp}/**',
62 |         '**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,storybook,eslint,prettier}.config.*', // ê°ì¢… ì„¤ì • íŒŒì¼
63 |         '**/prisma/seed/**', // Prisma Seed íŒŒì¼
64 |         '**/scripts/**', // ìŠ¤í¬ë¦½íŠ¸ í´ë”
65 |         // '**/src/tests/**', // í…ŒìŠ¤íŠ¸ ê´€ë ¨ í´ë”
66 |         '**/src/components/board/nodes/NodeInspect*.tsx', //ë””ë²„ê¹…ìš© NodeInspector
67 |         // src/lib
68 |         '**/src/lib/debug-utils.ts',  // ë””ë²„ê¹… ìœ í‹¸ë¦¬í‹° 
69 |         '**/test-utils.ts',                
70 |         '**/src/lib/cookie.ts',
71 |         '**/src/lib/auth-server.ts',
72 |         '**/src/lib/prisma.ts',
[TRUNCATED]
```

src/middleware.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: middleware.ts
3 |  * ëª©ì : Supabase ì¸ì¦ í† í° ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•œ ë¯¸ë“¤ì›¨ì–´
4 |  * ì—­í• : ì¸ì¦ í† í°ì„ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë¸Œë¼ìš°ì €ì™€ ì„œë²„ ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬
5 |  * ì‘ì„±ì¼: 2025-03-08
6 |  * ìˆ˜ì •ì¼: 2025-03-27
7 |  * ìˆ˜ì •ì¼: 2024-05-08 : ì¸ì¦ëœ ì‚¬ìš©ìê°€ /login í˜ì´ì§€ ì ‘ê·¼ ì‹œ í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜í•˜ëŠ” ê¸°ëŠ¥ ì¶”ê°€
8 |  */
9 | 
10 | import { NextRequest, NextResponse } from 'next/server'
11 | 
12 | import { createServerClient } from '@supabase/ssr'
13 | 
14 | import { updateSession } from '@/lib/supabase/middleware'
15 | import { Database } from '@/types/supabase'
16 | 
17 | export async function middleware(request: NextRequest) {
18 |   // ë¨¼ì € ì„¸ì…˜ ì—…ë°ì´íŠ¸
19 |   const response = await updateSession(request)
20 |   
21 |   // ë¡œê·¸ì¸ í˜ì´ì§€ ì ‘ê·¼ ì²´í¬
22 |   const url = new URL(request.url)
23 |   if (url.pathname === '/login') {
24 |     // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
25 |     const supabase = createServerClient<Database>(
26 |       process.env.NEXT_PUBLIC_SUPABASE_URL!,
27 |       process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
28 |       {
29 |         cookies: {
30 |           get(name: string) {
31 |             return request.cookies.get(name)?.value
32 |           },
33 |           set() {
34 |             // ë¯¸ë“¤ì›¨ì–´ì—ì„œëŠ” ì¿ í‚¤ë¥¼ ì„¤ì •í•˜ì§€ ì•ŠìŒ
35 |           },
36 |           remove() {
37 |             // ë¯¸ë“¤ì›¨ì–´ì—ì„œëŠ” ì¿ í‚¤ë¥¼ ì‚­ì œí•˜ì§€ ì•ŠìŒ
38 |           },
39 |         },
40 |       }
41 |     )
42 |     
43 |     // í˜„ì¬ ì‚¬ìš©ì ì„¸ì…˜ í™•ì¸
44 |     const { data } = await supabase.auth.getSession()
45 |     
46 |     // ì¸ì¦ëœ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì— ì ‘ê·¼í•  ê²½ìš° í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
47 |     if (data?.session) {
48 |       return NextResponse.redirect(new URL('/', request.url))
49 |     }
50 |   }
51 |   
52 |   return response
53 | }
54 | 
55 | export const config = {
56 |   matcher: [
57 |     /*
58 |      * Match all request paths except for the ones starting with:
59 |      * - _next/static (static files)
60 |      * - _next/image (image optimization files)
61 |      * - favicon.ico (favicon file)
62 |      * Feel free to modify this pattern to include more paths.
63 |      */
64 |     '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
65 |   ],
66 | } 
```

types/vitest.d.ts
```
1 | /// <reference types="vitest" />
2 | /// <reference types="@testing-library/jest-dom" />
3 | 
4 | import type { TestingLibraryMatchers } from '@testing-library/jest-dom/matchers';
5 | 
6 | declare global {
7 |   namespace Vi {
8 |     interface JestAssertion<T = any> 
9 |       extends jest.Matchers<void, T>,
10 |         TestingLibraryMatchers<T, void> {}
11 |   }
12 | 
13 |   // í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì „ì—­ fetchë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
14 |   var fetch: jest.Mock<Promise<Response>> & {
15 |     mockResolvedValue: (value: any) => jest.Mock;
16 |     mockRejectedValue: (error: any) => jest.Mock;
17 |     mockImplementation: (fn: (...args: any[]) => any) => jest.Mock;
18 |   };
19 | }
20 | 
21 | // Prisma ëª¨í‚¹ íƒ€ì… í™•ì¥
22 | declare module '@prisma/client' {
23 |   interface PrismaClient {
24 |     tag?: {
25 |       findUnique: jest.Mock<any, any>;
26 |       findMany: jest.Mock<any, any>; 
27 |       create: jest.Mock<any, any>;
28 |       delete: jest.Mock<any, any>;
29 |       update: jest.Mock<any, any>;
30 |     };
31 |     cardTag?: {
32 |       deleteMany: jest.Mock<any, any>;
33 |       create: jest.Mock<any, any>;
34 |       findMany: jest.Mock<any, any>;
35 |     };
36 |     card?: {
37 |       findUnique: jest.Mock<any, any>;
38 |       findMany: jest.Mock<any, any>;
39 |       create: jest.Mock<any, any>;
40 |       delete: jest.Mock<any, any>;
41 |       update: jest.Mock<any, any>;
42 |     };
43 |   }
44 | } 
```

vitest/failed-files-reporter.js
```
1 | // failed-files-reporter.js
2 | export default class FailedFilesReporter {
3 |     onFinished(results) {
4 |         // results.testFileResultsëŠ” ê° í…ŒìŠ¤íŠ¸ íŒŒì¼ì˜ ê²°ê³¼ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
5 |         const failedFiles = results.testFileResults
6 |             .filter(fileResult => fileResult.numFailingTests > 0)
7 |             .map(fileResult => fileResult.file)
8 | 
9 |         if (failedFiles.length > 0) {
10 |             console.log('\nì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸ íŒŒì¼:');
11 |             failedFiles.forEach(file => console.log(file))
12 |         }
13 |     }
14 | }
```

scripts/check-port.js
```
1 | /**
2 |  * íŒŒì¼ëª…: check-port.js
3 |  * ëª©ì : í¬íŠ¸ 3000ì´ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸í•˜ê³  í•„ìš”ì‹œ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
4 |  * ì—­í• : ê°œë°œ ì„œë²„ ì‹¤í–‰ ì „ í¬íŠ¸ ì¶©ëŒ ì˜ˆë°©
5 |  * ì‘ì„±ì¼: 2024-03-24
6 |  * ìˆ˜ì •ì¼: 2025-03-26
7 |  */
8 | 
9 | import { execSync } from 'child_process';
10 | import os from 'os';
11 | 
12 | const PORT = 3000;
13 | 
14 | function checkPort() {
15 |   console.log(`\nğŸ” í¬íŠ¸ ${PORT} ìƒíƒœ í™•ì¸ ì¤‘...`);
16 | 
17 |   try {
18 |     let command;
19 |     let processIdCommand;
20 | 
21 |     // OSë³„ ëª…ë ¹ì–´ ì„¤ì •
22 |     if (os.platform() === 'win32') {
23 |       // Windows
24 |       command = `netstat -ano | findstr :${PORT}`;
25 |       processIdCommand = (line) => {
26 |         const parts = line.trim().split(/\s+/);
27 |         return parts[parts.length - 1];
28 |       };
29 |     } else {
30 |       // macOS, Linux
31 |       command = `lsof -i :${PORT}`;
32 |       processIdCommand = (line) => {
33 |         const parts = line.trim().split(/\s+/);
34 |         return parts[1];
35 |       };
36 |     }
37 | 
38 |     // ëª…ë ¹ì–´ ì‹¤í–‰ ë° ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
39 |     const result = execSync(command, { encoding: 'utf8' });
40 | 
41 |     if (result && result.trim()) {
42 |       console.log(`âš ï¸ í¬íŠ¸ ${PORT}ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.`);
43 | 
44 |       // ê²°ê³¼ì—ì„œ PID ì¶”ì¶œ
45 |       const lines = result.split('\n').filter(Boolean);
46 | 
47 |       // í—¤ë” ë¼ì¸ ì œì™¸ (macOS/Linuxì˜ lsof ëª…ë ¹ì–´ëŠ” í—¤ë”ê°€ ìˆìŒ)
48 |       const processLines = os.platform() === 'win32' ? lines : lines.slice(1);
49 | 
50 |       if (processLines.length > 0) {
51 |         // ì²« ë²ˆì§¸ í”„ë¡œì„¸ìŠ¤ì˜ PID ì¶”ì¶œ
52 |         const pid = processIdCommand(processLines[0]);
53 | 
54 |         if (pid) {
55 |           console.log(`ğŸ‘‰ PID ${pid} í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì¤‘...`);
56 | 
57 |           try {
58 |             // í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
59 |             if (os.platform() === 'win32') {
60 |               execSync(`taskkill /F /PID ${pid}`);
61 |             } else {
62 |               execSync(`kill -9 ${pid}`);
63 |             }
64 |             console.log(`âœ… í¬íŠ¸ ${PORT}ë¥¼ ì‚¬ìš©í•˜ë˜ í”„ë¡œì„¸ìŠ¤(PID: ${pid})ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
65 |           } catch (killError) {
66 |             console.error(`âŒ í”„ë¡œì„¸ìŠ¤(PID: ${pid}) ì¢…ë£Œ ì‹¤íŒ¨:`, killError.message);
[TRUNCATED]
```

scripts/coverage-report.js
```
1 | import fs from 'fs';
2 | import path from 'path';
3 | import { fileURLToPath } from 'url';
4 | 
5 | // __dirname ëŒ€ì²´
6 | const __filename = fileURLToPath(import.meta.url);
7 | const __dirname = path.dirname(__filename);
8 | 
9 | // íŒŒë¼ë¯¸í„°
10 | const sortBy = process.argv[2] || 'LoC';
11 | 
12 | // íŒŒì¼ ì½ê¸°
13 | const coveragePath = path.resolve(__dirname, '../coverage/coverage-summary.json');
14 | 
15 | if (!fs.existsSync(coveragePath)) {
16 |     console.error('âŒ coverage-summary.json íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
17 |     process.exit(1);
18 | }
19 | 
20 | const summary = JSON.parse(fs.readFileSync(coveragePath, 'utf-8'));
21 | delete summary.total;
22 | 
23 | const rows = Object.entries(summary).map(([filePath, metrics]) => {
24 |     const folder = path.dirname(filePath);
25 |     const file = path.basename(filePath);
26 |     const lines = metrics.lines || {};
27 |     const branches = metrics.branches || {};
28 |     const functions = metrics.functions || {};
29 | 
30 |     return {
31 |         'íŒŒì¼ëª…': file,
32 |         'í´ë”': folder,
33 |         'LoC': lines.total || 0,
34 |         'ë¸Œëœì¹˜ ì»¤ë²„ë¦¬ì§€': branches.pct || 0,
35 |         'í•¨ìˆ˜ ì»¤ë²„ë¦¬ì§€': functions.pct || 0,
36 |         'ë¼ì¸ ì»¤ë²„ë¦¬ì§€': lines.pct || 0,
37 |         'uncovered Line': (lines.total || 0) - (lines.covered || 0),
38 |     };
39 | });
40 | 
41 | // ì •ë ¬
42 | const validSort = rows[0].hasOwnProperty(sortBy) ? sortBy : 'LoC';
43 | rows.sort((a, b) => b[validSort] - a[validSort]);
44 | 
45 | // ì¶œë ¥
46 | const printTable = (data) => {
47 |     if (data.length === 0) {
48 |         console.log('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
49 |         return;
50 |     }
51 | 
52 |     const headers = Object.keys(data[0]);
53 |     const colWidths = headers.map(header =>
54 |         Math.max(header.length, ...data.map(row => String(row[header] ?? '').length))
55 |     );
56 | 
57 |     const formatRow = (rowOrHeader) =>
58 |         headers.map((h, i) => String(rowOrHeader[h] ?? rowOrHeader[i] ?? '').padEnd(colWidths[i])).join(' | ');
59 | 
60 |     const separator = colWidths.map(w => '-'.repeat(w)).join('-|-');
61 | 
62 |     // âœ… ìˆ˜ì •ëœ ì¶œë ¥
63 |     console.log(formatRow(headers));
64 |     console.log(separator);
[TRUNCATED]
```

scripts/create-user.js
```
1 | const { PrismaClient } = require('@prisma/client');
2 | const prisma = new PrismaClient();
3 | 
4 | async function main() {
5 |   try {
6 |     const user = await prisma.user.create({
7 |       data: {
8 |         email: 'test@example.com',
9 |         name: 'Test User'
10 |       }
11 |     });
12 |     console.log('Created user:', user);
13 |   } catch (error) {
14 |     console.error('Error creating user:', error);
15 |   } finally {
16 |     await prisma.$disconnect();
17 |   }
18 | }
19 | 
20 | main(); 
```

scripts/pre-deploy.js
```
1 | #!/usr/bin/env node
2 | 
3 | /**
4 |  * ë°°í¬ ì „ í™˜ê²½ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸
5 |  * 
6 |  * ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” Vercel ë“±ì˜ í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬í•˜ê¸° ì „ì—
7 |  * í™˜ê²½ íŒŒì¼ì„ í™•ì¸í•˜ê³  í•„ìš”í•œ ì„¤ì •ì„ ì ìš©í•©ë‹ˆë‹¤.
8 |  */
9 | 
10 | import { execSync } from 'child_process';
11 | import fs from 'fs';
12 | import path from 'path';
13 | import { fileURLToPath } from 'url';
14 | 
15 | // __dirname ëŒ€ì²´
16 | const __filename = fileURLToPath(import.meta.url);
17 | const __dirname = path.dirname(__filename);
18 | 
19 | console.log('ë°°í¬ ì „ í™˜ê²½ ì„¤ì • í™•ì¸ ì¤‘...');
20 | 
21 | // ê¸°ë³¸ í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ ëª©ë¡
22 | let requiredEnvVars = [
23 |   'DATABASE_PROVIDER',
24 |   'DATABASE_URL'
25 | ];
26 | 
27 | // ë°ì´í„°ë² ì´ìŠ¤ í”„ë¡œë°”ì´ë”ì— ë”°ë¼ ì¶”ê°€ ë³€ìˆ˜ ê²€ì¦
28 | if (process.env.DATABASE_PROVIDER === 'postgresql') {
29 |   requiredEnvVars.push('DIRECT_URL');
30 |   requiredEnvVars.push('NEXT_PUBLIC_SUPABASE_URL');
31 |   requiredEnvVars.push('NEXT_PUBLIC_SUPABASE_ANON_KEY');
32 | 
33 |   if (process.env.NODE_ENV === 'production') {
34 |     requiredEnvVars.push('NEXT_PUBLIC_OAUTH_REDIRECT_URL');
35 |   }
36 | }
37 | 
38 | // í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
39 | const missingEnvVars = requiredEnvVars.filter(envVar => !process.env[envVar]);
40 | 
41 | if (missingEnvVars.length > 0) {
42 |   console.error('âŒ ëˆ„ë½ëœ í™˜ê²½ ë³€ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤:');
43 |   missingEnvVars.forEach(envVar => {
44 |     console.error(`   - ${envVar}`);
45 |   });
46 |   process.exit(1);
47 | }
48 | 
49 | console.log('âœ… ëª¨ë“  í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
50 | 
51 | // í”„ë¡œë•ì…˜ í™˜ê²½ í™•ì¸
52 | if (process.env.NODE_ENV === 'production') {
53 |   console.log('í”„ë¡œë•ì…˜ í™˜ê²½ ê°ì§€: ì„¤ì •ì„ í™•ì¸í•©ë‹ˆë‹¤...');
54 | 
55 |   if (process.env.DATABASE_PROVIDER !== 'postgresql') {
56 |     console.error('âŒ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” DATABASE_PROVIDERê°€ postgresqlì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
57 |     process.exit(1);
58 |   }
59 | 
60 |   if (process.env.DATABASE_PROVIDER === 'postgresql' && !process.env.DATABASE_URL.includes('supabase.co')) {
61 |     console.error('âŒ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ DATABASE_URLì´ Supabase ì—°ê²° ë¬¸ìì—´ì´ ì•„ë‹™ë‹ˆë‹¤.');
62 |     process.exit(1);
63 |   }
64 | }
65 | 
66 | console.log('âœ… í™˜ê²½ ì„¤ì • í™•ì¸ ì™„ë£Œ');
67 | 
68 | // Prisma í´ë¼ì´ì–¸íŠ¸ ìƒì„±
69 | console.log('Prisma í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤...');
70 | try {
[TRUNCATED]
```

scripts/schema-sync.js
```
1 | #!/usr/bin/env node
2 | 
3 | /**
4 |  * Prisma ìŠ¤í‚¤ë§ˆ ë™ê¸°í™” ìŠ¤í¬ë¦½íŠ¸
5 |  * 
6 |  * ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë§ˆìŠ¤í„° í…œí”Œë¦¿ì—ì„œ ê° í™˜ê²½ë³„ ìŠ¤í‚¤ë§ˆë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
7 |  */
8 | import fs from 'fs';
9 | import path from 'path';
10 | import { fileURLToPath } from 'url';
11 | 
12 | // __dirname ëŒ€ì²´
13 | const __filename = fileURLToPath(import.meta.url);
14 | const __dirname = path.dirname(__filename);
15 | 
16 | // ê²½ë¡œ ì„¤ì •
17 | const basePath = path.join(__dirname, '../prisma');
18 | const masterSchemaPath = path.join(basePath, 'schema.master.prisma');
19 | const sqliteSchemaPath = path.join(basePath, 'schema.sqlite.prisma');
20 | const postgresSchemaPath = path.join(basePath, 'schema.postgresql.prisma');
21 | 
22 | console.log('Prisma ìŠ¤í‚¤ë§ˆ ë™ê¸°í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...');
23 | 
24 | // ë§ˆìŠ¤í„° ìŠ¤í‚¤ë§ˆ íŒŒì¼ í™•ì¸
25 | if (!fs.existsSync(masterSchemaPath)) {
26 |   console.log('ë§ˆìŠ¤í„° ìŠ¤í‚¤ë§ˆ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. í˜„ì¬ schema.prismaë¥¼ ë§ˆìŠ¤í„°ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.');
27 |   const currentSchemaPath = path.join(basePath, 'schema.prisma');
28 |   if (fs.existsSync(currentSchemaPath)) {
29 |     fs.copyFileSync(currentSchemaPath, masterSchemaPath);
30 |     console.log(`í˜„ì¬ ìŠ¤í‚¤ë§ˆë¥¼ ë§ˆìŠ¤í„° í…œí”Œë¦¿ìœ¼ë¡œ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤: ${masterSchemaPath}`);
31 |   } else {
32 |     console.error('ì˜¤ë¥˜: í˜„ì¬ ìŠ¤í‚¤ë§ˆ íŒŒì¼ë„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
33 |     process.exit(1);
34 |   }
35 | }
36 | 
37 | // ë§ˆìŠ¤í„° ìŠ¤í‚¤ë§ˆ ì½ê¸°
38 | console.log(`ë§ˆìŠ¤í„° ìŠ¤í‚¤ë§ˆ íŒŒì¼ ì½ê¸°: ${masterSchemaPath}`);
39 | const masterSchema = fs.readFileSync(masterSchemaPath, 'utf8');
40 | 
41 | // SQLite ìŠ¤í‚¤ë§ˆ ìƒì„±
42 | const sqliteSchema = masterSchema
43 |   .replace(/provider(\s*)=(\s*)"postgresql"/g, 'provider$1=$2"sqlite"')
44 |   .replace(/directUrl(\s*)=(\s*)env\("DIRECT_URL"\)/g, '')
45 |   .replace(/extensions(\s*)=(\s*)\[.*?\]/g, '')
46 |   .replace(/\/\/ This is your Prisma schema file for.*?,/g, '// This is your Prisma schema file for SQLite,');
47 | 
48 | // PostgreSQL ìŠ¤í‚¤ë§ˆ ìƒì„±
49 | const postgresSchema = masterSchema
50 |   .replace(/provider(\s*)=(\s*)"sqlite"/g, 'provider$1=$2"postgresql"')
51 |   .replace(/\/\/ This is your Prisma schema file for.*?,/g, '// This is your Prisma schema file for PostgreSQL,');
52 | 
53 | // ìƒì„±ëœ ìŠ¤í‚¤ë§ˆ íŒŒì¼ ì €ì¥
54 | fs.writeFileSync(sqliteSchemaPath, sqliteSchema);
55 | console.log(`SQLite ìŠ¤í‚¤ë§ˆ íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${sqliteSchemaPath}`);
56 | 
57 | fs.writeFileSync(postgresSchemaPath, postgresSchema);
[TRUNCATED]
```

scripts/select-db.js
```
1 | #!/usr/bin/env node
2 | 
3 | import fs from 'fs';
4 | import path from 'path';
5 | import { fileURLToPath } from 'url';
6 | 
7 | // __dirname ëŒ€ì²´
8 | const __filename = fileURLToPath(import.meta.url);
9 | const __dirname = path.dirname(__filename);
10 | 
11 | // í™˜ê²½ í™•ì¸
12 | const isProduction = process.env.NODE_ENV === 'production';
13 | const dbType = isProduction ? 'postgresql' : 'sqlite';
14 | 
15 | // ê²½ë¡œ ì„¤ì •
16 | const basePath = path.join(__dirname, '../prisma');
17 | const schemaPath = path.join(basePath, 'schema.prisma');
18 | const sourceSchemaPath = path.join(basePath, `schema.${dbType}.prisma`);
19 | 
20 | console.log(`í™˜ê²½: ${isProduction ? 'í”„ë¡œë•ì…˜' : 'ê°œë°œ'}`);
21 | console.log(`ë°ì´í„°ë² ì´ìŠ¤: ${dbType}`);
22 | console.log(`ì†ŒìŠ¤ ìŠ¤í‚¤ë§ˆ: ${sourceSchemaPath}`);
23 | console.log(`íƒ€ê²Ÿ ìŠ¤í‚¤ë§ˆ: ${schemaPath}`);
24 | 
25 | // íŒŒì¼ ë³µì‚¬
26 | try {
27 |   // ì†ŒìŠ¤ íŒŒì¼ ì¡´ì¬ í™•ì¸
28 |   if (!fs.existsSync(sourceSchemaPath)) {
29 |     console.error(`ì˜¤ë¥˜: ì†ŒìŠ¤ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${sourceSchemaPath}`);
30 |     process.exit(1);
31 |   }
32 | 
33 |   // íŒŒì¼ ë³µì‚¬
34 |   fs.copyFileSync(sourceSchemaPath, schemaPath);
35 |   console.log(`âœ… ì„±ê³µ: ${dbType} ìŠ¤í‚¤ë§ˆë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.`);
36 | 
37 |   // Prisma ìƒì„± ëª…ë ¹ì–´ ì•ˆë‚´
38 |   console.log('ì´ì œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”: npx prisma generate');
39 | } catch (error) {
40 |   console.error(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
41 |   process.exit(1);
42 | } 
```

scripts/test-db.js
```
1 | // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
2 | import { PrismaClient } from '@prisma/client';
3 | 
4 | async function main() {
5 |   console.log('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
6 |   console.log('í™˜ê²½ ë³€ìˆ˜:', {
7 |     NODE_ENV: process.env.NODE_ENV,
8 |     DATABASE_URL: process.env.DATABASE_URL,
9 |     DATABASE_PROVIDER: process.env.DATABASE_PROVIDER
10 |   });
11 | 
12 |   try {
13 |     const prisma = new PrismaClient();
14 |     console.log('Prisma í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì„±ê³µ');
15 | 
16 |     // ì—°ê²° í…ŒìŠ¤íŠ¸
17 |     console.log('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹œë„ ì¤‘...');
18 |     await prisma.$connect();
19 |     console.log('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ!');
20 | 
21 |     // ê°„ë‹¨í•œ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
22 |     console.log('ì‚¬ìš©ì ì¡°íšŒ ì‹œë„ ì¤‘...');
23 |     const users = await prisma.user.findMany({ take: 5 });
24 |     console.log(`ì‚¬ìš©ì ì¡°íšŒ ì„±ê³µ: ${users.length}ëª…ì˜ ì‚¬ìš©ì ë°œê²¬`);
25 | 
26 |     // ì—°ê²° ì¢…ë£Œ
27 |     await prisma.$disconnect();
28 |     console.log('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¢…ë£Œ');
29 |   } catch (error) {
30 |     console.error('ì—ëŸ¬ ë°œìƒ:', error);
31 |   }
32 | }
33 | 
34 | main(); 
```

scripts/update-file-dates.js
```
1 | /**
2 |  * íŒŒì¼ëª…: scripts/update-file-dates.js
3 |  * ëª©ì : ì½”ë“œë² ì´ìŠ¤ íŒŒì¼ì˜ ì‘ì„±ì¼ í—¤ë”ë¥¼ ìˆ˜ì •
4 |  * ì—­í• : 2024ë…„ ë˜ëŠ” ì´ìƒí•œ ë‚ ì§œê°€ ìˆëŠ” íŒŒì¼ì˜ í—¤ë”ë¥¼ íŒŒì¼ ìƒì„± ë‚ ì§œë¡œ ì—…ë°ì´íŠ¸
5 |  * ì‘ì„±ì¼: 2023-05-26
6 |  */
7 | 
8 | const { exec } = require('child_process');
9 | const fs = require('fs');
10 | const path = require('path');
11 | const util = require('util');
12 | const execPromise = util.promisify(exec);
13 | 
14 | // src ë””ë ‰í† ë¦¬ ê²½ë¡œ
15 | const srcDir = path.join(__dirname, '../src');
16 | 
17 | // íŒŒì¼ ìƒì„± ë‚ ì§œë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (git logë¥¼ ì‚¬ìš©í•˜ì—¬ ì²« ì»¤ë°‹ ë‚ ì§œë¥¼ ê°€ì ¸ì˜´)
18 | async function getFileCreationDate(filePath) {
19 |     try {
20 |         // ìƒëŒ€ ê²½ë¡œë¡œ ë³€í™˜
21 |         const relativeFilePath = path.relative(path.join(__dirname, '..'), filePath);
22 | 
23 |         // git logë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì˜ ì²« ì»¤ë°‹ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
24 |         const { stdout } = await execPromise(`git log --follow --format="%ad" --date=short -- "${relativeFilePath}" | tail -1`);
25 | 
26 |         // ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë°˜í™˜, ì—†ìœ¼ë©´ í˜„ì¬ ë‚ ì§œ ë°˜í™˜
27 |         const gitDate = stdout.trim();
28 |         if (gitDate) {
29 |             return gitDate;
30 |         }
31 | 
32 |         // git ì •ë³´ê°€ ì—†ëŠ” ê²½ìš° íŒŒì¼ ìƒì„±ì¼ ê°€ì ¸ì˜¤ê¸°
33 |         const stats = fs.statSync(filePath);
34 |         const date = new Date(stats.birthtime);
35 |         const year = date.getFullYear();
36 |         const month = String(date.getMonth() + 1).padStart(2, '0');
37 |         const day = String(date.getDate()).padStart(2, '0');
38 |         return `${year}-${month}-${day}`;
39 |     } catch (error) {
40 |         console.error(`Error getting creation date for ${filePath}:`, error);
41 | 
42 |         // ì˜¤ë¥˜ ë°œìƒ ì‹œ í˜„ì¬ ë‚ ì§œ ë°˜í™˜
43 |         const now = new Date();
44 |         const year = now.getFullYear();
45 |         const month = String(now.getMonth() + 1).padStart(2, '0');
46 |         const day = String(now.getDate()).padStart(2, '0');
47 |         return `${year}-${month}-${day}`;
48 |     }
49 | }
50 | 
51 | // ë‚ ì§œ í˜•ì‹ ê²€ì¦ ë° 2024ë…„ ë‚ ì§œ í™•ì¸
52 | function isDateInvalid(dateStr) {
53 |     // ë‚ ì§œ í˜•ì‹ ê²€ì¦ (YYYY-MM-DD)
54 |     const datePattern = /^\d{4}-\d{2}-\d{2}$/;
55 |     if (!datePattern.test(dateStr)) {
[TRUNCATED]
```

html/assets/index-CsZqQx26.js
```
1 | var DS=Object.defineProperty;var IS=(e,t,r)=>t in e?DS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var us=(e,t,r)=>IS(e,typeof t!="symbol"?t+"":t,r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function r(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(s){if(s.ep)return;s.ep=!0;const c=r(s);fetch(s.href,c)}})();/**
2 | * @vue/shared v3.5.12
3 | * (c) 2018-present Yuxi (Evan) You and Vue contributors
4 | * @license MIT
[TRUNCATED]
```

prisma/seed/index.js
```
1 | import { PrismaClient } from '@prisma/client';
2 | const prisma = new PrismaClient();
3 | 
4 | async function main() {
5 |   try {
6 |     // ì‚¬ìš©ì ìƒì„±
7 |     const user = await prisma.user.upsert({
8 |       where: { email: 'test@example.com' },
9 |       update: {},
10 |       create: {
11 |         email: 'test@example.com',
12 |         name: 'Test User',
13 |         cards: {
14 |           create: [
15 |             {
16 |               title: 'ì‹œì‘í•˜ê¸°',
17 |               content: 'ë°±ì•¼ë“œ í”„ë¡œì íŠ¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!'
18 |             }
19 |           ]
20 |         }
21 |       }
22 |     });
23 | 
24 |     // íƒœê·¸ ìƒì„±
25 |     const welcomeTag = await prisma.tag.upsert({
26 |       where: { name: 'í™˜ì˜' },
27 |       update: {},
28 |       create: { name: 'í™˜ì˜' }
29 |     });
30 | 
31 |     // ì¹´ë“œ-íƒœê·¸ ì—°ê²°
32 |     const cards = await prisma.card.findMany({
33 |       where: { userId: user.id }
34 |     });
35 | 
36 |     if (cards.length > 0) {
37 |       await prisma.cardTag.upsert({
38 |         where: {
39 |           cardId_tagId: {
40 |             cardId: cards[0].id,
41 |             tagId: welcomeTag.id
42 |           }
43 |         },
44 |         update: {},
45 |         create: {
46 |           cardId: cards[0].id,
47 |           tagId: welcomeTag.id
48 |         }
49 |       });
50 |     }
51 | 
52 |     console.log('Database seeded!');
53 |   } catch (error) {
54 |     console.error('Error seeding database:', error);
55 |   } finally {
56 |     await prisma.$disconnect();
57 |   }
58 | }
59 | 
60 | main(); 
```

src/app/ReactQueryProvider.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/ReactQueryProvider.tsx
3 |  * ëª©ì : React Queryì˜ QueryClientë¥¼ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
4 |  * ì—­í• : Next.js App Routerì—ì„œ React Queryë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-18
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : ReactQueryDevtools ê°€ì‹œì„± ê°œì„ 
7 |  */
8 | 'use client';
9 | 
10 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
11 | import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
12 | import React from 'react';
13 | 
14 | export function ReactQueryProvider({ children }: { children: React.ReactNode }) {
15 |     const [queryClient] = React.useState(() => new QueryClient({
16 |         defaultOptions: {
17 |             queries: {
18 |                 staleTime: 1000 * 60 * 5, // 5ë¶„ 
19 |                 gcTime: 1000 * 60 * 10,   // 10ë¶„
20 |             },
21 |         },
22 |     }));
23 | 
24 |     return (
25 |         <QueryClientProvider client={queryClient}>
26 |             {children}
27 |             {/* ê°œë°œ ëª¨ë“œì—ì„œë§Œ DevTools í‘œì‹œ - ê¸°ë³¸ì ìœ¼ë¡œ ì—´ë¦° ìƒíƒœë¡œ ì‹œì‘ */}
28 |             {process.env.NODE_ENV === 'development' && (
29 |                 <ReactQueryDevtools
30 |                     initialIsOpen={true}
31 |                     position="bottom"
32 |                     buttonPosition="bottom-right"
33 |                 />
34 |             )}
35 |         </QueryClientProvider>
36 |     );
37 | }
```

src/app/layout.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: layout.test.tsx
3 |  * ëª©ì : RootLayout ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸ì˜ ê¸°ëŠ¥ê³¼ êµ¬ì¡° ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-03-30
7 |  * ìˆ˜ì •ì¼: 2025-04-27 : import ìˆœì„œ ì •ë¦¬
8 |  */
9 | 
10 | import { render, screen } from '@testing-library/react';
11 | import '@testing-library/jest-dom/vitest';
12 | import { describe, it, expect, vi, beforeEach } from 'vitest';
13 | 
14 | import RootLayout from './layout';
15 | import { metadata } from './metadata';
16 | 
17 | // next/font ëª¨ë“ˆ ëª¨í‚¹
18 | vi.mock('next/font/google', () => ({
19 |   Geist: vi.fn().mockReturnValue({
20 |     variable: 'mocked-geist-sans',
21 |   }),
22 |   Geist_Mono: vi.fn().mockReturnValue({
23 |     variable: 'mocked-geist-mono',
24 |   }),
25 | }));
26 | 
27 | // ClientLayout ëª¨í‚¹
28 | vi.mock('@/components/layout/ClientLayout', () => ({
29 |   ClientLayout: ({ children }: { children: React.ReactNode }) => (
30 |     <div data-testid="client-layout">{children}</div>
31 |   ),
32 | }));
33 | 
34 | describe('ë©”íƒ€ë°ì´í„° í…ŒìŠ¤íŠ¸', () => {
35 |   it('ê¸°ë³¸ ë©”íƒ€ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤', () => {
36 |     expect(metadata.title).toBeDefined();
37 |     expect(metadata.description).toBeDefined();
38 |   });
39 | });
40 | 
41 | describe('RootLayout ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸', () => {
42 |   beforeEach(() => {
43 |     render(
44 |       <RootLayout>
45 |         <div data-testid="test-child">Test Child</div>
46 |       </RootLayout>
47 |     );
48 |   });
49 | 
50 |   it('ì»´í¬ë„ŒíŠ¸ê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤', () => {
51 |     expect(RootLayout).toBeDefined();
52 |   });
53 | 
54 |   it('ìì‹ ì»´í¬ë„ŒíŠ¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ë Œë”ë§í•´ì•¼ í•©ë‹ˆë‹¤', () => {
55 |     const testChild = screen.getByTestId('test-child');
56 |     expect(testChild).toBeInTheDocument();
57 |     expect(testChild).toHaveTextContent('Test Child');
58 |   });
59 | 
60 |   it('ClientLayoutì´ ë Œë”ë§ë˜ì–´ì•¼ í•©ë‹ˆë‹¤', () => {
61 |     const clientLayout = screen.getByTestId('client-layout');
62 |     expect(clientLayout).toBeInTheDocument();
63 |     expect(clientLayout).toContainElement(screen.getByTestId('test-child'));
64 |   });
65 | }); 
```

src/app/layout.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/layout.tsx
3 |  * ëª©ì : ì•±ì˜ ê¸°ë³¸ ë ˆì´ì•„ì›ƒ êµ¬ì¡° ì •ì˜
4 |  * ì—­í• : ì „ì²´ í˜ì´ì§€ êµ¬ì¡°ì™€ ê³µí†µ UI ìš”ì†Œ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-02-27
6 |  * ìˆ˜ì •ì¼: 2025-03-28
7 |  * ìˆ˜ì •ì¼: 2024-05-08 : ë©”íƒ€ë°ì´í„° ì¶”ê°€
8 |  * ìˆ˜ì •ì¼: 2024-05-28 : import ìˆœì„œ ì •ë ¬
9 |  * ìˆ˜ì •ì¼: 2024-05-18 : ReactQueryProvider ì¶”ê°€
10 |  */
11 | 
12 | import "@/app/globals.css";
13 | import "@xyflow/react/dist/style.css";
14 | 
15 | import { Metadata } from "next";
16 | 
17 | import { ClientLayout } from "@/components/layout/ClientLayout";
18 | import { ReactQueryProvider } from "@/app/ReactQueryProvider";
19 | 
20 | export const metadata: Metadata = {
21 |   title: "Backyard - ìƒê°ì„ ê´€ë¦¬í•˜ëŠ” ìƒˆë¡œìš´ ë°©ë²•",
22 |   description: "ì•„ì´ë””ì–´ë¥¼ ì‹œê°ì ìœ¼ë¡œ êµ¬ì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì§ê´€ì ì¸ ë„êµ¬",
23 | }
24 | 
25 | export default function RootLayout({
26 |   children,
27 | }: {
28 |   children: React.ReactNode;
29 | }) {
30 |   return (
31 |     <html lang="ko">
32 |       <body className="antialiased" suppressHydrationWarning>
33 |         <ReactQueryProvider>
34 |           <ClientLayout>
35 |             {children}
36 |           </ClientLayout>
37 |         </ReactQueryProvider>
38 |       </body>
39 |     </html>
40 |   );
41 | }
```

src/app/metadata.ts
```
1 | import { Metadata } from "next";
2 | 
3 | export const metadata: Metadata = {
4 |   title: "Backyard - ëª¨ë“  ì•„ì´ë””ì–´ë¥¼ ì •ë¦¬í•˜ëŠ” ê³µê°„",
5 |   description: "íš¨ìœ¨ì ì¸ ë©”ëª¨ì™€ ì§€ì‹ ê´€ë¦¬ë¥¼ ìœ„í•œ ì†”ë£¨ì…˜",
6 |   icons: {
7 |     icon: "/favicon.ico",
8 |   },
9 | }; 
```

src/app/not-found.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: not-found.test.tsx
3 |  * ëª©ì : NotFound ì»´í¬ë„ŒíŠ¸ì˜ ê¸°ëŠ¥ ê²€ì¦
4 |  * ì—­í• : 404 í˜ì´ì§€ê°€ ì˜¬ë°”ë¥´ê²Œ ë Œë”ë§ë˜ëŠ”ì§€ í™•ì¸
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  */
7 | 
8 | import { render, screen } from '@testing-library/react';
9 | import { expect, describe, it, vi } from 'vitest';
10 | 
11 | import NotFound from './not-found';
12 | 
13 | // Next.js Link ì»´í¬ë„ŒíŠ¸ ëª¨í‚¹
14 | vi.mock('next/link', () => ({
15 |     default: ({ children, href }: { children: React.ReactNode, href: string }) => (
16 |         <a href={href} data-testid="link">
17 |             {children}
18 |         </a>
19 |     ),
20 | }));
21 | 
22 | describe('NotFound ì»´í¬ë„ŒíŠ¸', () => {
23 |     it('404 í…ìŠ¤íŠ¸ê°€ í‘œì‹œë˜ì–´ì•¼ í•¨', () => {
24 |         render(<NotFound />);
25 |         expect(screen.getByText('404')).toBeInTheDocument();
26 |     });
27 | 
28 |     it('í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ë‹¤ëŠ” ë©”ì‹œì§€ê°€ í‘œì‹œë˜ì–´ì•¼ í•¨', () => {
29 |         render(<NotFound />);
30 |         expect(screen.getByText('í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')).toBeInTheDocument();
31 |     });
32 | 
33 |     it('ì„¤ëª… í…ìŠ¤íŠ¸ê°€ í‘œì‹œë˜ì–´ì•¼ í•¨', () => {
34 |         render(<NotFound />);
35 |         expect(screen.getByText('ìš”ì²­í•˜ì‹  í˜ì´ì§€ê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì´ë™ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.')).toBeInTheDocument();
36 |     });
37 | 
38 |     it('í™ˆìœ¼ë¡œ ëŒì•„ê°€ëŠ” ë§í¬ê°€ ìˆì–´ì•¼ í•¨', () => {
39 |         render(<NotFound />);
40 |         const link = screen.getByTestId('link');
41 |         expect(link).toBeInTheDocument();
42 |         expect(link).toHaveAttribute('href', '/');
43 |         expect(link).toHaveTextContent('í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°');
44 |     });
45 | }); 
```

src/app/not-found.tsx
```
1 | 'use client';
2 | 
3 | import Link from 'next/link';
4 | 
5 | export default function NotFound() {
6 |   return (
7 |     <div className="flex flex-col items-center justify-center min-h-screen p-8">
8 |       <div className="text-center">
9 |         <h1 className="text-6xl font-bold text-gray-800 mb-4">404</h1>
10 |         <h2 className="text-2xl font-semibold text-gray-700 mb-6">í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
11 |         <p className="text-gray-600 mb-8">
12 |           ìš”ì²­í•˜ì‹  í˜ì´ì§€ê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì´ë™ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
13 |         </p>
14 |         <Link
15 |           href="/"
16 |           className="px-6 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors"
17 |         >
18 |           í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
19 |         </Link>
20 |       </div>
21 |     </div>
22 |   );
23 | } 
```

src/app/page.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: page.test.tsx
3 |  * ëª©ì : í™ˆ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : í™ˆ í˜ì´ì§€ì˜ ë Œë”ë§ê³¼ ê¸°ëŠ¥ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-03-30
7 |  * ìˆ˜ì •ì¼: 2025-04-25 : lint ì˜¤ë¥˜ ìˆ˜ì • - import ìˆœì„œ ë° next/link ì‚¬ìš©
8 |  */
9 | 
10 | import React from 'react';
11 | 
12 | import { render, screen } from '@testing-library/react';
13 | import '@testing-library/jest-dom/vitest';
14 | import { describe, it, expect, vi } from 'vitest';
15 | 
16 | import { DashboardLayout } from '@/components/layout/DashboardLayout';
17 | 
18 | import Home from './page';
19 | 
20 | // DashboardLayout ëª¨í‚¹
21 | vi.mock('@/components/layout/DashboardLayout', () => ({
22 |   DashboardLayout: vi.fn().mockImplementation(() => (
23 |     <div data-testid="dashboard-layout">
24 |       <h1>Backyard</h1>
25 |       <p>ì•„ì´ë””ì–´ì™€ ì§€ì‹ì„ ì‹œê°ì ìœ¼ë¡œ êµ¬ì„±, ê´€ë¦¬, ê³µìœ í•  ìˆ˜ ìˆëŠ” ë„êµ¬</p>
26 |       <span>ì¹´ë“œ ëª©ë¡ ë³´ê¸°</span>
27 |     </div>
28 |   )),
29 | }));
30 | 
31 | describe('Home í˜ì´ì§€', () => {
32 |   it('ì»´í¬ë„ŒíŠ¸ê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤', () => {
33 |     expect(typeof Home).toBe('function');
34 |   });
35 | 
36 |   it('DashboardLayoutì„ ë Œë”ë§í•´ì•¼ í•©ë‹ˆë‹¤', () => {
37 |     render(<Home />);
38 |     const dashboard = screen.getByTestId('dashboard-layout');
39 |     expect(dashboard).toBeInTheDocument();
40 |   });
41 | 
42 |   it('Backyard ì œëª©ì´ ë Œë”ë§ë˜ì–´ì•¼ í•©ë‹ˆë‹¤', () => {
43 |     render(<Home />);
44 |     const heading = screen.getByText('Backyard');
45 |     expect(heading).toBeInTheDocument();
46 |     expect(heading.tagName).toBe('H1');
47 |   });
48 | 
49 |   it('ì„¤ëª… í…ìŠ¤íŠ¸ê°€ ë Œë”ë§ë˜ì–´ì•¼ í•©ë‹ˆë‹¤', () => {
50 |     render(<Home />);
51 |     const description = screen.getByText('ì•„ì´ë””ì–´ì™€ ì§€ì‹ì„ ì‹œê°ì ìœ¼ë¡œ êµ¬ì„±, ê´€ë¦¬, ê³µìœ í•  ìˆ˜ ìˆëŠ” ë„êµ¬');
52 |     expect(description).toBeInTheDocument();
53 |     expect(description.tagName).toBe('P');
54 |   });
55 | 
56 |   it('ì¹´ë“œ ëª©ë¡ ë³´ê¸° ë§í¬ê°€ ë Œë”ë§ë˜ì–´ì•¼ í•©ë‹ˆë‹¤', () => {
57 |     render(<Home />);
58 |     const link = screen.getByText('ì¹´ë“œ ëª©ë¡ ë³´ê¸°');
59 |     expect(link).toBeInTheDocument();
60 |     expect(link.tagName).toBe('A');
61 |     expect(link).toHaveAttribute('href', '/cards');
62 |   });
63 | 
64 |   it('DashboardLayoutì´ í˜¸ì¶œë˜ì–´ì•¼ í•©ë‹ˆë‹¤', () => {
65 |     render(<Home />);
66 |     expect(DashboardLayout).toHaveBeenCalled();
67 |   });
68 | }); 
```

src/app/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/page.tsx
3 |  * ëª©ì : ì•±ì˜ ë©”ì¸ ì§„ì…ì (ë£¨íŠ¸ í˜ì´ì§€) êµ¬ì„±
4 |  * ì—­í• : ì‚¬ìš©ì ì¸ì¦ ìƒíƒœë¥¼ ì„œë²„ ì‚¬ì´ë“œì—ì„œ í™•ì¸í•˜ê³  ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
5 |  * ì‘ì„±ì¼: 2024-04-22
6 |  */
7 | 
8 | import { redirect } from 'next/navigation';
9 | import { auth } from '@/lib/auth-server';
10 | import { DashboardLayout } from '@/components/layout/DashboardLayout';
11 | 
12 | export default async function Home() {
13 |   const session = await auth(); // ì„¸ì…˜ í™•ì¸
14 | 
15 |   if (!session) { // ì„¸ì…˜ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
16 |     redirect('/login');
17 |   }
18 | 
19 |   // ì„¸ì…˜ ìˆìœ¼ë©´ ëŒ€ì‹œë³´ë“œ ë Œë”ë§
20 |   return <DashboardLayout />;
21 | }
```

src/app/test-query.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/test-query.tsx
3 |  * ëª©ì : React Query ì‘ë™ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì„ì‹œ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : React Queryì˜ ê¸°ë³¸ ê¸°ëŠ¥ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2024-05-18
6 |  */
7 | 
8 | "use client";
9 | 
10 | import { useQuery } from '@tanstack/react-query';
11 | 
12 | /**
13 |  * TestQuery: React Query ì‘ë™ í…ŒìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸
14 |  * @returns {JSX.Element} í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸
15 |  */
16 | export default function TestQuery() {
17 |     const { data, isLoading, error } = useQuery({
18 |         queryKey: ['test'],
19 |         queryFn: () => Promise.resolve('React Query is working!'),
20 |     });
21 | 
22 |     const { data: data2, isLoading: isLoading2, error: error2 } = useQuery({
23 |         queryKey: ['test2'],
24 |         queryFn: () => Promise.resolve('React Query is working, too!'),
25 |     });
26 | 
27 | 
28 |     if (isLoading) return <p>ë¡œë”© ì¤‘...</p>;
29 |     if (error) return <p>ì—ëŸ¬ ë°œìƒ: {error.message}</p>;
30 | 
31 |     return (
32 |         <div className="p-4 border rounded">
33 |             <h2 className="text-xl font-bold">React Query í…ŒìŠ¤íŠ¸</h2>
34 |             <p className="mt-2">ê²°ê³¼: {data}. {data2}</p>
35 |         </div>
36 |     );
37 | } 
```

src/components/IdeaMap.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/IdeaMap.tsx
3 |  * ëª©ì : ì¹´ë“œ ë°ì´í„° ì—…ë°ì´íŠ¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì œê³µ
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µ ë‚´ ì¹´ë“œ ë…¸ë“œ ë°ì´í„° ê°±ì‹  ë¡œì§
5 |  * ì‘ì„±ì¼: 2024-05-07
6 |  */
7 | 
8 | import { Node } from '@xyflow/react';
9 | 
10 | import { CardData } from '@/components/ideamap/types/ideamap-types';
11 | 
12 | /**
13 |  * updateCardNodes: ê¸°ì¡´ ë…¸ë“œ ë°°ì—´ì—ì„œ íŠ¹ì • ì¹´ë“œ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•œ ìƒˆ ë…¸ë“œ ë°°ì—´ ë°˜í™˜
14 |  * @param {Node<CardData>[]} prevNodes - ì—…ë°ì´íŠ¸í•  ë…¸ë“œ ë°°ì—´
15 |  * @param {CardData} cardData - ì—…ë°ì´íŠ¸í•  ì¹´ë“œ ë°ì´í„°
16 |  * @returns {Node<CardData>[]} ì—…ë°ì´íŠ¸ëœ ë…¸ë“œ ë°°ì—´
17 |  */
18 | export const updateCardNodes = (prevNodes: Node<CardData>[], cardData: CardData): Node<CardData>[] => {
19 |     return prevNodes.map((node) => {
20 |         if (node.id === cardData.id) {
21 |             return {
22 |                 ...node,
23 |                 data: {
24 |                     ...node.data,
25 |                     title: cardData.title,
26 |                     content: cardData.content ?? '',
27 |                 },
28 |             };
29 |         }
30 |         return node;
31 |     });
32 | }; 
```

src/services/cardService.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/services/cardService.ts
3 |  * ëª©ì : ì¹´ë“œ ê´€ë ¨ API í†µì‹  ì„œë¹„ìŠ¤
4 |  * ì—­í• : ì¹´ë“œ ë°ì´í„°ì˜ CRUD ì‘ì—…ì„ ìœ„í•œ API í˜¸ì¶œ í•¨ìˆ˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : ë‹¨ê±´/ì†Œë°°ì¹˜/ëŒ€ëŸ‰ API í˜¸ì¶œ êµ¬ì¡° ê°œì„  ë° ë¹„ë™ê¸° ì‘ì—… íŒ¨í„´ ì¶”ê°€
7 |  */
8 | 
9 | import { Card, CreateCardInput as CardInput, UpdateCardInput as CardPatch } from "@/types/card";
10 | import createLogger from '@/lib/logger';
11 | 
12 | const logger = createLogger('cardService');
13 | 
14 | /**
15 |  * fetchCards: ì¹´ë“œ ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
16 |  * @param {Object} params - ê²€ìƒ‰ íŒŒë¼ë¯¸í„° (ê²€ìƒ‰ì–´, íƒœê·¸ ë“±)
17 |  * @returns {Promise<Card[]>} ì¹´ë“œ ëª©ë¡
18 |  */
19 | export async function fetchCards(params?: { q?: string; tag?: string; userId?: string }): Promise<Card[]> {
20 |   try {
21 |     // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ìƒì„±
22 |     const queryParams = new URLSearchParams();
23 |     if (params?.q) queryParams.append('q', params.q);
24 |     if (params?.tag) queryParams.append('tag', params.tag);
25 |     if (params?.userId) queryParams.append('userId', params.userId);
26 |     
27 |     const queryString = queryParams.toString();
28 |     const url = `/api/cards${queryString ? `?${queryString}` : ''}`;
29 |     
30 |     const response = await fetch(url);
31 |     
32 |     if (!response.ok) {
33 |       throw new Error(response.statusText || 'ì¹´ë“œ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
34 |     }
35 |     
36 |     return await response.json();
37 |   } catch (error) {
38 |     logger.error('ì¹´ë“œ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
39 |     throw error;
40 |   }
41 | }
42 | 
43 | /**
44 |  * fetchCardById: íŠ¹ì • IDì˜ ì¹´ë“œë¥¼ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
45 |  * @param {string} id - ì¡°íšŒí•  ì¹´ë“œ ID
46 |  * @returns {Promise<Card>} ì¹´ë“œ ì •ë³´
47 |  */
48 | export async function fetchCardById(id: string): Promise<Card> {
49 |   try {
50 |     const response = await fetch(`/api/cards/${id}`);
51 |     
52 |     if (!response.ok) {
53 |       throw new Error(response.statusText || 'ì¹´ë“œë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
54 |     }
55 |     
56 |     return await response.json();
57 |   } catch (error) {
58 |     logger.error(`ì¹´ë“œ ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜ (ID=${id}):`, error);
59 |     throw error;
60 |   }
61 | }
62 | 
63 | /**
64 |  * createCardsAPI: ë‹¨ê±´ ë˜ëŠ” ì†Œë°°ì¹˜(â‰¤50) ì¹´ë“œë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
[TRUNCATED]
```

src/services/edgeService.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/services/edgeService.ts
3 |  * ëª©ì : ì—£ì§€ ê´€ë ¨ API í†µì‹  ì„œë¹„ìŠ¤
4 |  * ì—­í• : ì—£ì§€ ë°ì´í„°ì˜ CRUD ì‘ì—…ì„ ìœ„í•œ API í˜¸ì¶œ í•¨ìˆ˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-07-01
6 |  * @rule   three-layer-standard
7 |  * @layer  service
8 |  * @tag    @service-msw fetchEdges
9 |  */
10 | 
11 | import createLogger from '@/lib/logger';
12 | import { Edge, EdgeInput, EdgePatch } from '@/types/edge';
13 | 
14 | const logger = createLogger('edgeService');
15 | 
16 | /**
17 |  * fetchEdges: ëª¨ë“  ì—£ì§€ ëª©ë¡ ë˜ëŠ” í•„í„°ë§ëœ ì—£ì§€ ì¡°íšŒ
18 |  * @param {Object} params - í•„í„°ë§ íŒŒë¼ë¯¸í„°
19 |  * @returns {Promise<Edge[]>} ì—£ì§€ ëª©ë¡
20 |  */
21 | export async function fetchEdges(
22 |   params?: { source?: string; target?: string; userId?: string }
23 | ): Promise<Edge[]> {
24 |   try {
25 |     // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ìƒì„±
26 |     const queryParams = new URLSearchParams();
27 |     if (params?.source) queryParams.append('source', params.source);
28 |     if (params?.target) queryParams.append('target', params.target);
29 |     if (params?.userId) queryParams.append('userId', params.userId);
30 |     
31 |     const queryString = queryParams.toString();
32 |     const url = `/api/edges${queryString ? `?${queryString}` : ''}`;
33 |     
34 |     const response = await fetch(url);
35 |     
36 |     if (!response.ok) {
37 |       throw new Error(response.statusText || 'ì—£ì§€ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
38 |     }
39 |     
40 |     return await response.json();
41 |   } catch (error) {
42 |     logger.error('ì—£ì§€ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
43 |     throw error;
44 |   }
45 | }
46 | 
47 | /**
48 |  * fetchEdgeById: íŠ¹ì • IDì˜ ì—£ì§€ ì¡°íšŒ
49 |  * @param {string} id - ì—£ì§€ ID
50 |  * @returns {Promise<Edge>} ì—£ì§€ ë°ì´í„°
51 |  */
52 | export async function fetchEdgeById(id: string): Promise<Edge> {
53 |   try {
54 |     const response = await fetch(`/api/edges/${id}`);
55 |     
56 |     if (!response.ok) {
57 |       throw new Error(response.statusText || 'ì—£ì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
58 |     }
59 |     
60 |     return await response.json();
61 |   } catch (error) {
62 |     logger.error(`ì—£ì§€ ì¡°íšŒ ì˜¤ë¥˜ (ID=${id}):`, error);
63 |     throw error;
64 |   }
65 | }
66 | 
67 | /**
68 |  * createEdgeAPI: ìƒˆ ì—£ì§€ ìƒì„±
69 |  * @param {EdgeInput | EdgeInput[]} input - ìƒì„±í•  ì—£ì§€ ë°ì´í„°(ë‹¨ì¼ ë˜ëŠ” ë°°ì—´)
[TRUNCATED]
```

src/services/ideaMapSettingsService.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/services/ideaMapSettingsService.ts
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ ì„¤ì • ê´€ë ¨ API í˜¸ì¶œ ì„œë¹„ìŠ¤
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ì„œë²„ì™€ í†µì‹ í•˜ëŠ” ìˆœìˆ˜ í•¨ìˆ˜ë“¤ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { IdeaMapSettings } from '@/lib/ideamap-utils';
9 | 
10 | /**
11 |  * getApiUrl: API URLì„ ê°€ì ¸ì˜¤ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
12 |  * @returns {string} API URL
13 |  */
14 | const getApiUrl = (): string => {
15 |   return process.env.NEXT_PUBLIC_API_URL || '';
16 | };
17 | 
18 | /**
19 |  * fetchIdeaMapSettings: ì‚¬ìš©ìì˜ ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ì¡°íšŒ
20 |  * @param {string} userId - ì‚¬ìš©ì ID
21 |  * @returns {Promise<IdeaMapSettings | null>} ì„¤ì • ê°ì²´ ë˜ëŠ” null
22 |  */
23 | export const fetchIdeaMapSettings = async (userId: string): Promise<IdeaMapSettings | null> => {
24 |   try {
25 |     if (!userId) {
26 |       console.warn('[ideaMapSettingsService] ì‚¬ìš©ì ID ì—†ìŒ, ì„¤ì • ë¡œë“œ ìŠ¤í‚µ');
27 |       return null;
28 |     }
29 | 
30 |     console.log('[ideaMapSettingsService] ì„œë²„ì—ì„œ ì„¤ì • ë¡œë“œ ì‹œì‘', { userId });
31 |     
32 |     const apiUrl = getApiUrl();
33 |     const response = await fetch(`${apiUrl}/api/ideamap-settings?userId=${encodeURIComponent(userId)}`);
34 |     
35 |     if (!response.ok) {
36 |       throw new Error('ì„œë²„ì—ì„œ ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
37 |     }
38 | 
39 |     const data = await response.json();
40 |     return data.settings;
41 |   } catch (error) {
42 |     console.error('[ideaMapSettingsService] ì„¤ì • ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
43 |     return null;
44 |   }
45 | };
46 | 
47 | /**
48 |  * updateIdeaMapSettings: ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ë¶€ë¶„ ì—…ë°ì´íŠ¸
49 |  * @param {string} userId - ì‚¬ìš©ì ID
50 |  * @param {Partial<IdeaMapSettings>} settings - ì—…ë°ì´íŠ¸í•  ì„¤ì • ì¼ë¶€
51 |  * @returns {Promise<IdeaMapSettings | null>} ì—…ë°ì´íŠ¸ëœ ì„¤ì • ë˜ëŠ” null
52 |  */
53 | export const updateIdeaMapSettings = async (
54 |   userId: string, 
55 |   settings: Partial<IdeaMapSettings>
56 | ): Promise<IdeaMapSettings | null> => {
57 |   try {
58 |     if (!userId) {
59 |       console.warn('[ideaMapSettingsService] ì‚¬ìš©ì ID ì—†ìŒ, ì„¤ì • ì—…ë°ì´íŠ¸ ìŠ¤í‚µ');
60 |       return null;
61 |     }
62 | 
63 |     // ìš”ì²­ ë°ì´í„° ê¹Šì€ ë³µì‚¬ ë° ë¬¸ìì—´ ë³€í™˜ í™•ì¸
64 |     const safeSettings = JSON.parse(JSON.stringify(settings));
65 |     
66 |     console.log('[ideaMapSettingsService] ì„¤ì • ì—…ë°ì´íŠ¸ ìš”ì²­:', {
67 |       userId,
68 |       settings: safeSettings
69 |     });
70 |     
71 |     const apiUrl = getApiUrl();
[TRUNCATED]
```

src/services/tagService.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/services/tagService.ts
3 |  * ëª©ì : íƒœê·¸ ê´€ë ¨ API í†µì‹  ì„œë¹„ìŠ¤
4 |  * ì—­í• : íƒœê·¸ ë°ì´í„°ì˜ CRUD ì‘ì—…ì„ ìœ„í•œ API í˜¸ì¶œ í•¨ìˆ˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import createLogger from '@/lib/logger';
9 | 
10 | // íƒœê·¸ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
11 | export interface Tag {
12 |   id: string;
13 |   name: string;
14 |   count?: number;
15 |   createdAt: string;
16 | }
17 | 
18 | export interface TagInput {
19 |   name: string;
20 | }
21 | 
22 | const logger = createLogger('tagService');
23 | 
24 | /**
25 |  * fetchTags: ëª¨ë“  íƒœê·¸ ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
26 |  * @returns {Promise<Tag[]>} íƒœê·¸ ëª©ë¡
27 |  */
28 | export async function fetchTags(): Promise<Tag[]> {
29 |   try {
30 |     const response = await fetch('/api/tags');
31 |     
32 |     if (!response.ok) {
33 |       throw new Error(response.statusText || 'íƒœê·¸ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
34 |     }
35 |     
36 |     return await response.json();
37 |   } catch (error) {
38 |     logger.error('íƒœê·¸ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
39 |     throw error;
40 |   }
41 | }
42 | 
43 | /**
44 |  * createTagAPI: ìƒˆ íƒœê·¸ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
45 |  * @param {TagInput} tagInput - ìƒì„±í•  íƒœê·¸ ë°ì´í„°
46 |  * @returns {Promise<Tag>} ìƒì„±ëœ íƒœê·¸ ì •ë³´
47 |  */
48 | export async function createTagAPI(tagInput: TagInput): Promise<Tag> {
49 |   try {
50 |     const response = await fetch('/api/tags', {
51 |       method: 'POST',
52 |       headers: {
53 |         'Content-Type': 'application/json',
54 |       },
55 |       body: JSON.stringify(tagInput),
56 |     });
57 |     
58 |     if (!response.ok) {
59 |       throw new Error(response.statusText || 'íƒœê·¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
60 |     }
61 |     
62 |     return await response.json();
63 |   } catch (error) {
64 |     logger.error('íƒœê·¸ ìƒì„± ì˜¤ë¥˜:', error);
65 |     throw error;
66 |   }
67 | }
68 | 
69 | /**
70 |  * deleteTagAPI: íƒœê·¸ë¥¼ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
71 |  * @param {string} id - ì‚­ì œí•  íƒœê·¸ ID
72 |  * @returns {Promise<void>}
73 |  */
74 | export async function deleteTagAPI(id: string): Promise<void> {
75 |   try {
76 |     const response = await fetch(`/api/tags/${id}`, {
77 |       method: 'DELETE',
78 |     });
79 |     
80 |     if (!response.ok) {
[TRUNCATED]
```

src/hooks/useAddNodeOnEdgeDrop.ts
```
1 | import { useState, useCallback } from 'react';
2 | 
3 | import { OnConnectStart, OnConnectEnd, useReactFlow, Connection, XYPosition } from '@xyflow/react';
4 | 
5 | interface UseAddNodeOnEdgeDropProps {
6 |   onCreateNode: (position: XYPosition, connectingNodeId: string, handleType: 'source' | 'target') => void;
7 | }
8 | 
9 | /**
10 |  * ì—£ì§€ë¥¼ ë“œë˜ê·¸í•´ì„œ íŠ¹ì • ìœ„ì¹˜ì— ë“œë¡­í–ˆì„ ë•Œ ìƒˆ ë…¸ë“œë¥¼ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í›…
11 |  */
12 | export function useAddNodeOnEdgeDrop({ onCreateNode }: UseAddNodeOnEdgeDropProps) {
13 |   // í˜„ì¬ ì—°ê²° ì¤‘ì¸ ë…¸ë“œ ID
14 |   const [connectingNodeId, setConnectingNodeId] = useState<string | null>(null);
15 |   // í˜„ì¬ ì—°ê²° ì¤‘ì¸ í•¸ë“¤ íƒ€ì… (source ë˜ëŠ” target)
16 |   const [connectingHandleType, setConnectingHandleType] = useState<'source' | 'target' | null>(null);
17 |   
18 |   // ReactFlow ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°
19 |   const { screenToFlowPosition, getNodes } = useReactFlow();
20 |   
21 |   // ì—°ê²° ì‹œì‘ í•¸ë“¤ëŸ¬
22 |   const onConnectStart: OnConnectStart = useCallback((_, { nodeId, handleType }) => {
23 |     setConnectingNodeId(nodeId);
24 |     setConnectingHandleType(handleType as 'source' | 'target');
25 |   }, []);
26 |   
27 |   // ì—°ê²° ì¢…ë£Œ í•¸ë“¤ëŸ¬
28 |   const onConnectEnd: OnConnectEnd = useCallback(
29 |     (event) => {
30 |       if (!connectingNodeId || !connectingHandleType || !event) {
31 |         return;
32 |       }
33 |       
34 |       // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ë¥¼ ìºìŠ¤íŒ…
35 |       const mouseEvent = event as MouseEvent;
36 |       
37 |       // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ë¥¼ Flow ì¢Œí‘œë¡œ ë³€í™˜
38 |       const position = screenToFlowPosition({
39 |         x: mouseEvent.clientX,
40 |         y: mouseEvent.clientY,
41 |       });
42 |       
43 |       // ë…¸ë“œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
44 |       const nodes = getNodes();
45 |       
46 |       // í•´ë‹¹ ìœ„ì¹˜ì— ì´ë¯¸ ë…¸ë“œê°€ ìˆëŠ”ì§€ í™•ì¸ (50px í—ˆìš© ì˜¤ì°¨)
47 |       const targetNodeAtPosition = nodes.find(
48 |         node => 
49 |           Math.abs(node.position.x - position.x) < 50 && 
50 |           Math.abs(node.position.y - position.y) < 50
51 |       );
52 |       
53 |       // ì´ë¯¸ ë…¸ë“œê°€ ìˆìœ¼ë©´ ìë™ ì—°ê²° ì²˜ë¦¬ëŠ” í•˜ì§€ ì•Šê³  ê¸°ë³¸ ë™ì‘ì„ ì‚¬ìš©
54 |       if (!targetNodeAtPosition) {
55 |         // ë…¸ë“œê°€ ì—†ìœ¼ë©´ ìƒˆ ë…¸ë“œ ìƒì„± í•¨ìˆ˜ í˜¸ì¶œ
56 |         onCreateNode(position, connectingNodeId, connectingHandleType);
57 |       }
58 |       
59 |       // ì—°ê²° ìƒíƒœ ì´ˆê¸°í™”
60 |       setConnectingNodeId(null);
61 |       setConnectingHandleType(null);
62 |     },
63 |     [connectingNodeId, connectingHandleType, getNodes, onCreateNode, screenToFlowPosition]
64 |   );
65 |   
66 |   return {
67 |     connectingNodeId,
68 |     connectingHandleType,
69 |     onConnectStart,
70 |     onConnectEnd,
71 |   };
72 | } 
```

src/hooks/useAuth.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useAuth.ts
3 |  * ëª©ì : Supabase ì¸ì¦ ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸ êµ¬ë… ë° ìƒíƒœ ê´€ë¦¬
4 |  * ì—­í• : Auth ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹ê³¼ ì „ì—­ ìƒíƒœ ë™ê¸°í™”ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì»¤ìŠ¤í…€ í›…
5 |  * ì‘ì„±ì¼: 2024-05-13
6 |  * ìˆ˜ì •ì¼: 2025-04-24 : useAuthStore ë¦¬íŒ©í† ë§ì— ë§ì¶° ì—…ë°ì´íŠ¸ - setUser ëŒ€ì‹  setProfile ì‚¬ìš©
7 |  */
8 | 
9 | 'use client';
10 | 
11 | import { useEffect, useState } from 'react';
12 | import { User } from '@supabase/supabase-js';
13 | import { createClient } from '@/lib/supabase/client';
14 | import { useAuthStore } from '@/store/useAuthStore';
15 | import createLogger from '@/lib/logger';
16 | 
17 | // ë¡œê±° ìƒì„±
18 | const logger = createLogger('useAuth');
19 | 
20 | /**
21 |  * ì¸ì¦ ìƒíƒœ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
22 |  */
23 | interface AuthStatus {
24 |   user: User | null;
25 |   isLoading: boolean;
26 |   error: Error | null;
27 | }
28 | 
29 | /**
30 |  * useAuth: Supabase ì¸ì¦ ìƒíƒœ ë³€ê²½ì„ êµ¬ë…í•˜ì—¬ ì•± ìƒíƒœì— ë°˜ì˜í•˜ëŠ” í›…
31 |  * @returns {AuthStatus} í˜„ì¬ ì‚¬ìš©ì ì •ë³´, ë¡œë”© ë° ì—ëŸ¬ ìƒíƒœ
32 |  */
33 | export function useAuth(): AuthStatus {
34 |   // ë¡œì»¬ ìƒíƒœ ì„¤ì •
35 |   const [localUser, setLocalUser] = useState<User | null>(null);
36 |   const [localIsLoading, setLocalIsLoading] = useState<boolean>(true);
37 |   const [localError, setLocalError] = useState<Error | null>(null);
38 | 
39 |   // Zustand ìŠ¤í† ì–´ì—ì„œ ì•¡ì…˜ ê°€ì ¸ì˜¤ê¸°
40 |   const setStoreLoading = useAuthStore((state) => state.setLoading);
41 |   const setStoreProfile = useAuthStore((state) => state.setProfile);
42 |   const setStoreError = useAuthStore((state) => state.setError);
43 | 
44 |   useEffect(() => {
45 |     let mounted = true;
46 |     
47 |     async function initializeAuth() {
48 |       try {
49 |         // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
50 |         const supabase = createClient();
51 |         
52 |         // ì´ˆê¸° ì„¸ì…˜ í™•ì¸
53 |         const { data: { session }, error: sessionError } = await supabase.auth.getSession();
54 |         
55 |         if (sessionError) {
56 |           throw sessionError;
57 |         }
58 | 
59 |         // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì„¤ì •
60 |         if (session?.user) {
61 |           if (mounted) {
62 |             setStoreProfile(session.user);
63 |             setStoreLoading(false);
64 |           }
65 |         } else {
66 |           if (mounted) {
67 |             setStoreProfile(null);
68 |             setStoreLoading(false);
69 |           }
70 |         }
71 | 
72 |         // ì¸ì¦ ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
73 |         const { data: { subscription } } = supabase.auth.onAuthStateChange(
[TRUNCATED]
```

src/hooks/useCard.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useCard.test.tsx
3 |  * ëª©ì : useCard í›…ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : íŠ¹ì • ì¹´ë“œ ì¡°íšŒ ê¸°ëŠ¥ ê²€ì¦ ë° ì—ëŸ¬ í•¸ë“¤ë§ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { expect, describe, it, beforeAll, afterAll, afterEach } from 'vitest';
9 | import { renderHook, waitFor } from '@testing-library/react';
10 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
11 | import { setupServer } from 'msw/node';
12 | import { http, HttpResponse } from 'msw';
13 | import { useCard } from './useCard';
14 | 
15 | // í…ŒìŠ¤íŠ¸ìš© ë˜í¼ ì»´í¬ë„ŒíŠ¸
16 | const createWrapper = () => {
17 |     const queryClient = new QueryClient({
18 |         defaultOptions: {
19 |             queries: {
20 |                 retry: false,
21 |             },
22 |         },
23 |     });
24 | 
25 |     return ({ children }: { children: React.ReactNode }) => (
26 |         <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>
27 |     );
28 | };
29 | 
30 | // í…ŒìŠ¤íŠ¸ìš© ëª¨ì˜ ë°ì´í„°
31 | const mockCard = {
32 |     id: '1',
33 |     title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ',
34 |     content: 'ì´ê²ƒì€ í…ŒìŠ¤íŠ¸ ì¹´ë“œ ë‚´ìš©ì…ë‹ˆë‹¤.',
35 |     userId: 'user-1',
36 |     createdAt: new Date().toISOString(),
37 |     updatedAt: new Date().toISOString(),
38 |     tags: [{ id: 'tag-1', name: 'í…ŒìŠ¤íŠ¸' }],
39 |     user: {
40 |         id: 'user-1',
41 |         name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
42 |         email: 'test@example.com',
43 |         image: 'https://example.com/avatar.png',
44 |     },
45 | };
46 | 
47 | // MSW ì„œë²„ ì„¤ì •
48 | const server = setupServer(
49 |     // ì„±ê³µ ì‘ë‹µ í•¸ë“¤ëŸ¬
50 |     http.get('/api/cards/:id', ({ params }) => {
51 |         const { id } = params;
52 | 
53 |         if (id === '1') {
54 |             return HttpResponse.json(mockCard);
55 |         }
56 | 
57 |         if (id === 'not-found') {
58 |             return new HttpResponse(null, { status: 404 });
59 |         }
60 | 
61 |         return HttpResponse.json(null);
62 |     }),
63 | 
64 |     // ì„œë²„ ì˜¤ë¥˜ í•¸ë“¤ëŸ¬
65 |     http.get('/api/cards/error', () => {
66 |         return new HttpResponse(null, { status: 500 });
67 |     })
68 | );
69 | 
70 | // í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „ ì„œë²„ ì‹œì‘
71 | beforeAll(() => server.listen());
72 | 
73 | // ê° í…ŒìŠ¤íŠ¸ í›„ í•¸ë“¤ëŸ¬ ì´ˆê¸°í™”
74 | afterEach(() => server.resetHandlers());
75 | 
76 | // ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¢…ë£Œ í›„ ì„œë²„ ì¢…ë£Œ
77 | afterAll(() => server.close());
78 | 
[TRUNCATED]
```

src/hooks/useCard.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useCard.ts
3 |  * ëª©ì : íŠ¹ì • ì¹´ë“œ IDì˜ ìƒì„¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” í›…
4 |  * ì—­í• : React Queryë¥¼ ì‚¬ìš©í•˜ì—¬ ì¹´ë“œ ìƒì„¸ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³  ìºì‹±
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { useQuery } from '@tanstack/react-query';
9 | import { fetchCardById } from '../services/cardService';
10 | import type { Card } from '../types/card';
11 | 
12 | /**
13 |  * useCard: íŠ¹ì • ì¹´ë“œ IDì˜ ìƒì„¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” í›…
14 |  * @param {string | undefined} cardId - ì¡°íšŒí•  ì¹´ë“œì˜ ID
15 |  * @returns {UseQueryResult} ì¹´ë“œ ë°ì´í„°ì™€ ë¡œë”©/ì—ëŸ¬ ìƒíƒœ
16 |  */
17 | export function useCard(cardId?: string) {
18 |   return useQuery<Card, Error>({
19 |     queryKey: ['card', cardId],
20 |     queryFn: () => fetchCardById(cardId as string),
21 |     enabled: !!cardId, // cardIdê°€ ìˆì„ ë•Œë§Œ ì¿¼ë¦¬ ì‹¤í–‰
22 |     staleTime: 5 * 60 * 1000, // 5ë¶„
23 |     gcTime: 10 * 60 * 1000, // 10ë¶„
24 |   });
25 | } 
```

src/hooks/useCardData.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: useCardData.ts
3 |  * ëª©ì : ì¹´ë“œ ë°ì´í„°ë¥¼ APIì—ì„œ ë¡œë“œí•˜ê³  ê´€ë¦¬í•˜ëŠ” í›…
4 |  * ì—­í• : API í˜¸ì¶œ ë° ì‘ë‹µ ì²˜ë¦¬, ë°ì´í„° ìºì‹±, ì „ì—­ ìƒíƒœ ì—…ë°ì´íŠ¸ ë‹´ë‹¹
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2024-05-30 : ì¹´ë“œ ë¡œë“œ í›„ ë…¸ë“œì™€ ë™ê¸°í™” ë¡œì§ ì¶”ê°€
7 |  */
8 | 
9 | import { useState, useEffect, useCallback } from 'react';
10 | 
11 | import { toast } from 'sonner';
12 | 
13 | import { useAppStore, Card } from '@/store/useAppStore';
14 | 
15 | interface UseCardDataOptions {
16 |   autoLoad?: boolean;
17 |   userId?: string | null;
18 |   searchQuery?: string | null;
19 |   tagFilter?: string | null;
20 | }
21 | 
22 | /**
23 |  * useCardData: ì¹´ë“œ ë°ì´í„°ë¥¼ APIì—ì„œ ë¡œë“œí•˜ê³  ê´€ë¦¬í•˜ëŠ” í›…
24 |  * @param options ë°ì´í„° ë¡œë“œ ì„¤ì • ì˜µì…˜
25 |  * @returns ì¹´ë“œ ë°ì´í„° ê´€ë ¨ ìƒíƒœ ë° í•¨ìˆ˜ë“¤
26 |  */
27 | export function useCardData({
28 |   autoLoad = true,
29 |   userId = null,
30 |   searchQuery = null,
31 |   tagFilter = null
32 | }: UseCardDataOptions = {}) {
33 |   // ë¡œë”© ë° ì—ëŸ¬ ìƒíƒœ
34 |   const [isLoading, setIsLoading] = useState(false);
35 |   const [error, setError] = useState<string | null>(null);
36 |   const [lastLoadedAt, setLastLoadedAt] = useState<Date | null>(null);
37 |   
38 |   // useAppStoreì—ì„œ ì¹´ë“œ ê´€ë ¨ ìƒíƒœ ë° í•¨ìˆ˜ ê°€ì ¸ì˜¤ê¸°
39 |   const cards = useAppStore(state => state.cards);
40 |   const setCards = useAppStore(state => state.setCards);
41 |   
42 |   /**
43 |    * ì¹´ë“œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
44 |    * @param params ì„ íƒì  ê²€ìƒ‰ ë§¤ê°œë³€ìˆ˜
45 |    */
46 |   const loadCards = useCallback(async (params?: {
47 |     userId?: string;
48 |     q?: string;
49 |     tag?: string;
50 |   }) => {
51 |     try {
52 |       setIsLoading(true);
53 |       setError(null);
54 |       
55 |       // URL ë§¤ê°œë³€ìˆ˜ êµ¬ì„±
56 |       const searchParams = new URLSearchParams();
57 |       
58 |       // ê¸°ë³¸ ì˜µì…˜ê³¼ ë§¤ê°œë³€ìˆ˜ ë³‘í•©
59 |       const userId = params?.userId || null;
60 |       const q = params?.q || searchQuery || null;
61 |       const tag = params?.tag || tagFilter || null;
62 |       
63 |       // ì„ íƒì  ë§¤ê°œë³€ìˆ˜ ì¶”ê°€
64 |       if (userId) searchParams.append('userId', userId);
65 |       if (q) searchParams.append('q', q);
66 |       if (tag) searchParams.append('tag', tag);
67 |       
68 |       // ì—”ë“œí¬ì¸íŠ¸ êµ¬ì„±
69 |       const queryString = searchParams.toString();
[TRUNCATED]
```

src/hooks/useCardMutations.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useCardMutations.ts
3 |  * ëª©ì : ì¹´ë“œ ìƒì„±, ìˆ˜ì •, ì‚­ì œë¥¼ ìœ„í•œ React Query mutation í›… ì œê³µ
4 |  * ì—­í• : ì¹´ë“œ ê´€ë ¨ ë°ì´í„° ë³€ê²½ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í›… êµ¬í˜„
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { useMutation, useQueryClient } from '@tanstack/react-query';
9 | import { toast } from 'sonner';
10 | import { Card } from '../types/card';
11 | 
12 | interface CreateCardData {
13 |   title: string;
14 |   content?: string;
15 |   tags?: string[];
16 |   x?: number;
17 |   y?: number;
18 | }
19 | 
20 | interface UpdateCardData {
21 |   id: string;
22 |   title?: string;
23 |   content?: string;
24 |   tags?: string[];
25 | }
26 | 
27 | /**
28 |  * createCard: ìƒˆ ì¹´ë“œë¥¼ ìƒì„±í•˜ëŠ” API í˜¸ì¶œ í•¨ìˆ˜
29 |  * @param {CreateCardData} cardData - ìƒì„±í•  ì¹´ë“œ ë°ì´í„°
30 |  * @returns {Promise<Card>} ìƒì„±ëœ ì¹´ë“œ ê°ì²´
31 |  */
32 | const createCard = async (cardData: CreateCardData): Promise<Card> => {
33 |   const response = await fetch('/api/cards', {
34 |     method: 'POST',
35 |     headers: {
36 |       'Content-Type': 'application/json',
37 |     },
38 |     body: JSON.stringify(cardData),
39 |   });
40 | 
41 |   if (!response.ok) {
42 |     const errorData = await response.text();
43 |     throw new Error(errorData || 'ì¹´ë“œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
44 |   }
45 | 
46 |   return response.json();
47 | };
48 | 
49 | /**
50 |  * useCreateCard: ì¹´ë“œ ìƒì„±ì„ ìœ„í•œ mutation í›…
51 |  * @returns {UseMutationResult} ì¹´ë“œ ìƒì„± mutation ê²°ê³¼
52 |  */
53 | export function useCreateCard() {
54 |   const queryClient = useQueryClient();
55 |   
56 |   return useMutation({
57 |     mutationFn: createCard,
58 |     onSuccess: (data) => {
59 |       // ìºì‹œ ë¬´íš¨í™”
60 |       queryClient.invalidateQueries({ queryKey: ['cards'] });
61 |       toast.success('ì¹´ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
62 |       return data;
63 |     },
64 |     onError: (error: Error) => {
65 |       toast.error(`ì¹´ë“œ ìƒì„± ì‹¤íŒ¨: ${error.message}`);
66 |     },
67 |   });
68 | }
69 | 
70 | /**
71 |  * updateCard: ì¹´ë“œë¥¼ ìˆ˜ì •í•˜ëŠ” API í˜¸ì¶œ í•¨ìˆ˜
72 |  * @param {UpdateCardData} cardData - ìˆ˜ì •í•  ì¹´ë“œ ë°ì´í„°
73 |  * @returns {Promise<Card>} ìˆ˜ì •ëœ ì¹´ë“œ ê°ì²´
74 |  */
75 | const updateCard = async (cardData: UpdateCardData): Promise<Card> => {
76 |   const { id, ...data } = cardData;
77 |   
78 |   const response = await fetch(`/api/cards/${id}`, {
79 |     method: 'PATCH',
80 |     headers: {
[TRUNCATED]
```

src/hooks/useCards.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useCards.test.tsx
3 |  * ëª©ì : useCards í›…ì˜ í…ŒìŠ¤íŠ¸ íŒŒì¼
4 |  * ì—­í• : ì¹´ë“œ ëª©ë¡ ì¡°íšŒ í›…ì˜ ê¸°ëŠ¥ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { afterAll, afterEach, beforeAll, describe, expect, it, vi } from 'vitest';
9 | import { renderHook, waitFor } from '@testing-library/react';
10 | import { http, HttpResponse, delay } from 'msw';
11 | import { setupServer } from 'msw/node';
12 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
13 | import React, { ReactNode } from 'react';
14 | import { useCards } from '../hooks/useCards';
15 | import { Card } from '../types/card';
16 | 
17 | // í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°
18 | const mockCards: Card[] = [
19 |     {
20 |         id: '1',
21 |         title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ 1',
22 |         content: 'ì²« ë²ˆì§¸ ì¹´ë“œ ë‚´ìš©',
23 |         createdAt: new Date().toISOString(),
24 |         updatedAt: new Date().toISOString(),
25 |         userId: 'user1',
26 |         tags: [{ id: 'tag1', name: 'íƒœê·¸1' }],
27 |         user: { id: 'user1', name: 'ì‚¬ìš©ì1', email: 'user1@example.com' }
28 |     },
29 |     {
30 |         id: '2',
31 |         title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ 2',
32 |         content: 'ë‘ ë²ˆì§¸ ì¹´ë“œ ë‚´ìš©',
33 |         createdAt: new Date().toISOString(),
34 |         updatedAt: new Date().toISOString(),
35 |         userId: 'user2',
36 |         tags: [{ id: 'tag2', name: 'íƒœê·¸2' }],
37 |         user: { id: 'user2', name: 'ì‚¬ìš©ì2', email: 'user2@example.com' }
38 |     }
39 | ];
40 | 
41 | // MSW ì„œë²„ ì„¤ì •
42 | const server = setupServer(
43 |     // ëª¨ë“  ì¹´ë“œ ì¡°íšŒ í•¸ë“¤ëŸ¬
44 |     http.get('/api/cards', async () => {
45 |         await delay(100);
46 |         return HttpResponse.json(mockCards);
47 |     }),
48 | 
49 |     // ê²€ìƒ‰ì–´ë¡œ í•„í„°ë§ëœ ì¹´ë“œ ì¡°íšŒ í•¸ë“¤ëŸ¬
50 |     http.get('/api/cards', async ({ request }) => {
51 |         const url = new URL(request.url);
52 |         const query = url.searchParams.get('q');
53 | 
54 |         if (query === 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ 1') {
55 |             await delay(100);
56 |             return HttpResponse.json([mockCards[0]]);
57 |         }
58 | 
59 |         return HttpResponse.json(mockCards);
60 |     }, { path: '/api/cards?q=:query' }),
61 | 
62 |     // íƒœê·¸ë¡œ í•„í„°ë§ëœ ì¹´ë“œ ì¡°íšŒ í•¸ë“¤ëŸ¬
63 |     http.get('/api/cards', async ({ request }) => {
64 |         const url = new URL(request.url);
65 |         const tag = url.searchParams.get('tag');
66 | 
67 |         if (tag === 'íƒœê·¸1') {
[TRUNCATED]
```

src/hooks/useCards.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useCards.ts
3 |  * ëª©ì : ì¹´ë“œ ëª©ë¡ ì¡°íšŒë¥¼ ìœ„í•œ React Query í›…
4 |  * ì—­í• : ì¹´ë“œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³  ìºì‹±í•˜ëŠ” React Query í›… ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { useQuery } from '@tanstack/react-query';
9 | import { fetchCards } from '../services/cardService';
10 | import { Card } from '../types/card';
11 | 
12 | export interface CardQueryParams {
13 |   q?: string;
14 |   tag?: string;
15 |   userId?: string;
16 |   error?: string; // í…ŒìŠ¤íŠ¸ìš© íŒŒë¼ë¯¸í„°
17 | }
18 | 
19 | /**
20 |  * useCards: ì¹´ë“œ ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” React Query í›…
21 |  * @param params - ì¡°íšŒ íŒŒë¼ë¯¸í„° (ê²€ìƒ‰ì–´, íƒœê·¸, ì‚¬ìš©ì ID)
22 |  * @returns React Query ê²°ê³¼ (ë°ì´í„°, ë¡œë”© ìƒíƒœ, ì—ëŸ¬ ë“±)
23 |  */
24 | export function useCards(params?: CardQueryParams) {
25 |   return useQuery<Card[], Error>({
26 |     queryKey: ['cards', params],
27 |     queryFn: () => fetchCards({ 
28 |       q: params?.q, 
29 |       tag: params?.tag, 
30 |       userId: params?.userId 
31 |     }),
32 |     staleTime: 1000 * 60 * 5, // 5ë¶„
33 |     gcTime: 1000 * 60 * 10, // 10ë¶„
34 |   });
35 | } 
```

src/hooks/useCreateCard.test.tsx
```
1 | // src/hooks/useCreateCard.test.tsx
2 | import React from 'react';
3 | import { http } from 'msw';
4 | import { setupServer } from 'msw/node';
5 | import { renderHook, waitFor } from '@testing-library/react';
6 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
7 | import { useCreateCard } from './useCreateCard';
8 | import { vi } from 'vitest';
9 | import { CreateCardInput, Card } from '../types/card';
10 | 
11 | // MSW ì„œë²„ë¥¼ í…ŒìŠ¤íŠ¸ íŒŒì¼ ë‚´ì—ì„œ ì§ì ‘ ì„¤ì •
12 | const server = setupServer();
13 | 
14 | describe('@tanstack-mutation-msw useCreateCard', () => {
15 |     // í…ŒìŠ¤íŠ¸ ì „í›„ ì„œë²„ ë¼ì´í”„ì‚¬ì´í´
16 |     beforeAll(() => server.listen());
17 |     afterEach(() => server.resetHandlers());
18 |     afterAll(() => server.close());
19 | 
20 |     // QueryClient Provider wrapper ìƒì„± í—¬í¼
21 |     const createWrapper = (qc: QueryClient) => ({ children }: { children: React.ReactNode }) => (
22 |         <QueryClientProvider client={qc}>{children}</QueryClientProvider>
23 |     );
24 | 
25 |     it('ì„±ê³µ ì‹œ invalidateQueries í˜¸ì¶œ ë° ë°ì´í„° ë°˜í™˜', async () => {
26 |         // MSW v2: http.post ì‚¬ìš©
27 |         const mockCard: Card = {
28 |             id: 'test-1',
29 |             title: 'Title',
30 |             content: 'Content',
31 |             createdAt: new Date().toISOString(),
32 |             updatedAt: new Date().toISOString(),
33 |             userId: 'user-1',
34 |         };
35 |         server.use(
36 |             http.post('/api/cards', (req, res, ctx) => res(ctx.status(201), ctx.json(mockCard)))
37 |         );
38 | 
39 |         // ì‹¤ì œ QueryClient + spy
40 |         const qc = new QueryClient({ defaultOptions: { queries: { retry: false }, mutations: { retry: false } } });
41 |         const invalidateSpy = vi.spyOn(qc, 'invalidateQueries');
42 |         const wrapper = createWrapper(qc);
43 | 
44 |         // í›… ì‹¤í–‰ ë° mutateAsync í˜¸ì¶œ
45 |         const { result } = renderHook(() => useCreateCard(), { wrapper });
46 |         const input: CreateCardInput = { title: 'Title', content: 'Content', userId: 'user-1' };
47 |         await result.current.mutateAsync(input);
48 | 
49 |         // onSuccess ì²˜ë¦¬ ê¸°ë‹¤ë¦¬ê¸°
50 |         await waitFor(() => expect(result.current.isSuccess).toBe(true));
51 | 
52 |         // ë°ì´í„° ë°˜í™˜ ë° invalidate í˜¸ì¶œ ê²€ì¦
53 |         expect(result.current.data).toEqual(mockCard);
54 |         expect(invalidateSpy).toHaveBeenCalledWith({ queryKey: ['cards'] });
55 |     });
56 | 
57 |     it('ì‹¤íŒ¨ ì‹œ isError í”Œë˜ê·¸ í™œì„±í™”', async () => {
58 |         server.use(
59 |             http.post('/api/cards', (req, res, ctx) => res(ctx.status(500)))
60 |         );
61 | 
[TRUNCATED]
```

src/hooks/useCreateCard.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useCreateCard.ts
3 |  * ëª©ì : ì¹´ë“œ ìƒì„±ì„ ìœ„í•œ Mutation í›…
4 |  * ì—­í• : React Query useMutationì„ ì‚¬ìš©í•˜ì—¬ ì¹´ë“œ ìƒì„± ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : MSW í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì§ì ‘ fetch API ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
7 |  */
8 | 
9 | import { useMutation, useQueryClient, UseMutationResult } from '@tanstack/react-query';
10 | import { Card, CreateCardInput as CardInput } from '../types/card';
11 | 
12 | /**
13 |  * createCardAPI: ì§ì ‘ API í˜¸ì¶œì„ êµ¬í˜„í•œ í•¨ìˆ˜
14 |  * @param {CardInput | CardInput[]} input - ìƒì„±í•  ì¹´ë“œ ë°ì´í„°(ë‹¨ì¼ ë˜ëŠ” ë°°ì—´)
15 |  * @returns {Promise<Card[]>} ìƒì„±ëœ ì¹´ë“œ ì •ë³´ ë°°ì—´
16 |  */
17 | async function createCardAPI(input: CardInput | CardInput[]): Promise<Card[]> {
18 |   const response = await fetch('/api/cards', {
19 |     method: 'POST',
20 |     headers: {
21 |       'Content-Type': 'application/json',
22 |     },
23 |     body: JSON.stringify(input),
24 |   });
25 |   
26 |   if (!response.ok) {
27 |     const error = await response.json();
28 |     throw new Error(error.error || 'ì¹´ë“œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
29 |   }
30 |   
31 |   return await response.json();
32 | }
33 | 
34 | /**
35 |  * useCreateCard: ì¹´ë“œ ìƒì„±ì„ ìœ„í•œ Mutation í›…
36 |  * @returns {UseMutationResult<Card[], Error, CardInput | CardInput[]>} ì¹´ë“œ ìƒì„± mutation ê²°ê³¼
37 |  */
38 | export function useCreateCard(): UseMutationResult<Card[], Error, CardInput | CardInput[]> {
39 |   const queryClient = useQueryClient();
40 |   
41 |   return useMutation({
42 |     mutationFn: (payload) => createCardAPI(payload),
43 |     onSuccess: () => {
44 |       queryClient.invalidateQueries({ queryKey: ['cards'] });
45 |     }
46 |   });
47 | } 
```

src/hooks/useCreateTag.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useCreateTag.test.tsx
3 |  * ëª©ì : useCreateTag í›… í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : íƒœê·¸ ìƒì„± ë®¤í…Œì´ì…˜ í›…ì˜ ë™ì‘ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * @rule   three-layer-standard
7 |  * @layer  tanstack-query-hook
8 |  * @tag    @tanstack-mutation-msw useCreateTag
9 |  */
10 | 
11 | import { describe, it, expect, beforeAll, afterEach, afterAll, vi } from 'vitest';
12 | import { renderHook, waitFor, act } from '@testing-library/react';
13 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
14 | import { http, HttpResponse } from 'msw';
15 | import { setupServer } from 'msw/node';
16 | 
17 | import { useCreateTag } from './useCreateTag';
18 | import { Tag, TagInput } from '@/services/tagService';
19 | 
20 | // í…ŒìŠ¤íŠ¸ìš© íƒœê·¸ ë°ì´í„°
21 | const mockTagInput: TagInput = { name: 'ìƒˆ íƒœê·¸' };
22 | const mockCreatedTag: Tag = {
23 |     id: 'new-tag-123',
24 |     name: 'ìƒˆ íƒœê·¸',
25 |     count: 0,
26 |     createdAt: '2025-04-21T00:00:00Z'
27 | };
28 | 
29 | // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ QueryClient ìƒì„±
30 | const createTestQueryClient = () => new QueryClient({
31 |     defaultOptions: {
32 |         queries: {
33 |             retry: false,
34 |             gcTime: Infinity,
35 |         },
36 |         mutations: {
37 |             retry: false,
38 |         },
39 |     },
40 | });
41 | 
42 | // í…ŒìŠ¤íŠ¸ìš© QueryClient Provider
43 | const createWrapper = () => {
44 |     const testQueryClient = createTestQueryClient();
45 |     return ({ children }: { children: React.ReactNode }) => (
46 |         <QueryClientProvider client={testQueryClient}>
47 |             {children}
48 |         </QueryClientProvider>
49 |     );
50 | };
51 | 
52 | // MSW í…ŒìŠ¤íŠ¸ ì„œë²„ ì„¤ì •
53 | const server = setupServer(
54 |     // íƒœê·¸ ìƒì„± API í•¸ë“¤ëŸ¬
55 |     http.post('/api/tags', async () => {
56 |         return HttpResponse.json(mockCreatedTag, { status: 201 });
57 |     })
58 | );
59 | 
60 | describe('useCreateTag í›…', () => {
61 |     beforeAll(() => server.listen());
62 |     afterEach(() => server.resetHandlers());
63 |     afterAll(() => server.close());
64 | 
65 |     it('íƒœê·¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ìƒì„±í•˜ê³  íƒœê·¸ ëª©ë¡ ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™”í•œë‹¤', async () => {
66 |         const wrapper = createWrapper();
67 | 
68 |         // invalidateQueries ìŠ¤íŒŒì´ ìƒì„±
69 |         const invalidateQueriesSpy = vi.fn();
70 |         const queryClient = createTestQueryClient();
71 |         queryClient.invalidateQueries = invalidateQueriesSpy;
72 | 
73 |         const { result } = renderHook(() => useCreateTag(), {
74 |             wrapper: ({ children }) => (
75 |                 <QueryClientProvider client={queryClient}>
[TRUNCATED]
```

src/hooks/useCreateTag.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useCreateTag.ts
3 |  * ëª©ì : íƒœê·¸ ìƒì„± React Query Mutation í›…
4 |  * ì—­í• : ìƒˆ íƒœê·¸ë¥¼ ìƒì„±í•˜ê³  íƒœê·¸ ëª©ë¡ ìºì‹œë¥¼ ë¬´íš¨í™”í•˜ëŠ” ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * @rule   three-layer-standard
7 |  * @layer  tanstack-query-hook
8 |  * @tag    @tanstack-mutation-msw useCreateTag
9 |  */
10 | 
11 | import { useMutation, useQueryClient, UseMutationResult } from '@tanstack/react-query';
12 | import { createTagAPI, Tag, TagInput } from '@/services/tagService';
13 | 
14 | /**
15 |  * useCreateTag: ìƒˆ íƒœê·¸ë¥¼ ìƒì„±í•˜ëŠ” ë®¤í…Œì´ì…˜ í›…
16 |  * @returns UseMutationResult ê°ì²´ (mutate, status, error ë“± í¬í•¨)
17 |  */
18 | export function useCreateTag(): UseMutationResult<Tag, Error, TagInput> {
19 |   const queryClient = useQueryClient();
20 | 
21 |   return useMutation({
22 |     mutationKey: ['createTag'],
23 |     mutationFn: (tagInput: TagInput) => createTagAPI(tagInput),
24 |     onSuccess: () => {
25 |       // íƒœê·¸ ëª©ë¡ ì¿¼ë¦¬ ë¬´íš¨í™” â†’ ëª©ë¡ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
26 |       queryClient.invalidateQueries({ queryKey: ['tags'] });
27 |     }
28 |   });
29 | } 
```

src/hooks/useDeleteCard.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: useDeleteCard.ts
3 |  * ëª©ì : ì¹´ë“œ ì‚­ì œë¥¼ ìœ„í•œ React Query Mutation í›… êµ¬í˜„
4 |  * ì—­í• : ë‹¨ì¼ ì¹´ë“œ ì‚­ì œ API í˜¸ì¶œê³¼ ê´€ë ¨ ì¿¼ë¦¬ ìºì‹œ ë¬´íš¨í™” ì²˜ë¦¬
5 |  * ì‘ì„±ì¼: 2023-05-11
6 |  */
7 | 
8 | import { useMutation, useQueryClient, UseMutationResult } from '@tanstack/react-query';
9 | import { deleteCardAPI } from '@/services/cardService';
10 | 
11 | /**
12 |  * useDeleteCard: ë‹¨ì¼ ì¹´ë“œ ì‚­ì œë¥¼ ìœ„í•œ mutation í›…
13 |  * @param {string} cardId - ì‚­ì œí•  ì¹´ë“œì˜ ID
14 |  * @returns {UseMutationResult<void, Error, void>} - mutation ê²°ê³¼ ê°ì²´
15 |  */
16 | export function useDeleteCard(cardId: string): UseMutationResult<void, Error, void> {
17 |   const queryClient = useQueryClient();
18 |   
19 |   return useMutation({
20 |     mutationKey: ['deleteCard', cardId],
21 |     mutationFn: () => deleteCardAPI(cardId),
22 |     onSuccess: () => {
23 |       // ì¹´ë“œ ëª©ë¡ ì¿¼ë¦¬ ìºì‹œ ë¬´íš¨í™”
24 |       queryClient.invalidateQueries({ queryKey: ['cards'] });
25 |       
26 |       // í•´ë‹¹ ì¹´ë“œì˜ ìƒì„¸ ì •ë³´ ì¿¼ë¦¬ ìºì‹œ ì œê±°
27 |       queryClient.removeQueries({ queryKey: ['card', cardId] });
28 |     },
29 |   });
30 | } 
```

src/hooks/useDeleteTag.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useDeleteTag.test.tsx
3 |  * ëª©ì : useDeleteTag í›… í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : íƒœê·¸ ì‚­ì œ ë®¤í…Œì´ì…˜ í›…ì˜ ë™ì‘ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * @rule   three-layer-standard
7 |  * @layer  tanstack-query-hook
8 |  * @tag    @tanstack-mutation-msw useDeleteTag
9 |  */
10 | 
11 | import { describe, it, expect, beforeAll, afterEach, afterAll, vi } from 'vitest';
12 | import { renderHook, waitFor, act } from '@testing-library/react';
13 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
14 | import { http, HttpResponse } from 'msw';
15 | import { setupServer } from 'msw/node';
16 | 
17 | import { useDeleteTag } from './useDeleteTag';
18 | 
19 | // í…ŒìŠ¤íŠ¸ìš© íƒœê·¸ ID
20 | const mockTagId = 'tag-123';
21 | 
22 | // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ QueryClient ìƒì„±
23 | const createTestQueryClient = () => new QueryClient({
24 |     defaultOptions: {
25 |         queries: {
26 |             retry: false,
27 |             gcTime: Infinity,
28 |         },
29 |         mutations: {
30 |             retry: false,
31 |         },
32 |     },
33 | });
34 | 
35 | // í…ŒìŠ¤íŠ¸ìš© QueryClient Provider
36 | const createWrapper = () => {
37 |     const testQueryClient = createTestQueryClient();
38 |     return ({ children }: { children: React.ReactNode }) => (
39 |         <QueryClientProvider client={testQueryClient}>
40 |             {children}
41 |         </QueryClientProvider>
42 |     );
43 | };
44 | 
45 | // MSW í…ŒìŠ¤íŠ¸ ì„œë²„ ì„¤ì •
46 | const server = setupServer(
47 |     // íƒœê·¸ ì‚­ì œ API í•¸ë“¤ëŸ¬
48 |     http.delete(`/api/tags/${mockTagId}`, () => {
49 |         return new HttpResponse(null, { status: 204 });
50 |     })
51 | );
52 | 
53 | describe('useDeleteTag í›…', () => {
54 |     beforeAll(() => server.listen());
55 |     afterEach(() => server.resetHandlers());
56 |     afterAll(() => server.close());
57 | 
58 |     it('íƒœê·¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œí•˜ê³  íƒœê·¸ ëª©ë¡ ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™”í•œë‹¤', async () => {
59 |         // invalidateQueries ìŠ¤íŒŒì´ ìƒì„±
60 |         const invalidateQueriesSpy = vi.fn();
61 |         const queryClient = createTestQueryClient();
62 |         queryClient.invalidateQueries = invalidateQueriesSpy;
63 | 
64 |         const { result } = renderHook(() => useDeleteTag(), {
65 |             wrapper: ({ children }) => (
66 |                 <QueryClientProvider client={queryClient}>
67 |                     {children}
68 |                 </QueryClientProvider>
69 |             ),
70 |         });
71 | 
72 |         // ì´ˆê¸° ìƒíƒœ í™•ì¸
73 |         expect(result.current.isPending).toBe(false);
74 |         expect(result.current.isSuccess).toBe(false);
75 | 
76 |         // mutate í•¨ìˆ˜ í˜¸ì¶œ
77 |         act(() => {
[TRUNCATED]
```

src/hooks/useDeleteTag.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useDeleteTag.ts
3 |  * ëª©ì : íƒœê·¸ ì‚­ì œ React Query Mutation í›…
4 |  * ì—­í• : íƒœê·¸ë¥¼ ì‚­ì œí•˜ê³  íƒœê·¸ ëª©ë¡ ìºì‹œë¥¼ ë¬´íš¨í™”í•˜ëŠ” ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * @rule   three-layer-standard
7 |  * @layer  tanstack-query-hook
8 |  * @tag    @tanstack-mutation-msw useDeleteTag
9 |  */
10 | 
11 | import { useMutation, useQueryClient, UseMutationResult } from '@tanstack/react-query';
12 | import { deleteTagAPI } from '@/services/tagService';
13 | 
14 | /**
15 |  * useDeleteTag: íƒœê·¸ë¥¼ ì‚­ì œí•˜ëŠ” ë®¤í…Œì´ì…˜ í›…
16 |  * @returns UseMutationResult ê°ì²´ (mutate, status, error ë“± í¬í•¨)
17 |  */
18 | export function useDeleteTag(): UseMutationResult<void, Error, string> {
19 |   const queryClient = useQueryClient();
20 | 
21 |   return useMutation({
22 |     mutationKey: ['deleteTag'],
23 |     mutationFn: (tagId: string) => deleteTagAPI(tagId),
24 |     onSuccess: () => {
25 |       // íƒœê·¸ ëª©ë¡ ì¿¼ë¦¬ ë¬´íš¨í™” â†’ ëª©ë¡ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
26 |       queryClient.invalidateQueries({ queryKey: ['tags'] });
27 |     }
28 |   });
29 | } 
```

src/hooks/useIdeaMapInteractions.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useIdeaMapInteractions.ts
3 |  * ëª©ì : IdeaMap(React Flow) ìƒí˜¸ì‘ìš© ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì œê³µ
4 |  * ì—­í• : IdeaMapì—ì„œ ë°œìƒí•˜ëŠ” ê°ì¢… ì´ë²¤íŠ¸(ë…¸ë“œ í´ë¦­, ë°°ê²½ í´ë¦­, ë“œë˜ê·¸&ë“œë¡­, ì—£ì§€ ì—°ê²° ë“±)ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤ì„ í†µí•© ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { MouseEvent, DragEvent, useCallback } from 'react';
9 | import { useAppStore } from '@/store/useAppStore';
10 | import { useCreateCard } from '@/hooks/useCardMutations';
11 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
12 | import { 
13 |   Node, 
14 |   Edge, 
15 |   Connection, 
16 |   useReactFlow,
17 |   addEdge,
18 |   XYPosition,
19 |   ReactFlowInstance
20 | } from '@xyflow/react';
21 | 
22 | // íƒ€ì… ì •ì˜
23 | type NodeMouseHandler = (event: MouseEvent, node: Node) => void;
24 | type PaneMouseEvent = MouseEvent<Element, globalThis.MouseEvent>;
25 | type NodeDragHandler = (event: MouseEvent, node: Node, nodes: Node[]) => void;
26 | 
27 | /**
28 |  * useIdeaMapInteractions: IdeaMap(React Flow) ìƒí˜¸ì‘ìš©ì„ ìœ„í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ëª¨ìŒì„ ì œê³µí•˜ëŠ” í›…
29 |  * @returns {Object} ë‹¤ì–‘í•œ React Flow ì´ë²¤íŠ¸ì— ëŒ€ì‘í•˜ëŠ” í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
30 |  */
31 | export function useIdeaMapInteractions() {
32 |   // AppStoreì—ì„œ ì¹´ë“œ ì„ íƒ ê´€ë ¨ ì•¡ì…˜ ê°€ì ¸ì˜¤ê¸°
33 |   const selectCards = useAppStore(state => state.selectCards);
34 |   const toggleSelectedCard = useAppStore(state => state.toggleSelectedCard);
35 |   const clearSelectedCards = useAppStore(state => state.clearSelectedCards);
36 |   
37 |   // ì¹´ë“œ ìƒì„± ë®¤í…Œì´ì…˜
38 |   const { mutate: createCard } = useCreateCard();
39 |   
40 |   // IdeaMapStoreì—ì„œ ì—£ì§€ ê´€ë ¨ ì•¡ì…˜ ê°€ì ¸ì˜¤ê¸°
41 |   const setEdges = useIdeaMapStore(state => state.setEdges);
42 |   const edges = useIdeaMapStore(state => state.edges);
43 |   
44 |   // ReactFlow ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸° (ë·°í¬íŠ¸ ë³€í™˜, ë…¸ë“œ ìœ„ì¹˜ ê³„ì‚° ë“±ì— í•„ìš”)
45 |   const reactFlowInstance = useReactFlow();
46 | 
47 |   /**
48 |    * onNodeClick: ë…¸ë“œ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
49 |    * @param {MouseEvent} event - ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
50 |    * @param {Node} node - í´ë¦­ëœ ë…¸ë“œ
51 |    */
52 |   const onNodeClick: NodeMouseHandler = useCallback((event, node) => {
53 |     event.stopPropagation(); // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
54 |     
55 |     // Ctrl/Command ë˜ëŠ” Shift í‚¤ì™€ í•¨ê»˜ í´ë¦­í•˜ë©´ ë‹¤ì¤‘ ì„ íƒ í† ê¸€
56 |     if (event.ctrlKey || event.metaKey || event.shiftKey) {
57 |       toggleSelectedCard(node.id);
58 |     } else {
59 |       // ì¼ë°˜ í´ë¦­ì€ ë‹¨ì¼ ì„ íƒ
60 |       selectCards([node.id]);
61 |     }
62 |   }, [selectCards, toggleSelectedCard]);
63 | 
64 |   /**
[TRUNCATED]
```

src/hooks/useIdeaMapLayout.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useIdeaMapLayout.ts
3 |  * ëª©ì : IdeaMap ë ˆì´ì•„ì›ƒ ê´€ë¦¬ ë° ì €ì¥ ê¸°ëŠ¥ ì œê³µ
4 |  * ì—­í• : ë…¸ë“œ ë°°ì¹˜, ë ˆì´ì•„ì›ƒ ë³€ê²½, ë¡œì»¬ ì €ì¥ì†Œ ê´€ë¦¬ ë“± IdeaMapì˜ ë ˆì´ì•„ì›ƒ ê´€ë ¨ ê¸°ëŠ¥ í†µí•© ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { useCallback, useRef } from 'react';
9 | import { 
10 |   Node, 
11 |   Edge, 
12 |   useReactFlow,
13 |   Viewport
14 | } from '@xyflow/react';
15 | import { toast } from 'sonner';
16 | 
17 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
18 | import { getGridLayout, getLayoutedElements } from '@/lib/layout-utils';
19 | import { IDEAMAP_TRANSFORM_STORAGE_KEY } from '@/lib/ideamap-constants';
20 | import { CardData } from '@/components/ideamap/types/ideamap-types';
21 | 
22 | /**
23 |  * useIdeaMapLayout: IdeaMap ë ˆì´ì•„ì›ƒ ê´€ë ¨ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í›…
24 |  * @param {React.RefObject<HTMLDivElement>} reactFlowWrapper - ReactFlowë¥¼ ê°ì‹¸ëŠ” div ìš”ì†Œì˜ ref
25 |  * @returns ë ˆì´ì•„ì›ƒ ê´€ë ¨ í•¨ìˆ˜ë“¤
26 |  */
27 | export function useIdeaMapLayout(reactFlowWrapper: React.RefObject<HTMLDivElement>) {
28 |   // ë³€ê²½ ì‚¬í•­ ì¶”ì ì„ ìœ„í•œ ref
29 |   const hasUnsavedChanges = useRef(false);
30 |   
31 |   // ReactFlow ì¸ìŠ¤í„´ìŠ¤
32 |   const reactFlowInstance = useReactFlow();
33 |   
34 |   // IdeaMapStoreì—ì„œ í•„ìš”í•œ ìƒíƒœì™€ í•¨ìˆ˜ ê°€ì ¸ì˜¤ê¸°
35 |   const nodes = useIdeaMapStore(state => state.nodes);
36 |   const edges = useIdeaMapStore(state => state.edges);
37 |   const setNodes = useIdeaMapStore(state => state.setNodes);
38 |   const setEdges = useIdeaMapStore(state => state.setEdges);
39 |   const saveLayout = useIdeaMapStore(state => state.saveLayout);
40 |   const saveEdges = useIdeaMapStore(state => state.saveEdges);
41 |   const setViewport = useIdeaMapStore(state => state.setViewport);
42 |   const saveViewport = useIdeaMapStore(state => state.saveViewport);
43 |   const restoreViewport = useIdeaMapStore(state => state.restoreViewport);
44 | 
45 |   /**
46 |    * ë·°í¬íŠ¸ ì €ì¥ í•¨ìˆ˜
47 |    * @returns {boolean} ì €ì¥ ì„±ê³µ ì—¬ë¶€
48 |    */
49 |   const saveTransform = useCallback(() => {
50 |     if (!reactFlowInstance) {
51 |       console.error('[useIdeaMapLayout] ë·°í¬íŠ¸ ì €ì¥ ì‹¤íŒ¨: ReactFlow ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ìŒ');
52 |       return false;
53 |     }
54 |     
55 |     try {
56 |       // í˜„ì¬ ë·°í¬íŠ¸ ê°€ì ¸ì˜¤ê¸°
57 |       const viewport = reactFlowInstance.getViewport();
58 |       
59 |       // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
60 |       localStorage.setItem(IDEAMAP_TRANSFORM_STORAGE_KEY, JSON.stringify(viewport));
61 |       
62 |       // ìƒíƒœ ì—…ë°ì´íŠ¸
63 |       setViewport(viewport);
64 |       
65 |       console.log('[useIdeaMapLayout] ë·°í¬íŠ¸ ì €ì¥ ì™„ë£Œ:', viewport);
[TRUNCATED]
```

src/hooks/useIdeaMapSettings.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useIdeaMapSettings.ts
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ ì„¤ì • ê´€ë ¨ React Query í›… ì œê³µ
4 |  * ì—­í• : ì„œë²„ ìƒíƒœë¡œì„œì˜ ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ê´€ë¦¬í•˜ëŠ” í›… ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
9 | 
10 | import { IdeaMapSettings, DEFAULT_IDEAMAP_SETTINGS } from '@/lib/ideamap-utils';
11 | import * as ideaMapSettingsService from '@/services/ideaMapSettingsService';
12 | 
13 | /**
14 |  * useIdeaMapSettings: ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ê°€ì ¸ì˜¤ëŠ” ì¿¼ë¦¬ í›…
15 |  * @param {string} userId - ì‚¬ìš©ì ID
16 |  * @returns {Object} ì„¤ì • ë°ì´í„°ì™€ ë¡œë”© ìƒíƒœë¥¼ í¬í•¨í•œ ê°ì²´
17 |  */
18 | export const useIdeaMapSettings = (userId: string) => {
19 |   return useQuery({
20 |     queryKey: ['ideaMapSettings', userId],
21 |     queryFn: () => ideaMapSettingsService.fetchIdeaMapSettings(userId),
22 |     enabled: !!userId,
23 |     staleTime: 1000 * 60 * 5, // 5ë¶„ ë™ì•ˆ ë°ì´í„°ë¥¼ ì‹ ì„ í•˜ê²Œ ìœ ì§€
24 |     initialData: DEFAULT_IDEAMAP_SETTINGS,
25 |   });
26 | };
27 | 
28 | /**
29 |  * useUpdateIdeaMapSettingsMutation: ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë®¤í…Œì´ì…˜ í›…
30 |  * @returns {Object} mutate í•¨ìˆ˜ì™€ ìƒíƒœë¥¼ í¬í•¨í•œ ê°ì²´
31 |  */
32 | export const useUpdateIdeaMapSettingsMutation = () => {
33 |   const queryClient = useQueryClient();
34 |   
35 |   return useMutation({
36 |     mutationFn: ({ 
37 |       userId, 
38 |       settings 
39 |     }: { 
40 |       userId: string; 
41 |       settings: Partial<IdeaMapSettings>; 
42 |     }) => 
43 |       ideaMapSettingsService.updateIdeaMapSettings(userId, settings),
44 |     onSuccess: (data, variables) => {
45 |       const { userId } = variables;
46 |       
47 |       // ì¿¼ë¦¬ ìºì‹œ ë¬´íš¨í™”
48 |       queryClient.invalidateQueries({ 
49 |         queryKey: ['ideaMapSettings', userId] 
50 |       });
51 |       
52 |       // ë¡œì»¬ ìºì‹œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸
53 |       queryClient.setQueryData(['ideaMapSettings', userId], (oldData: any) => {
54 |         if (!oldData) return data;
55 |         return { ...oldData, ...variables.settings };
56 |       });
57 |     },
58 |   });
59 | };
60 | 
61 | /**
62 |  * useCreateIdeaMapSettingsMutation: ìƒˆ ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ìƒì„±í•˜ëŠ” ë®¤í…Œì´ì…˜ í›…
63 |  * @returns {Object} mutate í•¨ìˆ˜ì™€ ìƒíƒœë¥¼ í¬í•¨í•œ ê°ì²´
64 |  */
65 | export const useCreateIdeaMapSettingsMutation = () => {
66 |   const queryClient = useQueryClient();
67 |   
68 |   return useMutation({
69 |     mutationFn: ({ 
70 |       userId, 
71 |       settings 
72 |     }: { 
73 |       userId: string; 
74 |       settings: IdeaMapSettings; 
75 |     }) => 
76 |       ideaMapSettingsService.createIdeaMapSettings(userId, settings),
77 |     onSuccess: (data, variables) => {
78 |       const { userId } = variables;
79 |       queryClient.invalidateQueries({ 
80 |         queryKey: ['ideaMapSettings', userId] 
81 |       });
82 |     },
83 |   });
[TRUNCATED]
```

src/hooks/useResizable.ts
```
1 | import { useState, useEffect, useRef } from 'react';
2 | 
3 | interface UseResizableProps {
4 |   initialWidth: number;
5 |   minWidth: number;
6 |   maxWidth: number;
7 |   onWidthChange?: (width: number) => void;
8 |   storageKey?: string;
9 | }
10 | 
11 | export function useResizable({
12 |   initialWidth = 320,
13 |   minWidth = 240,
14 |   maxWidth = 480,
15 |   onWidthChange,
16 |   storageKey
17 | }: UseResizableProps) {
18 |   // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì €ì¥ëœ ë„ˆë¹„ ê°€ì ¸ì˜¤ê¸°
19 |   const getStoredWidth = () => {
20 |     if (typeof window === 'undefined' || !storageKey) return initialWidth;
21 |     
22 |     const storedWidth = localStorage.getItem(storageKey);
23 |     if (storedWidth) {
24 |       const parsed = parseInt(storedWidth, 10);
25 |       if (!isNaN(parsed) && parsed >= minWidth && parsed <= maxWidth) {
26 |         return parsed;
27 |       }
28 |     }
29 |     return initialWidth;
30 |   };
31 | 
32 |   const [width, setWidth] = useState<number>(getStoredWidth);
33 |   const [isDragging, setIsDragging] = useState<boolean>(false);
34 |   const dragHandleRef = useRef<HTMLDivElement>(null);
35 | 
36 |   useEffect(() => {
37 |     if (storageKey && typeof window !== 'undefined') {
38 |       localStorage.setItem(storageKey, width.toString());
39 |     }
40 |     
41 |     onWidthChange?.(width);
42 |   }, [width, storageKey, onWidthChange]);
43 | 
44 |   useEffect(() => {
45 |     const handleMouseMove = (e: MouseEvent) => {
46 |       if (!isDragging) return;
47 |       
48 |       // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì™€ ìš”ì†Œì˜ ìœ„ì¹˜ì— ë”°ë¼ ë„ˆë¹„ ê³„ì‚°
49 |       const newWidth = window.innerWidth - e.clientX;
50 |       const clampedWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));
51 |       
52 |       setWidth(clampedWidth);
53 |     };
54 | 
55 |     const handleMouseUp = () => {
56 |       setIsDragging(false);
57 |     };
58 | 
59 |     // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
60 |     if (isDragging) {
61 |       document.addEventListener('mousemove', handleMouseMove);
62 |       document.addEventListener('mouseup', handleMouseUp);
63 |     }
64 | 
65 |     return () => {
66 |       document.removeEventListener('mousemove', handleMouseMove);
67 |       document.removeEventListener('mouseup', handleMouseUp);
68 |     };
69 |   }, [isDragging, minWidth, maxWidth]);
70 | 
71 |   const startResize = (e: React.MouseEvent) => {
72 |     e.preventDefault();
73 |     setIsDragging(true);
74 |   };
75 | 
76 |   return {
77 |     width,
78 |     isDragging,
79 |     startResize,
80 |     dragHandleRef,
81 |     setWidth
82 |   };
83 | } 
```

src/hooks/useTags.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useTags.test.tsx
3 |  * ëª©ì : useTags í›… í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : íƒœê·¸ ëª©ë¡ ì¡°íšŒ í›…ì˜ ë™ì‘ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * @rule   three-layer-standard
7 |  * @layer  tanstack-query-hook
8 |  * @tag    @tanstack-query-msw fetchTags
9 |  */
10 | 
11 | import { describe, it, expect, beforeAll, afterEach, afterAll } from 'vitest';
12 | import { renderHook, waitFor } from '@testing-library/react';
13 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
14 | import { http, HttpResponse } from 'msw';
15 | import { setupServer } from 'msw/node';
16 | 
17 | import { useTags } from './useTags';
18 | import { Tag } from '@/services/tagService';
19 | import { mockTags } from '@/tests/msw/handlers/tagHandlers';
20 | 
21 | // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ QueryClient ìƒì„±
22 | const createTestQueryClient = () => new QueryClient({
23 |     defaultOptions: {
24 |         queries: {
25 |             retry: false,        // ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì•ˆí•¨
26 |             gcTime: Infinity,    // ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹œê°„ (ì´ì „ì˜ cacheTime)
27 |         },
28 |     },
29 | });
30 | 
31 | // í…ŒìŠ¤íŠ¸ìš© QueryClient Provider
32 | const createWrapper = () => {
33 |     const testQueryClient = createTestQueryClient();
34 |     return ({ children }: { children: React.ReactNode }) => (
35 |         <QueryClientProvider client={testQueryClient}>
36 |             {children}
37 |         </QueryClientProvider>
38 |     );
39 | };
40 | 
41 | // MSW í…ŒìŠ¤íŠ¸ ì„œë²„ ì„¤ì •
42 | const server = setupServer(
43 |     // íƒœê·¸ ëª©ë¡ API í•¸ë“¤ëŸ¬
44 |     http.get('/api/tags', () => {
45 |         return HttpResponse.json(mockTags);
46 |     })
47 | );
48 | 
49 | describe('useTags í›…', () => {
50 |     beforeAll(() => server.listen());
51 |     afterEach(() => server.resetHandlers());
52 |     afterAll(() => server.close());
53 | 
54 |     it('íƒœê·¸ ëª©ë¡ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤', async () => {
55 |         const wrapper = createWrapper();
56 |         const { result } = renderHook(() => useTags(), { wrapper });
57 | 
58 |         // ì´ˆê¸° ìƒíƒœ: ë¡œë”© ì¤‘
59 |         expect(result.current.isLoading).toBe(true);
60 |         expect(result.current.data).toBeUndefined();
61 | 
62 |         // ë°ì´í„° ë¡œë”© ì™„ë£Œ ëŒ€ê¸°
63 |         await waitFor(() => expect(result.current.isSuccess).toBe(true));
64 | 
65 |         // ì„±ê³µ ì‹œ íƒœê·¸ ë°ì´í„°ê°€ ìˆì–´ì•¼ í•¨
66 |         expect(result.current.data).toEqual(mockTags);
67 |         expect(result.current.data?.length).toEqual(mockTags.length);
68 |     });
69 | 
70 |     it('API ì˜¤ë¥˜ ë°œìƒ ì‹œ ì—ëŸ¬ ìƒíƒœë¥¼ ë°˜í™˜í•œë‹¤', async () => {
[TRUNCATED]
```

src/hooks/useTags.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useTags.ts
3 |  * ëª©ì : íƒœê·¸ ëª©ë¡ ì¡°íšŒ React Query í›…
4 |  * ì—­í• : íƒœê·¸ ëª©ë¡ì„ ê°€ì ¸ì˜¤ê³  ìºì‹±í•˜ëŠ” í›… ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * @rule   three-layer-standard
7 |  * @layer  tanstack-query-hook
8 |  * @tag    @tanstack-query-msw fetchTags
9 |  */
10 | 
11 | import { useQuery, UseQueryOptions, UseQueryResult } from '@tanstack/react-query';
12 | import { fetchTags, Tag } from '@/services/tagService';
13 | 
14 | /**
15 |  * useTags: íƒœê·¸ ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” í›…
16 |  * @param options - useQuery ì¶”ê°€ ì˜µì…˜ (ì„ íƒì‚¬í•­)
17 |  * @returns íƒœê·¸ ëª©ë¡ ì¿¼ë¦¬ ê²°ê³¼ (data, isLoading, error ë“±)
18 |  */
19 | export function useTags(
20 |   options?: Omit<UseQueryOptions<Tag[], Error>, 'queryKey' | 'queryFn'>
21 | ): UseQueryResult<Tag[], Error> {
22 |   return useQuery({
23 |     queryKey: ['tags'],
24 |     queryFn: () => fetchTags(),
25 |     staleTime: 1000 * 60 * 5, // 5ë¶„ ë™ì•ˆ ë°ì´í„°ë¥¼ "ì‹ ì„ "í•˜ê²Œ ìœ ì§€ (ë¶ˆí•„ìš”í•œ ì¬ìš”ì²­ ë°©ì§€)
26 |     ...options,
27 |   });
28 | } 
```

src/hooks/useUpdateCard.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useUpdateCard.test.tsx
3 |  * ëª©ì : useUpdateCard í›…ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : TanStack Query ë®¤í…Œì´ì…˜ í›…ì˜ ìˆ˜ì • ê¸°ëŠ¥ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : MSW ì„œë²„ ì„¤ì • ìˆ˜ì •
7 |  */
8 | 
9 | import React from 'react';
10 | import { renderHook } from '@testing-library/react';
11 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
12 | import { useUpdateCard } from './useUpdateCard';
13 | import { describe, it, expect, vi, beforeEach } from 'vitest';
14 | import { UpdateCardInput } from '../types/card';
15 | import { http, HttpResponse } from 'msw';
16 | import { setupMSW } from './mocks/node';
17 | import { mockUpdatedCard } from './mocks/handlers';
18 | 
19 | // MSW ì„œë²„ ì„¤ì •
20 | const msw = setupMSW();
21 | 
22 | describe('@tanstack-mutation-msw useUpdateCard', () => {
23 |     beforeEach(() => {
24 |         vi.spyOn(console, 'error').mockImplementation(() => { });
25 |     });
26 | 
27 |     it('ì¹´ë“œ ìˆ˜ì • ì„±ê³µ ì‹œ í•´ë‹¹ ìºì‹œë¥¼ ë¬´íš¨í™”í•œë‹¤', async () => {
28 |         // QueryClient ì„¤ì •
29 |         const queryClient = new QueryClient({
30 |             defaultOptions: {
31 |                 queries: { retry: false },
32 |                 mutations: { retry: false }
33 |             }
34 |         });
35 | 
36 |         // ìºì‹œ ë¬´íš¨í™” ëª¨ë‹ˆí„°ë§
37 |         const invalidateSpy = vi.spyOn(queryClient, 'invalidateQueries');
38 | 
39 |         // í…ŒìŠ¤íŠ¸ ë˜í¼
40 |         const wrapper = ({ children }: { children: React.ReactNode }) => (
41 |             <QueryClientProvider client={queryClient}>
42 |                 {children}
43 |             </QueryClientProvider>
44 |         );
45 | 
46 |         // í›… ë Œë”ë§
47 |         const { result } = renderHook(() => useUpdateCard(), { wrapper });
48 | 
49 |         // í…ŒìŠ¤íŠ¸ ë°ì´í„°
50 |         const cardId = 'test-card-123';
51 |         const patch: UpdateCardInput = {
52 |             title: 'ìˆ˜ì •ëœ ì¹´ë“œ',
53 |             content: 'ìˆ˜ì •ëœ ë‚´ìš©'
54 |         };
55 | 
56 |         // ë®¤í…Œì´ì…˜ ì‹¤í–‰
57 |         const response = await result.current.mutateAsync({ id: cardId, patch });
58 | 
59 |         // ì‘ë‹µ ë°ì´í„° ê²€ì¦
60 |         expect(response).toEqual(mockUpdatedCard);
61 | 
62 |         // ìºì‹œ ë¬´íš¨í™” ê²€ì¦ - ì¹´ë“œ ëª©ë¡ ìºì‹œ
63 |         expect(invalidateSpy).toHaveBeenCalledWith({ queryKey: ['cards'] });
64 | 
65 |         // ìºì‹œ ë¬´íš¨í™” ê²€ì¦ - íŠ¹ì • ì¹´ë“œ ìºì‹œ
66 |         expect(invalidateSpy).toHaveBeenCalledWith({ queryKey: ['card', cardId] });
67 |     });
68 | 
69 |     it('ì„œë²„ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜ˆì™¸ë¥¼ ì „íŒŒí•œë‹¤', async () => {
70 |         // ì˜¤ë¥˜ ì‘ë‹µ í•¸ë“¤ëŸ¬ ì¶”ê°€
71 |         msw.use(
72 |             http.patch('/api/cards/:id', () => {
[TRUNCATED]
```

src/hooks/useUpdateCard.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/useUpdateCard.ts
3 |  * ëª©ì : ì¹´ë“œ ìˆ˜ì •ì„ ìœ„í•œ Mutation í›…
4 |  * ì—­í• : React Query useMutationì„ ì‚¬ìš©í•˜ì—¬ ì¹´ë“œ ìˆ˜ì • ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { useMutation, useQueryClient, UseMutationResult } from '@tanstack/react-query';
9 | import { Card, UpdateCardInput } from '../types/card';
10 | import { updateCardAPI } from '../services/cardService';
11 | 
12 | /**
13 |  * useUpdateCard: ì¹´ë“œ ìˆ˜ì •ì„ ìœ„í•œ Mutation í›…
14 |  * @returns {UseMutationResult<Card, Error, {id: string, patch: UpdateCardInput}>} ì¹´ë“œ ìˆ˜ì • mutation ê²°ê³¼
15 |  */
16 | export function useUpdateCard(): UseMutationResult<Card, Error, {id: string, patch: UpdateCardInput}> {
17 |   const queryClient = useQueryClient();
18 |   
19 |   return useMutation({
20 |     mutationFn: ({ id, patch }) => updateCardAPI(id, patch),
21 |     onSuccess: (updatedCard) => {
22 |       // ì¹´ë“œ ëª©ë¡ ìºì‹œ ë¬´íš¨í™”
23 |       queryClient.invalidateQueries({ queryKey: ['cards'] });
24 |       
25 |       // í•´ë‹¹ ì¹´ë“œ ìƒì„¸ ì •ë³´ ìºì‹œ ì—…ë°ì´íŠ¸
26 |       queryClient.invalidateQueries({ queryKey: ['card', updatedCard.id] });
27 |     }
28 |   });
29 | } 
30 | 
31 | // sequenceDiagram
32 | //     participant Reactì»´í¬ë„ŒíŠ¸
33 | //     participant useUpdateCardí›…
34 | //     participant ReactQueryCache
35 | //     participant updateCardAPI
36 | //     participant ì„œë²„API
37 | //     participant ë°ì´í„°ë² ì´ìŠ¤
38 | 
39 | //     Reactì»´í¬ë„ŒíŠ¸->>useUpdateCardí›…: mutate({id: "card-123", patch: {title: "ìˆ˜ì •ëœ ì œëª©"}})
40 | //     useUpdateCardí›…->>updateCardAPI: updateCardAPI("card-123", {title: "ìˆ˜ì •ëœ ì œëª©"})
41 | //     updateCardAPI->>ì„œë²„API: PATCH /api/cards/card-123
42 | //     ì„œë²„API->>ë°ì´í„°ë² ì´ìŠ¤: ì¹´ë“œ ë°ì´í„° ì—…ë°ì´íŠ¸
43 | //     ë°ì´í„°ë² ì´ìŠ¤-->>ì„œë²„API: ì—…ë°ì´íŠ¸ ê²°ê³¼
44 | //     ì„œë²„API-->>updateCardAPI: ì‘ë‹µ (ì—…ë°ì´íŠ¸ëœ ì¹´ë“œ ê°ì²´)
45 | //     updateCardAPI-->>useUpdateCardí›…: ì—…ë°ì´íŠ¸ëœ ì¹´ë“œ ê°ì²´ ë°˜í™˜
46 | //     useUpdateCardí›…->>ReactQueryCache: invalidateQueries(['cards'])
47 | //     useUpdateCardí›…->>ReactQueryCache: invalidateQueries(['card', "card-123"])
48 | //     ReactQueryCache-->>Reactì»´í¬ë„ŒíŠ¸: UI ì—…ë°ì´íŠ¸ (ìµœì‹  ë°ì´í„°ë¡œ)
```

src/lib/api-utils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/lib/api-utils.ts
3 |  * ëª©ì : API ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
4 |  * ì—­í• : ê°œë°œ í™˜ê²½ê³¼ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë„ì™€ì¤Œ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * @rule   three-layer-standard
7 |  * @layer  service
8 |  */
9 | 
10 | import { NextRequest } from 'next/server';
11 | 
12 | import { PrismaClient } from '@prisma/client';
13 | 
14 | import { getUserFromRequest } from './auth-server';
15 | import prisma from './prisma';
16 | import { createClient } from './supabase/server';
17 | 
18 | /**
19 |  * isDevelopment: í˜„ì¬ í™˜ê²½ì´ ê°œë°œ í™˜ê²½ì¸ì§€ í™•ì¸
20 |  * @returns {boolean} ê°œë°œ í™˜ê²½ì´ë©´ true, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ false
21 |  */
22 | export function isDevelopment(): boolean {
23 |   return process.env.NODE_ENV === 'development';
24 | }
25 | 
26 | /**
27 |  * getAuthUser: ìš”ì²­ì—ì„œ ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
28 |  * @param {NextRequest} request - ë‹¤ìŒ ìš”ì²­ ê°ì²´
29 |  * @returns {Promise<any>} ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´
30 |  */
31 | export async function getAuthUser(request: NextRequest) {
32 |   return await getUserFromRequest(request);
33 | }
34 | 
35 | /**
36 |  * getEdgeModel: í˜„ì¬ í™˜ê²½ì— ë§ëŠ” ì—£ì§€ ëª¨ë¸ ì ‘ê·¼ ê°ì²´ ì–»ê¸°
37 |  * ê°œë°œ í™˜ê²½ì—ì„œëŠ” Prismaë¥¼, í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” Supabaseë¥¼ ì‚¬ìš©
38 |  * @returns Edge ëª¨ë¸ ì ‘ê·¼ ê°ì²´
39 |  */
40 | export async function getEdgeModel() {
41 |   if (isDevelopment()) {
42 |     // ê°œë°œ í™˜ê²½: Prisma ì‚¬ìš©
43 |     return {
44 |       findUnique: async ({ where }: { where: { id: string } }) => {
45 |         return await prisma.edge.findUnique({ where });
46 |       },
47 |       findMany: async ({ where, orderBy }: { where?: any; orderBy?: any }) => {
48 |         return await prisma.edge.findMany({ where, orderBy });
49 |       },
50 |       create: async ({ data }: { data: any }) => {
51 |         return await prisma.edge.create({ data });
52 |       },
53 |       update: async ({ where, data }: { where: { id: string }; data: any }) => {
54 |         return await prisma.edge.update({ where, data });
55 |       },
56 |       delete: async ({ where }: { where: { id: string } }) => {
57 |         return await prisma.edge.delete({ where });
58 |       },
59 |       deleteMany: async ({ where }: { where: any }) => {
60 |         return await prisma.edge.deleteMany({ where });
61 |       }
62 |     };
63 |   } else {
64 |     // í”„ë¡œë•ì…˜ í™˜ê²½: Supabase ì‚¬ìš©
65 |     const supabase = await createClient();
66 |     return {
67 |       findUnique: async ({ where }: { where: { id: string } }) => {
68 |         const { data, error } = await supabase
[TRUNCATED]
```

src/lib/auth-server.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: auth-server.ts
3 |  * ëª©ì : ì„œë²„ ì¸¡ ì¸ì¦ ê¸°ëŠ¥ ë° ì„¸ì…˜ ì²˜ë¦¬
4 |  * ì—­í• : API ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©í•  ì„œë²„ ì¸¡ ì¸ì¦ í•¨ìˆ˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-09
7 |  * ìˆ˜ì •ì¼: 2024-05-19 : serverSignInWithGoogle í•¨ìˆ˜ ì¶”ê°€
8 |  * 
9 |  * @rule   three-layer-standard
10 |  * @layer  service
11 |  * @tag    @service-msw serverSignInWithGoogle
12 |  * ì„¤ëª…    ì„œë²„ì—ì„œ Google OAuth ì¸ì¦ URLì„ ìƒì„±í•˜ëŠ” ì„œë¹„ìŠ¤ í•¨ìˆ˜ (Supabase API í˜¸ì¶œ, HTTP ê²½ê³„ MSWë¡œ í…ŒìŠ¤íŠ¸)
13 |  */
14 | 
15 | import createLogger from './logger';
16 | import { createClient } from './supabase/server';
17 | 
18 | // ë¡œê±° ìƒì„±
19 | const logger = createLogger('AuthServer');
20 | 
21 | /**
22 |  * auth: ì„œë²„ ì»´í¬ë„ŒíŠ¸ì™€ API ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©í•  ì¸ì¦ í•¨ìˆ˜
23 |  * @returns í˜„ì¬ ì¸ì¦ëœ ì„¸ì…˜ ì •ë³´
24 |  */
25 | export const auth = async () => {
26 |   try {
27 |     const supabase = await createClient();
28 |     const { data: { session } } = await supabase.auth.getSession();
29 |     return session;
30 |   } catch (error) {
31 |     logger.error('ì„œë²„ ì¸ì¦ ì˜¤ë¥˜:', error);
32 |     return null;
33 |   }
34 | };
35 | 
36 | /**
37 |  * getCurrentUser: í˜„ì¬ ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜
38 |  * @returns í˜„ì¬ ì¸ì¦ëœ ì‚¬ìš©ì ë˜ëŠ” null
39 |  */
40 | export const getCurrentUser = async () => {
41 |   try {
42 |     const supabase = await createClient();
43 |     const { data: { user } } = await supabase.auth.getUser();
44 |     return user;
45 |   } catch (error) {
46 |     logger.error('ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì˜¤ë¥˜:', error);
47 |     return null;
48 |   }
49 | };
50 | 
51 | /**
52 |  * serverSignInWithGoogle: ì„œë²„ì—ì„œ Google OAuth ë¡œê·¸ì¸ URL ìƒì„±
53 |  * @returns {Promise<{ success: boolean; url?: string; error?: string }>} ë¡œê·¸ì¸ ê²°ê³¼
54 |  */
55 | export async function serverSignInWithGoogle(): Promise<{ success: boolean; url?: string; error?: string }> {
56 |   try {
57 |     logger.info('ì„œë²„ì—ì„œ Google ë¡œê·¸ì¸ ì‹œì‘');
58 |     
59 |     // í˜„ì¬ í˜¸ìŠ¤íŠ¸ URL ì¶”ì¶œ (ì„œë²„ í™˜ê²½ì—ì„œëŠ” headers()ë¥¼ í†µí•´ ê°€ì ¸ì™€ì•¼ í•¨)
60 |     const headers = new Headers();
61 |     // ìš”ì²­ í—¤ë”ì—ì„œ í˜¸ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ í™˜ê²½ ë³€ìˆ˜ë‚˜ ì„¤ì •ì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤
62 |     const baseUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';
63 |     
64 |     // ë¦¬ë””ë ‰ì…˜ URL ì„¤ì •
65 |     const redirectUrl = `${baseUrl}/auth/callback`;
[TRUNCATED]
```

src/lib/auth.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: auth.ts
3 |  * ëª©ì : ì‚¬ìš©ì ì¸ì¦ ê´€ë ¨ ê¸°ëŠ¥ ì œê³µ
4 |  * ì—­í• : ë¡œê·¸ì¸, íšŒì›ê°€ì…, ì„¸ì…˜ ê´€ë¦¬ ë“± ì¸ì¦ ê´€ë ¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-08
6 |  * ìˆ˜ì •ì¼: 2025-04-09
7 |  * ìˆ˜ì •ì¼: 2023-10-31 : Supabase ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ê°œì„  ë° ì¿ í‚¤ ì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€
8 |  * ìˆ˜ì •ì¼: 2024-05-08 : signOut í•¨ìˆ˜ ê°„ì†Œí™” - @supabase/ssr ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬ì™€ í˜¸í™˜ë˜ë„ë¡ ê°œì„ 
9 |  * ìˆ˜ì •ì¼: 2024-04-19 : sessionStorage ê¸°ë°˜ code_verifier ê´€ë¦¬ ì½”ë“œ ì œê±° - @supabase/ssrì˜ ì¿ í‚¤ ë©”ì»¤ë‹ˆì¦˜ í™œìš©
10 |  * ìˆ˜ì •ì¼: 2024-05-18 : í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ ìœ í‹¸ ì •ë¦¬ - ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì½”ë“œ ì œê±° ë° Supabase SDK í˜¸ì¶œë¡œ ë‹¨ìˆœí™”
11 |  */
12 | 
13 | 'use client';
14 | 
15 | import { User } from '@supabase/supabase-js';
16 | 
17 | import { isClient } from './environment';
18 | import createLogger from './logger';
19 | import { createClient } from './supabase/client';
20 | 
21 | // ëª¨ë“ˆë³„ ë¡œê±° ìƒì„±
22 | const logger = createLogger('Auth');
23 | 
24 | // í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ê°€ì ¸ì˜¤ê¸°
25 | export const getAuthClient = () => {
26 |   if (!isClient()) {
27 |     throw new Error('ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
28 |   }
29 |   
30 |   return createClient();
31 | };
32 | 
33 | // ExtendedUser íƒ€ì… ì •ì˜
34 | export interface ExtendedUser extends User {
35 |   dbUser?: any; // Prisma User ëª¨ë¸
36 | }
37 | 
38 | /**
39 |  * signUp: ì‚¬ìš©ì íšŒì›ê°€ì… ì²˜ë¦¬
40 |  * @param {string} email - ì´ë©”ì¼ ì£¼ì†Œ
41 |  * @param {string} password - ë¹„ë°€ë²ˆí˜¸
42 |  * @param {string | null} name - ì‚¬ìš©ì ì´ë¦„ (ì„ íƒì‚¬í•­)
43 |  * @returns {Promise<{user: User, authData: any}>} ì‚¬ìš©ì ì •ë³´
44 |  */
45 | export async function signUp(email: string, password: string, name: string | null = null) {
46 |   try {
47 |     // Supabase ì¸ì¦ìœ¼ë¡œ ì‚¬ìš©ì ìƒì„±
48 |     const client = getAuthClient();
49 |     const { data: authData, error: authError } = await client.auth.signUp({
50 |       email,
51 |       password,
52 |     });
53 | 
54 |     if (authError) {
55 |       throw authError;
56 |     }
57 | 
58 |     if (!authData.user) {
59 |       throw new Error('ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨');
60 |     }
61 | 
62 |     // APIë¥¼ í†µí•´ ì‚¬ìš©ì ë°ì´í„° ìƒì„±
63 |     try {
64 |       const response = await fetch('/api/user/register', {
65 |         method: 'POST',
66 |         headers: {
67 |           'Content-Type': 'application/json',
68 |         },
[TRUNCATED]
```

src/lib/base64.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: base64.ts
3 |  * ëª©ì : Base64 ì¸ì½”ë”© ìœ í‹¸ë¦¬í‹°
4 |  * ì—­í• : ì¼ë°˜ ë° URL-safe Base64 ì¸ì½”ë”©/ë””ì½”ë”© ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  */
7 | 
8 | /**
9 |  * base64Encode: ë¬¸ìì—´ì„ Base64ë¡œ ì¸ì½”ë”©
10 |  * @param {string} str - ì¸ì½”ë”©í•  ë¬¸ìì—´
11 |  * @returns {string} Base64 ì¸ì½”ë”©ëœ ë¬¸ìì—´
12 |  */
13 | export const base64Encode = (str: string): string => {
14 |   if (typeof window !== 'undefined') {
15 |     // ë¸Œë¼ìš°ì € í™˜ê²½
16 |     return window.btoa(str);
17 |   } else {
18 |     // Node.js í™˜ê²½
19 |     return Buffer.from(str).toString('base64');
20 |   }
21 | };
22 | 
23 | /**
24 |  * base64Decode: Base64 ë¬¸ìì—´ì„ ë””ì½”ë”©
25 |  * @param {string} str - ë””ì½”ë”©í•  Base64 ë¬¸ìì—´
26 |  * @returns {string} ë””ì½”ë”©ëœ ë¬¸ìì—´
27 |  */
28 | export const base64Decode = (str: string): string => {
29 |   if (typeof window !== 'undefined') {
30 |     // ë¸Œë¼ìš°ì € í™˜ê²½
31 |     return window.atob(str);
32 |   } else {
33 |     // Node.js í™˜ê²½
34 |     return Buffer.from(str, 'base64').toString();
35 |   }
36 | };
37 | 
38 | /**
39 |  * base64UrlEncode: ArrayBufferë¥¼ URL ì•ˆì „í•œ Base64 ë¬¸ìì—´ë¡œ ì¸ì½”ë”©
40 |  * - RFC 7636ì— ë”°ë¼ code_challengeë¥¼ ìœ„í•œ í¬ë§·ìœ¼ë¡œ ì¸ì½”ë”©
41 |  * - `+` -> `-`, `/` -> `_`, íŒ¨ë”© ë¬¸ì(`=`) ì œê±°
42 |  * @param {ArrayBufferLike} buffer - ì¸ì½”ë”©í•  ArrayBuffer
43 |  * @returns {string} URL ì•ˆì „í•œ Base64 ë¬¸ìì—´
44 |  */
45 | export const base64UrlEncode = (buffer: ArrayBufferLike): string => {
46 |   let base64 = '';
47 |   
48 |   if (typeof window !== 'undefined') {
49 |     // ë¸Œë¼ìš°ì € í™˜ê²½
50 |     base64 = window.btoa(
51 |       String.fromCharCode.apply(
52 |         null,
53 |         new Uint8Array(buffer) as unknown as number[]
54 |       )
55 |     );
56 |   } else {
57 |     // Node.js í™˜ê²½
58 |     base64 = Buffer.from(buffer).toString('base64');
59 |   }
60 |   
61 |   // URL ì•ˆì „ ë¬¸ìë¡œ ë³€ê²½ (+, /, = ì²˜ë¦¬)
62 |   return base64
63 |     .replace(/\+/g, '-')
64 |     .replace(/\//g, '_')
65 |     .replace(/=+$/, '');
66 | };
67 | 
68 | /**
69 |  * base64UrlDecode: URL ì•ˆì „í•œ Base64 ë¬¸ìì—´ì„ ë””ì½”ë”©í•˜ì—¬ ArrayBuffer ë°˜í™˜
70 |  * - `-` -> `+`, `_` -> `/`, íŒ¨ë”© ë¬¸ì ë³µì›
71 |  * @param {string} base64Url - ë””ì½”ë”©í•  URL ì•ˆì „ Base64 ë¬¸ìì—´
72 |  * @returns {ArrayBufferLike} ë””ì½”ë”©ëœ ArrayBuffer
73 |  */
[TRUNCATED]
```

src/lib/constants.ts
```
1 | // ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìƒìˆ˜ ê°’ë“¤
2 | 
3 | // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ID (ë°ì´í„°ë² ì´ìŠ¤ì— ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ” ID)
4 | // ì´ì „ ê°’: export const DEFAULT_USER_ID = "91fc1ef9-daec-45de-8eb4-40ca52ec292f";
5 | export const DEFAULT_USER_ID = "13ce1b15-aa4e-452b-af81-124d06413662"; // ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì¡´ì¬í•˜ëŠ” ID
6 | 
7 | // í˜ì´ì§€ í¬ê¸° ìƒìˆ˜
8 | export const PAGE_SIZE = 10;
9 | 
10 | // ë‚ ì§œ í˜•ì‹
11 | export const DATE_FORMAT = "YYYYë…„ MMì›” DDì¼"; 
```

src/lib/cookie.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/lib/cookie.ts
3 |  * ëª©ì : í¬ë¡œìŠ¤ ë„ë©”ì¸ ì¿ í‚¤ ê´€ë¦¬ ìœ í‹¸ë¦¬í‹° ì œê³µ
4 |  * ì—­í• : ì¿ í‚¤ ì„¤ì •, ì¡°íšŒ, ì‚­ì œ ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  */
7 | 
8 | import { createLogger } from './logger';
9 | 
10 | const logger = createLogger('Cookie');
11 | 
12 | /**
13 |  * ì¿ í‚¤ ì„¤ì •
14 |  * @param name ì¿ í‚¤ ì´ë¦„
15 |  * @param value ì¿ í‚¤ ê°’
16 |  * @param options ì¿ í‚¤ ì˜µì…˜
17 |  */
18 | export function setCookie(
19 |   name: string,
20 |   value: string,
21 |   options: {
22 |     days?: number;
23 |     path?: string;
24 |     domain?: string;
25 |     sameSite?: 'strict' | 'lax' | 'none';
26 |     secure?: boolean;
27 |   } = {}
28 | ): void {
29 |   if (typeof document === 'undefined') {
30 |     logger.warn('Document is not available - ì¿ í‚¤ë¥¼ ì„¤ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
31 |     return;
32 |   }
33 | 
34 |   const { days = 7, path = '/', domain, sameSite = 'lax', secure = false } = options;
35 | 
36 |   // ë§Œë£Œì¼ ê³„ì‚°
37 |   const expiresDate = new Date();
38 |   expiresDate.setTime(expiresDate.getTime() + days * 24 * 60 * 60 * 1000);
39 | 
40 |   // ì¿ í‚¤ ë¬¸ìì—´ êµ¬ì„±
41 |   let cookieString = `${encodeURIComponent(name)}=${encodeURIComponent(value)}; expires=${expiresDate.toUTCString()}; path=${path}`;
42 | 
43 |   // ë„ë©”ì¸ ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
44 |   if (domain) {
45 |     cookieString += `; domain=${domain}`;
46 |   }
47 | 
48 |   // SameSite ì¶”ê°€
49 |   cookieString += `; samesite=${sameSite}`;
50 | 
51 |   // Secure ì¶”ê°€ (SameSite=Noneì¼ ê²½ìš° í•„ìˆ˜)
52 |   if (secure || sameSite === 'none') {
53 |     cookieString += '; secure';
54 |   }
55 | 
56 |   // ì¿ í‚¤ ì„¤ì •
57 |   document.cookie = cookieString;
58 |   logger.debug(`ì¿ í‚¤ ì„¤ì •: ${name}`, { days, path, domain, sameSite, secure });
59 | }
60 | 
61 | /**
62 |  * ì¿ í‚¤ ê°’ ì¡°íšŒ
63 |  * @param name ì¿ í‚¤ ì´ë¦„
64 |  * @returns ì¿ í‚¤ ê°’ ë˜ëŠ” null
65 |  */
66 | export function getCookie(name: string): string | null {
67 |   if (typeof document === 'undefined') {
68 |     logger.warn('Document is not available - ì¿ í‚¤ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
69 |     return null;
70 |   }
71 | 
72 |   const nameEQ = encodeURIComponent(name) + '=';
73 |   const ca = document.cookie.split(';');
74 | 
[TRUNCATED]
```

src/lib/db-check.js
```
1 | import { PrismaClient } from '@prisma/client';
2 | 
3 | let prisma;
4 | 
5 | if (process.env.NODE_ENV === 'production') {
6 |   prisma = new PrismaClient();
7 | } else {
8 |   if (!global.prisma) {
9 |     global.prisma = new PrismaClient();
10 |   }
11 |   prisma = global.prisma;
12 | }
13 | 
14 | export async function checkDatabaseConnection() {
15 |   try {
16 |     // ê°„ë‹¨í•œ ì¿¼ë¦¬ë¡œ ì—°ê²° í™•ì¸
17 |     await prisma.$queryRaw`SELECT 1`;
18 |     return { connected: true };
19 |   } catch (error) {
20 |     console.error('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜:', error);
21 |     return { 
22 |       connected: false, 
23 |       error: error.message,
24 |       tips: [
25 |         '.env íŒŒì¼ì— DATABASE_URLì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.',
26 |         'PostgreSQL ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.',
27 |         'ë°ì´í„°ë² ì´ìŠ¤ "backyard"ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.',
28 |         'ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.'
29 |       ]
30 |     };
31 |   }
32 | }
33 | 
34 | export { prisma }; 
```

src/lib/db-init.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: db-init.ts
3 |  * ëª©ì : ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ë° í…Œì´ë¸” ìƒì„±
4 |  * ì—­í• : ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ í•„ìš”í•œ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ì„¤ì •
5 |  * ì‘ì„±ì¼: 2025-03-08
6 |  * ìˆ˜ì •ì¼: 2025-04-09
7 |  */
8 | 
9 | import { PrismaClient } from '@prisma/client';
10 | 
11 | import { createClient } from './supabase/server';
12 | 
13 | // í…Œì´ë¸” ì •ì˜ ë° ìƒì„± SQL
14 | const tableDefinitions = {
15 |   users: `
16 |     CREATE TABLE IF NOT EXISTS users (
17 |       id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
18 |       email TEXT UNIQUE NOT NULL,
19 |       name TEXT,
20 |       created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
21 |       updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
22 |     );
23 |   `,
24 |   cards: `
25 |     CREATE TABLE IF NOT EXISTS cards (
26 |       id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
27 |       title TEXT NOT NULL,
28 |       content TEXT,
29 |       created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
30 |       updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
31 |       user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE
32 |     );
33 |   `,
34 |   tags: `
35 |     CREATE TABLE IF NOT EXISTS tags (
36 |       id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
37 |       name TEXT UNIQUE NOT NULL,
38 |       created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
39 |       updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
40 |     );
41 |   `,
42 |   card_tags: `
43 |     CREATE TABLE IF NOT EXISTS card_tags (
44 |       id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
45 |       card_id UUID NOT NULL REFERENCES cards(id) ON DELETE CASCADE,
46 |       tag_id UUID NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
47 |       created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
48 |       UNIQUE(card_id, tag_id)
49 |     );
50 |   `,
51 |   board_settings: `
52 |     CREATE TABLE IF NOT EXISTS board_settings (
53 |       id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
54 |       user_id UUID UNIQUE NOT NULL REFERENCES users(id) ON DELETE CASCADE,
55 |       settings JSONB NOT NULL,
[TRUNCATED]
```

src/lib/debug-utils.ts
```
1 | /*
2 |   @description: ë””ë²„ê¹…ìš© ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
3 | */
4 | 
5 | import { BOARD_SETTINGS_KEY } from './ideamap-constants';
6 | 
7 | // ë””ë²„ê¹…ìš© ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
8 | export function resetLocalStorageBoardSettings() {
9 |   try {
10 |     localStorage.removeItem(BOARD_SETTINGS_KEY);
11 |     console.log('ë³´ë“œ ì„¤ì • ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
12 |     return true;
13 |   } catch (e) {
14 |     console.error('ë³´ë“œ ì„¤ì • ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
15 |     return false;
16 |   }
17 | }
18 | 
19 | // í˜„ì¬ ë³´ë“œ ì„¤ì • ì¶œë ¥ í•¨ìˆ˜
20 | export function logCurrentBoardSettings() {
21 |   try {
22 |     const settings = localStorage.getItem(BOARD_SETTINGS_KEY);
23 |     console.log('í˜„ì¬ ë³´ë“œ ì„¤ì • (localStorage):', settings ? JSON.parse(settings) : null);
24 |     
25 |     // Zustand ì €ì¥ì†Œ ë‚´ìš©ë„ í™•ì¸
26 |     const appStorage = localStorage.getItem('backyard-app-storage');
27 |     console.log('Zustand ì•± ìŠ¤í† ë¦¬ì§€:', appStorage ? JSON.parse(appStorage) : null);
28 |     
29 |     return settings ? JSON.parse(settings) : null;
30 |   } catch (e) {
31 |     console.error('ë³´ë“œ ì„¤ì • ì¶œë ¥ ì‹¤íŒ¨:', e);
32 |     return null;
33 |   }
34 | }
35 | 
36 | // Zustand ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
37 | export function resetZustandStorage() {
38 |   try {
39 |     localStorage.removeItem('backyard-app-storage');
40 |     console.log('Zustand ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
41 |     return true;
42 |   } catch (e) {
43 |     console.error('Zustand ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
44 |     return false;
45 |   }
46 | }
47 | 
48 | // ì „ì²´ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
49 | export function resetAllStorage() {
50 |   const boardReset = resetLocalStorageBoardSettings();
51 |   const zustandReset = resetZustandStorage();
52 |   
53 |   return boardReset && zustandReset;
54 | } 
```

src/lib/environment.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: environment.ts
3 |  * ëª©ì : ì‹¤í–‰ í™˜ê²½ ê°ì§€ ìœ í‹¸ë¦¬í‹°
4 |  * ì—­í• : í´ë¼ì´ì–¸íŠ¸/ì„œë²„ í™˜ê²½ ê°ì§€ ë° í™˜ê²½ë³„ ì½”ë“œ ì‹¤í–‰ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  */
7 | 
8 | /**
9 |  * isClient: í˜„ì¬ ì½”ë“œê°€ í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €) í™˜ê²½ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
10 |  * @returns {boolean} í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ ì—¬ë¶€
11 |  */
12 | export const isClient = (): boolean => {
13 |   return typeof window !== 'undefined';
14 | };
15 | 
16 | /**
17 |  * isServer: í˜„ì¬ ì½”ë“œê°€ ì„œë²„ í™˜ê²½ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
18 |  * @returns {boolean} ì„œë²„ í™˜ê²½ ì—¬ë¶€
19 |  */
20 | export const isServer = (): boolean => {
21 |   return typeof window === 'undefined';
22 | };
23 | 
24 | /**
25 |  * executeOnClient: í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì—ì„œë§Œ í•¨ìˆ˜ ì‹¤í–‰
26 |  * @param {Function} fn - í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹¤í–‰í•  í•¨ìˆ˜
27 |  * @returns {any | undefined} í•¨ìˆ˜ ì‹¤í–‰ ê²°ê³¼ ë˜ëŠ” undefined
28 |  */
29 | export const executeOnClient = <T>(fn: () => T): T | undefined => {
30 |   if (isClient()) {
31 |     return fn();
32 |   }
33 |   return undefined;
34 | };
35 | 
36 | /**
37 |  * executeOnServer: ì„œë²„ í™˜ê²½ì—ì„œë§Œ í•¨ìˆ˜ ì‹¤í–‰
38 |  * @param {Function} fn - ì„œë²„ì—ì„œ ì‹¤í–‰í•  í•¨ìˆ˜
39 |  * @returns {any | undefined} í•¨ìˆ˜ ì‹¤í–‰ ê²°ê³¼ ë˜ëŠ” undefined
40 |  */
41 | export const executeOnServer = <T>(fn: () => T): T | undefined => {
42 |   if (isServer()) {
43 |     return fn();
44 |   }
45 |   return undefined;
46 | };
47 | 
48 | /**
49 |  * getEnvironment: í˜„ì¬ ì‹¤í–‰ í™˜ê²½ ë°˜í™˜
50 |  * @returns {'client' | 'server'} ì‹¤í–‰ í™˜ê²½ ë¬¸ìì—´
51 |  */
52 | export const getEnvironment = (): 'client' | 'server' => {
53 |   return isClient() ? 'client' : 'server';
54 | };
55 | 
56 | /**
57 |  * runInEnvironment: í™˜ê²½ì— ë”°ë¼ ì ì ˆí•œ í•¨ìˆ˜ ì‹¤í–‰
58 |  * @param {Object} options - ì‹¤í–‰ ì˜µì…˜
59 |  * @param {Function} options.client - í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹¤í–‰í•  í•¨ìˆ˜
60 |  * @param {Function} options.server - ì„œë²„ì—ì„œ ì‹¤í–‰í•  í•¨ìˆ˜
61 |  * @returns {any} í™˜ê²½ì— ë§ëŠ” í•¨ìˆ˜ì˜ ì‹¤í–‰ ê²°ê³¼
62 |  */
63 | export const runInEnvironment = <C, S>({ 
64 |   client, 
65 |   server 
66 | }: { 
67 |   client?: () => C; 
68 |   server?: () => S; 
69 | }): C | S | undefined => {
70 |   if (isClient() && client) {
71 |     return client();
72 |   } else if (isServer() && server) {
73 |     return server();
74 |   }
75 |   return undefined;
[TRUNCATED]
```

src/lib/flow-constants.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: flow-constants.ts
3 |  * ëª©ì : React Flow ê´€ë ¨ ìƒìˆ˜ ì •ì˜
4 |  * ì—­í• : ì‹±ê¸€í†¤ íŒ¨í„´ìœ¼ë¡œ êµ¬í˜„í•˜ì—¬ í•­ìƒ ë™ì¼í•œ ê°ì²´ ì°¸ì¡°ë¥¼ ìœ ì§€í•¨
5 |  * ì‘ì„±ì¼: 2025-03-09
6 |  * ìˆ˜ì •ì¼: 2025-03-28
7 |  */
8 | 
9 | import CardNode from '@/components/ideamap/nodes/CardNode';
10 | import CustomEdge from '@/components/ideamap/nodes/CustomEdge';
11 | import NodeInspect from '@/components/ideamap/nodes/NodeInspect';
12 | 
13 | // 1. ë¨¼ì € íƒ€ì… í‚¤ ìƒìˆ˜ë¥¼ ì •ì˜ (ë¬¸ìì—´ë§Œ í¬í•¨)
14 | // ë…¸ë“œ íƒ€ì… í‚¤ ì •ì˜ - ë¬¸ìì—´ ìƒìˆ˜ë¡œ ë¶„ë¦¬
15 | export const NODE_TYPES_KEYS = Object.freeze({
16 |   card: 'card',
17 |   nodeInspect: 'nodeInspect',
18 |   default: 'default'
19 | });
20 | 
21 | // ì—£ì§€ íƒ€ì… í‚¤ ì •ì˜
22 | export const EDGE_TYPES_KEYS = Object.freeze({
23 |   custom: 'custom',
24 |   default: 'default'
25 | });
26 | 
27 | // 2. ê·¸ ë‹¤ìŒ ì»´í¬ë„ŒíŠ¸ ì •ì˜ ê²€ì¦
28 | // ì»´í¬ë„ŒíŠ¸ ìœ íš¨ì„± í™•ì¸
29 | const isValidComponent = (component: any): boolean => {
30 |   return typeof component === 'function';
31 | };
32 | 
33 | // ë””ë²„ê¹… ë¡œê·¸ - ì»´í¬ë„ŒíŠ¸ ê²€ì¦
34 | console.log('[flow-constants] ì»´í¬ë„ŒíŠ¸ ìœ íš¨ì„± ê²€ì¦:', {
35 |   cardNode: isValidComponent(CardNode) ? 'OK' : 'ERROR',
36 |   customEdge: isValidComponent(CustomEdge) ? 'OK' : 'ERROR',
37 |   nodeInspect: isValidComponent(NodeInspect) ? 'OK' : 'ERROR'
38 | });
39 | 
40 | // 3. íƒ€ì… í‚¤ì™€ ì»´í¬ë„ŒíŠ¸ ì—°ê²°
41 | // ë…¸ë“œ íƒ€ì… ì •ì˜ - ê°ì²´ í”„ë¦¬ì§•í•˜ì—¬ ë³€ê²½ ë¶ˆê°€ëŠ¥í•˜ê²Œ í•¨
42 | export const NODE_TYPES = Object.freeze({
43 |   [NODE_TYPES_KEYS.card]: CardNode,
44 |   [NODE_TYPES_KEYS.nodeInspect]: NodeInspect,
45 |   // React Flow ê¸°ë³¸ íƒ€ì…ì—ë„ ë§¤í•‘
46 |   [NODE_TYPES_KEYS.default]: CardNode
47 | });
48 | 
49 | // ì—£ì§€ íƒ€ì… ì •ì˜ - ê°ì²´ í”„ë¦¬ì§•í•˜ì—¬ ë³€ê²½ ë¶ˆê°€ëŠ¥í•˜ê²Œ í•¨
50 | export const EDGE_TYPES = Object.freeze({
51 |   [EDGE_TYPES_KEYS.custom]: CustomEdge,
52 |   // React FlowëŠ” 'default' íƒ€ì…ì„ ì°¾ì§€ ëª»í•˜ë©´ fallbackìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
53 |   // ëª…ì‹œì ìœ¼ë¡œ 'default' íƒ€ì…ë„ ë“±ë¡í•©ë‹ˆë‹¤.
54 |   [EDGE_TYPES_KEYS.default]: CustomEdge
55 | });
56 | 
57 | // 4. ìµœì¢… ë¡œê·¸ ì¶œë ¥
58 | // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
59 | console.log('[flow-constants] ë…¸ë“œ ë° ì—£ì§€ íƒ€ì… ë“±ë¡ ì™„ë£Œ:', {
60 |   NODE_TYPES_KEYS: Object.keys(NODE_TYPES_KEYS),
61 |   EDGE_TYPES_KEYS: Object.keys(EDGE_TYPES_KEYS),
62 |   NODE_TYPES: Object.keys(NODE_TYPES),
[TRUNCATED]
```

src/lib/ideamap-constants.ts
```
1 | import { ConnectionLineType, MarkerType } from '@xyflow/react';
2 | 
3 | // ìŠ¤ëƒ… ê·¸ë¦¬ë“œ ì˜µì…˜
4 | export const SNAP_GRID_OPTIONS = [
5 |   { value: 0, label: 'ë„ê¸°' },
6 |   { value: 10, label: '10px' },
7 |   { value: 15, label: '15px' },
8 |   { value: 20, label: '20px' },
9 |   { value: 25, label: '25px' },
10 | ];
11 | 
12 | // ê¸°ë³¸ ìŠ¤ëƒ… ê·¸ë¦¬ë“œ ì„¤ì •
13 | export const DEFAULT_SNAP_GRID = [15, 15];
14 | 
15 | // ì—°ê²°ì„  íƒ€ì… ì˜µì…˜
16 | export const CONNECTION_TYPE_OPTIONS = [
17 |   { value: ConnectionLineType.Bezier, label: 'ê³¡ì„  (Bezier)' },
18 |   { value: ConnectionLineType.Straight, label: 'ì§ì„  (Straight)' },
19 |   { value: ConnectionLineType.Step, label: 'ê³„ë‹¨ì‹ (Step)' },
20 |   { value: ConnectionLineType.SmoothStep, label: 'ë¶€ë“œëŸ¬ìš´ ê³„ë‹¨ì‹ (SmoothStep)' },
21 |   { value: ConnectionLineType.SimpleBezier, label: 'ë‹¨ìˆœ ê³¡ì„  (SimpleBezier)' },
22 | ];
23 | 
24 | // í™”ì‚´í‘œ ë§ˆì»¤ íƒ€ì… ì˜µì…˜
25 | export const MARKER_TYPE_OPTIONS = [
26 |   { value: MarkerType.Arrow, label: 'í™”ì‚´í‘œ (Arrow)' },
27 |   { value: MarkerType.ArrowClosed, label: 'ë‹«íŒ í™”ì‚´í‘œ (ArrowClosed)' },
28 |   { value: null, label: 'ì—†ìŒ (None)' },
29 | ];
30 | 
31 | // ì—°ê²°ì„  ë‘ê»˜ ì˜µì…˜
32 | export const STROKE_WIDTH_OPTIONS = [
33 |   { value: 1, label: 'ì–‡ê²Œ (1px)' },
34 |   { value: 2, label: 'ë³´í†µ (2px)' },
35 |   { value: 3, label: 'êµµê²Œ (3px)' },
36 |   { value: 4, label: 'ë§¤ìš° êµµê²Œ (4px)' },
37 | ];
38 | 
39 | // ë§ˆì»¤ í¬ê¸° ì˜µì…˜
40 | export const MARKER_SIZE_OPTIONS = [
41 |   { value: 10, label: 'ì‘ê²Œ (10px)' },
42 |   { value: 15, label: 'ë³´í†µ (15px)' },
43 |   { value: 20, label: 'í¬ê²Œ (20px)' },
44 |   { value: 25, label: 'ë§¤ìš° í¬ê²Œ (25px)' },
45 | ];
46 | 
47 | // ì—°ê²°ì„  ì• ë‹ˆë©”ì´ì…˜ ì˜µì…˜
48 | export const EDGE_ANIMATION_OPTIONS = [
49 |   { value: true, label: 'ì¼œê¸°' },
50 |   { value: false, label: 'ë„ê¸°' },
51 | ];
52 | 
53 | // ì—°ê²°ì„  ìƒ‰ìƒ ì˜µì…˜
54 | export const EDGE_COLOR_OPTIONS = [
55 |   { value: '#C1C1C1', label: 'íšŒìƒ‰ (ê¸°ë³¸)', color: '#C1C1C1' },
56 |   { value: '#000000', label: 'ê²€ì •ìƒ‰', color: '#000000' },
57 |   { value: '#FF0072', label: 'í•‘í¬ìƒ‰', color: '#FF0072' },
58 |   { value: '#3366FF', label: 'íŒŒë€ìƒ‰', color: '#3366FF' },
59 |   { value: '#43A047', label: 'ë…¹ìƒ‰', color: '#43A047' },
60 |   { value: '#FFC107', label: 'ë…¸ë€ìƒ‰', color: '#FFC107' },
61 |   { value: '#9C27B0', label: 'ë³´ë¼ìƒ‰', color: '#9C27B0' },
62 | ];
63 | 
64 | // ìŠ¤í† ë¦¬ì§€ í‚¤
65 | // export const STORAGE_KEY = 'backyard-board-layout';
[TRUNCATED]
```

src/lib/ideamap-ui-config.ts
```
1 | import { MarkerType, ConnectionLineType } from '@xyflow/react';
2 | import { I } from 'vitest/dist/chunks/reporters.d.CfRkRKN2.js';
3 | 
4 | import defaultConfig from '../config/uiOptions.json';
5 | 
6 | // ì¹´ë“œ ë³´ë“œ UI ì„¤ì • íƒ€ì… ì •ì˜
7 | export interface IdeaMapUIConfig {
8 |   autoSaveIntervalMinutes: number;
9 |   ideaMap: {
10 |     snapToGrid: boolean;
11 |     snapGrid: number[];
12 |     connectionLineType: string;
13 |     markerEnd: string | null;
14 |     strokeWidth: number;
15 |     markerSize: number;
16 |     edgeColor: string;
17 |     animated: boolean;
18 |     selectedEdgeColor: string;
19 |   };
20 |   card: {
21 |     defaultWidth: number;
22 |     backgroundColor: string;
23 |     borderRadius: number;
24 |     tagBackgroundColor: string;
25 |     fontSizes?: {
26 |       default: number;
27 |       title: number;
28 |       content: number;
29 |       tags: number;
30 |     };
31 |   };
32 |   handles: {
33 |     size: number;
34 |     backgroundColor: string;
35 |     borderColor: string;
36 |     borderWidth: number;
37 |   };
38 |   layout: {
39 |     defaultPadding: number;
40 |     defaultSpacing: {
41 |       horizontal: number;
42 |       vertical: number;
43 |     };
44 |     nodeSize?: {
45 |       width: number;
46 |       height: number;
47 |       maxHeight?: number;
48 |     };
49 |     graphSettings?: {
50 |       nodesep: number;
51 |       ranksep: number;
52 |       edgesep: number;
53 |     };
54 |   };
55 | }
56 | 
57 | // CSS ë³€ìˆ˜ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œë§Œ ì‘ë™)
58 | export function getCssVariable(name: string, fallback: string): string {
59 |   if (typeof window !== 'undefined') {
60 |     return getComputedStyle(document.documentElement).getPropertyValue(name).trim() || fallback;
61 |   }
62 |   return fallback;
63 | }
64 | 
65 | // CSS ë³€ìˆ˜ì—ì„œ ìˆ«ì ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
66 | export function getCssVariableAsNumber(name: string, fallback: number): number {
67 |   if (typeof window !== 'undefined') {
68 |     const value = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
69 |     if (value) {
70 |       // px ë‹¨ìœ„ ì œê±° ë° ìˆ«ìë¡œ ë³€í™˜
71 |       const numericValue = parseFloat(value.replace('px', '').replace('rem', ''));
72 |       return isNaN(numericValue) ? fallback : numericValue;
73 |     }
74 |   }
75 |   return fallback;
76 | }
77 | 
78 | // ê¸°ë³¸ ì„¤ì •ê°’ (íƒ€ì… ë³€í™˜ í¬í•¨)
79 | export const DEFAULT_UI_CONFIG: IdeaMapUIConfig = {
80 |   ...defaultConfig as IdeaMapUIConfig,
81 |   ideaMap: {
82 |     ...defaultConfig.ideaMap,
83 |     connectionLineType: defaultConfig.ideaMap.connectionLineType as ConnectionLineType,
84 |     markerEnd: defaultConfig.ideaMap.markerEnd as MarkerType,
[TRUNCATED]
```

src/lib/ideamap-utils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/lib/ideamap-utils.ts
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ ê´€ë ¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ëª¨ìŒ
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µ ì„¤ì • ê´€ë¦¬ ë° ìŠ¤íƒ€ì¼ ì ìš© ìœ í‹¸ë¦¬í‹° ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-22
6 |  * ìˆ˜ì •ì¼: 2024-05-29 : API URL í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
7 |  */
8 | 
9 | import { Edge, MarkerType, ConnectionLineType } from '@xyflow/react';
10 | 
11 | import { IDEAMAP_SETTINGS_STORAGE_KEY } from './ideamap-constants';
12 | 
13 | // API URL ê°€ì ¸ì˜¤ê¸°
14 | const getApiUrl = () => {
15 |   const apiUrl = process.env.NEXT_PUBLIC_API_URL || '';
16 |   return apiUrl;
17 | };
18 | 
19 | export interface IdeaMapSettings {
20 |   // ê·¸ë¦¬ë“œ ì„¤ì •
21 |   snapToGrid: boolean;
22 |   snapGrid: [number, number];
23 |   
24 |   // ì—°ê²°ì„  ì„¤ì •
25 |   connectionLineType: ConnectionLineType;
26 |   markerEnd: MarkerType | null;
27 |   strokeWidth: number;
28 |   markerSize: number;
29 |   edgeColor: string;
30 |   selectedEdgeColor: string;
31 |   animated: boolean;
32 | }
33 | 
34 | // ê¸°ë³¸ ì•„ì´ë””ì–´ë§µ ì„¤ì •
35 | export const DEFAULT_IDEAMAP_SETTINGS: IdeaMapSettings = {
36 |   // ê·¸ë¦¬ë“œ ì„¤ì •
37 |   snapToGrid: false,
38 |   snapGrid: [15, 15],
39 |   
40 |   // ì—°ê²°ì„  ì„¤ì •
41 |   connectionLineType: ConnectionLineType.SmoothStep,
42 |   markerEnd: MarkerType.Arrow,
43 |   strokeWidth: 2,
44 |   markerSize: 20,
45 |   edgeColor: '#C1C1C1',
46 |   selectedEdgeColor: '#FF0072',
47 |   animated: false,
48 | };
49 | 
50 | /**
51 |  * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
52 |  */
53 | export function loadIdeaMapSettings(): IdeaMapSettings {
54 |   if (typeof window === 'undefined') {
55 |     return DEFAULT_IDEAMAP_SETTINGS;
56 |   }
57 | 
58 |   try {
59 |     const savedSettings = localStorage.getItem(IDEAMAP_SETTINGS_STORAGE_KEY);
60 |     
61 |     if (!savedSettings) {
62 |       return DEFAULT_IDEAMAP_SETTINGS;
63 |     }
64 | 
65 |     // ì €ì¥ëœ ì„¤ì • ë³µì›
66 |     const parsedSettings = JSON.parse(savedSettings);
67 |     
68 |     // ê¸°ì¡´ ì„¤ì •ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ìœ¼ë¡œ í†µí•©
69 |     return {
70 |       ...DEFAULT_IDEAMAP_SETTINGS,
71 |       ...parsedSettings,
72 |     };
73 |   } catch (error) {
74 |     console.error('ì•„ì´ë””ì–´ë§µ ì„¤ì • ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
75 |     return DEFAULT_IDEAMAP_SETTINGS;
76 |   }
77 | }
78 | 
79 | /**
80 |  * ì•„ì´ë””ì–´ë§µ ì„¤ì •ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
81 |  */
82 | export function saveIdeaMapSettings(settings: IdeaMapSettings): void {
83 |   if (typeof window !== 'undefined') {
[TRUNCATED]
```

src/lib/layout-utils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: layout-utils.ts
3 |  * ëª©ì : React Flow ë…¸ë“œ ë ˆì´ì•„ì›ƒ ìë™í™”
4 |  * ì—­í• : ê·¸ë˜í”„ ë ˆì´ì•„ì›ƒ ê³„ì‚° ë° ë…¸ë“œ ë°°ì¹˜ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-06
6 |  * ìˆ˜ì •ì¼: 2025-03-27
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : ThemeContext ëŒ€ì‹  useAppStore(themeSlice) ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
8 |  */
9 | 
10 | import { Node, Edge, Position } from '@xyflow/react';
11 | import dagre from 'dagre';
12 | 
13 | import defaultConfig from '../config/uiOptions.json';
14 | import { useAppStore } from '@/store/useAppStore';
15 | 
16 | // ê¸°ë³¸ ë…¸ë“œ í¬ê¸° ì„¤ì • (ThemeContextê°€ ì—†ì„ ë•Œ í´ë°±ìš©)
17 | const DEFAULT_NODE_WIDTH = defaultConfig.layout.nodeSize?.width || 130;
18 | const DEFAULT_NODE_HEIGHT = defaultConfig.layout.nodeSize?.height || 48;
19 | 
20 | // ê·¸ë˜í”„ ê°„ê²© ì„¤ì • - ì„¤ì • íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¤ê¸°
21 | const GRAPH_SETTINGS = {
22 |   rankdir: 'LR', // ë°©í–¥: LR(ìˆ˜í‰) ë˜ëŠ” TB(ìˆ˜ì§)
23 |   nodesep: defaultConfig.layout.graphSettings.nodesep, // ê°™ì€ ë ˆë²¨ì˜ ë…¸ë“œ ê°„ ê±°ë¦¬ (í”½ì…€)
24 |   ranksep: defaultConfig.layout.graphSettings.ranksep, // ë ˆë²¨ ê°„ ê±°ë¦¬ (í”½ì…€)
25 |   edgesep: defaultConfig.layout.graphSettings.edgesep, // ì—£ì§€ ê°„ ê±°ë¦¬
26 |   marginx: defaultConfig.layout.defaultPadding || 20, // ê°€ë¡œ ë§ˆì§„ì€ defaultPadding ì‚¬ìš©
27 |   marginy: defaultConfig.layout.defaultPadding || 20  // ì„¸ë¡œ ë§ˆì§„ì€ defaultPadding ì‚¬ìš©
28 | };
29 | 
30 | /**
31 |  * React ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë ˆì´ì•„ì›ƒ í›…
32 |  * useAppStoreì—ì„œ ë…¸ë“œ í¬ê¸°ë¥¼ ê°€ì ¸ì™€ ë ˆì´ì•„ì›ƒì„ ê³„ì‚°í•©ë‹ˆë‹¤.
33 |  */
34 | export function useLayoutedElements() {
35 |   // useAppStoreì—ì„œ ideaMapSettings ê°€ì ¸ì˜¤ê¸°
36 |   const ideaMapSettings = useAppStore(state => state.ideaMapSettings);
37 |   
38 |   /**
39 |    * dagre ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë…¸ë“œì™€ ì—£ì§€ì˜ ë ˆì´ì•„ì›ƒì„ ì¬ë°°ì¹˜í•˜ëŠ” í•¨ìˆ˜
40 |    * 
41 |    * @param nodes ë…¸ë“œ ë°°ì—´
42 |    * @param edges ì—£ì§€ ë°°ì—´
43 |    * @param direction ë°°ì¹˜ ë°©í–¥ ('horizontal' ë˜ëŠ” 'vertical')
44 |    * @returns ë ˆì´ì•„ì›ƒì´ ì ìš©ëœ ë…¸ë“œì™€ ì—£ì§€
45 |    */
46 |   const getLayoutedElements = (
47 |     nodes: Node[],
48 |     edges: Edge[],
49 |     direction: 'horizontal' | 'vertical' = 'horizontal'
50 |   ) => {
51 |     // ë…¸ë“œë‚˜ ì—£ì§€ê°€ ì—†ëŠ” ê²½ìš° ê·¸ëŒ€ë¡œ ë°˜í™˜
52 |     if (nodes.length === 0) return { nodes, edges };
53 | 
54 |     // useAppStoreì—ì„œ ë…¸ë“œ í¬ê¸° ê°€ì ¸ì˜¤ê¸°
55 |     const NODE_WIDTH = ideaMapSettings.nodeWidth || DEFAULT_NODE_WIDTH;
56 |     const NODE_HEIGHT = ideaMapSettings.nodeSpacing || DEFAULT_NODE_HEIGHT;
57 | 
58 |     // ê·¸ë˜í”„ ìƒì„±
[TRUNCATED]
```

src/lib/logger.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: logger.ts
3 |  * ëª©ì : í†µí•© ë¡œê¹… ì‹œìŠ¤í…œ ì œê³µ
4 |  * ì—­í• : ë¸Œë¼ìš°ì €ì™€ ì„œë²„ ì–‘ìª½ì—ì„œ ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ê³  í•„ìš”ì‹œ ì„œë²„ë¡œ ë¡œê·¸ë¥¼ ì „ì†¡
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-07
7 |  * ìˆ˜ì •ì¼: 2025-04-19 : ë””ë²„ê·¸ ë¡œê·¸ ì •ë¦¬ - ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì¶œë ¥í•˜ë„ë¡ ê°œì„ 
8 |  */
9 | 
10 | // ë¡œê·¸ ë ˆë²¨ ì •ì˜
11 | export enum LogLevel {
12 |   DEBUG = 'debug',
13 |   INFO = 'info',
14 |   WARN = 'warn',
15 |   ERROR = 'error'
16 | }
17 | 
18 | // ë¡œê·¸ ë°ì´í„° ì¸í„°í˜ì´ìŠ¤
19 | interface LogData {
20 |   timestamp: string;
21 |   level: LogLevel;
22 |   module: string;
23 |   message: string;
24 |   data?: any;
25 |   sessionId?: string;
26 | }
27 | 
28 | // ì„¸ì…˜ ID ìƒì„±
29 | const generateSessionId = (): string => {
30 |   return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
31 | };
32 | 
33 | // ë¡œê·¸ ì €ì¥ì†Œ
34 | class LogStorage {
35 |   private static instance: LogStorage;
36 |   private logs: LogData[] = [];
37 |   private sessionId: string;
38 |   private readonly MAX_LOGS = 100;
39 | 
40 |   private constructor() {
41 |     this.sessionId = generateSessionId();
42 |     
43 |     // ë¸Œë¼ìš°ì € í™˜ê²½ì´ë©´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì„¸ì…˜ ID ë³µì› ì‹œë„
44 |     if (typeof window !== 'undefined') {
45 |       const storedSessionId = localStorage.getItem('logger.sessionId');
46 |       if (storedSessionId) {
47 |         this.sessionId = storedSessionId;
48 |       } else {
49 |         localStorage.setItem('logger.sessionId', this.sessionId);
50 |       }
51 |     }
52 |   }
53 | 
54 |   public static getInstance(): LogStorage {
55 |     if (!LogStorage.instance) {
56 |       LogStorage.instance = new LogStorage();
57 |     }
58 |     return LogStorage.instance;
59 |   }
60 | 
61 |   public getSessionId(): string {
62 |     return this.sessionId;
63 |   }
64 | 
65 |   public addLog(log: LogData): void {
66 |     // ì„¸ì…˜ ID ì¶”ê°€
67 |     log.sessionId = this.sessionId;
68 |     
69 |     // ë¡œê·¸ ì €ì¥
70 |     this.logs.push(log);
71 |     
72 |     // ìµœëŒ€ ë¡œê·¸ ìˆ˜ ì œí•œ
73 |     if (this.logs.length > this.MAX_LOGS) {
74 |       this.logs.shift();
75 |     }
76 |     
77 |     // ë¸Œë¼ìš°ì € í™˜ê²½ì´ë©´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë¡œê·¸ ì €ì¥
78 |     if (typeof window !== 'undefined') {
79 |       try {
[TRUNCATED]
```

src/lib/prisma.ts
```
1 | import { PrismaClient } from '@prisma/client';
2 | 
3 | // Prisma í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê¸€ë¡œë²Œë¡œ ê´€ë¦¬í•˜ì—¬ í•« ë¦¬ë¡œë“œ ì‹œ ì—°ê²°ì´ ì¤‘ë³µ ìƒì„±ë˜ëŠ” ê²ƒì„ ë°©ì§€
4 | const globalForPrisma = global as unknown as { prisma: PrismaClient };
5 | 
6 | // í™˜ê²½ ë³€ìˆ˜ ìœ íš¨ì„± í™•ì¸
7 | function validateEnv() {
8 |   const requiredEnvVars = ['DATABASE_URL'];
9 |   const missingEnvVars = requiredEnvVars.filter(envVar => !process.env[envVar]);
10 |   
11 |   if (missingEnvVars.length > 0) {
12 |     console.warn(`âš ï¸ ëˆ„ë½ëœ ë°ì´í„°ë² ì´ìŠ¤ í™˜ê²½ ë³€ìˆ˜: ${missingEnvVars.join(', ')}`);
13 |     return false;
14 |   }
15 |   return true;
16 | }
17 | 
18 | // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë¡œê¹… í™œì„±í™”, í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¹„í™œì„±í™”
19 | let prisma: PrismaClient;
20 | 
21 | try {
22 |   // í™˜ê²½ ë³€ìˆ˜ í™•ì¸
23 |   const isEnvValid = validateEnv();
24 |   
25 |   if (!isEnvValid && process.env.NODE_ENV === 'production') {
26 |     console.error('âŒ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ í•„ìˆ˜ ë°ì´í„°ë² ì´ìŠ¤ í™˜ê²½ ë³€ìˆ˜ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');
27 |     // í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ëª…ì‹œì ìœ¼ë¡œ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šê³  ë¡œê¹…ë§Œ ìˆ˜í–‰
28 |   }
29 |   
30 |   prisma = 
31 |     globalForPrisma.prisma ||
32 |     new PrismaClient({
33 |       log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],
34 |     });
35 |   
36 |   // ì—°ê²° í…ŒìŠ¤íŠ¸
37 |   if (process.env.NODE_ENV === 'development') {
38 |     prisma.$connect()
39 |       .then(() => console.log('âœ… Prisma ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ'))
40 |       .catch(error => console.error('âŒ Prisma ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨:', error));
41 |   }
42 | } catch (error) {
43 |   console.error('âŒ Prisma í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
44 |   // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì˜¤ë¥˜ ë°œìƒ ì‹œ ë”ë¯¸ Prisma í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©
45 |   if (process.env.NODE_ENV !== 'production') {
46 |     console.warn('âš ï¸ ë”ë¯¸ Prisma í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì´ ì œí•œë©ë‹ˆë‹¤.');
47 |     // @ts-ignore - ë”ë¯¸ í´ë¼ì´ì–¸íŠ¸ ìƒì„±
48 |     prisma = new Proxy({}, {
49 |       get: (target, prop) => {
50 |         // ê¸°ë³¸ ì†ì„±
51 |         if (prop === 'then' || prop === '$connect' || prop === '$disconnect') {
52 |           return () => Promise.resolve();
53 |         }
54 |         // ëª¨ë¸ ì ‘ê·¼ ì‹œ ë”ë¯¸ ëª¨ë¸ ë°˜í™˜
55 |         return new Proxy({}, {
56 |           get: () => (...args: any[]) => {
57 |             console.warn(`âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì—†ì´ Prisma ì‘ì—…ì´ í˜¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤: ${String(prop)}`);
58 |             return Promise.resolve([]);
59 |           }
60 |         });
61 |       }
62 |     });
63 |   } else {
[TRUNCATED]
```

src/lib/supabase-server.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: supabase-server.ts
3 |  * ëª©ì : ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ì ‘ê·¼
4 |  * ì—­í• : ì„œë²„ ì¸¡ Supabase ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-03-08
6 |  * ìˆ˜ì •ì¼: 2025-03-27
7 |  */
8 | 
9 | import { cookies } from 'next/headers';
10 | 
11 | import { createServerClient } from '@supabase/ssr';
12 | 
13 | import { Database } from '../types/supabase';
14 | 
15 | /**
16 |  * createServerSupabaseClient: ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
17 |  * ê° ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ ì‚¬ìš© ë¶ˆê°€)
18 |  * @returns ì„œë²„ìš© Supabase í´ë¼ì´ì–¸íŠ¸
19 |  */
20 | export async function createServerSupabaseClient() {
21 |   const cookieStore = await cookies();
22 |   
23 |   return createServerClient<Database>(
24 |     process.env.NEXT_PUBLIC_SUPABASE_URL!,
25 |     process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
26 |     {
27 |       cookies: {
28 |         get(name: string) {
29 |           return cookieStore.get(name)?.value;
30 |         },
31 |         set(name: string, value: string, options: any) {
32 |           // Next.js App Routerì—ì„œëŠ” ì¿ í‚¤ë¥¼ ì§ì ‘ ì„¤ì •í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ
33 |           // ì´ í•¨ìˆ˜ëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œì˜ ì‘ë‹µì— í¬í•¨ë  ë•Œë§Œ ë™ì‘í•©ë‹ˆë‹¤
34 |         },
35 |         remove(name: string, options: any) {
36 |           // ë§ˆì°¬ê°€ì§€ë¡œ í´ë¼ì´ì–¸íŠ¸ë¡œì˜ ì‘ë‹µì— í¬í•¨ë  ë•Œë§Œ ë™ì‘
37 |         },
38 |       },
39 |     }
40 |   );
41 | }
42 | 
43 | /**
44 |  * getServerSession: ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ í˜„ì¬ ì„¸ì…˜ ì¡°íšŒ
45 |  * @returns Supabase ì„¸ì…˜ ë˜ëŠ” null
46 |  */
47 | export async function getServerSession() {
48 |   try {
49 |     const supabase = await createServerSupabaseClient();
50 |     const { data: { session } } = await supabase.auth.getSession();
51 |     return session;
52 |   } catch (error) {
53 |     console.error('ì„œë²„ ì„¸ì…˜ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:', error);
54 |     return null;
55 |   }
56 | } 
```

src/lib/utils.ts
```
1 | import { type ClassValue, clsx } from "clsx"
2 | import { twMerge } from "tailwind-merge"
3 | 
4 | export function cn(...inputs: ClassValue[]) {
5 |   return twMerge(clsx(inputs))
6 | }
7 | 
8 | /**
9 |  * ë‚ ì§œ ë¬¸ìì—´ì„ í¬ë§·íŒ…í•©ë‹ˆë‹¤.
10 |  * @param {string | Date} dateInput - ë‚ ì§œ ë¬¸ìì—´ ë˜ëŠ” Date ê°ì²´
11 |  * @returns {string} í¬ë§·íŒ…ëœ ë‚ ì§œ ë¬¸ìì—´
12 |  */
13 | export function formatDate(dateInput: string | Date): string {
14 |   if (!dateInput) return '';
15 |   
16 |   try {
17 |     const date = dateInput instanceof Date ? dateInput : new Date(dateInput);
18 |     
19 |     // ìœ íš¨í•œ ë‚ ì§œì¸ì§€ í™•ì¸
20 |     if (isNaN(date.getTime())) {
21 |       return String(dateInput);
22 |     }
23 |     
24 |     // YYYYë…„ MMì›” DDì¼ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
25 |     return date.toLocaleDateString('ko-KR', {
26 |       year: 'numeric',
27 |       month: 'long',
28 |       day: 'numeric',
29 |       hour: '2-digit',
30 |       minute: '2-digit'
31 |     });
32 |   } catch (error) {
33 |     console.error('ë‚ ì§œ í¬ë§·íŒ… ì˜¤ë¥˜:', error);
34 |     return String(dateInput);
35 |   }
36 | }
37 | 
38 | // í…ìŠ¤íŠ¸ì—ì„œ íƒœê·¸ ì¶”ì¶œ (#íƒœê·¸ í˜•ì‹)
39 | export function extractTags(text: string): string[] {
40 |   const tagPattern = /#([a-zA-Z0-9ê°€-í£_\-]+)/g;
41 |   const matches = text.match(tagPattern);
42 |   
43 |   if (!matches) return [];
44 |   
45 |   return matches.map(tag => tag.slice(1)); // # ì œê±°
46 | }
47 | 
48 | // í…ìŠ¤íŠ¸ì—ì„œ íƒœê·¸ë¥¼ ë³€í™˜ (#íƒœê·¸ -> Badge ì»´í¬ë„ŒíŠ¸ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•œ ì¤€ë¹„)
49 | export function parseTagsInText(text: string): { text: string, tags: string[] } {
50 |   const tags = extractTags(text);
51 |   return { text, tags };
52 | }
53 | 
54 | /**
55 |  * hexToHsl: 16ì§„ìˆ˜ ìƒ‰ìƒ ì½”ë“œë¥¼ HSL ìƒ‰ìƒê°’ìœ¼ë¡œ ë³€í™˜
56 |  * @param {string} hex - 16ì§„ìˆ˜ ìƒ‰ìƒ ì½”ë“œ (ì˜ˆ: "#ff0000")
57 |  * @returns {{ h: number, s: number, l: number } | null} HSL ìƒ‰ìƒê°’ ë˜ëŠ” ë³€í™˜ ì‹¤íŒ¨ ì‹œ null
58 |  */
59 | export function hexToHsl(hex: string): { h: number, s: number, l: number } | null {
60 |   if (!hex) return null;
61 |   
62 |   // hexë¥¼ RGBë¡œ ë³€í™˜
63 |   const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
64 |   if (!result) return null;
65 |   
66 |   const r = parseInt(result[1], 16) / 255;
[TRUNCATED]
```

src/tests/helper.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/tests/helper.ts
3 |  * ëª©ì : í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì œê³µ
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì‚¬ìš©ë˜ëŠ” ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ëª¨ìŒ
5 |  * ì‘ì„±ì¼: 2025-03-30
6 |  */
7 | 
8 | /**
9 |  * flushPromises: ë¹„ë™ê¸° ì‘ì—…ì´ ì²˜ë¦¬ë  ìˆ˜ ìˆë„ë¡ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ë¹„ì›ë‹ˆë‹¤.
10 |  * @returns {Promise<void>} ë¹„ë™ê¸° ì‘ì—…ì´ ì™„ë£Œëœ í›„ì˜ í”„ë¡œë¯¸ìŠ¤
11 |  */
12 | export const flushPromises = (): Promise<void> => {
13 |   return new Promise(resolve => setTimeout(resolve, 0));
14 | }; 
```

src/tests/setup.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: setup.ts
3 |  * ëª©ì : Vitest í…ŒìŠ¤íŠ¸ ì„¤ì •
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì • ë° ì „ì—­ ì„¤ì • ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-08 - waitFor ì œëŒ€ë¡œ ì‘ë™í•˜ë„ë¡ setTimeout ëª¨í‚¹ ë°©ì‹ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2023-10-27 : ë¦°í„° ì˜¤ë¥˜ ìˆ˜ì • (ë¯¸ì‚¬ìš© ë³€ìˆ˜/í•¨ìˆ˜ ì œê±°, íƒ€ì… ë¬¸ì œ í•´ê²°)
8 |  */
9 | 
10 | import '@testing-library/jest-dom/vitest';
11 | import * as matchers from '@testing-library/jest-dom/matchers';
12 | import { cleanup } from '@testing-library/react';
13 | import { beforeEach, afterEach, vi, expect, beforeAll, afterAll } from 'vitest';
14 | 
15 | import { server } from './msw/server'; // MSW ì„œë²„ ì„í¬íŠ¸
16 | 
17 | // Testing Libraryì˜ jest-dom ë§¤ì²˜ í™•ì¥
18 | expect.extend(matchers);
19 | 
20 | // --- MSW ì„œë²„ ì„¤ì • ---
21 | // Node.js v20 undici íƒ€ì„ì•„ì›ƒ ì´ìŠˆ í•´ê²°ì„ ìœ„í•œ ì„¤ì •
22 | beforeAll(() => {
23 |   // fetch íƒ€ì„ì•„ì›ƒ ê´€ë ¨ ì´ìŠˆ í•´ê²°ì„ ìœ„í•´ bypass ëª¨ë“œ ì‚¬ìš©
24 |   server.listen({ 
25 |     onUnhandledRequest: 'bypass',
26 |   });
27 |   
28 |   // íƒ€ì´ë¨¸ ëª¨í‚¹ ì œê±° - wait-forê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ë„ë¡ ìˆ˜ì •
29 |   // ì‹¤ì œ íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •
30 |   if (typeof window !== 'undefined') {
31 |     // ì‹¤ì œ íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš© (ëª¨í‚¹í•˜ì§€ ì•ŠìŒ)
32 |     vi.useRealTimers(); // waitForê°€ ì˜ì¡´í•˜ëŠ” ì‹¤ì œ íƒ€ì´ë¨¸ ì‚¬ìš©
33 |   }
34 | });
35 | 
36 | afterEach(() => {
37 |   // ê° í…ŒìŠ¤íŠ¸ í›„ í•¸ë“¤ëŸ¬ ì´ˆê¸°í™”
38 |   server.resetHandlers();
39 |   // React ì»´í¬ë„ŒíŠ¸ ì •ë¦¬
40 |   cleanup();
41 | });
42 | 
43 | afterAll(() => {
44 |   // ëª¨ë“  í…ŒìŠ¤íŠ¸ í›„ ì„œë²„ ì •ë¦¬
45 |   server.close();
46 | });
47 | // --- MSW ì„œë²„ ì„¤ì • ë ---
48 | 
49 | // í•­ìƒ document.bodyê°€ ì¡´ì¬í•˜ë„ë¡ í•¨
50 | if (typeof document !== 'undefined' && !document.body) {
51 |   document.body = document.createElement('body');
52 | }
53 | 
54 | // Logger ëª¨í‚¹ (ì‹¤ì œ êµ¬í˜„ê³¼ ì¼ì¹˜í•˜ë„ë¡ ìˆ˜ì •)
55 | vi.mock('@/lib/logger', () => {
56 |   const mockLogs: any[] = [];
57 |   const mockSessionId = 'test-session-id';
58 |   let isWindowDefined = true;
59 | 
60 |   const mockLogStorage = {
61 |     getInstance: vi.fn(() => ({
62 |       getSessionId: vi.fn(() => mockSessionId),
63 |       addLog: vi.fn((log: any) => {
64 |         log.sessionId = mockSessionId;
65 |         mockLogs.push(log);
66 |         if (mockLogs.length > 100) mockLogs.shift();
67 |         
68 |         if (isWindowDefined) {
[TRUNCATED]
```

src/tests/test-utils.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: test-utils.tsx
3 |  * ëª©ì : í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ë° ë˜í¼ ì œê³µ
4 |  * ì—­í• : Next.js, React ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ìœ í‹¸ë¦¬í‹° ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-30
6 |  * ìˆ˜ì •ì¼: 2025-04-01
7 |  * ìˆ˜ì •ì¼: 2023-10-27 : ë¦°í„° ì˜¤ë¥˜ ìˆ˜ì • (ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±°)
8 |  */
9 | 
10 | import React, { ReactElement, ReactNode } from 'react';
11 | 
12 | import { render as rtlRender, RenderOptions, RenderResult, screen as rtlScreen } from '@testing-library/react';
13 | import userEvent from '@testing-library/user-event';
14 | import { Node, Edge, ReactFlowInstance, MarkerType } from '@xyflow/react';
15 | import { vi, expect as vitestExpect } from 'vitest';
16 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
17 | 
18 | import { CardData } from '@/components/ideamap/types/ideamap-types';
19 | 
20 | // XYFlow ëª¨í‚¹
21 | export const mockReactFlow = {
22 |     project: vi.fn(({ x, y }) => ({ x, y })),
23 |     getIntersectingNodes: vi.fn(() => []),
24 |     getNode: vi.fn(),
25 |     getNodes: vi.fn(() => []),
26 |     getEdge: vi.fn(),
27 |     getEdges: vi.fn(() => []),
28 |     viewportInitialized: true,
29 |     getViewport: vi.fn(() => ({ x: 0, y: 0, zoom: 1 })),
30 |     screenToFlowPosition: vi.fn(({ x, y }) => ({ x, y })),
31 | } as unknown as ReactFlowInstance;
32 | 
33 | // í…ŒìŠ¤íŠ¸ ë…¸ë“œ ìƒì„± ìœ í‹¸ë¦¬í‹°
34 | export const createTestNode = (id: string, position = { x: 0, y: 0 }): Node<CardData> => ({
35 |     id,
36 |     type: 'default',
37 |     position,
38 |     data: {
39 |         id,
40 |         title: `Test Card ${id}`,
41 |         content: `Test Content ${id}`,
42 |         tags: [],
43 |     },
44 | });
45 | 
46 | // í…ŒìŠ¤íŠ¸ ì—£ì§€ ìƒì„± ìœ í‹¸ë¦¬í‹°
47 | export const createTestEdge = (id: string, source: string, target: string): Edge => ({
48 |     id,
49 |     source,
50 |     target,
51 |     type: 'default',
52 |     markerEnd: MarkerType.ArrowClosed,
53 | });
54 | 
55 | // ì´ë²¤íŠ¸ ê°ì²´ ìƒì„± ìœ í‹¸ë¦¬í‹°
56 | export const createDragEvent = (data: any = {}): React.DragEvent => ({
57 |     preventDefault: vi.fn(),
58 |     stopPropagation: vi.fn(),
59 |     dataTransfer: {
60 |         dropEffect: 'none',
61 |         getData: vi.fn(() => {
62 |             try {
63 |                 return typeof data === 'string' ? data : JSON.stringify(data);
64 |             } catch {
65 |                 return '';
66 |             }
67 |         }),
[TRUNCATED]
```

src/types/card.ts
```
1 | export interface User {
2 |   id: string;
3 |   name: string | null;
4 | }
5 | 
6 | export interface Card {
7 |   id: string;
8 |   title: string;
9 |   content: string | null;
10 |   createdAt: string;
11 |   updatedAt: string;
12 |   userId: string;
13 |   user?: User;
14 |   cardTags?: Array<{ tag: { id: string; name: string; } }>;
15 | }
16 | 
17 | export interface CreateCardInput {
18 |   title: string;
19 |   content?: string;
20 |   userId: string;
21 |   tags?: string[];
22 | }
23 | 
24 | export interface UpdateCardInput {
25 |   title?: string;
26 |   content?: string;
27 |   tags?: string[];
28 | } 
```

src/types/flow.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/types/flow.ts
3 |  * ëª©ì : ReactFlow ê´€ë ¨ íƒ€ì… ì •ì˜
4 |  * ì—­í• : ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ë˜ëŠ” ReactFlow ê´€ë ¨ íƒ€ì…ë“¤ì„ ì •ì˜
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : RefObjectì™€ Edge íƒ€ì… ê´€ë ¨ ì˜¤ë¥˜ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2023-10-27 : ESLint ì˜¤ë¥˜ ìˆ˜ì • (import ìˆœì„œ, ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±°, any íƒ€ì… ì œê±°)
8 |  */
9 | 
10 | import React from 'react';
11 | 
12 | import { Edge as ReactFlowEdge } from '@xyflow/react';
13 | 
14 | export interface NodeData {
15 |   id: string;
16 |   title: string;
17 |   content: string;
18 |   type?: string;
19 |   width?: number;
20 |   height?: number;
21 |   color?: string;
22 |   tags?: string[];
23 |   position?: {
24 |     x: number;
25 |     y: number;
26 |   };
27 |   // ì¶”ê°€ ì†ì„±ë“¤
28 |   [key: string]: unknown;
29 | }
30 | 
31 | /**
32 |  * SafeRefObject: HTMLElementì— ëŒ€í•œ RefObject íƒ€ì… í™•ì¥
33 |  * - null í—ˆìš©í•˜ì§€ ì•ŠëŠ” RefObject<HTMLElement> íƒ€ì…ì„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ íƒ€ì…
34 |  */
35 | export type SafeRefObject<T extends HTMLElement> = React.RefObject<T>;
36 | 
37 | /**
38 |  * Edge: ReactFlow Edge íƒ€ì… í™•ì¥
39 |  * - ReactFlowì˜ Edge íƒ€ì…ì„ í™•ì¥í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í•„ìš”í•œ ì†ì„± ì¶”ê°€
40 |  */
41 | export type Edge = ReactFlowEdge;
42 | 
43 | /**
44 |  * EdgeChangeHandler: Edge ë³€ê²½ í•¸ë“¤ëŸ¬ íƒ€ì…
45 |  * - Edge ë°°ì—´ì„ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜ì˜ íƒ€ì… ì •ì˜
46 |  */
47 | export type EdgeChangeHandler = (edges: Edge[]) => void; 
```

src/types/global.d.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: global.d.ts
3 |  * ëª©ì : ì „ì—­ íƒ€ì… ì„ ì–¸
4 |  * ì—­í• : ì „ì—­ ë³€ìˆ˜ ë° í™•ì¥ íƒ€ì…ì„ ì„ ì–¸
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : any íƒ€ì…ì„ unknownìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ESLint ì˜¤ë¥˜ ìˆ˜ì •
7 |  */
8 | 
9 | import { SupabaseClient } from '@supabase/supabase-js';
10 | 
11 | import { Database } from './supabase';
12 | 
13 | declare global {
14 |   interface Window {
15 |     /**
16 |      * ì „ì—­ Supabase ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
17 |      */
18 |     __SUPABASE_SINGLETON_CLIENT?: SupabaseClient<Database>;
19 |     
20 |     /**
21 |      * Supabase ê²½ê³  ë¹„í™œì„±í™” í”Œë˜ê·¸
22 |      */
23 |     __SUPABASE_DISABLE_WARNING?: boolean;
24 |   }
25 |   
26 |   /**
27 |    * ì½˜ì†” ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë“œë¥¼ ìœ„í•œ íƒ€ì… ì„ ì–¸
28 |    */
29 |   interface Console {
30 |     warn: (...data: unknown[]) => void;
31 |     originalWarn?: (...data: unknown[]) => void;
32 |   }
33 | } 
```

src/types/supabase.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/types/supabase.ts
3 |  * ëª©ì : Supabase ë°ì´í„°ë² ì´ìŠ¤ íƒ€ì… ì •ì˜
4 |  * ì—­í• : Supabase ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ íƒ€ì…ì„ ì •ì˜í•˜ì—¬ íƒ€ì… ì•ˆì •ì„± ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : ë¹ˆ ê°ì²´ íƒ€ì…({})ì„ ëª…ì‹œì ì¸ íƒ€ì…ìœ¼ë¡œ ë³€ê²½
7 |  */
8 | 
9 | export type Json =
10 |   | string
11 |   | number
12 |   | boolean
13 |   | null
14 |   | { [key: string]: Json | undefined }
15 |   | Json[]
16 | 
17 | // Supabase ë°ì´í„°ë² ì´ìŠ¤ì˜ íƒ€ì… ì •ì˜
18 | export interface Database {
19 |   public: {
20 |     Tables: {
21 |       users: {
22 |         Row: {
23 |           id: string
24 |           email: string
25 |           name: string | null
26 |           created_at: string
27 |           updated_at: string
28 |         }
29 |         Insert: {
30 |           id?: string
31 |           email: string
32 |           name?: string | null
33 |           created_at?: string
34 |           updated_at?: string
35 |         }
36 |         Update: {
37 |           id?: string
38 |           email?: string
39 |           name?: string | null
40 |           updated_at?: string
41 |         }
42 |       }
43 |       cards: {
44 |         Row: {
45 |           id: string
46 |           title: string
47 |           content: string | null
48 |           user_id: string
49 |           created_at: string
50 |           updated_at: string
51 |         }
52 |         Insert: {
53 |           id?: string
54 |           title: string
55 |           content?: string | null
56 |           user_id: string
57 |           created_at?: string
58 |           updated_at?: string
59 |         }
60 |         Update: {
61 |           id?: string
62 |           title?: string
63 |           content?: string | null
64 |           user_id?: string
65 |           updated_at?: string
66 |         }
67 |       }
68 |       tags: {
69 |         Row: {
70 |           id: string
71 |           name: string
72 |           created_at: string
73 |           updated_at: string
74 |         }
75 |         Insert: {
76 |           id?: string
77 |           name: string
78 |           created_at?: string
79 |           updated_at?: string
80 |         }
81 |         Update: {
82 |           id?: string
83 |           name?: string
84 |           updated_at?: string
85 |         }
86 |       }
87 |       card_tags: {
88 |         Row: {
89 |           id: string
90 |           card_id: string
91 |           tag_id: string
92 |           created_at: string
[TRUNCATED]
```

src/types/vitest.d.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/types/vitest.d.ts
3 |  * ëª©ì : Vitestì™€ Testing Library íƒ€ì… í™•ì¥ ì„ ì–¸
4 |  * ì—­í• : ì „ì—­ íƒ€ì… í™•ì¥ ë° í…ŒìŠ¤íŠ¸ ê´€ë ¨ íƒ€ì… ì •ì˜
5 |  * ì‘ì„±ì¼: 2025-05-15
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : ESLint ì˜¤ë¥˜ ìˆ˜ì • (ë¯¸ì‚¬ìš© import ì œê±°, ë¹ˆ ì¸í„°í˜ì´ìŠ¤ ìˆ˜ì •)
7 |  */
8 | 
9 | import type { TestingLibraryMatchers } from '@testing-library/jest-dom/matchers';
10 | 
11 | declare global {
12 |   namespace Vi {
13 |     // jest.Matchers íƒ€ì…ì„ ìƒì†ë°›ì•„ JestAssertion í™•ì¥
14 |     interface JestAssertion<T = unknown> extends jest.Matchers<void, T> {
15 |       // ì¶”ê°€ í™•ì¥ ê¸°ëŠ¥ì´ í•„ìš”í•œ ê²½ìš° ì—¬ê¸°ì— êµ¬í˜„
16 |       toBeSomething(): void;
17 |     }
18 |   }
19 | 
20 |   // @testing-library/jest-dom í™•ì¥
21 |   interface Matchers<R = void> extends TestingLibraryMatchers<typeof expect.stringContaining, R> {
22 |     // ì¶”ê°€ í™•ì¥ ê¸°ëŠ¥ì´ í•„ìš”í•œ ê²½ìš° ì—¬ê¸°ì— êµ¬í˜„
23 |     toBeSomethingElse(): R;
24 |   }
25 | } 
```

src/store/cardStateSlice.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/store/cardStateSlice.ts
3 |  * ëª©ì : ì¹´ë“œ ì„ íƒ ë° í™•ì¥ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” Zustand ìŠ¬ë¼ì´ìŠ¤
4 |  * ì—­í• : ì¹´ë“œ ì„ íƒ(selectedCardIds) ë° í™•ì¥(expandedCardId) ìƒíƒœì™€ ê´€ë ¨ ì•¡ì…˜ ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : Zustand v5 ë¬¸ë²•ì— ë§ê²Œ StateCreator ì‹œê·¸ë‹ˆì²˜ ìˆ˜ì •
7 |  */
8 | 
9 | import { StateCreator } from 'zustand';
10 | 
11 | /**
12 |  * ì¹´ë“œ ìƒíƒœ ìŠ¬ë¼ì´ìŠ¤ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
13 |  */
14 | export interface CardStateState {
15 |   // í˜„ì¬ ì„ íƒëœ ì¹´ë“œë“¤ì˜ ID ëª©ë¡ (ë©€í‹°ì„ íƒ ì§€ì›)
16 |   selectedCardIds: string[];
17 |   
18 |   // í˜„ì¬ í™•ì¥ëœ ì¹´ë“œ ID (í•˜ë‚˜ë§Œ ê°€ëŠ¥)
19 |   expandedCardId: string | null;
20 |   
21 |   // ì„ íƒëœ ì¹´ë“œ ID (ë‹¨ì¼ ì„ íƒ ì§€ì›, ì²« ë²ˆì§¸ ì„ íƒëœ ì¹´ë“œ ID)
22 |   selectedCardId: string | null;
23 | 
24 |   // ì•¡ì…˜
25 |   // ì—¬ëŸ¬ ì¹´ë“œ ì„ íƒ ì„¤ì • (ê¸°ì¡´ ì„ íƒ êµì²´)
26 |   selectCards: (ids: string[]) => void;
27 |   
28 |   // ë‹¨ì¼ ì¹´ë“œ ì„ íƒ (ê¸°ì¡´ ì„ íƒ êµì²´)
29 |   selectCard: (id: string | null) => void;
30 |   
31 |   // ì¹´ë“œ ì„ íƒ í† ê¸€ (ìˆìœ¼ë©´ ì œê±°, ì—†ìœ¼ë©´ ì¶”ê°€)
32 |   toggleSelectedCard: (id: string) => void;
33 |   
34 |   // ì„ íƒ í•´ì œ (ëª¨ë“  ì¹´ë“œ)
35 |   clearSelectedCards: () => void;
36 |   
37 |   // ì¹´ë“œ í™•ì¥ í† ê¸€ (ê°™ì€ ID í˜¸ì¶œ ì‹œ ë‹«í˜)
38 |   toggleExpandCard: (id: string) => void;
39 | }
40 | 
41 | /**
42 |  * createCardStateSlice: ì¹´ë“œ ì„ íƒ ìƒíƒœ ê´€ë ¨ Zustand ìŠ¬ë¼ì´ìŠ¤ ìƒì„±
43 |  * @param set - Zustand ìƒíƒœ ì„¤ì • í•¨ìˆ˜
44 |  * @param get - Zustand ìƒíƒœ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
45 |  * @returns CardStateState ê°ì²´
46 |  */
47 | export const createCardStateSlice: StateCreator<CardStateState> = (set, get) => ({
48 |   // ì´ˆê¸° ìƒíƒœ
49 |   selectedCardIds: [],
50 |   expandedCardId: null,
51 |   selectedCardId: null,
52 |   
53 |   // ì•¡ì…˜
54 |   /**
55 |    * selectCards: ì—¬ëŸ¬ ì¹´ë“œ ì„ íƒ ì„¤ì •
56 |    * @param ids - ì„ íƒí•  ì¹´ë“œ ID ë°°ì—´
57 |    */
58 |   selectCards: (ids) => set({ 
59 |     selectedCardIds: ids,
60 |     selectedCardId: ids.length > 0 ? ids[0] : null 
61 |   }),
62 |   
63 |   /**
64 |    * selectCard: ë‹¨ì¼ ì¹´ë“œ ì„ íƒ
65 |    * @param id - ì„ íƒí•  ì¹´ë“œ ID ë˜ëŠ” null (ì„ íƒ í•´ì œ)
66 |    */
67 |   selectCard: (id) => set({ 
68 |     selectedCardIds: id ? [id] : [],
69 |     selectedCardId: id 
70 |   }),
71 |   
72 |   /**
73 |    * toggleSelectedCard: ì¹´ë“œ ì„ íƒ ìƒíƒœ í† ê¸€
[TRUNCATED]
```

src/store/ideaMapSlice.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/store/ideaMapSlice.ts
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ UI ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” Zustand ìŠ¬ë¼ì´ìŠ¤
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µ UI ì„¤ì • ë° ReactFlow ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { ReactFlowInstance, ConnectionLineType, MarkerType } from '@xyflow/react';
9 | import { StateCreator } from 'zustand';
10 | 
11 | import { IdeaMapSettings, DEFAULT_IDEAMAP_SETTINGS } from '@/lib/ideamap-utils';
12 | 
13 | /**
14 |  * ì•„ì´ë””ì–´ë§µ ìƒíƒœ ì¸í„°í˜ì´ìŠ¤
15 |  */
16 | export interface IdeaMapState {
17 |   // React Flow ì¸ìŠ¤í„´ìŠ¤
18 |   reactFlowInstance: ReactFlowInstance | null;
19 |   setReactFlowInstance: (instance: ReactFlowInstance | null) => void;
20 |   
21 |   // ì•„ì´ë””ì–´ë§µ ì„¤ì • (UI ìƒíƒœ)
22 |   ideaMapSettings: IdeaMapSettings;
23 |   updateIdeaMapSettings: (settings: Partial<IdeaMapSettings>) => void;
24 |   
25 |   // ë ˆì´ì•„ì›ƒ ë°©í–¥
26 |   layoutDirection: 'horizontal' | 'vertical' | 'auto' | null;
27 |   setLayoutDirection: (direction: 'horizontal' | 'vertical' | 'auto' | null) => void;
28 | }
29 | 
30 | /**
31 |  * createIdeaMapSlice: ì•„ì´ë””ì–´ë§µ UI ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” Zustand ìŠ¬ë¼ì´ìŠ¤ ìƒì„±
32 |  */
33 | export const createIdeaMapSlice: StateCreator<IdeaMapState> = (set) => ({
34 |   // React Flow ì¸ìŠ¤í„´ìŠ¤
35 |   reactFlowInstance: null,
36 |   setReactFlowInstance: (instance) => set({ reactFlowInstance: instance }),
37 |   
38 |   // ì•„ì´ë””ì–´ë§µ ì„¤ì • (UI ìƒíƒœ)
39 |   ideaMapSettings: DEFAULT_IDEAMAP_SETTINGS,
40 |   updateIdeaMapSettings: (newSettings) => set((state) => ({ 
41 |     ideaMapSettings: { ...state.ideaMapSettings, ...newSettings } 
42 |   })),
43 |   
44 |   // ë ˆì´ì•„ì›ƒ ë°©í–¥
45 |   layoutDirection: null,
46 |   setLayoutDirection: (direction) => set({ layoutDirection: direction }),
47 | }); 
```

src/store/themeSlice.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/store/themeSlice.ts
3 |  * ëª©ì : ì•± í…Œë§ˆ ë° ë””ìì¸ ê´€ë ¨ ìƒíƒœ ê´€ë¦¬
4 |  * ì—­í• : ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ, ë…¸ë“œ í¬ê¸° ë“± í…Œë§ˆ ê´€ë ¨ ì „ì—­ ìƒíƒœì™€ ì•¡ì…˜ ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : layoutDirection ì†ì„± ì¶”ê°€
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : StateCreator ì‹œê·¸ë‹ˆì²˜ë¥¼ Zustand v5ì— ë§ê²Œ ìˆ˜ì •
8 |  * ìˆ˜ì •ì¼: 2025-04-21 : strokeWidth ì†ì„± ì¶”ê°€
9 |  * ìˆ˜ì •ì¼: 2025-04-21 : connectionLineType, markerEnd ì†ì„± ì¶”ê°€ ë° ê¸°ì¡´ ì†ì„±ë“¤ í™•ì¸
10 |  */
11 | 
12 | import { StateCreator } from 'zustand'
13 | import { ConnectionLineType, MarkerType } from '@xyflow/react';
14 | 
15 | /**
16 |  * í…Œë§ˆ ìƒíƒœ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
17 |  */
18 | export interface ThemeState {
19 |   // í…Œë§ˆ ëª¨ë“œ (ë¼ì´íŠ¸/ë‹¤í¬)
20 |   themeMode: 'light' | 'dark' | 'system';
21 |   
22 |   // ì•„ì´ë””ì–´ë§µ ê´€ë ¨ ì„¤ì •
23 |   ideaMapSettings: {
24 |     nodeWidth: number;
25 |     nodeSpacing: number;
26 |     maxNodeHeight: number;
27 |     nodeBorderRadius: number;
28 |     nodeFontSize: number;
29 |     edgeType: 'bezier' | 'step' | 'straight';
30 |     edgeWidth: number;
31 |     strokeWidth: number;
32 |     snapGrid: [number, number];
33 |     snapToGrid: boolean;
34 |     connectionLineType: ConnectionLineType;
35 |     markerEnd: MarkerType | null;
36 |     markerSize: number;
37 |     edgeColor: string;
38 |     selectedEdgeColor: string;
39 |     animated: boolean;
40 |     [key: string]: any; // ì¶”ê°€ ì„¤ì •ì„ ìœ„í•œ ì¸ë±ìŠ¤ ì‹œê·¸ë‹ˆì²˜
41 |   };
42 |   
43 |   // ë ˆì´ì•„ì›ƒ ì˜µì…˜ (ìˆ˜í‰/ìˆ˜ì§/ìë™ë°°ì¹˜/ì—†ìŒ)
44 |   layoutDirection: 'horizontal' | 'vertical' | 'auto' | 'none';
45 |   setLayoutDirection: (direction: 'horizontal' | 'vertical' | 'auto' | 'none') => void;
46 |   
47 |   // ì•¡ì…˜
48 |   toggleThemeMode: () => void;
49 |   setThemeMode: (mode: 'light' | 'dark' | 'system') => void;
50 |   updateIdeaMapSettings: (settings: Partial<ThemeState['ideaMapSettings']>) => void;
51 |   resetIdeaMapSettings: () => void;
52 | }
53 | 
54 | // ê¸°ë³¸ ì•„ì´ë””ì–´ë§µ ì„¤ì • ê°’
55 | const DEFAULT_IDEAMAP_SETTINGS = {
56 |   nodeWidth: 250,
57 |   nodeSpacing: 100,
58 |   maxNodeHeight: 180,
59 |   nodeBorderRadius: 8,
60 |   nodeFontSize: 14,
61 |   edgeType: 'bezier' as const,
62 |   edgeWidth: 2,
63 |   strokeWidth: 2,
64 |   snapGrid: [25, 25] as [number, number],
65 |   snapToGrid: true,
66 |   connectionLineType: 'bezier' as ConnectionLineType,
67 |   markerEnd: 'arrow' as MarkerType,
68 |   markerSize: 8,
69 |   edgeColor: '#333333',
70 |   selectedEdgeColor: '#ff0000',
71 |   animated: false
72 | };
[TRUNCATED]
```

src/store/uiSlice.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/store/uiSlice.ts
3 |  * ëª©ì : UI ê´€ë ¨ ì „ì—­ ìƒíƒœì™€ ì•¡ì…˜ì„ ê´€ë¦¬í•˜ëŠ” Zustand ìŠ¬ë¼ì´ìŠ¤
4 |  * ì—­í• : ì‚¬ì´ë“œë°” ì—´ë¦¼/ë‹«í˜, ë„ˆë¹„ ë“± UI ê´€ë ¨ ì „ì—­ ìƒíƒœ ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : Zustand v5 ë¬¸ë²•ì— ë§ê²Œ StateCreator ì‹œê·¸ë‹ˆì²˜ ìˆ˜ì •
7 |  */
8 | 
9 | import { StateCreator } from 'zustand';
10 | 
11 | // UI ìƒíƒœ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
12 | export interface UiState {
13 |   // ì‚¬ì´ë“œë°” ìƒíƒœ
14 |   isSidebarOpen: boolean;
15 |   setSidebarOpen: (open: boolean) => void;
16 |   toggleSidebar: () => void;
17 |   
18 |   // ì‚¬ì´ë“œë°” ë„ˆë¹„
19 |   sidebarWidth: number;
20 |   setSidebarWidth: (width: number) => void;
21 |   
22 |   // ë¡œë”© ìƒíƒœ
23 |   isLoading: boolean;
24 |   setLoading: (loading: boolean) => void;
25 | 
26 |   // ì—ëŸ¬ ìƒíƒœ
27 |   error: Error | null;
28 |   setError: (error: Error | null) => void;
29 |   clearError: () => void;
30 | }
31 | 
32 | // UI ìƒíƒœ ìŠ¬ë¼ì´ìŠ¤ ìƒì„± í•¨ìˆ˜ (Zustand v5 ë¬¸ë²•)
33 | export const createUiSlice: StateCreator<UiState> = (set) => ({
34 |   // ì‚¬ì´ë“œë°” ìƒíƒœ ì´ˆê¸°ê°’ ë° ì•¡ì…˜
35 |   isSidebarOpen: false,
36 |   setSidebarOpen: (open) => set({ isSidebarOpen: open }),
37 |   toggleSidebar: () => set((state) => ({ isSidebarOpen: !state.isSidebarOpen })),
38 |   
39 |   // ì‚¬ì´ë“œë°” ë„ˆë¹„ ì´ˆê¸°ê°’ ë° ì•¡ì…˜
40 |   sidebarWidth: 300, // ê¸°ë³¸ê°’ ì„¤ì •
41 |   setSidebarWidth: (width) => set({ sidebarWidth: width }),
42 |   
43 |   // ë¡œë”© ìƒíƒœ ì´ˆê¸°ê°’ ë° ì•¡ì…˜
44 |   isLoading: false,
45 |   setLoading: (loading) => set({ isLoading: loading }),
46 | 
47 |   // ì—ëŸ¬ ìƒíƒœ ì´ˆê¸°ê°’ ë° ì•¡ì…˜
48 |   error: null,
49 |   setError: (error) => set({ error }),
50 |   clearError: () => set({ error: null }),
51 | }); 
```

src/store/useAppStore.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/store/useAppStore.ts
3 |  * ëª©ì : Zustand ìŠ¤í† ì–´ ìŠ¬ë¼ì´ìŠ¤ í†µí•© ë° ê¸€ë¡œë²Œ ìƒíƒœ ê´€ë¦¬
4 |  * ì—­í• : UI, ì¹´ë“œ ìƒíƒœ, í…Œë§ˆ ë“± ì—¬ëŸ¬ ìŠ¬ë¼ì´ìŠ¤ë¥¼ í†µí•©í•œ ë£¨íŠ¸ ìŠ¤í† ì–´ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-22
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : Zustand ìŠ¤í† ì–´ ìŠ¬ë¼ì´ìŠ¤ ë¶„ë¦¬ ë° í†µí•©
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : í”„ë¡œì íŠ¸ ê´€ë ¨ í•¨ìˆ˜ ëª©ì—… ë°ì´í„°ë¡œ ë³€ê²½
8 |  * ìˆ˜ì •ì¼: 2025-04-21 : ìŠ¬ë¼ì´ìŠ¤ í•¨ìˆ˜ í˜¸ì¶œ ì¸ìˆ˜ ìˆ˜ì •
9 |  * ìˆ˜ì •ì¼: 2025-04-21 : Zustand ìŠ¬ë¼ì´ìŠ¤ í†µí•© êµ¬ì¡° ëª…í™•í™”
10 |  * ìˆ˜ì •ì¼: 2025-04-21 : createIdeaMapSliceë¥¼ ë³„ë„ íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ê³  ìˆœìˆ˜ UI ìƒíƒœë§Œ ê´€ë¦¬í•˜ë„ë¡ ìˆ˜ì •
11 |  */
12 | 
13 | import { ReactFlowInstance, Node, Edge } from '@xyflow/react'
14 | import { toast } from 'sonner'
15 | import { create } from 'zustand'
16 | import { persist, subscribeWithSelector, createJSONStorage } from 'zustand/middleware'
17 | 
18 | import { saveAllLayoutData } from '@/components/ideamap/utils/ideamap-graphUtils'
19 | import { signOut, getCurrentUser } from "@/lib/auth"
20 | import { IDEAMAP_LAYOUT_STORAGE_KEY, IDEAMAP_EDGES_STORAGE_KEY } from '@/lib/ideamap-constants'
21 | import { getLayoutedElements, getGridLayout } from '@/lib/layout-utils'
22 | import { createLogger } from '@/lib/logger'
23 | 
24 | import { UiState, createUiSlice } from './uiSlice'
25 | import { CardStateState, createCardStateSlice } from './cardStateSlice'
26 | import { ThemeState, createThemeSlice } from './themeSlice'
27 | import { IdeaMapState, createIdeaMapSlice } from './ideaMapSlice'
28 | 
29 | //ë¡œê±° ì´ˆê¸°í™”
30 | const logger = createLogger('useIdeaMapLayout');
31 | // í”„ë¡œì íŠ¸ ì •ë³´ ì¸í„°í˜ì´ìŠ¤
32 | export interface Project {
33 |   id: string;
34 |   name: string;
35 |   ownerNickname?: string;
36 |   userId: string;
37 |   createdAt: string;
38 |   updatedAt: string;
39 |   settings?: any;
40 | }
41 | 
42 | // ì•„ì´ë””ì–´ë§µ ê´€ë ¨ ìƒíƒœ ì¸í„°í˜ì´ìŠ¤ëŠ” ideaMapSlice.tsë¡œ ì´ë™
43 | 
44 | // í”„ë¡œì íŠ¸ ê´€ë ¨ ìƒíƒœ ì¸í„°í˜ì´ìŠ¤
45 | interface ProjectState {
46 |   projects: Project[];
47 |   activeProjectId: string | null;
48 |   fetchProjects: () => Promise<void>;
49 |   setProjects: (projects: Project[]) => void;
50 |   setActiveProject: (projectId: string | null) => void;
51 |   createProject: (projectData: Partial<Project>) => Promise<Project | null>;
52 |   updateProject: (projectId: string, projectData: Partial<Project>) => Promise<Project | null>;
53 |   deleteProject: (projectId: string) => Promise<boolean>;
54 | }
55 | 
56 | // ì¹´ë“œ ë°ì´í„° ê´€ë ¨ ìƒíƒœ ì¸í„°í˜ì´ìŠ¤
57 | interface CardDataState {
58 |   cards: any[]; // ì „ì²´ ì¹´ë“œ ëª©ë¡
59 |   setCards: (cards: any[]) => void; // ì¹´ë“œ ëª©ë¡ ì„¤ì • í•¨ìˆ˜
60 | }
61 | 
[TRUNCATED]
```

src/store/useAuthStore.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/store/useAuthStore.ts
3 |  * ëª©ì : Zustandë¥¼ ì‚¬ìš©í•œ ì¸ì¦ ìƒíƒœ ê´€ë¦¬
4 |  * ì—­í• : Supabase ì‚¬ìš©ì ì •ë³´ì™€ ì¸ì¦ ê´€ë ¨ ìƒíƒœë¥¼ ì¤‘ì•™ ì§‘ì¤‘ì ìœ¼ë¡œ ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-04-09
6 |  * ìˆ˜ì •ì¼: 2025-04-24 : ìŠ¤í† ì–´ ë¦¬íŒ©í† ë§ - í† í° ë° ì¸ì¦ ê´€ë ¨ ì •ë³´ë¥¼ ì œê±°í•˜ê³  ì‚¬ìš©ì í”„ë¡œí•„ê³¼ ìƒíƒœë§Œ ê´€ë¦¬í•˜ë„ë¡ ìˆ˜ì •
7 |  */
8 | 
9 | 'use client';
10 | 
11 | import { create } from 'zustand';
12 | import { User } from '@supabase/supabase-js';
13 | 
14 | import createLogger from '@/lib/logger';
15 | 
16 | // ë¡œê±° ìƒì„±
17 | const logger = createLogger('AuthStore');
18 | 
19 | // ì¸ì¦ ìƒíƒœ ì¸í„°í˜ì´ìŠ¤
20 | interface AuthState {
21 |   // ìƒíƒœ (State)
22 |   profile: User | null;
23 |   isLoading: boolean;
24 |   error: string | null;
25 |   
26 |   // ì•¡ì…˜ (Actions)
27 |   setProfile: (user: User | null) => void;
28 |   setLoading: (loading: boolean) => void;
29 |   setError: (error: string | null) => void;
30 | }
31 | 
32 | // Zustand ìŠ¤í† ì–´ ìƒì„±
33 | export const useAuthStore = create<AuthState>((set) => ({
34 |   // ì´ˆê¸° ìƒíƒœ
35 |   profile: null,
36 |   isLoading: true,
37 |   error: null,
38 |   
39 |   // ì•¡ì…˜ êµ¬í˜„
40 |   setProfile: (user) => {
41 |     // logger.info('ì‚¬ìš©ì í”„ë¡œí•„ ì„¤ì •', { 
42 |     //   hasUser: !!user, 
43 |     //   userId: user?.id
44 |     // });
45 |     set({ profile: user });
46 |   },
47 |   
48 |   setLoading: (isLoading) => {
49 |     set({ isLoading });
50 |   },
51 |   
52 |   setError: (error) => {
53 |     if (error) {
54 |       logger.error('ì¸ì¦ ì˜¤ë¥˜ ì„¤ì •', error);
55 |     } else {
56 |       logger.debug('ì¸ì¦ ì˜¤ë¥˜ ì´ˆê¸°í™”');
57 |     }
58 |     set({ error });
59 |   }
60 | }));
61 | 
62 | // ì„ íƒê¸° (Selectors)
63 | export const selectIsAuthenticated = (state: AuthState) => !!state.profile;
64 | export const selectUserId = (state: AuthState) => state.profile?.id;
65 | export const selectUserEmail = (state: AuthState) => state.profile?.email;
66 | export const selectIsLoading = (state: AuthState) => state.isLoading;
67 | export const selectError = (state: AuthState) => state.error; 
```

src/store/useIdeaMapStore.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: useIdeaMapStore.ts
3 |  * ëª©ì : Zustandë¥¼ í™œìš©í•œ ì•„ì´ë””ì–´ë§µ ê´€ë ¨ ì „ì—­ ìƒíƒœ ê´€ë¦¬
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µì˜ ë…¸ë“œ, ì—£ì§€, ì„¤ì • ë“± ëª¨ë“  ìƒíƒœë¥¼ ì¤‘ì•™ ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : ë¯¸ì‚¬ìš© í•¨ìˆ˜ ì œê±°, any íƒ€ì… êµ¬ì²´í™”
7 |  * ìˆ˜ì •ì¼: 2024-05-09 : loadIdeaMapData í•¨ìˆ˜ ê°œì„  ë° syncCardsWithNodes í•¨ìˆ˜ ì¶”ê°€
8 |  * ìˆ˜ì •ì¼: 2024-05-30 : loadIdeaMapData í•¨ìˆ˜ì— ë…¸ë“œ-ì¹´ë“œ ë™ê¸°í™” ë¡œì§ ì¶”ê°€
9 |  * ìˆ˜ì •ì¼: 2024-06-27 : ë…¸ë“œ ìƒì„± ê´€ë ¨ ë””ë²„ê¹… ë¡œê¹… ê°•í™”
10 |  * ìˆ˜ì •ì¼: 2024-06-28 : React Flow ì´ˆê¸°í™” ë° ë…¸ë“œ/ì—£ì§€ ì •ë³´ ì£¼ì… ê´€ë ¨ ë””ë²„ê¹… ë¡œê¹… ì¶”ê°€
11 |  * ìˆ˜ì •ì¼: 2024-07-18 : saveLayout í•¨ìˆ˜ ê°œì„  ë° ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
12 |  * ìˆ˜ì •ì¼: 2025-04-19 : ë¡œê·¸ ìµœì í™” - ê³¼ë„í•œ ì½˜ì†” ë¡œê·¸ ì œê±° ë° logger.debugë¡œ ë³€ê²½
13 |  * ìˆ˜ì •ì¼: 2025-04-19 : ìƒíƒœ ì—…ë°ì´íŠ¸ ìµœì í™” - ë‹¤ì¤‘ set í˜¸ì¶œì„ í•˜ë‚˜ë¡œ ë°°ì¹­
14 |  */
15 | import { 
16 |   Node, 
17 |   Edge, 
18 |   Connection, 
19 |   applyNodeChanges, 
20 |   applyEdgeChanges,
21 |   addEdge,
22 |   NodeChange,
23 |   EdgeChange,
24 |   XYPosition,
25 |   Viewport,
26 |   ReactFlowInstance
27 | } from '@xyflow/react';
28 | import { toast } from 'sonner';
29 | import { create } from 'zustand';
30 | import { persist } from 'zustand/middleware';
31 | 
32 | import { CardData } from '@/components/ideamap/types/ideamap-types';
33 | import { NODE_TYPES_KEYS } from '@/lib/flow-constants';
34 | import { IDEAMAP_LAYOUT_STORAGE_KEY, IDEAMAP_EDGES_STORAGE_KEY, IDEAMAP_TRANSFORM_STORAGE_KEY } from '@/lib/ideamap-constants';
35 | import { 
36 |   IdeaMapSettings, 
37 |   DEFAULT_IDEAMAP_SETTINGS, 
38 |   saveIdeaMapSettings,
39 |   applyIdeaMapEdgeSettings,
40 |   loadIdeaMapSettingsFromServer,
41 |   saveIdeaMapSettingsToServer
42 | } from '@/lib/ideamap-utils';
43 | import { getLayoutedElements, getGridLayout } from '@/lib/layout-utils';
44 | import createLogger from '@/lib/logger';
45 | 
46 | import { useAppStore } from './useAppStore';
47 | // ë¡œê±° ìƒì„±
48 | const logger = createLogger('useIdeaMapStore');
49 | 
50 | // í™•ì¥ëœ Viewport íƒ€ì… (width, height ì†ì„± í¬í•¨)
51 | interface ExtendedViewport extends Viewport {
52 |   width?: number;
53 |   height?: number;
54 | }
55 | 
56 | // ì•„ì´ë””ì–´ë§µ ìŠ¤í† ì–´ ìƒíƒœ ì¸í„°í˜ì´ìŠ¤
57 | interface IdeaMapState {
58 |   // ë…¸ë“œ ê´€ë ¨ ìƒíƒœ
59 |   nodes: Node<CardData>[];
60 |   setNodes: (nodes: Node<CardData>[]) => void;
61 |   onNodesChange: (changes: NodeChange[]) => void;
62 |   
63 |   // ì—£ì§€ ê´€ë ¨ ìƒíƒœ
64 |   edges: Edge[];
[TRUNCATED]
```

src/app/cards/page.test.tsx
```
1 | /**
2 |  * @vitest-environment jsdom
3 |  */
4 | 
5 | import React from 'react';
6 | 
7 | import { render, screen } from '@testing-library/react';
8 | import { describe, it, expect, vi } from 'vitest';
9 | import '@testing-library/jest-dom/vitest';
10 | 
11 | import CardsPage from './page';
12 | 
13 | // Next.jsì˜ router í›… ëª¨í‚¹
14 | vi.mock('next/navigation', () => ({
15 |   useRouter: vi.fn(() => ({
16 |     push: vi.fn(),
17 |     replace: vi.fn(),
18 |     prefetch: vi.fn(),
19 |     pathname: '/cards',
20 |   })),
21 |   useSearchParams: vi.fn(() => ({
22 |     get: vi.fn(() => null),
23 |     has: vi.fn(() => false),
24 |     forEach: vi.fn(),
25 |   })),
26 | }));
27 | 
28 | // TagFilter ì»´í¬ë„ŒíŠ¸ ëª¨í‚¹
29 | vi.mock('@/components/cards/TagFilter', () => ({
30 |   TagFilter: vi.fn(() => <div data-testid="tag-filter">íƒœê·¸ í•„í„°</div>)
31 | }));
32 | 
33 | // React.Suspense ëª¨í‚¹
34 | vi.mock('react', async () => {
35 |   const originalReact = await vi.importActual('react');
36 |   return {
37 |     ...originalReact,
38 |     Suspense: ({ children, fallback }: { children: React.ReactNode; fallback: React.ReactNode }) => {
39 |       return (
40 |         <>
41 |           <div data-testid="suspense-fallback">{fallback}</div>
42 |           <div data-testid="suspense-children">{children}</div>
43 |         </>
44 |       );
45 |     },
46 |   };
47 | });
48 | 
49 | // í…ŒìŠ¤íŠ¸ìš© CardListSkeleton (page ëª¨ë“ˆì—ì„œ ê°€ì ¸ì˜¤ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸ì—ì„œ ì§ì ‘ ì •ì˜)
50 | const CardListSkeleton = () => (
51 |   <div data-testid="skeleton-grid" className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
52 |     {Array(6).fill(0).map((_, index) => (
53 |       <div key={index} className="border rounded-md p-4 space-y-4">
54 |         <div data-testid="skeleton" className="h-6 w-3/4" />
55 |         <div data-testid="skeleton" className="h-24" />
56 |         <div className="flex justify-between">
57 |           <div data-testid="skeleton" className="h-4 w-1/4" />
58 |           <div data-testid="skeleton" className="h-8 w-1/4" />
59 |         </div>
60 |       </div>
61 |     ))}
62 |   </div>
63 | );
64 | 
65 | // Suspense ë‚´ë¶€ ì»´í¬ë„ŒíŠ¸ ëª¨í‚¹
[TRUNCATED]
```

src/app/cards/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/cards/page.tsx
3 |  * ëª©ì : ì¹´ë“œ ëª©ë¡ì„ í‘œì‹œí•˜ê³  í•„í„°ë§ ê¸°ëŠ¥ ì œê³µ
4 |  * ì—­í• : ì¹´ë“œ ëª©ë¡ í˜ì´ì§€ì˜ ë ˆì´ì•„ì›ƒê³¼ ì»´í¬ë„ŒíŠ¸ êµ¬ì„±
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-04-08
7 |  * ìˆ˜ì •ì¼: 2025-05-30 : TagFilterë¥¼ Suspenseë¡œ ê°ì‹¸ useSearchParams ì˜¤ë¥˜ í•´ê²°
8 |  */
9 | 
10 | import { Suspense } from 'react';
11 | 
12 | import { Metadata } from "next";
13 | 
14 | import CardList from "@/components/cards/CardList";
15 | import CreateCardModal from "@/components/cards/CreateCardModal";
16 | import { TagFilter } from "@/components/cards/TagFilter";
17 | import { Skeleton } from '@/components/ui/skeleton';
18 | 
19 | 
20 | 
21 | export const metadata: Metadata = {
22 |   title: "ì¹´ë“œ ëª©ë¡ | Backyard",
23 |   description: "ë°±ì•¼ë“œ ì¹´ë“œ ëª©ë¡ í˜ì´ì§€ì…ë‹ˆë‹¤.",
24 | };
25 | 
26 | // ì¹´ë“œ ëª©ë¡ ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤
27 | function CardListSkeleton() {
28 |   return (
29 |     <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
30 |       {Array(6).fill(0).map((_, index) => (
31 |         <div key={index} className="border rounded-md p-4 space-y-4">
32 |           <Skeleton className="h-6 w-3/4" />
33 |           <Skeleton className="h-24" />
34 |           <div className="flex justify-between">
35 |             <Skeleton className="h-4 w-1/4" />
36 |             <Skeleton className="h-8 w-1/4" />
37 |           </div>
38 |         </div>
39 |       ))}
40 |     </div>
41 |   );
42 | }
43 | 
44 | // íƒœê·¸ í•„í„° ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤
45 | function TagFilterSkeleton() {
46 |   return (
47 |     <div className="space-y-2 p-3 border rounded-md">
48 |       <Skeleton className="h-6 w-1/2" />
49 |       <Skeleton className="h-4 w-full" />
50 |       <Skeleton className="h-4 w-full" />
51 |       <Skeleton className="h-4 w-3/4" />
52 |     </div>
53 |   );
54 | }
55 | 
56 | export default function CardsPage() {
57 |   return (
58 |     <div className="container mx-auto py-8">
59 |       {/* í˜ì´ì§€ í—¤ë” */}
60 |       <div className="mb-6">
61 |         <div className="flex justify-between items-center mb-2">
62 |           <div>
[TRUNCATED]
```

src/app/ideamap/page.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: page.test.tsx
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : IdeaMap ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-04-15
7 |  * ìˆ˜ì •ì¼: 2025-04-25 : ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” import ë° ë³€ìˆ˜ ì œê±°
8 |  */
9 | 
10 | import { render, screen } from '@testing-library/react';
11 | import { Node, Edge, NodeChange } from '@xyflow/react';
12 | import { describe, test, expect, vi, beforeEach } from 'vitest';
13 | 
14 | import IdeaMapPage from './page';
15 | import '@testing-library/jest-dom/vitest';
16 | import { autoLayoutNodes } from './page';
17 | 
18 | // LocalStorage ëª¨í‚¹
19 | const localStorageMock = (() => {
20 |   let store: Record<string, string> = {};
21 |   return {
22 |     getItem: vi.fn((key: string) => store[key] || null),
23 |     setItem: vi.fn((key: string, value: string) => {
24 |       store[key] = value.toString();
25 |     }),
26 |     clear: vi.fn(() => {
27 |       store = {};
28 |     }),
29 |   };
30 | })();
31 | 
32 | Object.defineProperty(window, 'localStorage', {
33 |   value: localStorageMock,
34 | });
35 | 
36 | // ResizeObserver ëª¨í‚¹ (ReactFlowì—ì„œ í•„ìš”)
37 | class ResizeObserverMock {
38 |   observe = vi.fn();
39 |   unobserve = vi.fn();
40 |   disconnect = vi.fn();
41 | }
42 | 
43 | global.ResizeObserver = ResizeObserverMock;
44 | 
45 | // React Flowì˜ applyNodeChanges í•¨ìˆ˜ ê²°ê³¼ë¥¼ ëª¨í‚¹í•˜ê¸° ìœ„í•œ ë³€ìˆ˜
46 | let mockAppliedNodes: Node[] = [];
47 | 
48 | // ReactFlow ì „ì²´ ëª¨í‚¹ - í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì‹¤ì œ ë Œë”ë§ ì—†ì´ ëª¨í‚¹ëœ êµ¬ì„±ìš”ì†Œë§Œ ì‚¬ìš©
49 | const nodesMock: Node[] = [];
50 | const edgesMock: Edge[] = [];
51 | const setNodesMock = vi.fn();
52 | const setEdgesMock = vi.fn();
53 | const onNodesChangeMock = vi.fn();
54 | const onEdgesChangeMock = vi.fn();
55 | 
56 | // ReactFlowì˜ ReactFlowProviderì™€ useReactFlow hook ëª¨í‚¹
57 | vi.mock('@xyflow/react', () => {
58 |   // ReactFlow ì»´í¬ë„ŒíŠ¸ ëª¨í‚¹
59 |   const ReactFlowMock = ({ children, onNodesChange }: { children?: React.ReactNode, onNodesChange?: (changes: NodeChange[]) => void }) => (
60 |     <div
61 |       data-testid="react-flow-mock"
62 |       onClick={() => {
63 |         // ë…¸ë“œ ìœ„ì¹˜ ë³€ê²½ ì‹œë®¬ë ˆì´ì…˜
64 |         if (onNodesChange) {
65 |           onNodesChange([{
66 |             type: 'position',
67 |             id: '1',
68 |             position: { x: 200, y: 200 },
69 |           } as NodeChange]);
70 |         }
71 |       }}
[TRUNCATED]
```

src/app/ideamap/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: page.tsx
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µ ê¸°ëŠ¥ì˜ í˜ì´ì§€ ë ˆë²¨ ì»´í¬ë„ŒíŠ¸, ë¦¬íŒ©í† ë§ëœ IdeaMap ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-04-15
7 |  * ìˆ˜ì •ì¼: 2025-04-27 : any íƒ€ì…ì„ Node íƒ€ì…ìœ¼ë¡œ ë³€ê²½
8 |  */
9 | 
10 | 'use client';
11 | 
12 | import { Node, ReactFlowProvider } from '@xyflow/react';
13 | 
14 | import IdeaMap from '@/components/ideamap/components/IdeaMap';
15 | import { useAppStore } from '@/store/useAppStore';
16 | 
17 | // ê¸°ì¡´ ì½”ë“œ ë³´ì¡´ì„ ìœ„í•œ ì£¼ì„ ì²˜ë¦¬ëœ í•¨ìˆ˜ë“¤ (í…ŒìŠ¤íŠ¸ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆìŒ)
18 | export const autoLayoutNodes = (nodes: Node[]) => {
19 |   return nodes.map((node: Node, index: number) => ({
20 |     ...node,
21 |     position: {
22 |       x: (index % 3) * 300 + 50,
23 |       y: Math.floor(index / 3) * 200 + 50
24 |     }
25 |   }));
26 | };
27 | 
28 | // ì•„ì´ë””ì–´ë§µ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
29 | export default function IdeaMapPage() {
30 |   const { selectCard } = useAppStore();
31 | 
32 |   return (
33 |     <div className="w-full h-full relative">
34 |       <ReactFlowProvider>
35 |         <IdeaMap
36 |           onSelectCard={selectCard}
37 |           className="bg-background"
38 |           showControls={true}
39 |         />
40 |       </ReactFlowProvider>
41 |     </div>
42 |   );
43 | } 
```

src/app/login/actions.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: actions.ts
3 |  * ëª©ì : ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… ì„œë²„ ì•¡ì…˜ ì œê³µ
4 |  * ì—­í• : ì‚¬ìš©ì ì¸ì¦ ì²˜ë¦¬
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-05 : OAuth ë¦¬ë‹¤ì´ë ‰ì…˜ URL í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2025-04-24 : Supabase ê¸°ë°˜ ì¸ì¦ ì²˜ë¦¬ë¡œ ë¦¬íŒ©í† ë§
8 |  * ìˆ˜ì •ì¼: 2025-04-24 : Google ë¡œê·¸ì¸ ì•¡ì…˜ì„ ì„œë²„ í˜¸í™˜ í•¨ìˆ˜ë¡œ ìˆ˜ì •
9 |  * ìˆ˜ì •ì¼: 2025-04-24 : êµ¬ê¸€ ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰ì…˜ ì²˜ë¦¬ ë°©ì‹ ë³€ê²½ - URL ë°˜í™˜ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •
10 |  * ìˆ˜ì •ì¼: 2024-05-19 : í´ë¼ì´ì–¸íŠ¸ Google OAuth ëª¨ë“ˆì„ ì„œë²„ í˜¸í™˜ ëª¨ë“ˆë¡œ êµì²´
11 |  * ìˆ˜ì •ì¼: 2024-05-19 : Google OAuth í•¨ìˆ˜ import ê²½ë¡œ ë³€ê²½ (auth/server â†’ auth-server)
12 |  * 
13 |  * @rule   three-layer-standard
14 |  * @layer  service
15 |  * @tag    @service-msw googleSignInAction
16 |  * ì„¤ëª…    ì„œë²„ ì•¡ì…˜(action)ì—ì„œ auth-server ì„œë¹„ìŠ¤ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¸ì¦ ì²˜ë¦¬ (MSWë¡œ í…ŒìŠ¤íŠ¸)
17 |  */
18 | 
19 | 'use server'
20 | 
21 | import { redirect } from 'next/navigation'
22 | 
23 | import { signIn } from '@/lib/auth'
24 | import { serverSignInWithGoogle } from '@/lib/auth-server'
25 | import createLogger from '@/lib/logger'
26 | 
27 | // ë¡œê±° ìƒì„±
28 | const logger = createLogger('LoginActions')
29 | 
30 | /**
31 |  * loginAction: ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ë¡œê·¸ì¸
32 |  * @param formData - ë¡œê·¸ì¸ í¼ ë°ì´í„° (email, password)
33 |  */
34 | export async function loginAction(formData: FormData) {
35 |   const email = formData.get('email') as string
36 |   const password = formData.get('password') as string
37 | 
38 |   // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
39 |   if (!email || !password) {
40 |     logger.error('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤')
41 |     return redirect('/login?error=Missing+credentials')
42 |   }
43 | 
44 |   try {
45 |     logger.debug('ë¡œê·¸ì¸ ì‹œë„:', { email })
46 |     const data = await signIn(email, password)
47 | 
48 |     // ì„±ê³µ ì‹œ í™ˆí˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
49 |     logger.info('ë¡œê·¸ì¸ ì„±ê³µ:', { email })
50 |     return redirect('/')
51 |   } catch (error) {
52 |     logger.error('ë¡œê·¸ì¸ ì¤‘ ì˜ˆì™¸ ë°œìƒ:', error)
53 |     const errorMessage = error instanceof Error ? error.message : 'Unknown error'
54 |     return redirect(`/login?error=${encodeURIComponent(errorMessage)}`)
55 |   }
56 | }
57 | 
58 | /**
59 |  * signupAction: ìƒˆ ì‚¬ìš©ì ë“±ë¡
60 |  * @param formData - íšŒì›ê°€ì… í¼ ë°ì´í„° (email, password, name)
61 |  */
[TRUNCATED]
```

src/app/login/layout.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/login/layout.tsx
3 |  * ëª©ì : ë¡œê·¸ì¸ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ
4 |  * ì—­í• : PublicOnlyLayoutì„ ì ìš©í•˜ì—¬ ì´ë¯¸ ì¸ì¦ëœ ì‚¬ìš©ì ë¦¬ë””ë ‰ì…˜
5 |  * ì‘ì„±ì¼: 2024-05-08
6 |  */
7 | 
8 | import { PublicOnlyLayout } from '@/components/layout/PublicOnlyLayout';
9 | 
10 | export default function LoginLayout({ children }: { children: React.ReactNode }) {
11 |     return <PublicOnlyLayout>{children}</PublicOnlyLayout>;
12 | } 
```

src/app/login/page.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/login/page.test.tsx
3 |  * ëª©ì : ë¡œê·¸ì¸ í˜ì´ì§€ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ë¡œê·¸ì¸ í˜ì´ì§€ ë Œë”ë§ ë° ê¸°ëŠ¥ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-02-15
6 |  * ìˆ˜ì •ì¼: 2025-03-27
7 |  * ìˆ˜ì •ì¼: 2024-05-16 : Triple-slash ì°¸ì¡° ì œê±° ë° import ë¬¸ìœ¼ë¡œ ë³€ê²½
8 |  * ìˆ˜ì •ì¼: 2025-04-27 : ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” import ì œê±°
9 |  */
10 | 
11 | import React from 'react';
12 | 
13 | import { render, screen } from '@testing-library/react';
14 | import { describe, it, expect, vi, beforeEach } from 'vitest';
15 | import '@testing-library/jest-dom/vitest';
16 | 
17 | import LoginPage from './page';
18 | 
19 | // ì„œë²„ ì•¡ì…˜ ëª¨í‚¹
20 | const mockLogin = vi.fn();
21 | const mockSignup = vi.fn();
22 | const mockSignInWithGoogle = vi.fn();
23 | 
24 | vi.mock('./actions', () => ({
25 |   login: vi.fn(() => mockLogin),
26 |   signup: vi.fn(() => mockSignup),
27 |   signInWithGoogle: vi.fn(() => mockSignInWithGoogle)
28 | }));
29 | 
30 | // searchParams ëª¨í‚¹
31 | const mockSearchParams = new Map();
32 | 
33 | vi.mock('next/navigation', () => ({
34 |   useSearchParams: vi.fn(() => ({
35 |     get: (key: string) => mockSearchParams.get(key)
36 |   }))
37 | }));
38 | 
39 | describe('LoginPage', () => {
40 |   beforeEach(() => {
41 |     vi.clearAllMocks();
42 |     mockSearchParams.clear();
43 |   });
44 | 
45 |   it('ë¡œê·¸ì¸ í˜ì´ì§€ê°€ ì˜¬ë°”ë¥´ê²Œ ë Œë”ë§ë˜ì–´ì•¼ í•¨', () => {
46 |     render(<LoginPage />);
47 | 
48 |     // í˜ì´ì§€ ì œëª©ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
49 |     expect(screen.getByRole('heading', { name: 'ë¡œê·¸ì¸' })).toBeInTheDocument();
50 | 
51 |     // í¼ ìš”ì†Œë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
52 |     expect(screen.getByLabelText('ì´ë©”ì¼')).toBeInTheDocument();
53 |     expect(screen.getByLabelText('ë¹„ë°€ë²ˆí˜¸')).toBeInTheDocument();
54 | 
55 |     // ë²„íŠ¼ë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
56 |     expect(screen.getByRole('button', { name: 'ë¡œê·¸ì¸' })).toBeInTheDocument();
57 |     expect(screen.getByRole('button', { name: 'íšŒì›ê°€ì…' })).toBeInTheDocument();
58 |     expect(screen.getByRole('button', { name: /Googleë¡œ ê³„ì†í•˜ê¸°/ })).toBeInTheDocument();
59 |   });
60 | 
61 |   it('ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ URL íŒŒë¼ë¯¸í„°ë¡œë¶€í„° í‘œì‹œë˜ì–´ì•¼ í•¨', () => {
62 |     // ì˜¤ë¥˜ ë©”ì‹œì§€ íŒŒë¼ë¯¸í„° ì„¤ì •
63 |     mockSearchParams.set('error', 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
64 | 
65 |     render(<LoginPage />);
66 | 
67 |     // ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ í™”ë©´ì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
68 |     expect(screen.getByText('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')).toBeInTheDocument();
69 |   });
70 | 
71 |   it('ì„±ê³µ ë©”ì‹œì§€ê°€ URL íŒŒë¼ë¯¸í„°ë¡œë¶€í„° í‘œì‹œë˜ì–´ì•¼ í•¨', () => {
[TRUNCATED]
```

src/app/login/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/login/page.tsx
3 |  * ëª©ì : ë¡œê·¸ì¸ í˜ì´ì§€ ì œê³µ
4 |  * ì—­í• : ì‚¬ìš©ì ë¡œê·¸ì¸ UI ë Œë”ë§
5 |  * ì‘ì„±ì¼: 2025-03-08
6 |  * ìˆ˜ì •ì¼: 2025-03-27
7 |  * ìˆ˜ì •ì¼: 2024-05-29 : ì´ë¯¸ì§€ í‘œì‹œ ë°©ì‹ ë³€ê²½ (object-cover)
8 |  * ìˆ˜ì •ì¼: 2024-05-30 : ì´ë¯¸ì§€ ìºì‹± ë° ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì¶”ê°€ (ì§€ì—° ì—†ëŠ” ë™ì‹œ ë¡œë”©)
9 |  * ìˆ˜ì •ì¼: 2025-05-30 : LoginFormì„ Suspenseë¡œ ê°ì‹¸ì„œ useSearchParams ì˜¤ë¥˜ í•´ê²°
10 |  */
11 | 
12 | 'use client';
13 | 
14 | import React, { useEffect, useState, Suspense } from 'react';
15 | 
16 | import Image from 'next/image';
17 | 
18 | import LoginForm from '@/components/login/loginForm';
19 | import { Skeleton } from '@/components/ui/skeleton';
20 | 
21 | // ë°°ê²½ ì´ë¯¸ì§€ ë°°ì—´ (v0 ë””ìì¸ì—ì„œ ê°€ì ¸ì˜¨ ì´ë¯¸ì§€)
22 | const backgroundImages = [
23 |   '/images/blockchain-cubes.png',
24 |   '/images/fiber-optic-lights.png',
25 |   '/images/lightbulb-blue.png',
26 |   '/images/lightbulb-hands.png',
27 |   '/images/lightbulb-sunset.png',
28 |   '/images/network-visualization.png',
29 | ];
30 | 
31 | /**
32 |  * getCachedImagePath: ìºì‹œëœ ì´ë¯¸ì§€ ê²½ë¡œ ë°˜í™˜ ë˜ëŠ” ìƒˆ ì´ë¯¸ì§€ ìºì‹±
33 |  * @returns {string} ì´ë¯¸ì§€ ê²½ë¡œ
34 |  */
35 | const getCachedImagePath = () => {
36 |   // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œë§Œ ì‹¤í–‰
37 |   if (typeof window === 'undefined') return null;
38 | 
39 |   // ìºì‹œì—ì„œ ì´ë¯¸ì§€ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
40 |   const cachedImage = localStorage.getItem('loginBackgroundImage');
41 | 
42 |   if (cachedImage && backgroundImages.includes(cachedImage)) {
43 |     return cachedImage;
44 |   }
45 | 
46 |   // ìƒˆ ëœë¤ ì´ë¯¸ì§€ ì„ íƒ ë° ìºì‹±
47 |   const randomIndex = Math.floor(Math.random() * backgroundImages.length);
48 |   const newImagePath = backgroundImages[randomIndex];
49 |   localStorage.setItem('loginBackgroundImage', newImagePath);
50 |   return newImagePath;
51 | };
52 | 
53 | // ë¡œê·¸ì¸ í¼ ë¡œë”© ìƒíƒœë¥¼ ìœ„í•œ ìŠ¤ì¼ˆë ˆí†¤ ì»´í¬ë„ŒíŠ¸
54 | function LoginFormSkeleton() {
55 |   return (
56 |     <div className="w-full max-w-md p-6 md:p-12 space-y-6">
57 |       <div className="mb-4 text-center">
58 |         <Skeleton className="h-8 w-40 mx-auto mb-2" />
59 |         <Skeleton className="h-4 w-32 mx-auto" />
60 |       </div>
61 |       <div className="border rounded-lg p-6 space-y-4">
[TRUNCATED]
```

src/app/tags/page.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/tags/page.test.tsx
3 |  * ëª©ì : íƒœê·¸ ê´€ë¦¬ í˜ì´ì§€ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : íƒœê·¸ í˜ì´ì§€ ë Œë”ë§ ë° ê¸°ëŠ¥ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-03-27
7 |  * ìˆ˜ì •ì¼: 2024-05-16 : Triple-slash ì°¸ì¡° ì œê±° ë° import ë¬¸ìœ¼ë¡œ ë³€ê²½
8 |  */
9 | 
10 | import React from 'react';
11 | 
12 | import { render, screen, cleanup } from '@testing-library/react';
13 | import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
14 | 
15 | import TagsPage from './page';
16 | import '@testing-library/jest-dom/vitest';
17 | 
18 | // vi.hoistedë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨í‚¹ ê°ì²´ ìƒì„±
19 | const mocks = vi.hoisted(() => ({
20 |   findMany: vi.fn()
21 | }));
22 | 
23 | // prisma ëª¨í‚¹
24 | vi.mock('@/lib/prisma', () => ({
25 |   default: {
26 |     tag: {
27 |       findMany: mocks.findMany
28 |     }
29 |   }
30 | }));
31 | 
32 | // formatDate ëª¨í‚¹
33 | vi.mock('@/lib/utils', () => ({
34 |   // eslint-disable-next-line @typescript-eslint/no-unused-vars
35 |   formatDate: vi.fn((_: string | Date) => '2023ë…„ 1ì›” 1ì¼'),
36 |   cn: vi.fn((...args: any[]) => args.join(' '))
37 | }));
38 | 
39 | // ì»´í¬ë„ŒíŠ¸ ëª¨í‚¹ - ì˜¬ë°”ë¥¸ ê²½ë¡œë¡œ ìˆ˜ì •
40 | vi.mock('@/components/tags/TagForm', () => ({
41 |   default: () => <div data-testid="tag-form">íƒœê·¸ ì¶”ê°€ í¼</div>
42 | }));
43 | 
44 | vi.mock('@/components/tags/TagList', () => ({
45 |   default: ({ initialTags }: { initialTags: any[] }) => (
46 |     <div data-testid="tag-list">
47 |       íƒœê·¸ ìˆ˜: {initialTags.length}
48 |     </div>
49 |   )
50 | }));
51 | 
52 | // Card ëª¨í‚¹
53 | vi.mock('@/components/ui/card', () => ({
54 |   Card: ({ children }: { children: React.ReactNode }) => <div data-slot="card" className="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm ">{children}</div>,
55 |   CardHeader: ({ children }: { children: React.ReactNode }) => <div data-slot="card-header" className="@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6 ">{children}</div>,
[TRUNCATED]
```

src/app/tags/page.tsx
```
1 | import { Tag } from "@prisma/client";
2 | import { Metadata } from "next";
3 | 
4 | import TagForm from "@/components/tags/TagForm";
5 | import TagList from "@/components/tags/TagList";
6 | import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
7 | import prisma from "@/lib/prisma";
8 | import { formatDate } from "@/lib/utils";
9 | 
10 | export const metadata: Metadata = {
11 |   title: "íƒœê·¸ ê´€ë¦¬ | Backyard",
12 |   description: "íƒœê·¸ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.",
13 | };
14 | 
15 | type TagWithCount = Tag & {
16 |   _count: {
17 |     cardTags: number;
18 |   };
19 | };
20 | 
21 | export default async function TagsPage() {
22 |   let tags: TagWithCount[] = [];
23 |   
24 |   try {
25 |     tags = await prisma.tag.findMany({
26 |       orderBy: {
27 |         name: 'asc'
28 |       },
29 |       include: {
30 |         _count: {
31 |           select: { cardTags: true }
32 |         }
33 |       }
34 |     });
35 |   } catch (error) {
36 |     console.error("íƒœê·¸ ì¡°íšŒ ì˜¤ë¥˜:", error);
37 |     // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¹ˆ ë°°ì—´ ì‚¬ìš©
38 |   }
39 | 
40 |   const formattedTags = tags.map(tag => ({
41 |     id: tag.id,
42 |     name: tag.name,
43 |     count: tag._count.cardTags,
44 |     createdAt: formatDate(tag.createdAt)
45 |   }));
46 | 
47 |   return (
48 |     <div className="container mx-auto py-8">
49 |       <h1 className="text-3xl font-bold mb-6">íƒœê·¸ ê´€ë¦¬</h1>
50 |       
51 |       <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
52 |         <div className="md:col-span-1">
53 |           <Card>
54 |             <CardHeader>
55 |               <CardTitle>ìƒˆ íƒœê·¸ ì¶”ê°€</CardTitle>
56 |             </CardHeader>
57 |             <CardContent>
58 |               <TagForm />
59 |             </CardContent>
60 |           </Card>
61 |         </div>
62 |         
63 |         <div className="md:col-span-2">
64 |           <Card>
65 |             <CardHeader>
66 |               <CardTitle>íƒœê·¸ ëª©ë¡</CardTitle>
67 |             </CardHeader>
68 |             <CardContent>
69 |               <TagList initialTags={formattedTags} />
70 |             </CardContent>
71 |           </Card>
72 |         </div>
73 |       </div>
74 |     </div>
75 |   );
76 | } 
```

src/app/test-db/page.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: page.test.tsx
3 |  * ëª©ì : ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : TestDatabasePage ì»´í¬ë„ŒíŠ¸ì˜ ë‹¤ì–‘í•œ ìƒíƒœ ë° ë™ì‘ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  */
7 | 
8 | import { render, screen } from '@testing-library/react';
9 | import { describe, it, expect, vi, beforeEach } from 'vitest';
10 | 
11 | import TestDatabasePage from './page';
12 | 
13 | // Prisma í´ë¼ì´ì–¸íŠ¸ ëª¨í‚¹
14 | vi.mock('@/lib/prisma', () => ({
15 |     default: {
16 |         tag: {
17 |             findMany: vi.fn(),
18 |         },
19 |         $disconnect: vi.fn(),
20 |     },
21 | }));
22 | 
23 | // console.error ëª¨í‚¹
24 | vi.spyOn(console, 'error').mockImplementation(() => { });
25 | 
26 | describe('TestDatabasePage ì»´í¬ë„ŒíŠ¸', () => {
27 |     let mockPrisma: any;
28 | 
29 |     beforeEach(async () => {
30 |         vi.clearAllMocks();
31 |         // ê° í…ŒìŠ¤íŠ¸ ì „ì— ëª¨í‚¹ëœ Prisma ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°
32 |         mockPrisma = (await import('@/lib/prisma')).default;
33 |     });
34 | 
35 |     it('íƒœê·¸ ëª©ë¡ì´ ìˆì„ ë•Œ ì˜¬ë°”ë¥´ê²Œ ë Œë”ë§í•´ì•¼ í•¨', async () => {
36 |         // íƒœê·¸ ë°ì´í„° ëª¨í‚¹
37 |         const mockTags = [
38 |             { id: 1, name: 'ë¦¬ì•¡íŠ¸', _count: { cardTags: 5 } },
39 |             { id: 2, name: 'íƒ€ì…ìŠ¤í¬ë¦½íŠ¸', _count: { cardTags: 3 } },
40 |             { id: 3, name: 'ë°±ì—”ë“œ', _count: { cardTags: 2 } },
41 |         ];
42 | 
43 |         // Prisma ì‘ë‹µ ëª¨í‚¹
44 |         (mockPrisma.tag.findMany as any).mockResolvedValueOnce(mockTags);
45 | 
46 |         // ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ (ë¹„ë™ê¸° ì»´í¬ë„ŒíŠ¸ì´ë¯€ë¡œ ì„ì‹œ ë³€í™˜ ì‚¬ìš©)
47 |         const Component = await TestDatabasePage();
48 |         render(Component);
49 | 
50 |         // í˜ì´ì§€ ì œëª© í™•ì¸
51 |         expect(screen.getByText('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸')).toBeInTheDocument();
52 | 
53 |         // ê° íƒœê·¸ê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
54 |         expect(screen.getByText('ë¦¬ì•¡íŠ¸')).toBeInTheDocument();
55 |         expect(screen.getByText('íƒ€ì…ìŠ¤í¬ë¦½íŠ¸')).toBeInTheDocument();
56 |         expect(screen.getByText('ë°±ì—”ë“œ')).toBeInTheDocument();
57 | 
58 |         // íƒœê·¸ ê°œìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
59 |         expect(screen.getByText('ì—°ê²°ëœ ì¹´ë“œ: 5ê°œ')).toBeInTheDocument();
60 |         expect(screen.getByText('ì—°ê²°ëœ ì¹´ë“œ: 3ê°œ')).toBeInTheDocument();
61 |         expect(screen.getByText('ì—°ê²°ëœ ì¹´ë“œ: 2ê°œ')).toBeInTheDocument();
62 | 
63 |         // ì„±ê³µ ë©”ì‹œì§€ í™•ì¸
64 |         expect(screen.getByText('ì´ í˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆë‹¤ë©´ Prismaì™€ Supabase ì—°ê²°ì´ ì„±ê³µì ìœ¼ë¡œ êµ¬ì„±ëœ ê²ƒì…ë‹ˆë‹¤!')).toBeInTheDocument();
65 | 
66 |         // Prisma í˜¸ì¶œ í™•ì¸
67 |         expect(mockPrisma.tag.findMany).toHaveBeenCalledTimes(1);
68 |         expect(mockPrisma.tag.findMany).toHaveBeenCalledWith({
69 |             include: {
70 |                 _count: {
[TRUNCATED]
```

src/app/test-db/page.tsx
```
1 | import React from 'react';
2 | 
3 | import type { Tag } from '@prisma/client';
4 | 
5 | import prisma from '@/lib/prisma';
6 | 
7 | // íƒœê·¸ì™€ ì—°ê²°ëœ ì¹´ë“œ ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” íƒ€ì… ì •ì˜
8 | type TagWithCount = Tag & {
9 |   _count: {
10 |     cardTags: number;
11 |   };
12 | };
13 | 
14 | export default async function TestDatabasePage() {
15 |   let tags: TagWithCount[] = [];
16 |   let error: string | null = null;
17 |   
18 |   try {
19 |     // Prismaë¥¼ ì‚¬ìš©í•˜ì—¬ íƒœê·¸ ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤
20 |     tags = await prisma.tag.findMany({
21 |       include: {
22 |         _count: {
23 |           select: {
24 |             cardTags: true,
25 |           },
26 |         },
27 |       },
28 |     });
29 |   } catch (e) {
30 |     console.error('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜:', e);
31 |     error = e instanceof Error ? e.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
32 |   }
33 | 
34 |   return (
35 |     <div className="container mx-auto p-6">
36 |       <h1 className="text-3xl font-bold mb-6">ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
37 |       
38 |       <div className="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
39 |         <h2 className="text-2xl font-semibold mb-4">íƒœê·¸ ëª©ë¡</h2>
40 |         
41 |         {error ? (
42 |           <div className="p-4 mb-4 bg-red-50 dark:bg-red-900/20 rounded">
43 |             <p className="text-red-700 dark:text-red-400">
44 |               ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜: {error}
45 |             </p>
46 |             <p className="mt-2 text-sm text-red-600 dark:text-red-300">
47 |               Vercel í™˜ê²½ ë³€ìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
48 |             </p>
49 |           </div>
50 |         ) : tags.length === 0 ? (
51 |           <p className="text-gray-500 dark:text-gray-400">ë“±ë¡ëœ íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
52 |         ) : (
53 |           <ul className="space-y-2">
54 |             {tags.map((tag) => (
55 |               <li 
56 |                 key={tag.id}
57 |                 className="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded"
58 |               >
59 |                 <span className="font-medium">{tag.name}</span>
60 |                 <span className="text-sm text-gray-500 dark:text-gray-400">
61 |                   ì—°ê²°ëœ ì¹´ë“œ: {tag._count.cardTags}ê°œ
[TRUNCATED]
```

src/app/test-react-query/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/test-react-query/page.tsx
3 |  * ëª©ì : React Query Provider ì„¤ì • í…ŒìŠ¤íŠ¸ 
4 |  * ì—­í• : ReactQueryProviderê°€ ì œëŒ€ë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ í˜ì´ì§€
5 |  * ì‘ì„±ì¼: 2024-05-18
6 |  */
7 | 
8 | import TestQuery from '../test-query';
9 | 
10 | /**
11 |  * TestReactQueryPage: React Query í…ŒìŠ¤íŠ¸ í˜ì´ì§€
12 |  * @returns {JSX.Element} í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
13 |  */
14 | export default function TestReactQueryPage() {
15 |     return (
16 |         <div className="container mx-auto p-8">
17 |             <h1 className="text-2xl font-bold mb-6">React Query í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>
18 |             <TestQuery />
19 |         </div>
20 |     );
21 | } 
```

src/components/auth/AuthErrorDisplay.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/auth/AuthErrorDisplay.test.tsx
3 |  * ëª©ì : AuthErrorDisplay ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì¸ì¦ ì˜¤ë¥˜ ì •ë³´ í‘œì‹œ ì»´í¬ë„ŒíŠ¸ì˜ ê¸°ëŠ¥ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2024-09-28
6 |  */
7 | 
8 | import { render, screen } from '@testing-library/react';
9 | import { describe, expect, it, vi, beforeEach } from 'vitest';
10 | 
11 | import AuthErrorDisplay from './AuthErrorDisplay';
12 | 
13 | // ëª¨í‚¹ ì„¤ì •
14 | const mockGet = vi.fn();
15 | 
16 | vi.mock('next/navigation', () => ({
17 |     useSearchParams: () => ({
18 |         get: mockGet
19 |     })
20 | }));
21 | 
22 | describe('AuthErrorDisplay', () => {
23 |     beforeEach(() => {
24 |         vi.clearAllMocks();
25 |         vi.spyOn(console, 'error').mockImplementation(() => { });
26 |         mockGet.mockImplementation((param: string) => {
27 |             if (param === 'error') return 'default';
28 |             if (param === 'error_description') return '';
29 |             return null;
30 |         });
31 |     });
32 | 
33 |     it('ê¸°ë³¸ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤', () => {
34 |         render(<AuthErrorDisplay />);
35 |         expect(screen.getByText('ì¸ì¦ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')).toBeInTheDocument();
36 |     });
37 | 
38 |     it('íŠ¹ì • ì˜¤ë¥˜ ìœ í˜•ì— ëŒ€í•œ ë©”ì‹œì§€ë¥¼ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤', () => {
39 |         mockGet.mockImplementation((param: string) => {
40 |             if (param === 'error') return 'invalid_callback';
41 |             if (param === 'error_description') return '';
42 |             return null;
43 |         });
44 | 
45 |         render(<AuthErrorDisplay />);
46 |         expect(screen.getByText('ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ ì½œë°±ì…ë‹ˆë‹¤.')).toBeInTheDocument();
47 |     });
48 | 
49 |     it('ì˜¤ë¥˜ ì„¤ëª…ì´ ìˆì„ ê²½ìš° í•¨ê»˜ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤', () => {
50 |         mockGet.mockImplementation((param: string) => {
51 |             if (param === 'error') return 'verification_failed';
52 |             if (param === 'error_description') return 'ì´ë©”ì¼ ì£¼ì†Œê°€ í™•ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
53 |             return null;
54 |         });
55 | 
56 |         render(<AuthErrorDisplay />);
57 |         expect(screen.getByText('ì´ë©”ì¼ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')).toBeInTheDocument();
58 |         expect(screen.getByText('ì´ë©”ì¼ ì£¼ì†Œê°€ í™•ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.')).toBeInTheDocument();
59 |     });
60 | 
61 |     it('ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ìœ í˜•ì— ëŒ€í•´ ê¸°ë³¸ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤', () => {
62 |         mockGet.mockImplementation((param: string) => {
63 |             if (param === 'error') return 'unknown_error';
64 |             return null;
65 |         });
66 | 
67 |         render(<AuthErrorDisplay />);
68 |         expect(screen.getByText('ì¸ì¦ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')).toBeInTheDocument();
69 |     });
70 | 
[TRUNCATED]
```

src/components/auth/AuthErrorDisplay.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/auth/AuthErrorDisplay.tsx
3 |  * ëª©ì : ì¸ì¦ ì˜¤ë¥˜ ì •ë³´ í‘œì‹œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : URL íŒŒë¼ë¯¸í„°ì—ì„œ ì˜¤ë¥˜ ì •ë³´ë¥¼ ê°€ì ¸ì™€ í•´ë‹¹ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œ
5 |  * ì‘ì„±ì¼: 2024-09-28
6 |  */
7 | 
8 | 'use client';
9 | 
10 | import { useEffect, useState } from 'react'
11 | import Link from 'next/link'
12 | import { useSearchParams } from 'next/navigation'
13 | import createLogger from '@/lib/logger'
14 | 
15 | // ë¡œê±° ìƒì„±
16 | const logger = createLogger('AuthErrorDisplay')
17 | 
18 | // ì˜¤ë¥˜ ë©”ì‹œì§€ ë§¤í•‘
19 | const ERROR_MESSAGES: Record<string, string> = {
20 |     invalid_callback: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ ì½œë°±ì…ë‹ˆë‹¤.',
21 |     verification_failed: 'ì´ë©”ì¼ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
22 |     exchange_error: 'ì¸ì¦ í† í° êµí™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
23 |     no_code: 'ì¸ì¦ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.',
24 |     no_session: 'ì„¸ì…˜ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
25 |     default: 'ì¸ì¦ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
26 | }
27 | 
28 | export default function AuthErrorDisplay() {
29 |     const searchParams = useSearchParams()
30 |     const [error, setError] = useState<string>('default')
31 |     const [description, setDescription] = useState<string>('')
32 | 
33 |     useEffect(() => {
34 |         // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì˜¤ë¥˜ ì •ë³´ ì¶”ì¶œ
35 |         const errorParam = searchParams.get('error') || 'default'
36 |         const errorDescription = searchParams.get('error_description') || ''
37 | 
38 |         setError(errorParam)
39 |         setDescription(errorDescription)
40 | 
41 |         // ì˜¤ë¥˜ ë¡œê¹…
42 |         logger.error('ì¸ì¦ ì˜¤ë¥˜:', {
43 |             error: errorParam,
44 |             description: errorDescription
45 |         })
46 |     }, [searchParams])
47 | 
48 |     return (
49 |         <>
50 |             <p className="text-gray-700 mb-4">
51 |                 {ERROR_MESSAGES[error] || ERROR_MESSAGES.default}
52 |             </p>
53 | 
54 |             {description && (
55 |                 <p className="text-sm text-gray-500 mb-6 p-3 bg-gray-50 rounded">
56 |                     {description}
57 |                 </p>
58 |             )}
59 | 
60 |             <div className="flex flex-col space-y-3">
61 |                 <Link
62 |                     href="/login"
63 |                     className="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors"
64 |                 >
65 |                     ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
66 |                 </Link>
67 | 
68 |                 <Link
69 |                     href="/"
[TRUNCATED]
```

src/components/auth/AuthForm.tsx
```
1 | 'use client';
2 | 
3 | import { useState } from 'react';
4 | 
5 | import { setCookie } from 'cookies-next';
6 | import { toast } from 'sonner';
7 | 
8 | import { Button } from '@/components/ui/button';
9 | import { Input } from '@/components/ui/input';
10 | import { Label } from '@/components/ui/label';
11 | import { signIn, signUp, signInWithGoogle } from '@/lib/auth';
12 | import createLogger from '@/lib/logger';
13 | 
14 | // ë¡œê±° ìƒì„±
15 | const logger = createLogger('AuthForm');
16 | 
17 | type AuthMode = 'login' | 'register';
18 | 
19 | export default function AuthForm() {
20 |   const [mode, setMode] = useState<AuthMode>('login');
21 |   const [email, setEmail] = useState('');
22 |   const [password, setPassword] = useState('');
23 |   const [name, setName] = useState('');
24 |   const [isLoading, setIsLoading] = useState(false);
25 |   const [isGoogleLoading, setIsGoogleLoading] = useState(false);
26 | 
27 |   const toggleMode = () => {
28 |     setMode(mode === 'login' ? 'register' : 'login');
29 |     // í¼ ì´ˆê¸°í™”
30 |     setEmail('');
31 |     setPassword('');
32 |     setName('');
33 |   };
34 | 
35 |   const handleSubmit = async (e: React.FormEvent) => {
36 |     e.preventDefault();
37 |     setIsLoading(true);
38 | 
39 |     try {
40 |       if (mode === 'login') {
41 |         const { session } = await signIn(email, password);
42 | 
43 |         // ì¶”ê°€: ì¿ í‚¤ë¥¼ ì—¬ê¸°ì„œë„ ì§ì ‘ ì„¤ì • (ë³´ì™„ì±…)
44 |         if (session) {
45 |           // í˜„ì¬ í˜¸ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
46 |           const host = window.location.hostname;
47 |           const isLocalhost = host === 'localhost' || host === '127.0.0.1';
48 | 
49 |           // ë„ë©”ì¸ ì„¤ì • (ë¡œì»¬í˜¸ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ)
50 |           let domain = undefined;
51 |           if (!isLocalhost) {
52 |             // ì„œë¸Œë„ë©”ì¸ í¬í•¨í•˜ê¸° ìœ„í•´ ìµœìƒìœ„ ë„ë©”ì¸ë§Œ ì„¤ì •
53 |             const hostParts = host.split('.');
54 |             if (hostParts.length > 1) {
55 |               // vercel.app ë˜ëŠ” yoursite.com í˜•íƒœì¼ ê²½ìš°
56 |               domain = '.' + hostParts.slice(-2).join('.');
57 |             } else {
58 |               domain = host;
59 |             }
60 |           }
61 | 
62 |           // cookies-next ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
63 |           setCookie('sb-access-token', session.access_token, {
64 |             maxAge: 60 * 60 * 24 * 7, // 7ì¼
65 |             path: '/',
66 |             domain: domain,
67 |             secure: window.location.protocol === 'https:',
68 |             sameSite: 'lax'
69 |           });
70 | 
71 |           if (session.refresh_token) {
[TRUNCATED]
```

src/components/auth/UserProfile.tsx
```
1 | 'use client';
2 | 
3 | import { useState, useEffect } from 'react';
4 | 
5 | import { useRouter } from 'next/navigation';
6 | 
7 | import { toast } from 'sonner';
8 | 
9 | import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';
10 | import { Button } from '@/components/ui/button';
11 | import {
12 |   DropdownMenu,
13 |   DropdownMenuTrigger,
14 |   DropdownMenuContent,
15 |   DropdownMenuItem,
16 |   DropdownMenuSeparator
17 | } from '@/components/ui/dropdown-menu';
18 | import { getCurrentUser, signOut } from '@/lib/auth';
19 | 
20 | 
21 | 
22 | type User = {
23 |   id: string;
24 |   email: string;
25 |   dbUser?: {
26 |     name: string | null;
27 |   } | null;
28 |   user_metadata?: {
29 |     full_name?: string;
30 |     avatar_url?: string;
31 |   };
32 | };
33 | 
34 | export default function UserProfile() {
35 |   const [user, setUser] = useState<User | null>(null);
36 |   const [isLoading, setIsLoading] = useState(true);
37 |   const router = useRouter();
38 | 
39 |   useEffect(() => {
40 |     const fetchUser = async () => {
41 |       try {
42 |         const currentUser = await getCurrentUser();
43 |         setUser(currentUser);
44 |       } catch (error) {
45 |         console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
46 |       } finally {
47 |         setIsLoading(false);
48 |       }
49 |     };
50 | 
51 |     fetchUser();
52 |   }, []);
53 | 
54 |   const handleSignOut = async () => {
55 |     try {
56 |       await signOut();
57 |       toast.success('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
58 |       router.push('/login');
59 |     } catch (error) {
60 |       toast.error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
61 |       console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
62 |     }
63 |   };
64 | 
65 |   // ì‚¬ìš©ì ì´ë¦„ì„ ê°€ì ¸ì˜¤ëŠ” í—¬í¼ í•¨ìˆ˜
66 |   const getUserName = () => {
67 |     if (!user) return '';
68 | 
69 |     // ìš°ì„ ìˆœìœ„: 1. Google í”„ë¡œí•„ ì´ë¦„, 2. DBì— ì €ì¥ëœ ì´ë¦„, 3. ì´ë©”ì¼ ì•ë¶€ë¶„
70 |     return user.user_metadata?.full_name ||
71 |       user.dbUser?.name ||
72 |       (user.email ? user.email.split('@')[0] : 'ì‚¬ìš©ì');
73 |   };
74 | 
75 |   // ì•„ë°”íƒ€ ì´ë¯¸ì§€ URL ë˜ëŠ” ì´ë‹ˆì…œì„ ê°€ì ¸ì˜¤ëŠ” í—¬í¼ í•¨ìˆ˜
76 |   const getAvatar = () => {
77 |     if (!user) return '';
78 | 
79 |     return user.user_metadata?.avatar_url || '';
80 |   };
81 | 
82 |   // ì´ë‹ˆì…œ ìƒì„± í—¬í¼ í•¨ìˆ˜
83 |   const getInitials = () => {
[TRUNCATED]
```

src/components/cards/CardList.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: ./src/components/cards/CardList.test.tsx
3 |  * ëª©ì : ì¹´ë“œ ëª©ë¡ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì¹´ë“œ ëª©ë¡ ë Œë”ë§ ë° ë™ì‘ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-04-25 : lint ì˜¤ë¥˜ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : React Queryë¡œ ë¦¬íŒ©í† ë§
8 |  */
9 | 
10 | import React from 'react';
11 | 
12 | import { useSearchParams, useRouter } from 'next/navigation';
13 | 
14 | import { render, screen, fireEvent, cleanup, waitFor } from '@testing-library/react';
15 | import '@testing-library/jest-dom/vitest';
16 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
17 | import { http, HttpResponse } from 'msw';
18 | import { setupServer } from 'msw/node';
19 | import { toast } from 'sonner';
20 | import { describe, it, expect, beforeEach, afterEach, afterAll, vi, beforeAll } from 'vitest';
21 | 
22 | import CardList from './CardList';
23 | import * as cardService from '@/services/cardService';
24 | 
25 | // MSW ì„œë²„ ì„¤ì •
26 | const mockCards = [
27 |   {
28 |     id: 'card1',
29 |     title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ 1',
30 |     content: 'í…ŒìŠ¤íŠ¸ ë‚´ìš© 1',
31 |     createdAt: '2023-01-01T00:00:00.000Z',
32 |     updatedAt: '2023-01-01T00:00:00.000Z',
33 |     userId: 'user1',
34 |   },
35 |   {
36 |     id: 'card2',
37 |     title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ 2',
38 |     content: 'í…ŒìŠ¤íŠ¸ ë‚´ìš© 2',
39 |     createdAt: '2023-01-02T00:00:00.000Z',
40 |     updatedAt: '2023-01-02T00:00:00.000Z',
41 |     userId: 'user2',
42 |   },
43 | ];
44 | 
45 | const server = setupServer(
46 |   http.get('/api/cards', ({ request }) => {
47 |     const url = new URL(request.url);
48 |     const q = url.searchParams.get('q');
49 |     const tag = url.searchParams.get('tag');
50 | 
51 |     // ê²€ìƒ‰ì–´ë‚˜ íƒœê·¸ í•„í„°ë§ ì ìš©
52 |     if (q === 'error') {
53 |       return new HttpResponse(null, { status: 500 });
54 |     }
55 | 
56 |     let filteredCards = [...mockCards];
57 |     if (q) {
58 |       filteredCards = filteredCards.filter(card =>
59 |         card.title.toLowerCase().includes(q.toLowerCase()) ||
60 |         (card.content && card.content.toLowerCase().includes(q.toLowerCase()))
61 |       );
62 |     }
63 | 
64 |     return HttpResponse.json(filteredCards);
65 |   }),
66 | 
67 |   http.delete('/api/cards/:id', () => {
[TRUNCATED]
```

src/components/cards/CardList.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/cards/CardList.tsx
3 |  * ëª©ì : ì¹´ë“œ ëª©ë¡ ì¡°íšŒ í™”ë©´ êµ¬í˜„
4 |  * ì—­í• : React Query useQueryë¥¼ ì‚¬ìš©í•˜ì—¬ ì¹´ë“œ ëª©ë¡ ì¡°íšŒ ê¸°ëŠ¥ ì œê³µ. ì´í›„ì— BulletBoard ê¸°ëŠ¥ìœ¼ë¡œ ê°œì„  ì˜ˆì •
5 |  * ì‘ì„±ì¼: 2025-04-22
6 |  */
7 | 
8 | "use client";
9 | 
10 | import React, { useState } from "react";
11 | 
12 | import { useSearchParams } from "next/navigation";
13 | import { useRouter } from "next/navigation";
14 | 
15 | import { Trash2, Eye } from "lucide-react";
16 | import { toast } from "sonner";
17 | 
18 | import TiptapViewer from "@/components/editor/TiptapViewer";
19 | import { Badge } from "@/components/ui/badge";
20 | import { Button } from "@/components/ui/button";
21 | import { Card, CardContent, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
22 | import {
23 |   Dialog,
24 |   DialogContent,
25 |   DialogHeader,
26 |   DialogTitle,
27 |   DialogDescription,
28 |   DialogFooter,
29 |   DialogTrigger,
30 |   DialogClose,
31 | } from "@/components/ui/dialog";
32 | import { formatDate } from "@/lib/utils";
33 | import { useCards } from "@/hooks/useCards";
34 | 
35 | import { SearchBar } from "./SearchBar";
36 | 
37 | interface Tag {
38 |   id: string;
39 |   name: string;
40 | }
41 | 
42 | interface CardTag {
43 |   tag: Tag;
44 | }
45 | 
46 | interface CardItem {
47 |   id: string;
48 |   title: string;
49 |   content: string;
50 |   createdAt: string;
51 |   cardTags?: CardTag[];
52 | }
53 | 
54 | export default function CardList() {
55 |   const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);
56 |   const [deletingCardId, setDeletingCardId] = useState<string | null>(null);
57 |   const [isDeleting, setIsDeleting] = useState(false);
58 |   const searchParams = useSearchParams();
59 |   const router = useRouter();
60 | 
61 |   const q = searchParams.get('q') || undefined;
62 |   const tag = searchParams.get('tag') || undefined;
63 | 
64 |   const { data: cards, isLoading, error } = useCards({ q, tag });
65 | 
66 |   // ì¿¼ë¦¬ ìƒíƒœ ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸
67 |   console.log('[CardList] React Query ìƒíƒœ:', {
68 |     ë°ì´í„°ìˆìŒ: !!cards,
69 |     ì¹´ë“œê°œìˆ˜: cards?.length || 0,
70 |     ë¡œë”©ì¤‘: isLoading,
71 |     ì—ëŸ¬: error
72 |   });
73 | 
74 |   const handleTagClick = (tagName: string, e: React.MouseEvent) => {
75 |     e.preventDefault();
76 |     e.stopPropagation();
[TRUNCATED]
```

src/components/cards/CreateCardModal.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/cards/CreateCardModal.test.tsx
3 |  * ëª©ì : CreateCardModal ì»´í¬ë„ŒíŠ¸ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì¹´ë“œ ìƒì„± ëª¨ë‹¬ì˜ ë™ì‘, ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬, API í˜¸ì¶œ, íƒœê·¸ ê´€ë¦¬ ë“±ì„ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-04-08
6 |  * ìˆ˜ì •ì¼: 2025-04-25 : lint ì˜¤ë¥˜ ìˆ˜ì • - ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” import ë° ë³€ìˆ˜ ì œê±°
7 |  */
8 | 
9 | import { useState } from 'react';
10 | 
11 | import { render, screen, waitFor } from '@testing-library/react';
12 | import userEvent from '@testing-library/user-event';
13 | import { http, HttpResponse } from 'msw';
14 | import { act } from 'react-dom/test-utils';
15 | import { vi } from 'vitest';
16 | 
17 | import { useAppStore } from '@/store/useAppStore';
18 | import { server } from '@/tests/msw/server';
19 | 
20 | import CreateCardModal from './CreateCardModal';
21 | 
22 | // useRouter ëª¨í‚¹
23 | const mockRouter = {
24 |     refresh: vi.fn(),
25 |     push: vi.fn(),
26 |     replace: vi.fn(),
27 | };
28 | 
29 | vi.mock('next/navigation', () => ({
30 |     useRouter: () => mockRouter,
31 | }));
32 | 
33 | // TipTap ì—ë””í„° ëª¨í‚¹
34 | vi.mock('@/components/editor/TiptapEditor', () => ({
35 |     default: ({ onUpdate, onChange, content }: { onUpdate?: (content: string) => void, onChange?: (content: string) => void, content?: string }) => {
36 |         const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
37 |             if (onUpdate) {
38 |                 onUpdate(e.target.value);
39 |             }
40 |             if (onChange) {
41 |                 onChange(e.target.value);
42 |             }
43 |         };
44 | 
45 |         return (
46 |             <div data-testid="tiptap-editor">
47 |                 <textarea
48 |                     data-testid="tiptap-content"
49 |                     onChange={handleChange}
50 |                     aria-label="ë‚´ìš©"
51 |                     value={content || ""}
52 |                 />
53 |             </div>
54 |         );
55 |     }
56 | }));
57 | 
58 | // toast ëª¨í‚¹
59 | vi.mock('sonner', () => {
60 |     return {
61 |         toast: {
62 |             error: vi.fn(),
63 |             success: vi.fn(),
64 |         }
65 |     };
66 | });
67 | 
68 | // window.location.reload ëª¨í‚¹
69 | const mockReload = vi.fn();
70 | Object.defineProperty(window, 'location', {
71 |     value: { reload: mockReload },
72 |     writable: true
73 | });
74 | 
75 | // console.error ëª¨í‚¹
76 | const originalConsoleError = console.error;
77 | beforeAll(() => {
[TRUNCATED]
```

src/components/cards/CreateCardModal.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: ./src/components/cards/CreateCardModal.tsx
3 |  * ëª©ì : ìƒˆë¡œìš´ ì¹´ë“œ ìƒì„±ì„ ìœ„í•œ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì¹´ë“œ ì‘ì„± ì–‘ì‹ì„ ì œê³µí•˜ê³  ì¹´ë“œ ìƒì„± ê¸°ëŠ¥ ìˆ˜í–‰
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-04-25 : lint ì˜¤ë¥˜ ìˆ˜ì • - ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” import ë° ë³€ìˆ˜ ì œê±°
7 |  */
8 | 
9 | "use client";
10 | 
11 | import React, { useState, useRef, useEffect } from "react";
12 | 
13 | import { X, Loader2, PlusCircle } from "lucide-react";
14 | 
15 | import TiptapEditor from "@/components/editor/TiptapEditor";
16 | import { Badge } from "@/components/ui/badge";
17 | import { Button } from "@/components/ui/button";
18 | import {
19 |   Dialog,
20 |   DialogContent,
21 |   DialogHeader,
22 |   DialogTitle,
23 |   DialogTrigger,
24 |   DialogDescription,
25 |   DialogClose,
26 | } from "@/components/ui/dialog";
27 | import { Input } from "@/components/ui/input";
28 | import { Label } from "@/components/ui/label";
29 | import { DEFAULT_USER_ID } from "@/lib/constants";
30 | import { useCreateCard } from "@/hooks/useCreateCard";
31 | import { CreateCardInput, Card } from "@/types/card";
32 | 
33 | // ì»´í¬ë„ŒíŠ¸ì— props íƒ€ì… ì •ì˜
34 | interface CreateCardModalProps {
35 |   onCardCreated?: (cardData: Card) => void;
36 |   autoOpen?: boolean; // ìë™ìœ¼ë¡œ ëª¨ë‹¬ì„ ì—´ì§€ ì—¬ë¶€
37 |   onClose?: () => void; // ëª¨ë‹¬ì´ ë‹«í ë•Œ ì½œë°±
38 |   customTrigger?: React.ReactNode; // ì»¤ìŠ¤í…€ íŠ¸ë¦¬ê±° ë²„íŠ¼
39 | }
40 | 
41 | export default function CreateCardModal({
42 |   onCardCreated,
43 |   autoOpen = false,
44 |   onClose,
45 |   customTrigger,
46 | }: CreateCardModalProps) {
47 |   const [open, setOpen] = useState(false);
48 |   const [title, setTitle] = useState("");
49 |   const [content, setContent] = useState("");
50 |   const [tagInput, setTagInput] = useState("");
51 |   const [tags, setTags] = useState<string[]>([]);
52 |   const isComposing = useRef(false);
53 | 
54 |   // useCreateCard í›… ì‚¬ìš©
55 |   const createCardMutation = useCreateCard();
56 |   const { mutate: createCard } = createCardMutation;
57 |   const isLoading = createCardMutation.isPending;
58 |   const { isSuccess, error } = createCardMutation;
59 | 
60 |   // ìë™ìœ¼ë¡œ ëª¨ë‹¬ ì—´ê¸°
61 |   useEffect(() => {
62 |     if (autoOpen) {
63 |       setOpen(true);
64 |     }
65 |   }, [autoOpen]);
66 | 
67 |   // isSuccess ìƒíƒœë¥¼ ê°ì§€í•˜ì—¬ ëª¨ë‹¬ ë‹«ê¸°
68 |   useEffect(() => {
69 |     if (isSuccess) {
70 |       setTitle("");
71 |       setContent("");
72 |       setTags([]);
73 |       setTagInput("");
74 |       setOpen(false);
75 |     }
[TRUNCATED]
```

src/components/cards/EditCardContent.tsx
```
1 | "use client";
2 | 
3 | import React, { useState, useEffect } from "react";
4 | 
5 | import { Pencil, Check, X } from "lucide-react";
6 | import { toast } from "sonner";
7 | 
8 | import TiptapEditor from "@/components/editor/TiptapEditor";
9 | import TiptapViewer from "@/components/editor/TiptapViewer";
10 | import { Button } from "@/components/ui/button";
11 | import { useUpdateCard } from "@/hooks/useUpdateCard";
12 | 
13 | 
14 | interface EditCardContentProps {
15 |   cardId: string;
16 |   initialContent: string;
17 | }
18 | 
19 | export default function EditCardContent({ cardId, initialContent }: EditCardContentProps) {
20 |   const [isEditing, setIsEditing] = useState(false);
21 |   const [content, setContent] = useState(initialContent);
22 | 
23 |   // useUpdateCard í›… ì‚¬ìš©
24 |   const updateCardMutation = useUpdateCard();
25 |   const { mutate: updateCard } = updateCardMutation;
26 |   const isSubmitting = updateCardMutation.isPending;
27 |   const { isSuccess, error } = updateCardMutation;
28 | 
29 |   // ì—…ë°ì´íŠ¸ ì„±ê³µ ì‹œ í¸ì§‘ ëª¨ë“œ ì¢…ë£Œ
30 |   useEffect(() => {
31 |     if (isSuccess) {
32 |       setIsEditing(false);
33 |     }
34 |   }, [isSuccess]);
35 | 
36 |   const handleSubmit = async () => {
37 |     if (content === initialContent) {
38 |       setIsEditing(false);
39 |       return;
40 |     }
41 | 
42 |     if (!content.trim()) {
43 |       toast.error("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
44 |       return;
45 |     }
46 | 
47 |     updateCard(
48 |       {
49 |         id: cardId,
50 |         patch: { content }
51 |       },
52 |       {
53 |         onSuccess: () => {
54 |           toast.success("ë‚´ìš©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
55 |         },
56 |         onError: (error) => {
57 |           console.error("Error updating card content:", error);
58 |           toast.error(error instanceof Error ? error.message : "ë‚´ìš© ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
59 |         }
60 |       }
61 |     );
62 |   };
63 | 
64 |   const handleCancel = () => {
65 |     setContent(initialContent);
66 |     setIsEditing(false);
67 |   };
68 | 
69 |   if (isEditing) {
70 |     return (
71 |       <div className="space-y-4">
72 |         <TiptapEditor
73 |           content={content}
74 |           onChange={setContent}
75 |           placeholder="ì¹´ë“œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
76 |         />
77 |         {error && (
78 |           <p className="text-sm text-red-500">
79 |             ì˜¤ë¥˜: {error.message || 'ë‚´ìš© ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}
80 |           </p>
81 |         )}
82 |         <div className="flex justify-end space-x-2">
83 |           <Button
84 |             variant="outline"
85 |             size="sm"
86 |             onClick={handleCancel}
[TRUNCATED]
```

src/components/cards/EditCardForm.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/cards/EditCardForm.tsx
3 |  * ëª©ì : ì¹´ë“œ ìˆ˜ì • í¼ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì¹´ë“œ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•œ í¼ì„ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-17
6 |  */
7 | 
8 | "use client";
9 | 
10 | import React, { useState, useEffect } from "react";
11 | 
12 | import { X } from "lucide-react";
13 | import { toast } from "sonner";
14 | 
15 | import TiptapEditor from "@/components/editor/TiptapEditor";
16 | import { Badge } from "@/components/ui/badge";
17 | import { Button } from "@/components/ui/button";
18 | import { Input } from "@/components/ui/input";
19 | import { Label } from "@/components/ui/label";
20 | import { useUpdateCard } from "@/hooks/useUpdateCard";
21 | import { Card } from "@/types/card";
22 | 
23 | // ì¹´ë“œ íƒ€ì… ì •ì˜
24 | export interface CardData {
25 |   id: string;
26 |   title: string;
27 |   content: string;
28 |   cardTags?: Array<{ tag: { name: string } }>;
29 |   [key: string]: unknown; // ì¶”ê°€ ì†ì„±ì„ ìœ„í•œ ì¸ë±ìŠ¤ ì‹œê·¸ë‹ˆì²˜
30 | }
31 | 
32 | // ì»´í¬ë„ŒíŠ¸ props íƒ€ì… ì •ì˜
33 | interface EditCardFormProps {
34 |   card: CardData; // ì¹´ë“œ ë°ì´í„°
35 |   onSuccess?: (updatedCard?: CardData) => void; // ìˆ˜ì • ì„±ê³µ ì‹œ í˜¸ì¶œí•  ì½œë°±
36 |   onCancel?: () => void; // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œí•  ì½œë°±
37 | }
38 | 
39 | // EditCardForm ì»´í¬ë„ŒíŠ¸
40 | export default function EditCardForm({ card, onSuccess, onCancel }: EditCardFormProps) {
41 |   const [title, setTitle] = useState('');
42 |   const [content, setContent] = useState('');
43 |   const [tagInput, setTagInput] = useState('');
44 |   const [tags, setTags] = useState<string[]>([]);
45 |   const [isComposing, setIsComposing] = useState(false);
46 | 
47 |   // useUpdateCard í›… ì‚¬ìš©
48 |   const updateCardMutation = useUpdateCard();
49 |   const { mutate: updateCard } = updateCardMutation;
50 |   const isSubmitting = updateCardMutation.isPending;
51 |   const { isSuccess, error } = updateCardMutation;
52 | 
53 |   // ì´ˆê¸° ë°ì´í„° ë¡œë”©
54 |   useEffect(() => {
55 |     if (card) {
56 |       setTitle(card.title || '');
57 |       setContent(card.content || '');
58 |       // CardTagì—ì„œ íƒœê·¸ ì´ë¦„ì„ ì¶”ì¶œ
59 |       if (card.cardTags && Array.isArray(card.cardTags)) {
60 |         const tagNames = card.cardTags.map((cardTag) => cardTag.tag.name);
61 |         setTags(tagNames);
62 |       }
63 |     }
64 |   }, [card]);
65 | 
66 |   // ì—…ë°ì´íŠ¸ ì„±ê³µ ì‹œ ì²˜ë¦¬
67 |   useEffect(() => {
68 |     if (isSuccess) {
69 |       if (onSuccess) {
70 |         onSuccess();
71 |       }
[TRUNCATED]
```

src/components/cards/EditCardModal.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/cards/EditCardModal.tsx
3 |  * ëª©ì : ì¹´ë“œ ìˆ˜ì • ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì¹´ë“œ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•œ ëª¨ë‹¬ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-17
6 |  */
7 | 
8 | "use client";
9 | 
10 | import React, { useState, useEffect } from 'react';
11 | 
12 | import { X } from 'lucide-react';
13 | 
14 | import EditCardForm from "@/components/cards/EditCardForm";
15 | import type { CardData } from "@/components/cards/EditCardForm";
16 | import { Button } from "@/components/ui/button";
17 | 
18 | interface EditCardModalProps {
19 |   cardId: string;
20 |   onClose: () => void;
21 |   onCardUpdated?: (updatedCard: CardData) => void;
22 | }
23 | 
24 | /**
25 |  * ì¹´ë“œ ìˆ˜ì •ì„ ìœ„í•œ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
26 |  */
27 | export function EditCardModal({
28 |   cardId,
29 |   onClose,
30 |   onCardUpdated
31 | }: EditCardModalProps) {
32 |   const [card, setCard] = useState<CardData | null>(null);
33 |   const [loading, setLoading] = useState(true);
34 |   const [error, setError] = useState<string | null>(null);
35 | 
36 |   // ì¹´ë“œ ë°ì´í„° ë¡œë“œ
37 |   useEffect(() => {
38 |     const fetchCard = async () => {
39 |       try {
40 |         setLoading(true);
41 |         const response = await fetch(`/api/cards/${cardId}`);
42 | 
43 |         if (!response.ok) {
44 |           throw new Error('ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
45 |         }
46 | 
47 |         const data = await response.json();
48 |         setCard(data);
49 |       } catch (err) {
50 |         setError(err instanceof Error ? err.message : 'ì¹´ë“œ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
51 |       } finally {
52 |         setLoading(false);
53 |       }
54 |     };
55 | 
56 |     if (cardId) {
57 |       fetchCard();
58 |     }
59 |   }, [cardId]);
60 | 
61 |   // ì¹´ë“œ ì—…ë°ì´íŠ¸ ì½œë°±
62 |   const handleCardUpdated = (updatedCard?: CardData) => {
63 |     if (onCardUpdated && updatedCard) {
64 |       onCardUpdated(updatedCard);
65 |     }
66 |     onClose();
67 |   };
68 | 
69 |   // í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
70 |   const handleModalClick = (e: React.MouseEvent) => {
71 |     e.stopPropagation();
72 |   };
73 | 
74 |   return (
75 |     <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40" onClick={onClose}>
76 |       <div className="relative bg-card rounded-lg shadow-lg max-w-[700px] w-full mx-4" onClick={handleModalClick}>
[TRUNCATED]
```

src/components/cards/SearchBar.test.tsx
```
1 | import { render, screen, fireEvent } from '@testing-library/react';
2 | import { describe, it, expect, beforeEach, vi } from 'vitest';
3 | 
4 | import { SearchBar } from './SearchBar';
5 | import '@testing-library/jest-dom';
6 | 
7 | // ê¸°ë³¸ ëª¨í‚¹ ì„¤ì •
8 | const push = vi.fn();
9 | const useRouterMock = vi.fn().mockReturnValue({ push });
10 | const useSearchParamsMock = vi.fn().mockReturnValue({
11 |   get: vi.fn().mockReturnValue(null)
12 | });
13 | 
14 | vi.mock('next/navigation', () => ({
15 |   useRouter: () => useRouterMock(),
16 |   useSearchParams: () => useSearchParamsMock()
17 | }));
18 | 
19 | // ì‹¤ì œ SearchBar ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
20 | describe('SearchBar', () => {
21 |   beforeEach(() => {
22 |     vi.clearAllMocks();
23 |     useRouterMock.mockReturnValue({ push });
24 |     useSearchParamsMock.mockReturnValue({
25 |       get: vi.fn().mockReturnValue(null)
26 |     });
27 |   });
28 | 
29 |   it('ì˜¬ë°”ë¥´ê²Œ ë Œë”ë§ ë˜ì–´ì•¼ í•¨', () => {
30 |     render(<SearchBar />);
31 |     
32 |     // ê¸°ë³¸ ìš”ì†Œë“¤ì´ ë Œë”ë§ ë˜ì—ˆëŠ”ì§€ í™•ì¸
33 |     expect(screen.getByPlaceholderText('ê²€ìƒ‰ì–´ ì…ë ¥ ë˜ëŠ” #íƒœê·¸ ì…ë ¥')).toBeInTheDocument();
34 |     expect(screen.getByText('ê²€ìƒ‰')).toBeInTheDocument();
35 |   });
36 |   
37 |   it('URLì—ì„œ ê²€ìƒ‰ì–´ë¥¼ ê°€ì ¸ì™€ ì…ë ¥ í•„ë“œì— í‘œì‹œí•´ì•¼ í•¨', () => {
38 |     // URL íŒŒë¼ë¯¸í„° ëª¨í‚¹ ì„¤ì •
39 |     useSearchParamsMock.mockReturnValue({
40 |       get: (param: string) => param === 'q' ? 'í…ŒìŠ¤íŠ¸ì¿¼ë¦¬' : null
41 |     });
42 |     
43 |     render(<SearchBar />);
44 |     
45 |     // useEffectì—ì„œ URL íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì ¸ì™€ ì…ë ¥ í•„ë“œì— ì„¤ì •
46 |     const inputElement = screen.getByPlaceholderText('ê²€ìƒ‰ì–´ ì…ë ¥ ë˜ëŠ” #íƒœê·¸ ì…ë ¥');
47 |     expect(inputElement).toHaveValue('í…ŒìŠ¤íŠ¸ì¿¼ë¦¬');
48 |   });
49 |   
50 |   it('ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ ì¼ë°˜ ê²€ìƒ‰ì–´ë¡œ ì˜¬ë°”ë¥¸ URLë¡œ ì´ë™í•´ì•¼ í•¨', () => {
51 |     render(<SearchBar />);
52 |     
53 |     // ì…ë ¥ í•„ë“œì— ê²€ìƒ‰ì–´ ì…ë ¥
54 |     const inputElement = screen.getByPlaceholderText('ê²€ìƒ‰ì–´ ì…ë ¥ ë˜ëŠ” #íƒœê·¸ ì…ë ¥');
55 |     fireEvent.change(inputElement, { target: { value: 'ì¼ë°˜ê²€ìƒ‰ì–´' } });
56 |     
57 |     // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­
58 |     const searchButton = screen.getByText('ê²€ìƒ‰');
59 |     fireEvent.click(searchButton);
60 |     
61 |     // ì˜¬ë°”ë¥¸ URLë¡œ ì´ë™í–ˆëŠ”ì§€ í™•ì¸
62 |     expect(push).toHaveBeenCalledWith('/cards?q=%EC%9D%BC%EB%B0%98%EA%B2%80%EC%83%89%EC%96%B4');
63 |   });
64 |   
65 |   it('íƒœê·¸ ê²€ìƒ‰ì–´(#ìœ¼ë¡œ ì‹œì‘)ë¡œ ê²€ìƒ‰ ì‹œ ì˜¬ë°”ë¥¸ URLë¡œ ì´ë™í•´ì•¼ í•¨', () => {
66 |     render(<SearchBar />);
67 |     
[TRUNCATED]
```

src/components/cards/SearchBar.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: SearchBar.tsx
3 |  * ëª©ì : ì¹´ë“œ ê²€ìƒ‰ ê¸°ëŠ¥ ì œê³µ
4 |  * ì—­í• : ì¹´ë“œ ê²€ìƒ‰ ë° íƒœê·¸ ê²€ìƒ‰ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-03-30
7 |  */
8 | 
9 | 'use client';
10 | 
11 | import { useState, useEffect, useCallback, useRef } from 'react';
12 | 
13 | import { useRouter, useSearchParams } from 'next/navigation';
14 | 
15 | import { Search, X, Hash, AlertCircle } from 'lucide-react';
16 | 
17 | import { Badge } from '@/components/ui/badge';
18 | import { Button } from '@/components/ui/button';
19 | import { Input } from '@/components/ui/input';
20 | import {
21 |   Tooltip,
22 |   TooltipContent,
23 |   TooltipProvider,
24 |   TooltipTrigger,
25 | } from "@/components/ui/tooltip";
26 | import { cn } from '@/lib/utils';
27 | 
28 | interface SearchBarProps {
29 |   className?: string;
30 |   placeholder?: string;
31 | }
32 | 
33 | export const SearchBar = ({ 
34 |   className, 
35 |   placeholder = "ê²€ìƒ‰ì–´ ì…ë ¥ ë˜ëŠ” #íƒœê·¸ ì…ë ¥" 
36 | }: SearchBarProps) => {
37 |   const router = useRouter();
38 |   const searchParams = useSearchParams();
39 |   const [searchTerm, setSearchTerm] = useState('');
40 |   const [recentSearches, setRecentSearches] = useState<string[]>([]);
41 |   const [isTagMode, setIsTagMode] = useState(false);
42 |   const inputRef = useRef<HTMLInputElement>(null);
43 |   
44 |   // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìµœê·¼ ê²€ìƒ‰ì–´ ë¶ˆëŸ¬ì˜¤ê¸°
45 |   useEffect(() => {
46 |     const savedSearches = localStorage.getItem('recentSearches');
47 |     if (savedSearches) {
48 |       try {
49 |         const parsed = JSON.parse(savedSearches);
50 |         if (Array.isArray(parsed)) {
51 |           setRecentSearches(parsed.slice(0, 5)); // ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ í‘œì‹œ
52 |         }
53 |       } catch {
54 |         // íŒŒì‹± ì˜¤ë¥˜ ì‹œ ë¬´ì‹œ
55 |       }
56 |     }
57 |   }, []);
58 |   
59 |   // URLì—ì„œ ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
60 |   useEffect(() => {
61 |     const q = searchParams.get('q') || '';
62 |     const tag = searchParams.get('tag');
63 |     
64 |     if (tag) {
65 |       setSearchTerm(`#${tag}`);
66 |       setIsTagMode(true);
67 |     } else {
68 |       setSearchTerm(q);
69 |       setIsTagMode(q.startsWith('#'));
70 |     }
71 |   }, [searchParams]);
72 |   
73 |   // ìµœê·¼ ê²€ìƒ‰ì–´ ì €ì¥
74 |   const saveRecentSearch = useCallback((term: string) => {
75 |     if (!term || term.length < 2) return; // ë„ˆë¬´ ì§§ì€ ê²€ìƒ‰ì–´ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ
76 |     
77 |     const newSearches = [
78 |       term, 
[TRUNCATED]
```

src/components/cards/TagFilter.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: TagFilter.tsx
3 |  * ëª©ì : ì¹´ë“œ ëª©ë¡ì—ì„œ íƒœê·¸ ê¸°ë°˜ í•„í„°ë§ ì œê³µ
4 |  * ì—­í• : ì„ íƒ ê°€ëŠ¥í•œ íƒœê·¸ ëª©ë¡ì„ í‘œì‹œí•˜ê³  íƒœê·¸ í•„í„°ë§ ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * @rule   three-layer-standard
7 |  * @layer  tanstack-query-hook
8 |  * @tag    @tanstack-query-msw fetchTags
9 |  */
10 | 
11 | 'use client';
12 | 
13 | import { useState, useEffect } from 'react';
14 | 
15 | import { useRouter, useSearchParams } from 'next/navigation';
16 | 
17 | import { Loader2, Tags, ChevronDown, ChevronUp } from 'lucide-react';
18 | import { toast } from 'sonner';
19 | 
20 | import { Badge } from '@/components/ui/badge';
21 | import { Button } from '@/components/ui/button';
22 | import { ScrollArea } from '@/components/ui/scroll-area';
23 | import { cn } from '@/lib/utils';
24 | import { useTags } from '@/hooks/useTags';
25 | import { Tag } from '@/services/tagService';
26 | 
27 | export function TagFilter() {
28 |   const router = useRouter();
29 |   const searchParams = useSearchParams();
30 |   const [expanded, setExpanded] = useState(true);
31 |   const [selectedTag, setSelectedTag] = useState<string | null>(null);
32 | 
33 |   // React Query í›…ì„ ì‚¬ìš©í•˜ì—¬ íƒœê·¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
34 |   const { data: tags = [], isLoading, error } = useTags();
35 | 
36 |   // URLì—ì„œ í˜„ì¬ ì„ íƒëœ íƒœê·¸ ê°€ì ¸ì˜¤ê¸°
37 |   useEffect(() => {
38 |     const tagParam = searchParams.get('tag');
39 |     setSelectedTag(tagParam);
40 |   }, [searchParams]);
41 | 
42 |   // íƒœê·¸ í´ë¦­ í•¸ë“¤ëŸ¬
43 |   const handleTagClick = (tagName: string) => {
44 |     if (selectedTag === tagName) {
45 |       // ì´ë¯¸ ì„ íƒëœ íƒœê·¸ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ í•„í„° í•´ì œ
46 |       router.push('/cards');
47 |       setSelectedTag(null);
48 |     } else {
49 |       // ìƒˆ íƒœê·¸ ì„ íƒ
50 |       router.push(`/cards?tag=${encodeURIComponent(tagName)}`);
51 |       setSelectedTag(tagName);
52 |     }
53 |   };
54 | 
55 |   // ì—ëŸ¬ ì²˜ë¦¬
56 |   if (error) {
57 |     toast.error('íƒœê·¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
58 |   }
59 | 
60 |   return (
61 |     <div className="mb-4 border rounded-md">
62 |       <div
63 |         className="p-3 flex justify-between items-center cursor-pointer bg-muted/30"
64 |         onClick={() => setExpanded(!expanded)}
65 |       >
66 |         <h3 className="font-medium flex items-center">
67 |           <Tags size={16} className="mr-2" />
68 |           íƒœê·¸ í•„í„°
69 |         </h3>
[TRUNCATED]
```

src/components/debug/DevTools.tsx
```
1 | import { useState } from 'react';
2 | 
3 | import { Panel } from '@xyflow/react';
4 | 
5 | import { ChangeLogger, useChangeLogger, type ChangeLoggerHandlers } from './ChangeLogger';
6 | import { NodeInspector } from './NodeInspector';
7 | import { ViewportLogger } from './ViewportLogger';
8 | 
9 | /**
10 |  * React Flow ë””ë²„ê¹…ì„ ìœ„í•œ DevTools ì»´í¬ë„ŒíŠ¸
11 |  * ë·°í¬íŠ¸ ë¡œê±°, ë…¸ë“œ ì¸ìŠ¤í™í„°, ë³€ê²½ ë¡œê±°ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
12 |  */
13 | export default function DevTools() {
14 |   const [showViewport, setShowViewport] = useState(false);
15 |   const [showNodeInspector, setShowNodeInspector] = useState(false);
16 |   const [showChangeLogger, setShowChangeLogger] = useState(false);
17 | 
18 |   return (
19 |     <Panel 
20 |       position="top-left" 
21 |       className="bg-card shadow p-3 rounded-md z-50"
22 |     >
23 |       <div className="flex flex-col gap-2">
24 |         <div className="flex gap-2 justify-center items-center">
25 |           <button
26 |             onClick={() => setShowViewport(!showViewport)}
27 |             className={`px-2 py-1 text-xs rounded ${
28 |               showViewport ? 'bg-blue-500 text-white' : 'bg-gray-200'
29 |             }`}
30 |           >
31 |             ë·°í¬íŠ¸ ë¡œê±° {showViewport ? 'ìˆ¨ê¸°ê¸°' : 'ë³´ê¸°'}
32 |           </button>
33 |           <button
34 |             onClick={() => setShowNodeInspector(!showNodeInspector)}
35 |             className={`px-2 py-1 text-xs rounded ${
36 |               showNodeInspector ? 'bg-blue-500 text-white' : 'bg-gray-200'
37 |             }`}
38 |           >
39 |             ë…¸ë“œ ì¸ìŠ¤í™í„° {showNodeInspector ? 'ìˆ¨ê¸°ê¸°' : 'ë³´ê¸°'}
40 |           </button>
41 |           <button
42 |             onClick={() => setShowChangeLogger(!showChangeLogger)}
43 |             className={`px-2 py-1 text-xs rounded ${
44 |               showChangeLogger ? 'bg-blue-500 text-white' : 'bg-gray-200'
45 |             }`}
46 |           >
47 |             ë³€ê²½ ë¡œê±° {showChangeLogger ? 'ìˆ¨ê¸°ê¸°' : 'ë³´ê¸°'}
48 |           </button>
49 |         </div>
50 |         
51 |         {showViewport && <ViewportLogger />}
52 |         {showNodeInspector && <NodeInspector />}
53 |         {showChangeLogger && <ChangeLogger />}
54 |       </div>
55 |     </Panel>
56 |   );
57 | }
58 | 
59 | // ë…¸ë“œì™€ ì—£ì§€ ë³€ê²½ ê°ì§€ë¥¼ ìœ„í•œ í›… ìµìŠ¤í¬íŠ¸
60 | export const useChangeLoggerHooks = (): ChangeLoggerHandlers => {
61 |   const [, , handlers] = useChangeLogger();
62 |   return handlers;
63 | } 
```

src/components/debug/InitDatabase.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: InitDatabase.tsx
3 |  * ëª©ì : ê°œë°œ í™˜ê²½ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
4 |  * ì—­í• : ê°œë°œ í™˜ê²½ì—ì„œë§Œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-30
6 |  */
7 | 
8 | 'use client';
9 | 
10 | import { useEffect } from 'react';
11 | 
12 | /**
13 |  * InitDatabase: ê°œë°œ í™˜ê²½ì—ì„œë§Œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
14 |  * @returns null - UIë¥¼ ë Œë”ë§í•˜ì§€ ì•ŠìŒ
15 |  */
16 | export default function InitDatabase() {
17 |   useEffect(() => {
18 |     const initDatabase = async () => {
19 |       if (process.env.NEXT_PUBLIC_ENABLE_DB_INIT !== 'true') {
20 |         return;
21 |       }
22 | 
23 |       try {
24 |         const response = await fetch('/api/db-init');
25 |         if (!response.ok) {
26 |           throw new Error('Failed to initialize database');
27 |         }
28 |         console.log('Database initialized successfully');
29 |       } catch (error) {
30 |         console.error('Error initializing database:', error);
31 |       }
32 |     };
33 | 
34 |     initDatabase();
35 |   }, []);
36 | 
37 |   return null;
38 | } 
```

src/components/debug/ViewportLogger.tsx
```
1 | import { useStore } from '@xyflow/react';
2 | import { shallow } from 'zustand/shallow';
3 | 
4 | /**
5 |  * ViewportLogger ì»´í¬ë„ŒíŠ¸ëŠ” í˜„ì¬ React Flow ë·°í¬íŠ¸ì˜ ìƒíƒœë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
6 |  * x, y ìœ„ì¹˜ì™€ ì¤Œ ë ˆë²¨ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
7 |  */
8 | const selector = (state: { transform?: [number, number, number] }) => ({
9 |   x: state.transform?.[0] || 0,
10 |   y: state.transform?.[1] || 0,
11 |   zoom: state.transform?.[2] || 1,
12 | });
13 | 
14 | export function ViewportLogger() {
15 |   const { x, y, zoom } = useStore(selector, shallow);
16 | 
17 |   return (
18 |     <div className="bg-muted p-2 rounded border text-xs mt-2">
19 |       <h3 className="font-bold mb-1 border-b pb-1">ë·°í¬íŠ¸ ë¡œê±°</h3>
20 |       <div>
21 |         <span>x: {x.toFixed(2)}</span>, <span>y: {y.toFixed(2)}</span>, <span>zoom: {zoom.toFixed(2)}</span>
22 |       </div>
23 |     </div>
24 |   );
25 | } 
```

src/components/ideamap/DagreNodePositioning.test.tsx
```
1 | import React from 'react';
2 | 
3 | import { render } from '@testing-library/react';
4 | import { ReactFlowProvider } from '@xyflow/react';
5 | import { Edge } from '@xyflow/react';
6 | import { vi } from 'vitest';
7 | 
8 | import DagreNodePositioning from './DagreNodePositioning';
9 | 
10 | 
11 | // ë‹¨ìˆœ ë Œë”ë§ í…ŒìŠ¤íŠ¸
12 | describe('DagreNodePositioning', () => {
13 |   it('ì»´í¬ë„ŒíŠ¸ê°€ ì˜¤ë¥˜ ì—†ì´ ë Œë”ë§ë˜ì–´ì•¼ í•©ë‹ˆë‹¤', () => {
14 |     const dummyOptions = { rankdir: 'TB' as const };
15 |     const dummySetNodes = vi.fn();
16 |     const dummySetEdges = vi.fn();
17 |     const dummySetViewIsFit = vi.fn();
18 |     const dummyEdges: Edge[] = [];
19 |     
20 |     render(
21 |       <ReactFlowProvider>
22 |         <DagreNodePositioning
23 |           Options={dummyOptions}
24 |           Edges={dummyEdges}
25 |           SetEdges={dummySetEdges}
26 |           SetNodes={dummySetNodes}
27 |           SetViewIsFit={dummySetViewIsFit}
28 |         />
29 |       </ReactFlowProvider>
30 |     );
31 |   });
32 | }); 
```

src/components/ideamap/DagreNodePositioning.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/ideamap/DagreNodePositioning.tsx
3 |  * ëª©ì : Dagre ë ˆì´ì•„ì›ƒ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬ ë…¸ë“œ ìœ„ì¹˜ë¥¼ ìë™ìœ¼ë¡œ ê³„ì‚°
4 |  * ì—­í• : Idea Mapì˜ ë…¸ë“œ ìë™ ë°°ì¹˜ ë° ë ˆì´ì•„ì›ƒ ì ìš© ì»´í¬ë„ŒíŠ¸
5 |  * ì‘ì„±ì¼: 2023-04-10
6 |  * ìˆ˜ì •ì¼: 2024-05-30 : prefer-const ë¦°íŠ¸ ê·œì¹™ ì ìš©
7 |  * ìˆ˜ì •ì¼: 2025-05-07 : ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±° (nodesPositioned)
8 |  */
9 | 
10 | import React, { useEffect } from 'react';
11 | 
12 | import { useReactFlow, Node, Edge, Position } from '@xyflow/react';
13 | import dagre from 'dagre';
14 | 
15 | import defaultConfig from '../../config/uiOptions.json';
16 | 
17 | interface DagreNodePositioningProps {
18 |   Options: { rankdir: 'TB' | 'LR' | 'BT' | 'RL' };
19 |   Edges: Edge[];
20 |   SetEdges: (edges: Edge[]) => void;
21 |   SetNodes: (nodes: Node[]) => void;
22 |   SetViewIsFit: (value: boolean) => void;
23 | }
24 | 
25 | // ê¸°ë³¸ CardNodeì˜ í¬ê¸° - ì„¤ì • íŒŒì¼ì—ì„œ ì¼ê´€ë˜ê²Œ ê°€ì ¸ì˜¤ê¸°
26 | const nodeWidth = defaultConfig.layout.nodeSize?.width || 130;
27 | const nodeHeight = defaultConfig.layout.nodeSize?.height || 48;
28 | 
29 | const DagreNodePositioning: React.FC<DagreNodePositioningProps> = ({ Options, Edges, SetEdges, SetNodes, SetViewIsFit }) => {
30 |   const { fitView, getNodes } = useReactFlow();
31 | 
32 |   // React Flow ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ë…¸ë“œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°
33 |   const flattenedNodes = getNodes();
34 | 
35 |   useEffect(() => {
36 |     // ë…¸ë“œê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
37 |     if (flattenedNodes.length > 0) {
38 |       const dagreGraph = new dagre.graphlib.Graph();
39 |       dagreGraph.setDefaultEdgeLabel(() => ({}));
40 |       dagreGraph.setGraph(Options);
41 | 
42 |       // ëª¨ë“  ë…¸ë“œë¥¼ dagre ê·¸ë˜í”„ì— ë“±ë¡ (ê¸°ë³¸ê°’ ì‚¬ìš©)
43 |       flattenedNodes.forEach((node) => {
44 |         // ì‹¤ì œ ì¸¡ì •ëœ í¬ê¸°ê°€ ì—†ìœ¼ë¯€ë¡œ ê¸°ë³¸ê°’ ì‚¬ìš©
45 |         dagreGraph.setNode(node.id, { width: nodeWidth, height: nodeHeight });
46 |       });
47 | 
48 |       // ì—£ì§€ ë“±ë¡
49 |       Edges.forEach((edge) => {
50 |         dagreGraph.setEdge(edge.source, edge.target);
51 |       });
52 | 
53 |       // ë ˆì´ì•„ì›ƒ ê³„ì‚°
54 |       dagre.layout(dagreGraph);
55 | 
56 |       // ê° ë…¸ë“œì˜ ìœ„ì¹˜ë¥¼ ì—…ë°ì´íŠ¸
57 |       const layoutedNodes = flattenedNodes.map((node) => {
58 |         const nodeWithPosition = dagreGraph.node(node.id);
59 |         if (!nodeWithPosition) {
60 |           return node;
61 |         }
62 | 
63 |         const updatedNode = {
64 |           ...node,
65 |           position: {
66 |             x: nodeWithPosition.x - nodeWidth / 2,
67 |             y: nodeWithPosition.y - nodeHeight / 2
68 |           },
[TRUNCATED]
```

src/components/ideamap/DebugPanel.tsx
```
1 | import React, { useState, useEffect } from 'react';
2 | 
3 | import { useReactFlow, NodeChange, EdgeChange } from '@xyflow/react';
4 | 
5 | interface DebugPanelProps {
6 |   nodeChanges?: NodeChange[];
7 |   edgeChanges?: EdgeChange[];
8 | }
9 | 
10 | const DebugPanel: React.FC<DebugPanelProps> = ({ nodeChanges, edgeChanges }) => {
11 |   const [isOpen, setIsOpen] = useState(false);
12 |   const { getViewport, getNodes } = useReactFlow();
13 |   const [viewport, setViewport] = useState({ x: 0, y: 0, zoom: 1 });
14 |   const [selectedNodeId, setSelectedNodeId] = useState<string | null>(null);
15 |   const [logs, setLogs] = useState<Array<{ time: string; message: string }>>([]);
16 | 
17 |   // ë·°í¬íŠ¸ ì—…ë°ì´íŠ¸
18 |   useEffect(() => {
19 |     const interval = setInterval(() => {
20 |       const currentViewport = getViewport();
21 |       setViewport(currentViewport);
22 |     }, 100);
23 | 
24 |     return () => clearInterval(interval);
25 |   }, [getViewport]);
26 | 
27 |   // ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
28 |   const addLog = (message: string) => {
29 |     const time = new Date().toLocaleTimeString();
30 |     setLogs(prev => [...prev.slice(-9), { time, message }]);
31 |   };
32 | 
33 |   // ë…¸ë“œ ë³€ê²½ ì‹œ ë¡œê·¸ ì¶”ê°€
34 |   useEffect(() => {
35 |     if (nodeChanges && nodeChanges.length > 0) {
36 |       const message = `ë…¸ë“œ ë³€ê²½: ${nodeChanges.map(c => `${c.type} ${c.id}`).join(', ')}`;
37 |       addLog(message);
38 |     }
39 |   }, [nodeChanges]);
40 | 
41 |   // ì—£ì§€ ë³€ê²½ ì‹œ ë¡œê·¸ ì¶”ê°€
42 |   useEffect(() => {
43 |     if (edgeChanges && edgeChanges.length > 0) {
44 |       const message = `ì—£ì§€ ë³€ê²½: ${edgeChanges.map(c => `${c.type} ${c.id}`).join(', ')}`;
45 |       addLog(message);
46 |     }
47 |   }, [edgeChanges]);
48 | 
49 |   // ì„ íƒëœ ë…¸ë“œ ì •ë³´
50 |   const selectedNode = selectedNodeId 
51 |     ? getNodes().find(node => node.id === selectedNodeId) 
52 |     : null;
53 | 
54 |   return (
55 |     <div className="fixed left-2 top-16 z-50">
56 |       <button 
57 |         onClick={() => setIsOpen(!isOpen)}
58 |         className="mb-2 px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"
59 |       >
60 |         {isOpen ? 'ë””ë²„ê·¸ íŒ¨ë„ ë‹«ê¸°' : 'ë””ë²„ê·¸ íŒ¨ë„ ì—´ê¸°'}
61 |       </button>
62 |       
63 |       {isOpen && (
[TRUNCATED]
```

src/components/ideamap/LayoutControls.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/ideamap/LayoutControls.tsx
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ ë ˆì´ì•„ì›ƒ ì œì–´ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ë ˆì´ì•„ì›ƒ ë°©í–¥ ë³€ê²½, ìë™ ë°°ì¹˜, ë ˆì´ì•„ì›ƒ ì €ì¥ ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-07
6 |  * ìˆ˜ì •ì¼: 2024-05-07 : ë¯¸ì‚¬ìš© import(toast) ì œê±°
7 |  */
8 | 
9 | import React from 'react';
10 | 
11 | import { Layout, LayoutGrid, AlignHorizontalJustifyCenter, AlignVerticalJustifyCenter } from 'lucide-react';
12 | 
13 | import { Button } from '@/components/ui/button';
14 | import {
15 |   DropdownMenu,
16 |   DropdownMenuContent,
17 |   DropdownMenuItem,
18 |   DropdownMenuLabel,
19 |   DropdownMenuSeparator,
20 |   DropdownMenuTrigger,
21 | } from '@/components/ui/dropdown-menu';
22 | 
23 | interface LayoutControlsProps {
24 |   onLayoutChange: (direction: 'horizontal' | 'vertical') => void;
25 |   onAutoLayout: () => void;
26 |   onSaveLayout: () => void;
27 | }
28 | 
29 | export default function LayoutControls({
30 |   onLayoutChange,
31 |   onAutoLayout,
32 |   onSaveLayout
33 | }: LayoutControlsProps) {
34 |   return (
35 |     <DropdownMenu>
36 |       <DropdownMenuTrigger asChild>
37 |         <Button variant="outline" size="icon">
38 |           <Layout className="h-4 w-4" />
39 |         </Button>
40 |       </DropdownMenuTrigger>
41 |       <DropdownMenuContent align="end" className="w-56">
42 |         <DropdownMenuLabel>ë ˆì´ì•„ì›ƒ ì˜µì…˜</DropdownMenuLabel>
43 |         <DropdownMenuSeparator />
44 |         <DropdownMenuItem
45 |           onClick={() => onLayoutChange('horizontal')}
46 |           className="flex items-center cursor-pointer"
47 |         >
48 |           <AlignHorizontalJustifyCenter className="mr-2 h-4 w-4" />
49 |           <span>ìˆ˜í‰ ë ˆì´ì•„ì›ƒ</span>
50 |         </DropdownMenuItem>
51 |         <DropdownMenuItem
52 |           onClick={() => onLayoutChange('vertical')}
53 |           className="flex items-center cursor-pointer"
54 |         >
55 |           <AlignVerticalJustifyCenter className="mr-2 h-4 w-4" />
56 |           <span>ìˆ˜ì§ ë ˆì´ì•„ì›ƒ</span>
57 |         </DropdownMenuItem>
58 |         <DropdownMenuSeparator />
59 |         <DropdownMenuItem
60 |           onClick={onAutoLayout}
61 |           className="flex items-center cursor-pointer"
62 |         >
63 |           <LayoutGrid className="mr-2 h-4 w-4" />
64 |           <span>ìë™ ë°°ì¹˜</span>
65 |         </DropdownMenuItem>
66 |         <DropdownMenuItem
67 |           onClick={onSaveLayout}
68 |           className="flex items-center cursor-pointer"
69 |         >
70 |           <svg className="mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
[TRUNCATED]
```

src/components/login/loginForm.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/login/loginForm.tsx
3 |  * ëª©ì : ì‚¬ìš©ì ë¡œê·¸ì¸ UI ì»´í¬ë„ŒíŠ¸ ì œê³µ
4 |  * ì—­í• : ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ ë° Google ì†Œì…œ ë¡œê·¸ì¸ í¼ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-06-28
6 |  * ìˆ˜ì •ì¼: 2024-05-30 : ì„œë²„ ì•¡ì…˜ ë° ìƒíƒœ ê´€ë¦¬ ì—°ë™ ì¶”ê°€
7 |  * ìˆ˜ì •ì¼: 2025-04-24 : ì•¡ì…˜ í•¨ìˆ˜ëª… ì—…ë°ì´íŠ¸ ë° Supabase ì§ì ‘ ì—°ë™
8 |  * ìˆ˜ì •ì¼: 2025-04-24 : êµ¬ê¸€ ë¡œê·¸ì¸ í•¸ë“¤ëŸ¬ ìˆ˜ì • - í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë¦¬ë‹¤ì´ë ‰ì…˜ ì²˜ë¦¬
9 |  * ìˆ˜ì •ì¼: 2025-04-24 : AuthContext ì œê±° ë° ìƒíƒœ ê´€ë¦¬ ë‹¨ìˆœí™”
10 |  */
11 | 
12 | "use client"
13 | 
14 | import React, { useState, useEffect } from 'react'
15 | 
16 | import Link from "next/link"
17 | import { useRouter } from "next/navigation"
18 | import { useSearchParams } from 'next/navigation' // ì—ëŸ¬/ë©”ì‹œì§€ í‘œì‹œ ìœ„í•´ ì¶”ê°€
19 | 
20 | import { ArrowRight, Mail, Lock } from "lucide-react"
21 | 
22 | import { loginAction, googleSignInAction } from '@/app/login/actions' // ì„œë²„ ì•¡ì…˜ import
23 | import { Button } from "@/components/ui/button"
24 | import { Card, CardContent, CardFooter, CardHeader, CardTitle } from "@/components/ui/card"
25 | import { Input } from "@/components/ui/input"
26 | import { Label } from "@/components/ui/label"
27 | import { Separator } from "@/components/ui/separator"
28 | 
29 | export default function LoginForm() {
30 |     const router = useRouter();
31 |     const [email, setEmail] = useState('');
32 |     const [password, setPassword] = useState('');
33 |     const [isEmailPending, setIsEmailPending] = useState(false); // ì´ë©”ì¼ ë¡œê·¸ì¸ ë¡œë”©
34 |     const [isGooglePending, setIsGooglePending] = useState(false); // Google ë¡œê·¸ì¸ ë¡œë”©
35 |     const searchParams = useSearchParams();
36 |     const [error, setError] = useState<string | null>(null);
37 |     const [message, setMessage] = useState<string | null>(null);
38 | 
39 |     useEffect(() => {
40 |         const errorParam = searchParams.get('error');
41 |         const messageParam = searchParams.get('message');
42 |         if (errorParam) setError(decodeURIComponent(errorParam));
43 |         if (messageParam) setMessage(decodeURIComponent(messageParam));
44 |     }, [searchParams]);
45 | 
46 |     const handleEmailLogin = async (event: React.FormEvent<HTMLFormElement> | React.MouseEvent<HTMLButtonElement>) => {
47 |         event.preventDefault();
48 |         setError(null);
49 |         setMessage(null);
50 |         setIsEmailPending(true);
51 |         const formData = new FormData();
52 |         formData.append('email', email);
53 |         formData.append('password', password);
54 |         try {
55 |             // ì„œë²„ ì•¡ì…˜ ì§ì ‘ í˜¸ì¶œ - ì„±ê³µì‹œ ìë™ ë¦¬ë‹¤ì´ë ‰ì…˜ë¨
56 |             await loginAction(formData);
[TRUNCATED]
```

src/components/layout/ClientLayout.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/layout/ClientLayout.test.tsx
3 |  * ëª©ì : ClientLayout ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ClientLayout ë Œë”ë§ ë° ë™ì‘ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-29
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : ThemeContext ëª¨í‚¹ ì œê±° ë° useAppStore ëª¨í‚¹ ì¶”ê°€
7 |  */
8 | 
9 | import { render, screen, waitFor } from '@testing-library/react';
10 | import { describe, expect, it, vi, beforeEach } from 'vitest';
11 | import { ReactNode } from 'react';
12 | import { ClientLayout } from './ClientLayout';
13 | import { useRouter } from 'next/navigation';
14 | 
15 | // ë¼ìš°í„° ëª¨í‚¹
16 | const mockPush = vi.fn();
17 | vi.mock('next/navigation', () => ({
18 |     useRouter: vi.fn().mockImplementation(() => ({
19 |         push: mockPush,
20 |         refresh: vi.fn(),
21 |         back: vi.fn(),
22 |         forward: vi.fn(),
23 |         prefetch: vi.fn(),
24 |     })),
25 |     usePathname: vi.fn().mockReturnValue('/'),
26 | }));
27 | 
28 | // Sonner í† ìŠ¤í„° ëª¨í‚¹
29 | vi.mock('sonner', () => ({
30 |     Toaster: () => <div data-testid="mock-toaster">Mock Toaster</div>,
31 | }));
32 | 
33 | // í°íŠ¸ ëª¨í‚¹
34 | vi.mock('next/font/google', () => ({
35 |     Montserrat: vi.fn().mockReturnValue({
36 |         className: 'mock-montserrat-class',
37 |         style: { fontFamily: 'Montserrat' },
38 |     }),
39 | }));
40 | 
41 | // useAppStore ëª¨í‚¹
42 | vi.mock('@/store/useAppStore', () => ({
43 |     useAppStore: vi.fn().mockImplementation(() => ({
44 |         themeMode: 'dark',
45 |         sidebarOpen: false,
46 |         toggleSidebar: vi.fn(),
47 |         closeSidebar: vi.fn(),
48 |         theme: {
49 |             layout: {
50 |                 padding: 25,
51 |                 spacing: {
52 |                     horizontal: 40,
53 |                     vertical: 30,
54 |                 }
55 |             },
56 |             node: {
57 |                 width: 150,
58 |                 height: 60,
59 |             }
60 |         }
61 |     })),
62 | }));
63 | 
64 | // Dropdown ëª¨í‚¹
65 | vi.mock('@/components/ui/dropdown-menu', () => ({
66 |     DropdownMenu: ({ children }: { children: ReactNode }) => <div data-testid="dropdown-menu">{children}</div>,
67 |     DropdownMenuContent: ({ children }: { children: ReactNode }) => <div data-testid="dropdown-menu-content">{children}</div>,
68 |     DropdownMenuGroup: ({ children }: { children: ReactNode }) => <div data-testid="dropdown-menu-group">{children}</div>,
69 |     DropdownMenuItem: ({ children }: { children: ReactNode }) => <div data-testid="dropdown-menu-item">{children}</div>,
[TRUNCATED]
```

src/components/layout/ClientLayout.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: ClientLayout.tsx
3 |  * ëª©ì : í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë ˆì´ì•„ì›ƒê³¼ ì „ì—­ ìƒíƒœ ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì¸ì¦ ìƒíƒœ, í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ë“± í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ë˜í•‘
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-09
7 |  * ìˆ˜ì •ì¼: 2024-05-13 : AuthProvider ì œê±°í•˜ê³  useAuth í›… ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
8 |  * ìˆ˜ì •ì¼: 2025-04-21 : ThemeProvider ì œê±°í•˜ê³  useAppStoreì˜ themeSlice ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
9 |  */
10 | 
11 | 'use client';
12 | 
13 | import { ReactNode, useEffect } from 'react';
14 | 
15 | import { Toaster } from "sonner";
16 | 
17 | import InitDatabase from "@/components/debug/InitDatabase";
18 | import { useAuth } from '@/hooks/useAuth';
19 | import createLogger from '@/lib/logger';
20 | import { useAuthStore, selectUserId } from '@/store/useAuthStore';
21 | 
22 | // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” (í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ì‹¤í–‰)
23 | // import { createClient } from "@/lib/supabase/client";
24 | 
25 | // ëª¨ë“ˆë³„ ë¡œê±° ìƒì„±
26 | const logger = createLogger('ClientLayout');
27 | 
28 | /**
29 |  * ClientLayout: í´ë¼ì´ì–¸íŠ¸ ì „ìš© ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
30 |  * @param children - ìì‹ ì»´í¬ë„ŒíŠ¸
31 |  * @returns í´ë¼ì´ì–¸íŠ¸ ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
32 |  */
33 | export function ClientLayout({ children }: { children: ReactNode }) {
34 |   // Supabase ì¸ì¦ ìƒíƒœ ë³€ê²½ êµ¬ë…
35 |   const { user, isLoading, error } = useAuth();
36 | 
37 |   // Zustand ìŠ¤í† ì–´ì—ì„œ userId ê°€ì ¸ì˜¤ê¸° (ë””ë²„ê¹…ìš©)
38 |   const userId = useAuthStore(selectUserId);
39 | 
40 |   useEffect(() => {
41 |     logger.info('í´ë¼ì´ì–¸íŠ¸ ë ˆì´ì•„ì›ƒ ë§ˆìš´íŠ¸');
42 | 
43 |     // ë¸Œë¼ìš°ì € í™˜ê²½ í™•ì¸ ë¡œê¹…
44 |     if (typeof window !== 'undefined') {
45 |       logger.info('ë¸Œë¼ìš°ì € í™˜ê²½ í™•ì¸');
46 |       // localStorage ì ‘ê·¼ ì—¬ë¶€ ì²´í¬ (í”„ë¼ì´ë¹— ë¸Œë¼ìš°ì§•ì—ì„œ ì˜ˆì™¸ ë°œìƒ ê°€ëŠ¥)
47 |       try {
48 |         localStorage.setItem('client_layout_test', 'test');
49 |         localStorage.removeItem('client_layout_test');
50 |         logger.info('localStorage ì ‘ê·¼ ê°€ëŠ¥');
51 |       } catch (error) {
52 |         logger.warn('localStorage ì ‘ê·¼ ë¶ˆê°€', error);
53 |       }
54 |     }
55 | 
56 |     // ê°œë°œ í™˜ê²½ì—ì„œ ì¸ì¦ ìƒíƒœ ì½˜ì†” ì¶œë ¥ (ë””ë²„ê¹…ìš©)
57 |     if (process.env.NODE_ENV === 'development') {
58 |       logger.debug('ì¸ì¦ ìƒíƒœ:', { userId, isLoading, error: error?.message });
59 |     }
60 | 
61 |     return () => {
62 |       logger.info('í´ë¼ì´ì–¸íŠ¸ ë ˆì´ì•„ì›ƒ ì–¸ë§ˆìš´íŠ¸');
63 |     };
64 |   }, [userId, isLoading, error]);
65 | 
66 |   return (
67 |     <main>
68 |       {children}
69 | 
70 |       {/* DB ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ */}
71 |       <InitDatabase />
72 |       <Toaster position="top-center" />
[TRUNCATED]
```

src/components/layout/DashboardLayout.tsx
```
1 | 'use client';
2 | 
3 | import { useEffect } from 'react';
4 | 
5 | import { ReactFlowProvider } from '@xyflow/react';
6 | 
7 | import { useAppStore } from '@/store/useAppStore';
8 | 
9 | import { MainCanvas } from './MainCanvas';
10 | import { MainToolbar } from './MainToolbar';
11 | import { ProjectToolbar } from './ProjectToolbar';
12 | import { ShortcutToolbar } from './ShortcutToolbar';
13 | import { Sidebar } from './Sidebar';
14 | // React Flow ìŠ¤íƒ€ì¼ì€ MainCanvasì—ì„œ import í•©ë‹ˆë‹¤
15 | 
16 | export function DashboardLayout() {
17 |   const { isSidebarOpen } = useAppStore();
18 | 
19 |   // í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œë§Œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
20 |   useEffect(() => {
21 |     // ì—¬ê¸°ì— í•„ìš”í•œ ì´ˆê¸°í™” ì½”ë“œ ì¶”ê°€
22 |     console.log('DashboardLayout ë§ˆìš´íŠ¸ë¨');
23 |     
24 |     return () => {
25 |       console.log('DashboardLayout ì–¸ë§ˆìš´íŠ¸ë¨');
26 |     };
27 |   }, []);
28 | 
29 |   return (
30 |     <div className="flex h-screen overflow-hidden bg-background">
31 |       {/* í”„ë¡œì íŠ¸ íˆ´ë°” (ì¢Œì¸¡ ìƒë‹¨) */}
32 |       <ProjectToolbar />
33 |       
34 |       {/* ë‹¨ì¶•í‚¤ íˆ´ë°” (ìš°ì¸¡ ìƒë‹¨) */}
35 |       <ShortcutToolbar />
36 |       
37 |       {/* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */}
38 |       <div className="flex flex-1 relative">
39 |         {/* ë©”ì¸ ìº”ë²„ìŠ¤ */}
40 |         <div className={`flex-1 h-full transition-all duration-300 ${isSidebarOpen ? 'mr-80' : ''}`}>
41 |           <ReactFlowProvider>
42 |             <MainCanvas />
43 |           </ReactFlowProvider>
44 |         </div>
45 |         
46 |         {/* ì‚¬ì´ë“œë°” */}
47 |         <Sidebar />
48 |       </div>
49 |       
50 |       {/* ë©”ì¸ íˆ´ë°” (í•˜ë‹¨ ì„¼í„°) */}
51 |       <MainToolbar />
52 |     </div>
53 |   );
54 | } 
```

src/components/layout/MainCanvas.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: MainCanvas.test.tsx
3 |  * ëª©ì : MainCanvas ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : MainCanvasê°€ ì ì ˆí•˜ê²Œ ë Œë”ë§ë˜ê³  IdeaMap ì»´í¬ë„ŒíŠ¸ì— ì˜¬ë°”ë¥¸ propsë¥¼ ì „ë‹¬í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  */
7 | 
8 | import { render, screen } from '@testing-library/react';
9 | import { vi } from 'vitest';
10 | 
11 | import { MainCanvas } from './MainCanvas';
12 | 
13 | // ì¢…ì†ì„± ëª¨í‚¹
14 | vi.mock('@/store/useAppStore', () => ({
15 |   useAppStore: () => ({
16 |     selectCard: vi.fn(),
17 |   }),
18 | }));
19 | 
20 | vi.mock('@xyflow/react', () => ({
21 |   ReactFlowProvider: ({ children }: { children: React.ReactNode }) => (
22 |     <div data-testid="react-flow-provider">{children}</div>
23 |   ),
24 | }));
25 | 
26 | vi.mock('@/components/ideamap/components/IdeaMap', () => ({
27 |   default: ({ onSelectCard, className, showControls }: any) => (
28 |     <div
29 |       data-testid="ideamap-component"
30 |       data-selectcard={!!onSelectCard}
31 |       data-classname={className}
32 |       data-showcontrols={showControls}
33 |     >
34 |       IdeaMap Component
35 |     </div>
36 |   ),
37 | }));
38 | 
39 | describe('MainCanvas', () => {
40 |   it('renders ReactFlowProvider and IdeaMap component with correct props', () => {
41 |     render(<MainCanvas />);
42 | 
43 |     // ReactFlowProviderê°€ ë Œë”ë§ë˜ì—ˆëŠ”ì§€ í™•ì¸
44 |     expect(screen.getByTestId('react-flow-provider')).toBeInTheDocument();
45 | 
46 |     // IdeaMap ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ë˜ì—ˆëŠ”ì§€ í™•ì¸
47 |     const ideaMapComponent = screen.getByTestId('ideamap-component');
48 |     expect(ideaMapComponent).toBeInTheDocument();
49 | 
50 |     // IdeaMap ì»´í¬ë„ŒíŠ¸ì— ì˜¬ë°”ë¥¸ propsê°€ ì „ë‹¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
51 |     expect(ideaMapComponent.getAttribute('data-selectcard')).toBe('true');
52 |     expect(ideaMapComponent.getAttribute('data-classname')).toBe('bg-background');
53 |     expect(ideaMapComponent.getAttribute('data-showcontrols')).toBe('true');
54 |   });
55 | }); 
```

src/components/layout/MainCanvas.tsx
```
1 | 'use client';
2 | 
3 | import { ReactFlowProvider } from '@xyflow/react';
4 | import { Loader2 } from 'lucide-react';
5 | 
6 | import Board from '@/components/ideamap/components/IdeaMap';
7 | import { useAppStore } from '@/store/useAppStore';
8 | 
9 | // ì™¸ë¶€ ë‚´ë³´ë‚´ê¸° ì»´í¬ë„ŒíŠ¸
10 | export function MainCanvas() {
11 |   const { selectCard } = useAppStore();
12 | 
13 |   return (
14 |     <ReactFlowProvider>
15 |       <div className="w-full h-full pt-14">
16 |         <Board
17 |           onSelectCard={selectCard}
18 |           className="bg-background"
19 |           showControls={true}
20 |         />
21 |       </div>
22 |     </ReactFlowProvider>
23 |   );
24 | } 
```

src/components/layout/MainToolbar.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: MainToolbar.test.tsx
3 |  * ëª©ì : MainToolbar ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ë ˆì´ì•„ì›ƒ ì»¨íŠ¸ë¡¤ëŸ¬ ì»´í¬ë„ŒíŠ¸ ìœ ë‹› í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-08
7 |  * ìˆ˜ì •ì¼: 2025-04-10 : Zustand store ëª¨í‚¹ ë°©ì‹ ë¦¬íŒ©í† ë§ì— ë§ê²Œ ìˆ˜ì •
8 |  */
9 | 
10 | import React from 'react';
11 | 
12 | import { render, screen, fireEvent } from '@testing-library/react';
13 | import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
14 | 
15 | import { MainToolbar } from './MainToolbar';
16 | 
17 | 
18 | // ëª¨í‚¹ëœ í•¨ìˆ˜ ì°¸ì¡°ë¥¼ í…ŒìŠ¤íŠ¸ ë‚´ì—ì„œ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ë³€ìˆ˜
19 | const mockApplyLayout = vi.fn();
20 | const mockSaveBoardLayout = vi.fn();
21 | 
22 | // useAppStore ëª¨í‚¹
23 | vi.mock('@/store/useAppStore', () => ({
24 |     useAppStore: (selector?: (state: any) => any) => {
25 |         const mockStoreValues = {
26 |             applyLayout: mockApplyLayout,
27 |             saveBoardLayout: mockSaveBoardLayout,
28 |             layoutDirection: 'auto'
29 |         };
30 | 
31 |         return selector ? selector(mockStoreValues) : mockStoreValues;
32 |     }
33 | }));
34 | 
35 | // CreateCardModal ëª¨í‚¹
36 | vi.mock('@/components/cards/CreateCardModal', () => ({
37 |     default: ({ customTrigger }: { customTrigger: React.ReactNode }) => (
38 |         <div data-testid="mock-create-card-modal">
39 |             {customTrigger}
40 |         </div>
41 |     )
42 | }));
43 | 
44 | // window.location.reload ëª¨í‚¹
45 | const mockReload = vi.fn();
46 | Object.defineProperty(window, 'location', {
47 |     value: { reload: mockReload },
48 |     writable: true
49 | });
50 | 
51 | describe('MainToolbar', () => {
52 |     beforeEach(() => {
53 |         // ê° í…ŒìŠ¤íŠ¸ ì „ ëª¨í‚¹ ì´ˆê¸°í™”
54 |         vi.clearAllMocks();
55 |         vi.useFakeTimers();
56 |     });
57 | 
58 |     afterEach(() => {
59 |         vi.useRealTimers();
60 |     });
61 | 
62 |     it('ìˆ˜í‰ ì •ë ¬ ë²„íŠ¼ í´ë¦­ ì‹œ applyLayoutì„ "horizontal" ì¸ìì™€ í•¨ê»˜ í˜¸ì¶œí•´ì•¼ í•¨', () => {
63 |         // ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
64 |         render(<MainToolbar />);
65 | 
66 |         // ìˆ˜í‰ ì •ë ¬ ë²„íŠ¼ ì°¾ê¸°
67 |         const horizontalButton = screen.getByTitle('ìˆ˜í‰ ì •ë ¬');
68 | 
69 |         // ë²„íŠ¼ í´ë¦­ (fireEvent ì‚¬ìš©)
70 |         fireEvent.click(horizontalButton);
71 | 
72 |         // applyLayoutì´ 'horizontal' ì¸ìì™€ í•¨ê»˜ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸
73 |         expect(mockApplyLayout).toHaveBeenCalledWith('horizontal');
74 |     });
75 | 
76 |     it('ìˆ˜ì§ ì •ë ¬ ë²„íŠ¼ í´ë¦­ ì‹œ applyLayoutì„ "vertical" ì¸ìì™€ í•¨ê»˜ í˜¸ì¶œí•´ì•¼ í•¨', () => {
77 |         // ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
78 |         render(<MainToolbar />);
[TRUNCATED]
```

src/components/layout/MainToolbar.tsx
```
1 | 'use client';
2 | 
3 | import {
4 |   AlignHorizontalJustifyCenter,
5 |   AlignVerticalJustifyCenter,
6 |   PlusCircle,
7 |   Save
8 | } from 'lucide-react';
9 | 
10 | import CreateCardModal from '@/components/cards/CreateCardModal';
11 | import { Button } from '@/components/ui/button';
12 | import { useAppStore } from '@/store/useAppStore';
13 | 
14 | export function MainToolbar() {
15 |   const {
16 |     applyLayout,
17 |     saveBoardLayout: saveIdeaMapLayout,
18 |     layoutDirection
19 |   } = useAppStore();
20 | 
21 |   return (
22 |     <div className="fixed bottom-3 left-1/2 transform -translate-x-1/2 flex items-center bg-background/80 backdrop-blur-sm rounded-lg shadow-md border p-1 px-2 z-10">
23 |       <CreateCardModal
24 |         customTrigger={
25 |           <Button
26 |             variant="ghost"
27 |             size="icon"
28 |             title="ìƒˆ ì¹´ë“œ ì¶”ê°€"
29 |             className="rounded-full h-[60px] w-[60px]"
30 |           >
31 |             <PlusCircle className="h-8 w-8" />
32 |             <span className="sr-only">ìƒˆ ì¹´ë“œ ì¶”ê°€</span>
33 |           </Button>
34 |         }
35 |       />
36 | 
37 |       <Button
38 |         variant="ghost"
39 |         size="icon"
40 |         title="ìˆ˜í‰ ì •ë ¬"
41 |         className="rounded-full h-[60px] w-[60px]"
42 |         onClick={() => applyLayout('horizontal')}
43 |       >
44 |         <AlignHorizontalJustifyCenter className="h-8 w-8" />
45 |         <span className="sr-only">ìˆ˜í‰ ì •ë ¬</span>
46 |       </Button>
47 | 
48 |       <Button
49 |         variant="ghost"
50 |         size="icon"
51 |         title="ìˆ˜ì§ ì •ë ¬"
52 |         className="rounded-full h-[60px] w-[60px]"
53 |         onClick={() => applyLayout('vertical')}
54 |       >
55 |         <AlignVerticalJustifyCenter className="h-8 w-8" />
56 |         <span className="sr-only">ìˆ˜ì§ ì •ë ¬</span>
57 |       </Button>
58 | 
59 |       <Button
60 |         variant="ghost"
61 |         size="icon"
62 |         title="ìë™ ë°°ì¹˜"
63 |         className="rounded-full h-[60px] w-[60px]"
64 |         onClick={() => applyLayout('auto')}
65 |       >
66 |         <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
67 |           <path d="M21 9L17 9M21 15H11M7 15H3M3 9L13 9M17 15L21 15M7 9H3" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
[TRUNCATED]
```

src/components/layout/ProjectToolbar.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: ProjectToolbar.test.tsx
3 |  * ëª©ì : ProjectToolbar ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : í”„ë¡œì íŠ¸ ì„¤ì • ë° ì»¨íŠ¸ë¡¤ ê¸°ëŠ¥ì„ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-10 : global-env-mocking.mdc ë£° ì ìš©í•˜ì—¬ console ëª¨í‚¹ ë°©ì‹ ê°œì„ 
7 |  * ìˆ˜ì •ì¼: 2025-04-12 : Zustand ì•¡ì…˜ ê¸°ë°˜ ë¦¬íŒ©í† ë§ì— ë§ê²Œ í…ŒìŠ¤íŠ¸ ìˆ˜ì •
8 |  * ìˆ˜ì •ì¼: 2025-04-15 : React Flow ëª¨í‚¹ ì¶”ê°€ ë° í…ŒìŠ¤íŠ¸ ì•ˆì •ì„± ê°œì„ 
9 |  * ìˆ˜ì •ì¼: 2025-04-15 : navigator.clipboard ëª¨í‚¹ ë° íƒ€ì„ì•„ì›ƒ ì„¤ì • ì¶”ê°€
10 |  * ìˆ˜ì •ì¼: 2025-04-17 : import ìˆœì„œ ì •ë ¬ (ë¦°íŠ¸ ì˜¤ë¥˜ ìˆ˜ì •)
11 |  */
12 | 
13 | // ë¨¼ì € React ë° í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
14 | import React from 'react';
15 | 
16 | import { render, screen, cleanup } from '@testing-library/react';
17 | import { ConnectionLineType, MarkerType } from '@xyflow/react';
18 | import { describe, it, expect, beforeEach, afterEach, beforeAll, afterAll, vi } from 'vitest';
19 | 
20 | import '@testing-library/jest-dom';
21 | 
22 | // ë‚´ë¶€ ëª¨ë“ˆ ë° Utilities
23 | import { useAppStore } from '@/store/useAppStore';
24 | import { server } from '@/tests/msw/server';
25 | import { mockReactFlow } from '@/tests/utils/react-flow-mock';
26 | 
27 | // ProjectToolbar ì»´í¬ë„ŒíŠ¸ ì„í¬íŠ¸
28 | import { ProjectToolbar } from './ProjectToolbar';
29 | 
30 | // React Flow ëª¨í‚¹ ë¨¼ì € í˜¸ì¶œ
31 | mockReactFlow();
32 | 
33 | // console.log ëª¨í‚¹ (vi.stubGlobal ì‚¬ìš©)
34 | // ì›ë˜ì˜ console ê°ì²´ ì €ì¥í•˜ì§€ ì•Šì•„ë„ ë¨ (vi.unstubAllGlobalsë¡œ ìë™ ë³µì›)
35 | // vi.stubGlobalì„ í†µí•´ í™˜ê²½ ìì²´ë¥¼ ëª¨í‚¹í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½
36 | const mockConsole = {
37 |     log: vi.fn(),
38 |     error: vi.fn(),
39 |     warn: vi.fn(),
40 |     info: vi.fn(),
41 |     debug: vi.fn()
42 | };
43 | // ëª¨ë“  console ë©”ì„œë“œ ìœ ì§€í•˜ë©´ì„œ logì™€ errorë§Œ ëª¨í‚¹
44 | vi.stubGlobal('console', {
45 |     ...console as Console,
46 |     log: mockConsole.log,
47 |     error: mockConsole.error
48 | });
49 | 
50 | // ë¸Œë¼ìš°ì € í™˜ê²½ ëª¨í‚¹ (window ê°ì²´)
51 | vi.stubGlobal('window', {
52 |     ...window,
53 |     localStorage: {
54 |         getItem: vi.fn(),
55 |         setItem: vi.fn(),
56 |         removeItem: vi.fn()
57 |     }
58 | });
59 | 
60 | // navigator.clipboard ëª¨í‚¹
61 | vi.stubGlobal('navigator', {
62 |     clipboard: {
63 |         writeText: vi.fn().mockResolvedValue(undefined),
64 |         readText: vi.fn().mockResolvedValue('')
65 |     }
66 | });
67 | 
[TRUNCATED]
```

src/components/layout/ProjectToolbar.tsx
```
1 | 'use client';
2 | 
3 | import React, { useCallback, useEffect } from 'react';
4 | 
5 | import { ConnectionLineType, MarkerType } from '@xyflow/react';
6 | import {
7 |   Menu,
8 |   // ChevronRight,
9 |   // Palette,
10 |   Grid3X3,
11 |   // ChevronsUpDown,
12 |   // AlignHorizontalJustifyCenter,
13 |   // AlignVerticalJustifyCenter,
14 |   // LayoutGrid,
15 |   Save,
16 |   Settings,
17 |   ArrowRightIcon,
18 |   Circle,
19 |   SeparatorHorizontal,
20 |   Paintbrush,
21 |   // Layout,
22 |   LogOut,
23 |   FileText,
24 |   FolderOpen
25 | } from 'lucide-react';
26 | import { toast } from 'sonner';
27 | 
28 | import { Button } from '@/components/ui/button';
29 | import {
30 |   DropdownMenu,
31 |   DropdownMenuContent,
32 |   DropdownMenuItem,
33 |   DropdownMenuTrigger,
34 |   DropdownMenuSub,
35 |   DropdownMenuSubTrigger,
36 |   DropdownMenuSubContent,
37 |   DropdownMenuPortal,
38 |   DropdownMenuSeparator,
39 |   DropdownMenuRadioGroup,
40 |   DropdownMenuRadioItem,
41 |   DropdownMenuCheckboxItem,
42 |   DropdownMenuLabel
43 | } from '@/components/ui/dropdown-menu';
44 | import { useUpdateIdeaMapSettingsMutation } from '@/hooks/useIdeaMapSettings';
45 | import {
46 |   SNAP_GRID_OPTIONS,
47 |   CONNECTION_TYPE_OPTIONS,
48 |   MARKER_TYPE_OPTIONS,
49 |   STROKE_WIDTH_OPTIONS,
50 |   MARKER_SIZE_OPTIONS,
51 |   EDGE_COLOR_OPTIONS,
52 |   EDGE_ANIMATION_OPTIONS
53 | } from '@/lib/ideamap-constants';
54 | // import {
55 | //   IDEAMAP_LAYOUT_STORAGE_KEY,
56 | //   IDEAMAP_EDGES_STORAGE_KEY,
57 | //   IDEAMAP_TRANSFORM_STORAGE_KEY
58 | // } from '@/lib/ideamap-constants';
59 | // import { IdeaMapSettings } from '@/lib/ideamap-utils';
60 | import createLogger from '@/lib/logger';
61 | import { useAppStore, selectActiveProject, Project } from '@/store/useAppStore';
62 | 
63 | // ëª¨ë“ˆë³„ ë¡œê±° ìƒì„±
64 | const logger = createLogger('ProjectToolbar');
65 | 
66 | export function ProjectToolbar() {
67 |   // useAppStoreì—ì„œ í”„ë¡œì íŠ¸ ì •ë³´ì™€ ì•¡ì…˜ì„ ê°€ì ¸ì˜´
68 |   const {
69 |     // layoutDirection,
70 |     // setLayoutDirection,
71 |     // rename board -> ideaMap
72 |     ideaMapSettings,
73 |     updateIdeaMapSettings,
74 |     saveIdeaMapLayout,
75 |     logoutAction,
76 |     projects,
77 |     // activeProjectId,
78 |     fetchProjects,
79 |     createProject,
80 |     // setActiveProject
81 |   } = useAppStore();
82 | 
83 |   // TanStack Query mutation í›… ì‚¬ìš©
84 |   const { mutate: updateSettings } = useUpdateIdeaMapSettingsMutation();
85 | 
86 |   // í™œì„± í”„ë¡œì íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
87 |   const activeProject = useAppStore(selectActiveProject);
88 | 
89 |   // í”„ë¡œì íŠ¸ ì´ë¦„ê³¼ ì‘ì„±ì ì •ë³´ í‘œì‹œ
90 |   const displayProjectName = activeProject
91 |     ? (activeProject.ownerNickname
92 |       ? `${activeProject.name} - ${activeProject.ownerNickname}`
[TRUNCATED]
```

src/components/layout/ProtectedLayout.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/layout/ProtectedLayout.tsx
3 |  * ëª©ì : ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë ˆì´ì•„ì›ƒ ì œê³µ
4 |  * ì—­í• : ì¸ì¦ ìƒíƒœ í™•ì¸ ë° ë¹„ì¸ì¦ ì‚¬ìš©ì ë¦¬ë””ë ‰ì…˜ ì²˜ë¦¬
5 |  * ì‘ì„±ì¼: 2024-05-08
6 |  * ìˆ˜ì •ì¼: 2024-05-08 : í•˜ì´ë“œë ˆì´ì…˜ ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•œ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2025-04-24 : AuthContext ì œê±° - useAuthStoreë¡œ ëŒ€ì²´
8 |  */
9 | 
10 | 'use client';
11 | 
12 | import { useEffect, useState } from 'react';
13 | 
14 | import { useRouter } from 'next/navigation';
15 | 
16 | import createLogger from '@/lib/logger';
17 | import { useAuthStore } from '@/store/useAuthStore';
18 | 
19 | // ë¡œê±° ìƒì„±
20 | const logger = createLogger('ProtectedLayout');
21 | 
22 | /**
23 |  * ProtectedLayout: ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
24 |  * @param children - ìì‹ ì»´í¬ë„ŒíŠ¸
25 |  * @returns ë³´í˜¸ëœ ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
26 |  */
27 | export function ProtectedLayout({ children }: { children: React.ReactNode }) {
28 |     // useAuthStoreë¡œë¶€í„° í•„ìš”í•œ ìƒíƒœë¥¼ ê°€ì ¸ì˜´
29 |     const profile = useAuthStore(state => state.profile);
30 |     const isLoading = useAuthStore(state => state.isLoading);
31 | 
32 |     const router = useRouter();
33 |     // í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìƒíƒœë¥¼ ì¶”ê°€í•˜ì—¬ í•˜ì´ë“œë ˆì´ì…˜ ì´í›„ì—ë§Œ UI ë³€ê²½
34 |     const [isMounted, setIsMounted] = useState(false);
35 | 
36 |     useEffect(() => {
37 |         // í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ë§ˆìš´íŠ¸ëœ í›„ì—ë§Œ ìƒíƒœ ë³€ê²½
38 |         setIsMounted(true);
39 | 
40 |         logger.info('ë³´í˜¸ëœ ë ˆì´ì•„ì›ƒ ìƒíƒœ', { isLoading, isAuthenticated: !!profile });
41 | 
42 |         // ì¸ì¦ ìƒíƒœ ë¡œë”©ì´ ì™„ë£Œë˜ê³ , ì‚¬ìš©ìê°€ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
43 |         if (!isLoading && !profile) {
44 |             logger.info('ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì, ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜');
45 |             router.push('/login');
46 |         }
47 |     }, [profile, isLoading, router]);
48 | 
49 |     // ì²˜ìŒ ì„œë²„ ë Œë”ë§ ì‹œì—ëŠ” í•­ìƒ childrenì„ ë Œë”ë§í•˜ì—¬ í•˜ì´ë“œë ˆì´ì…˜ ì˜¤ë¥˜ ë°©ì§€
50 |     if (!isMounted) {
51 |         return <>{children}</>;
52 |     }
53 | 
54 |     // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë§ˆìš´íŠ¸ëœ í›„ì—ë§Œ ë¡œë”© UI ë˜ëŠ” ë¦¬ë””ë ‰ì…˜ UI í‘œì‹œ
55 |     if (isLoading) {
56 |         return (
57 |             <div className="flex justify-center items-center min-h-screen">
58 |                 <div className="flex flex-col items-center">
59 |                     <div className="mb-4">
60 |                         <div className="animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"></div>
61 |                     </div>
[TRUNCATED]
```

src/components/layout/PublicOnlyLayout.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/layout/PublicOnlyLayout.tsx
3 |  * ëª©ì : ë¡œê·¸ì¸, íšŒì›ê°€ì… ë“± ê³µê°œ í˜ì´ì§€ ì „ìš© ë ˆì´ì•„ì›ƒ ì œê³µ
4 |  * ì—­í• : ì´ë¯¸ ì¸ì¦ëœ ì‚¬ìš©ìë¥¼ í™ˆìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜
5 |  * ì‘ì„±ì¼: 2024-05-08
6 |  * ìˆ˜ì •ì¼: 2024-05-08 : í•˜ì´ë“œë ˆì´ì…˜ ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•œ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2024-04-22 : ê¹œë¹¡ì„ í˜„ìƒ ì œê±°ë¥¼ ìœ„í•œ ë¡œë”© UI ìˆ˜ì •
8 |  * ìˆ˜ì •ì¼: 2025-04-24 : AuthContext ì œê±° - useAuthStoreë¡œ ëŒ€ì²´
9 |  */
10 | 
11 | 'use client';
12 | 
13 | import { useEffect, useState } from 'react';
14 | 
15 | import { useRouter } from 'next/navigation';
16 | 
17 | import createLogger from '@/lib/logger';
18 | import { useAuthStore } from '@/store/useAuthStore';
19 | 
20 | // ë¡œê±° ìƒì„±
21 | const logger = createLogger('PublicOnlyLayout');
22 | 
23 | /**
24 |  * PublicOnlyLayout: ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
25 |  * @param children - ìì‹ ì»´í¬ë„ŒíŠ¸
26 |  * @returns ê³µê°œ ì „ìš© ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
27 |  */
28 | export function PublicOnlyLayout({ children }: { children: React.ReactNode }) {
29 |     // useAuthStoreë¡œë¶€í„° í•„ìš”í•œ ìƒíƒœë¥¼ ê°€ì ¸ì˜´
30 |     const profile = useAuthStore(state => state.profile);
31 |     const isLoading = useAuthStore(state => state.isLoading);
32 | 
33 |     const router = useRouter();
34 |     // í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìƒíƒœë¥¼ ì¶”ê°€í•˜ì—¬ í•˜ì´ë“œë ˆì´ì…˜ ì´í›„ì—ë§Œ UI ë³€ê²½
35 |     const [isMounted, setIsMounted] = useState(false);
36 | 
37 |     useEffect(() => {
38 |         // í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ë§ˆìš´íŠ¸ëœ í›„ì—ë§Œ ìƒíƒœ ë³€ê²½
39 |         setIsMounted(true);
40 | 
41 |         logger.info('ê³µê°œ ì „ìš© ë ˆì´ì•„ì›ƒ ìƒíƒœ', { isLoading, isAuthenticated: !!profile });
42 | 
43 |         // ì¸ì¦ ìƒíƒœ ë¡œë”©ì´ ì™„ë£Œë˜ê³ , ì‚¬ìš©ìê°€ ìˆìœ¼ë©´ í™ˆìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜
44 |         if (!isLoading && profile) {
45 |             logger.info('ì´ë¯¸ ì¸ì¦ëœ ì‚¬ìš©ì, í™ˆìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜');
46 |             router.push('/');
47 |         }
48 |     }, [profile, isLoading, router]);
49 | 
50 |     // ì²˜ìŒ ì„œë²„ ë Œë”ë§ ì‹œì—ëŠ” í•­ìƒ childrenì„ ë Œë”ë§í•˜ì—¬ í•˜ì´ë“œë ˆì´ì…˜ ì˜¤ë¥˜ ë°©ì§€
51 |     if (!isMounted) {
52 |         return <>{children}</>;
53 |     }
54 | 
55 |     // ì¸ì¦ ìƒíƒœì— ê´€ê³„ì—†ì´ í•­ìƒ ìì‹ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
56 |     // ë¡œë”© ìƒíƒœì—ì„œë„ í•´ë‹¹ í˜ì´ì§€ë¥¼ ê³„ì† ë³´ì—¬ì£¼ì–´ ê¹œë¹¡ì„ ë°©ì§€
57 |     if (!profile) {
58 |         return <>{children}</>;
59 |     }
60 | 
61 |     // ì‚¬ìš©ìê°€ ì´ë¯¸ ì¸ì¦ë˜ì–´ ìˆê³  ë¦¬ë””ë ‰ì…˜ ì¤‘ì¸ ê²½ìš°ì—ë§Œ ë¡œë”© UI í‘œì‹œ
62 |     return (
63 |         <div className="flex justify-center items-center min-h-screen">
64 |             <div className="flex flex-col items-center">
[TRUNCATED]
```

src/components/layout/ShortcutToolbar.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: ShortcutToolbar.test.tsx
3 |  * ëª©ì : ShortcutToolbar ì»´í¬ë„ŒíŠ¸ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ë‹¨ì¶• ê¸°ëŠ¥ íˆ´ë°”ì˜ ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-03
7 |  */
8 | 
9 | import { render, screen, fireEvent } from '@testing-library/react';
10 | import { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';
11 | 
12 | import { ShortcutToolbarMock } from './ShortcutToolbarMock';
13 | import { setupShortcutToolbarTests, teardownShortcutToolbarTests, mockActions } from './test-utils';
14 | import '@testing-library/jest-dom';
15 | 
16 | // ì„±ê³µ ì¼€ì´ìŠ¤ì™€ ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìœ„í•œ í•¨ìˆ˜ ìƒì„±
17 | const createSuccessSignOutMock = () => {
18 |     return vi.fn().mockResolvedValue(undefined);
19 | };
20 | 
21 | const createFailureSignOutMock = () => {
22 |     return vi.fn().mockRejectedValue(new Error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨'));
23 | };
24 | 
25 | describe('ShortcutToolbar', () => {
26 |     beforeEach(() => {
27 |         setupShortcutToolbarTests();
28 |         vi.clearAllMocks();
29 |     });
30 | 
31 |     afterEach(() => {
32 |         teardownShortcutToolbarTests();
33 |     });
34 | 
35 |     describe('@testcase.mdc ShortcutToolbar ê¸°ë³¸ ê¸°ëŠ¥', () => {
36 |         it('rule: ëª¨ë“  ê¸°ë³¸ ë²„íŠ¼ì´ ë Œë”ë§ë˜ì–´ì•¼ í•¨', () => {
37 |             render(<ShortcutToolbarMock />);
38 | 
39 |             expect(screen.getByTitle('ì‚¬ì´ë“œë°” ì ‘ê¸°')).toBeInTheDocument();
40 |             expect(screen.getByTitle('ë¡œê·¸ì•„ì›ƒ')).toBeInTheDocument();
41 |         });
42 | 
43 |         it('rule: ì‚¬ì´ë“œë°” ì ‘ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ toggleSidebar ì•¡ì…˜ì´ í˜¸ì¶œë˜ì–´ì•¼ í•¨', () => {
44 |             render(<ShortcutToolbarMock />);
45 | 
46 |             fireEvent.click(screen.getByTitle('ì‚¬ì´ë“œë°” ì ‘ê¸°'));
47 |             expect(mockActions.toggleSidebar).toHaveBeenCalled();
48 |         });
49 |     });
50 | 
51 |     describe('@testcase.mdc ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥', () => {
52 |         it('rule: ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì‹œ signOut í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì–´ì•¼ í•¨', () => {
53 |             // ì„±ê³µ ì¼€ì´ìŠ¤ ì„¤ì •
54 |             mockActions.signOut = createSuccessSignOutMock();
55 | 
56 |             render(<ShortcutToolbarMock />);
57 |             fireEvent.click(screen.getByTitle('ë¡œê·¸ì•„ì›ƒ'));
58 | 
59 |             expect(mockActions.signOut).toHaveBeenCalled();
60 |             expect(mockActions.toast.success).not.toHaveBeenCalled(); // ë¹„ë™ê¸° í˜¸ì¶œ ì „ì—ëŠ” í˜¸ì¶œë˜ì§€ ì•Šì•„ì•¼ í•¨
61 |         });
62 | 
63 |         it('rule: ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‹œ ì„±ê³µ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ì–´ì•¼ í•¨', async () => {
64 |             // ì„±ê³µ ì¼€ì´ìŠ¤ ì„¤ì •
65 |             mockActions.signOut = createSuccessSignOutMock();
66 | 
67 |             // ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ë° í´ë¦­ ëŒ€ì‹  signOut í•¨ìˆ˜ ì§ì ‘ í˜¸ì¶œí•˜ê³  ê²°ê³¼ í™•ì¸
68 |             await mockActions.signOut()
69 |                 .then(() => {
70 |                     mockActions.toast.success('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
[TRUNCATED]
```

src/components/layout/ShortcutToolbar.tsx
```
1 | 'use client';
2 | 
3 | import { LogOut, PanelRight } from 'lucide-react';
4 | 
5 | import { Button } from '@/components/ui/button';
6 | import { useAppStore } from '@/store/useAppStore';
7 | 
8 | export function ShortcutToolbar() {
9 |   const { toggleSidebar } = useAppStore();
10 | 
11 |   return (
12 |     <div className="fixed top-3 right-3 flex items-center gap-1 bg-background/80 backdrop-blur-sm rounded-lg shadow-md border p-1 px-2 z-10">
13 |       {/* ì‚¬ì´ë“œë°” ì ‘ê¸° */}
14 |       <Button
15 |         variant="ghost"
16 |         size="icon"
17 |         className="rounded-full"
18 |         onClick={toggleSidebar}
19 |         title="ì‚¬ì´ë“œë°” ì ‘ê¸°"
20 |       >
21 |         <PanelRight className="h-5 w-5" />
22 |         <span className="sr-only">ì‚¬ì´ë“œë°” ì ‘ê¸°</span>
23 |       </Button>
24 | 
25 |       {/* ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */}
26 |       <Button
27 |         variant="ghost"
28 |         size="icon"
29 |         className="rounded-full"
30 |         title="ë¡œê·¸ì•„ì›ƒ"
31 |       >
32 |         <LogOut className="h-5 w-5" />
33 |         <span className="sr-only">ë¡œê·¸ì•„ì›ƒ</span>
34 |       </Button>
35 |     </div>
36 |   );
37 | } 
```

src/components/layout/ShortcutToolbarMock.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: ShortcutToolbarMock.tsx
3 |  * ëª©ì : ShortcutToolbar í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ëª¨í‚¹ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ì„ ì‹œë®¬ë ˆì´ì…˜
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-03
7 |  */
8 | 
9 | import React from 'react';
10 | 
11 | import { mockActions } from './test-utils';
12 | 
13 | export const ShortcutToolbarMock: React.FC = () => {
14 |     const handleLogout = () => {
15 |         // Promise ì²´ì¸ ì‚¬ìš©í•˜ì—¬ ë¶„ëª…í•œ íë¦„ ì œê³µ
16 |         mockActions.signOut()
17 |             .then(() => {
18 |                 mockActions.toast.success('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
19 |             })
20 |             .catch(() => {
21 |                 mockActions.toast.error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
22 |             });
23 |     };
24 | 
25 |     return (
26 |         <div>
27 |             <button title="ì‚¬ì´ë“œë°” ì ‘ê¸°" onClick={() => mockActions.toggleSidebar()}>
28 |                 ì‚¬ì´ë“œë°” ì ‘ê¸°
29 |             </button>
30 |             <button title="ë¡œê·¸ì•„ì›ƒ" onClick={handleLogout}>
31 |                 ë¡œê·¸ì•„ì›ƒ
32 |             </button>
33 |         </div>
34 |     );
35 | }; 
```

src/components/layout/Sidebar.tsx
```
1 | 'use client';
2 | 
3 | import { useEffect, useState, useRef, useMemo } from 'react';
4 | 
5 | import { useRouter } from 'next/navigation';
6 | import Link from 'next/link';
7 | 
8 | import { motion, AnimatePresence } from 'framer-motion';
9 | import { ChevronRight, Trash2, GripVertical, Pencil } from 'lucide-react';
10 | import { toast } from 'sonner';
11 | 
12 | // import CardList from '@/components/cards/CardList';
13 | import { EditCardModal } from '@/components/cards/EditCardModal';
14 | import DocumentViewer from '@/components/editor/DocumentViewer';
15 | import TiptapViewer from '@/components/editor/TiptapViewer';
16 | // import { Badge } from '@/components/ui/badge';
17 | import { Button } from '@/components/ui/button';
18 | import {
19 |   Dialog,
20 |   DialogContent,
21 |   DialogHeader,
22 |   DialogTitle,
23 |   DialogDescription,
24 |   DialogFooter,
25 |   // DialogTrigger,
26 |   DialogClose,
27 | } from '@/components/ui/dialog';
28 | import { Portal } from '@/components/ui/portal';
29 | import { useAuth } from '@/hooks/useAuth';
30 | import { useCards } from '@/hooks/useCards';
31 | import { useCard } from '@/hooks/useCard';
32 | import { useUpdateCard } from '@/hooks/useUpdateCard';
33 | import { useDeleteCard } from '@/hooks/useDeleteCard';
34 | import { useResizable } from '@/hooks/useResizable';
35 | import { cn } from '@/lib/utils';
36 | import { formatDate } from '@/lib/utils';
37 | import { useAppStore } from '@/store/useAppStore';
38 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
39 | import type { Card } from '@/types/card';
40 | import { signOut } from '@/lib/auth';
41 | import Image from 'next/image';
42 | import { useQueryClient } from '@tanstack/react-query';
43 | import { deleteCardAPI } from '@/services/cardService';
44 | 
45 | 
46 | // ì¹´ë“œ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
47 | interface Tag {
48 |   id: string;
49 |   name: string;
50 | }
51 | 
52 | interface CardTag {
53 |   id: string;
54 |   tag: Tag;
55 | }
56 | 
57 | interface CardItem extends Card {
58 |   cardTags?: CardTag[];
59 |   // ì—£ì§€ ì •ë³´ë¥¼ í†µí•´ ê³„ì¸µ êµ¬ì¡° íŒŒì•…ì„ ìœ„í•œ í•„ë“œ
60 |   parents?: string[];
61 |   children?: string[];
62 |   depth?: number;
63 | }
64 | 
65 | interface SidebarProps {
66 |   className?: string;
67 | }
68 | 
69 | export function Sidebar({ className }: SidebarProps) {
70 |   // const router = useRouter();
71 |   const {
72 |     isSidebarOpen,
73 |     setSidebarOpen,
74 |     selectedCardId,
75 |     selectedCardIds,
76 |     selectCard,
77 |     sidebarWidth,
78 |     setSidebarWidth,
79 |     reactFlowInstance
[TRUNCATED]
```

src/components/layout/test-utils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: test-utils.ts
3 |  * ëª©ì : ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ë° ëª¨í‚¹ ê°ì²´ ì œê³µ
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ ì„¤ì •, ì •ë¦¬, ëª¨í‚¹ëœ ì•¡ì…˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-03
7 |  */
8 | 
9 | import { toast } from 'sonner';
10 | import { vi } from 'vitest';
11 | 
12 | // ëª¨í‚¹ëœ ì•¡ì…˜ë“¤
13 | export const mockActions = {
14 |   // MainToolbar ì•¡ì…˜
15 |   applyLayout: vi.fn(),
16 |   createCard: vi.fn(() => Promise.resolve({ id: 'new-card-id' })),
17 |   updateBoardSettings: vi.fn(() => Promise.resolve()),
18 | 
19 |   // ShortcutToolbar ì•¡ì…˜
20 |   toggleSidebar: vi.fn(),
21 |   // Promiseë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ëª¨í‚¹ í•¨ìˆ˜
22 |   signOut: vi.fn().mockImplementation(() => Promise.resolve()),
23 |   toast: {
24 |     success: vi.fn(),
25 |     error: vi.fn(),
26 |   },
27 | };
28 | 
29 | /**
30 |  * setupMainToolbarTests: MainToolbar í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í™˜ê²½ì„ ì„¤ì •
31 |  */
32 | export const setupMainToolbarTests = () => {
33 |   // ëª¨ë“  ëª¨í‚¹ëœ í•¨ìˆ˜ ì´ˆê¸°í™”
34 |   vi.clearAllMocks();
35 | 
36 |   // Sonner í† ìŠ¤íŠ¸ ëª¨í‚¹
37 |   vi.mock('sonner', () => ({
38 |     toast: {
39 |       success: vi.fn(),
40 |       error: vi.fn(),
41 |     },
42 |   }));
43 | };
44 | 
45 | /**
46 |  * setupShortcutToolbarTests: ShortcutToolbar í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í™˜ê²½ì„ ì„¤ì •
47 |  */
48 | export const setupShortcutToolbarTests = () => {
49 |   // ëª¨ë“  ëª¨í‚¹ëœ í•¨ìˆ˜ ì´ˆê¸°í™”
50 |   vi.clearAllMocks();
51 | 
52 |   // Sonner í† ìŠ¤íŠ¸ ëª¨í‚¹
53 |   vi.mock('sonner', () => ({
54 |     toast: {
55 |       success: vi.fn(),
56 |       error: vi.fn(),
57 |     },
58 |   }));
59 | };
60 | 
61 | /**
62 |  * teardownMainToolbarTests: í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬ ì‘ì—… ìˆ˜í–‰
63 |  */
64 | export const teardownMainToolbarTests = () => {
65 |   vi.clearAllMocks();
66 |   vi.resetModules();
67 | };
68 | 
69 | /**
70 |  * teardownShortcutToolbarTests: í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬ ì‘ì—… ìˆ˜í–‰
71 |  */
72 | export const teardownShortcutToolbarTests = () => {
73 |   vi.clearAllMocks();
74 |   vi.resetModules();
75 | }; 
```

src/components/settings/NodeSizeSettings.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: NodeSizeSettings.test.tsx
3 |  * ëª©ì : NodeSizeSettings ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ë…¸ë“œ í¬ê¸° ì„¤ì • ì»´í¬ë„ŒíŠ¸ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : ThemeContext ëª¨í‚¹ì„ useAppStore ëª¨í‚¹ìœ¼ë¡œ ëŒ€ì²´
7 |  */
8 | 
9 | import React from 'react';
10 | 
11 | import { render, screen, fireEvent } from '@testing-library/react';
12 | import { describe, test, expect, vi, beforeEach } from 'vitest';
13 | import '@testing-library/jest-dom/vitest';
14 | 
15 | // ResizeObserver ëª¨í‚¹
16 | global.ResizeObserver = vi.fn().mockImplementation(() => ({
17 |   observe: vi.fn(),
18 |   unobserve: vi.fn(),
19 |   disconnect: vi.fn(),
20 | }));
21 | 
22 | // updateNodeSize ëª¨í‚¹ í•¨ìˆ˜
23 | const updateNodeSizeMock = vi.fn();
24 | const updateNodeInternalsMock = vi.fn();
25 | 
26 | // ReactFlow ëª¨í‚¹
27 | vi.mock('@xyflow/react', () => {
28 |   return {
29 |     useReactFlow: () => ({
30 |       getNodes: () => [{ id: 'node-1' }, { id: 'node-2' }],
31 |     }),
32 |     useUpdateNodeInternals: () => updateNodeInternalsMock,
33 |     ReactFlowProvider: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,
34 |   };
35 | });
36 | 
37 | // useAppStore ëª¨í‚¹
38 | vi.mock('@/store/useAppStore', () => {
39 |   return {
40 |     useAppStore: vi.fn((selector) => {
41 |       if (typeof selector === 'function') {
42 |         return selector({
43 |           ideaMapSettings: {
44 |             node: {
45 |               width: 220,
46 |               height: 48,
47 |               maxHeight: 180,
48 |               backgroundColor: '#ffffff',
49 |               borderColor: '#C1C1C1',
50 |               borderWidth: 1,
51 |               borderRadius: 8,
52 |               selectedBorderColor: '#0071e3',
53 |               font: {
54 |                 family: 'Pretendard, sans-serif',
55 |                 titleSize: 14,
56 |                 contentSize: 12,
57 |                 tagsSize: 10,
58 |               }
59 |             },
60 |             edge: {
61 |               color: '#C1C1C1',
62 |               width: 1,
63 |               selectedColor: '#0071e3',
64 |               animated: false,
65 |             },
66 |             handle: {
67 |               size: 8,
68 |               backgroundColor: '#ffffff',
69 |               borderColor: '#555555',
70 |               borderWidth: 1,
71 |             },
72 |             layout: {
73 |               spacing: {
74 |                 horizontal: 30,
75 |                 vertical: 30,
76 |               },
77 |               padding: 20,
78 |             },
79 |           },
80 |           updateIdeaMapSettings: vi.fn(),
81 |           updateNodeSize: updateNodeSizeMock,
82 |         });
83 |       }
84 |       return null;
85 |     }),
86 |   };
87 | });
88 | 
89 | // UI ì»´í¬ë„ŒíŠ¸ ëª¨í‚¹
[TRUNCATED]
```

src/components/settings/NodeSizeSettings.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: NodeSizeSettings.tsx
3 |  * ëª©ì : ë…¸ë“œ í¬ê¸° ì„¤ì • ì»´í¬ë„ŒíŠ¸ ì œê³µ
4 |  * ì—­í• : ì‚¬ìš©ìê°€ ë…¸ë“œ í¬ê¸°ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆëŠ” UI ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : ThemeContext ëŒ€ì‹  useAppStore(themeSlice) ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
7 |  */
8 | 
9 | 'use client';
10 | 
11 | import { useState, useEffect } from 'react';
12 | 
13 | import { useReactFlow, useUpdateNodeInternals } from '@xyflow/react';
14 | 
15 | import { Button } from "@/components/ui/button";
16 | import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
17 | import { Input } from "@/components/ui/input";
18 | import { Label } from "@/components/ui/label";
19 | import { Slider } from "@/components/ui/slider";
20 | import { useAppStore } from '@/store/useAppStore';
21 | 
22 | /**
23 |  * NodeSizeSettings: ë…¸ë“œ í¬ê¸° ì¡°ì • ì»´í¬ë„ŒíŠ¸
24 |  * @returns ë…¸ë“œ í¬ê¸° ì„¤ì • UI ì»´í¬ë„ŒíŠ¸
25 |  */
26 | export function NodeSizeSettings() {
27 |   const { getNodes } = useReactFlow();
28 |   const updateNodeInternals = useUpdateNodeInternals();
29 | 
30 |   // Zustand ìŠ¤í† ì–´ì—ì„œ í…Œë§ˆ ê´€ë ¨ ìƒíƒœì™€ ì•¡ì…˜ ê°€ì ¸ì˜¤ê¸°
31 |   const ideaMapSettings = useAppStore(state => state.ideaMapSettings);
32 |   const updateIdeaMapSettings = useAppStore(state => state.updateIdeaMapSettings);
33 | 
34 |   const [width, setWidth] = useState(ideaMapSettings.nodeWidth);
35 |   const [height, setHeight] = useState(ideaMapSettings.nodeSpacing);
36 |   const [maxHeight, setMaxHeight] = useState(ideaMapSettings.maxNodeHeight); // ê¸°ë³¸ ìµœëŒ€ ë†’ì´ ê°’
37 | 
38 |   // ì…ë ¥ê°’ì´ ë³€ê²½ë  ë•Œ ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
39 |   const handleWidthChange = (value: number | string) => {
40 |     const numValue = typeof value === 'string' ? parseInt(value, 10) : value;
41 |     if (!isNaN(numValue) && numValue > 0) {
42 |       setWidth(numValue);
43 |     }
44 |   };
45 | 
46 |   const handleHeightChange = (value: number | string) => {
47 |     const numValue = typeof value === 'string' ? parseInt(value, 10) : value;
48 |     if (!isNaN(numValue) && numValue > 0) {
49 |       setHeight(numValue);
50 |     }
51 |   };
52 | 
53 |   const handleMaxHeightChange = (value: number | string) => {
54 |     const numValue = typeof value === 'string' ? parseInt(value, 10) : value;
55 |     if (!isNaN(numValue) && numValue > 0) {
56 |       setMaxHeight(numValue);
57 |     }
58 |   };
59 | 
60 |   // í…Œë§ˆì— ë³€ê²½ì‚¬í•­ ì ìš©
61 |   const applyChanges = () => {
62 |     // Zustand ìŠ¤í† ì–´ ì—…ë°ì´íŠ¸
63 |     updateIdeaMapSettings({
64 |       nodeWidth: width,
[TRUNCATED]
```

src/components/tags/TagForm.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/tags/TagForm.test.tsx
3 |  * ëª©ì : TagForm ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : íƒœê·¸ ìƒì„± í¼ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * @rule   three-layer-standard
7 |  * @layer  components
8 |  */
9 | 
10 | import { describe, it, expect, vi, beforeEach } from 'vitest';
11 | import { render, screen, fireEvent, act } from '@testing-library/react';
12 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
13 | import TagForm from './TagForm';
14 | import { useCreateTag } from '@/hooks/useCreateTag';
15 | import { toast } from 'sonner';
16 | 
17 | // useCreateTag í›… ëª¨í‚¹
18 | vi.mock('@/hooks/useCreateTag', () => ({
19 |   useCreateTag: vi.fn(),
20 | }));
21 | 
22 | // toast ëª¨í‚¹
23 | vi.mock('sonner', () => ({
24 |   toast: {
25 |     success: vi.fn(),
26 |     error: vi.fn(),
27 |   },
28 | }));
29 | 
30 | // í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
31 | const renderWithClient = (ui: React.ReactElement) => {
32 |   const queryClient = new QueryClient({
33 |     defaultOptions: {
34 |       queries: {
35 |         retry: false,
36 |       },
37 |     },
38 |   });
39 |   return render(
40 |     <QueryClientProvider client={queryClient}>{ui}</QueryClientProvider>
41 |   );
42 | };
43 | 
44 | describe('TagForm ì»´í¬ë„ŒíŠ¸', () => {
45 |   // í…ŒìŠ¤íŠ¸ìš© mutate í•¨ìˆ˜
46 |   const mockMutate = vi.fn();
47 | 
48 |   beforeEach(() => {
49 |     vi.resetAllMocks();
50 | 
51 |     // ê¸°ë³¸ ìƒíƒœ ëª¨í‚¹
52 |     (useCreateTag as unknown as ReturnType<typeof vi.fn>).mockReturnValue({
53 |       mutate: mockMutate,
54 |       isPending: false,
55 |       isError: false,
56 |       error: null,
57 |     });
58 |   });
59 | 
60 |   it('íƒœê·¸ ì…ë ¥ í¼ì´ ì˜¬ë°”ë¥´ê²Œ ë Œë”ë§ëœë‹¤', () => {
61 |     renderWithClient(<TagForm />);
62 | 
63 |     // í¼ ìš”ì†Œê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
64 |     expect(screen.getByLabelText('íƒœê·¸ ì´ë¦„')).toBeInTheDocument();
65 |     expect(screen.getByPlaceholderText('ìƒˆ íƒœê·¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”')).toBeInTheDocument();
66 |     expect(screen.getByRole('button', { name: 'íƒœê·¸ ìƒì„±' })).toBeInTheDocument();
67 |   });
68 | 
69 |   it('ë¹ˆ ì…ë ¥ê°’ìœ¼ë¡œ ì œì¶œ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•œë‹¤', () => {
70 |     renderWithClient(<TagForm />);
71 | 
72 |     // ë¹ˆ í¼ ì œì¶œ
73 |     const submitButton = screen.getByRole('button', { name: 'íƒœê·¸ ìƒì„±' });
74 |     fireEvent.click(submitButton);
75 | 
76 |     // ì—ëŸ¬ í† ìŠ¤íŠ¸ í˜¸ì¶œ í™•ì¸
77 |     expect(toast.error).toHaveBeenCalledWith('íƒœê·¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
[TRUNCATED]
```

src/components/tags/TagForm.tsx
```
1 | "use client";
2 | 
3 | import { useState } from "react";
4 | import { toast } from "sonner";
5 | import { Loader2 } from "lucide-react";
6 | 
7 | import { Button } from "@/components/ui/button";
8 | import { Input } from "@/components/ui/input";
9 | import { Label } from "@/components/ui/label";
10 | import { useCreateTag } from "@/hooks/useCreateTag";
11 | 
12 | /**
13 |  * TagForm: ìƒˆë¡œìš´ íƒœê·¸ë¥¼ ìƒì„±í•˜ëŠ” í¼ ì»´í¬ë„ŒíŠ¸
14 |  */
15 | export default function TagForm() {
16 |   const [tagName, setTagName] = useState("");
17 | 
18 |   // useCreateTag í›…ì„ ì‚¬ìš©í•˜ì—¬ íƒœê·¸ ìƒì„± mutation ì‚¬ìš©
19 |   const { mutate: createTag, isPending, isError, error } = useCreateTag();
20 | 
21 |   const handleSubmit = (e: React.FormEvent) => {
22 |     e.preventDefault();
23 | 
24 |     if (!tagName.trim()) {
25 |       toast.error("íƒœê·¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
26 |       return;
27 |     }
28 | 
29 |     // í›…ì˜ mutate í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ íƒœê·¸ ìƒì„±
30 |     createTag(
31 |       { name: tagName.trim() },
32 |       {
33 |         onSuccess: () => {
34 |           toast.success("íƒœê·¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
35 |           setTagName(""); // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
36 |         },
37 |         onError: (error) => {
38 |           console.error("íƒœê·¸ ìƒì„± ì˜¤ë¥˜:", error);
39 |           toast.error(error instanceof Error ? error.message : "íƒœê·¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
40 |         }
41 |       }
42 |     );
43 |   };
44 | 
45 |   return (
46 |     <form onSubmit={handleSubmit} className="space-y-4">
47 |       <div className="space-y-2">
48 |         <Label htmlFor="tagName">íƒœê·¸ ì´ë¦„</Label>
49 |         <Input
50 |           id="tagName"
51 |           type="text"
52 |           value={tagName}
53 |           onChange={(e) => setTagName(e.target.value)}
54 |           placeholder="ìƒˆ íƒœê·¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
55 |           disabled={isPending}
56 |           maxLength={50}
57 |         />
58 |       </div>
59 | 
60 |       <Button type="submit" disabled={isPending} className="w-full">
61 |         {isPending ? (
62 |           <>
63 |             <Loader2 className="mr-2 h-4 w-4 animate-spin" />
64 |             ìƒì„± ì¤‘...
65 |           </>
66 |         ) : (
67 |           "íƒœê·¸ ìƒì„±"
68 |         )}
69 |       </Button>
70 |     </form>
71 |   );
72 | } 
```

src/components/tags/TagFormMock.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: TagFormMock.tsx
3 |  * ëª©ì : TagForm í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ëª¨í‚¹ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ì„ ì‹œë®¬ë ˆì´ì…˜
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-03
7 |  */
8 | 
9 | import React, { useState } from 'react';
10 | 
11 | import { mockActions } from './test-utils';
12 | 
13 | const formStyles = {
14 |     display: 'flex',
15 |     flexDirection: 'column' as const,
16 |     gap: '1rem',
17 |     padding: '1rem',
18 | };
19 | 
20 | const labelStyles = {
21 |     display: 'block',
22 |     marginBottom: '0.5rem',
23 |     fontWeight: 'bold',
24 | };
25 | 
26 | const inputStyles = {
27 |     padding: '0.5rem',
28 |     border: '1px solid #ccc',
29 |     borderRadius: '4px',
30 |     fontSize: '1rem',
31 | };
32 | 
33 | const buttonStyles = {
34 |     padding: '0.5rem 1rem',
35 |     backgroundColor: '#0070f3',
36 |     color: 'white',
37 |     border: 'none',
38 |     borderRadius: '4px',
39 |     cursor: 'pointer',
40 |     fontSize: '1rem',
41 |     ':disabled': {
42 |         backgroundColor: '#ccc',
43 |         cursor: 'not-allowed',
44 |     },
45 | };
46 | 
47 | export const TagFormMock: React.FC = () => {
48 |     const [tagName, setTagName] = useState('');
49 |     const [isSubmitting, setIsSubmitting] = useState(false);
50 | 
51 |     const handleSubmit = async (e: React.FormEvent) => {
52 |         e.preventDefault();
53 | 
54 |         if (!tagName.trim()) {
55 |             mockActions.toast.error('íƒœê·¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
56 |             return;
57 |         }
58 | 
59 |         setIsSubmitting(true);
60 | 
61 |         try {
62 |             const response = await mockActions.createTag(tagName);
63 |             if (!response.ok) {
64 |                 const data = await response.json();
65 |                 throw new Error(data.message || 'íƒœê·¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
66 |             }
67 |             mockActions.toast.success('íƒœê·¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
68 |             mockActions.reload();
69 |             setTagName('');
70 |         } catch (error) {
71 |             if (error instanceof Error) {
72 |                 mockActions.toast.error(error.message);
73 |             } else {
74 |                 mockActions.toast.error('íƒœê·¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
75 |             }
76 |         } finally {
77 |             setIsSubmitting(false);
78 |         }
79 |     };
80 | 
81 |     return (
82 |         <form onSubmit={handleSubmit} style={formStyles} role="form" aria-label="íƒœê·¸ ìƒì„± í¼">
83 |             <div>
84 |                 <label htmlFor="tagName" style={labelStyles}>
85 |                     íƒœê·¸ ì´ë¦„
86 |                 </label>
[TRUNCATED]
```

src/components/tags/TagList.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/tags/TagList.test.tsx
3 |  * ëª©ì : TagList ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : íƒœê·¸ ëª©ë¡ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * @rule   three-layer-standard
7 |  * @layer  components
8 |  */
9 | 
10 | import { describe, it, expect, vi, beforeEach } from 'vitest';
11 | import { render, screen, waitFor, fireEvent } from '@testing-library/react';
12 | import TagList from './TagList';
13 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
14 | import { useTags } from '@/hooks/useTags';
15 | import { useDeleteTag } from '@/hooks/useDeleteTag';
16 | import { Tag } from '@/services/tagService';
17 | 
18 | // Mock íƒœê·¸ ëª©ë¡
19 | const mockTags: Tag[] = [
20 |   { id: '1', name: 'ê°œë°œ', count: 5, createdAt: '2025-04-01T00:00:00Z' },
21 |   { id: '2', name: 'ì•„ì´ë””ì–´', count: 0, createdAt: '2025-04-02T00:00:00Z' },
22 | ];
23 | 
24 | // React Query í›… ëª¨í‚¹
25 | vi.mock('@/hooks/useTags', () => ({
26 |   useTags: vi.fn(),
27 | }));
28 | 
29 | vi.mock('@/hooks/useDeleteTag', () => ({
30 |   useDeleteTag: vi.fn(),
31 | }));
32 | 
33 | // í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
34 | const renderWithClient = (ui: React.ReactElement) => {
35 |   const queryClient = new QueryClient({
36 |     defaultOptions: {
37 |       queries: {
38 |         retry: false,
39 |       },
40 |     },
41 |   });
42 |   return render(
43 |     <QueryClientProvider client={queryClient}>{ui}</QueryClientProvider>
44 |   );
45 | };
46 | 
47 | describe('TagList ì»´í¬ë„ŒíŠ¸', () => {
48 |   beforeEach(() => {
49 |     vi.resetAllMocks();
50 |   });
51 | 
52 |   it('ë¡œë”© ì¤‘ ìƒíƒœë¥¼ í‘œì‹œí•œë‹¤', () => {
53 |     (useTags as unknown as ReturnType<typeof vi.fn>).mockReturnValue({
54 |       isLoading: true,
55 |       error: null,
56 |       data: undefined,
57 |     });
58 | 
59 |     renderWithClient(<TagList />);
60 | 
61 |     expect(screen.getByText('íƒœê·¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...')).toBeInTheDocument();
62 |   });
63 | 
64 |   it('ì—ëŸ¬ ìƒíƒœë¥¼ í‘œì‹œí•œë‹¤', () => {
65 |     const testError = new Error('í…ŒìŠ¤íŠ¸ ì—ëŸ¬');
66 |     (useTags as unknown as ReturnType<typeof vi.fn>).mockReturnValue({
67 |       isLoading: false,
68 |       error: testError,
69 |       data: undefined,
70 |     });
71 | 
72 |     renderWithClient(<TagList />);
73 | 
74 |     expect(screen.getByText('íƒœê·¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')).toBeInTheDocument();
75 |     expect(screen.getByText('í…ŒìŠ¤íŠ¸ ì—ëŸ¬')).toBeInTheDocument();
76 |   });
[TRUNCATED]
```

src/components/tags/TagList.tsx
```
1 | "use client";
2 | 
3 | import { useState } from "react";
4 | import Link from "next/link";
5 | import { Trash2, Loader2 } from "lucide-react";
6 | import { toast } from "sonner";
7 | 
8 | import {
9 |   AlertDialog,
10 |   AlertDialogAction,
11 |   AlertDialogCancel,
12 |   AlertDialogContent,
13 |   AlertDialogDescription,
14 |   AlertDialogFooter,
15 |   AlertDialogHeader,
16 |   AlertDialogTitle,
17 |   AlertDialogTrigger,
18 | } from "@/components/ui/alert-dialog";
19 | import { Badge } from "@/components/ui/badge";
20 | import { Button } from "@/components/ui/button";
21 | import {
22 |   Table,
23 |   TableBody,
24 |   TableCell,
25 |   TableHead,
26 |   TableHeader,
27 |   TableRow,
28 | } from "@/components/ui/table";
29 | 
30 | import { useTags } from "@/hooks/useTags";
31 | import { useDeleteTag } from "@/hooks/useDeleteTag";
32 | import { Tag } from "@/services/tagService";
33 | 
34 | /**
35 |  * TagList: ì „ì²´ íƒœê·¸ ëª©ë¡ì„ í‘œì‹œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸
36 |  */
37 | export default function TagList() {
38 |   // React Query í›…ì„ í†µí•´ íƒœê·¸ ëª©ë¡ ì¡°íšŒ
39 |   const { data: tags, isLoading, error } = useTags();
40 | 
41 |   // íƒœê·¸ ì‚­ì œ ë®¤í…Œì´ì…˜ í›…
42 |   const { mutate: deleteTag, isPending: isDeleting } = useDeleteTag();
43 | 
44 |   // ì‚­ì œ ì¤‘ì¸ íƒœê·¸ ID ê´€ë¦¬
45 |   const [tagToDelete, setTagToDelete] = useState<string | null>(null);
46 | 
47 |   // íƒœê·¸ ì‚­ì œ í•¸ë“¤ëŸ¬
48 |   const handleDeleteTag = () => {
49 |     if (!tagToDelete) return;
50 | 
51 |     deleteTag(tagToDelete, {
52 |       onSuccess: () => {
53 |         toast.success("íƒœê·¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
54 |         setTagToDelete(null);
55 |       },
56 |       onError: (error) => {
57 |         console.error("íƒœê·¸ ì‚­ì œ ì˜¤ë¥˜:", error);
58 |         toast.error(error instanceof Error ? error.message : "íƒœê·¸ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
59 |         setTagToDelete(null);
60 |       }
61 |     });
62 |   };
63 | 
64 |   // ë¡œë”© ì¤‘ UI
65 |   if (isLoading) {
66 |     return (
67 |       <div className="flex justify-center items-center py-12">
68 |         <Loader2 className="h-8 w-8 text-primary animate-spin" />
69 |         <span className="ml-2">íƒœê·¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
70 |       </div>
71 |     );
72 |   }
73 | 
74 |   // ì—ëŸ¬ UI
75 |   if (error) {
76 |     return (
77 |       <div className="text-center py-8 text-destructive">
78 |         <p>íƒœê·¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
[TRUNCATED]
```

src/components/tags/TagListMock.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: TagListMock.tsx
3 |  * ëª©ì : TagList ì»´í¬ë„ŒíŠ¸ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ëª¨í‚¹ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ì„ ì‹œë®¬ë ˆì´ì…˜
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-03
7 |  */
8 | 
9 | import React, { useState } from 'react';
10 | 
11 | import { mockActions } from './test-utils';
12 | 
13 | interface Tag {
14 |     id: string;
15 |     name: string;
16 |     count: number;
17 |     createdAt: string;
18 | }
19 | 
20 | interface TagListMockProps {
21 |     initialTags: Tag[];
22 | }
23 | 
24 | // API ì‘ë‹µ íƒ€ì… ì •ì˜ ì¶”ê°€
25 | interface ApiResponse {
26 |     message?: string;
27 |     error?: string;
28 |     status?: string;
29 |     [key: string]: unknown;
30 | }
31 | 
32 | export const TagListMock: React.FC<TagListMockProps> = ({ initialTags }) => {
33 |     const [tags, setTags] = useState(initialTags);
34 |     const [tagToDelete, setTagToDelete] = useState<string | null>(null);
35 |     const [isDeleting, setIsDeleting] = useState(false);
36 | 
37 |     const handleDeleteClick = (tagId: string) => {
38 |         const tag = tags.find(t => t.id === tagId);
39 |         if (tag) {
40 |             setTagToDelete(tagId);
41 |         }
42 |     };
43 | 
44 |     const handleDeleteConfirm = async () => {
45 |         if (!tagToDelete) return;
46 | 
47 |         setIsDeleting(true);
48 |         try {
49 |             const response = await mockActions.deleteTag(tagToDelete);
50 |             if (!response.ok) {
51 |                 const data = await response.json() as ApiResponse;
52 |                 throw new Error(data.error || 'íƒœê·¸ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
53 |             }
54 |             mockActions.toast.success('íƒœê·¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
55 |             setTags(tags.filter(tag => tag.id !== tagToDelete));
56 |         } catch (error) {
57 |             if (error instanceof Error) {
58 |                 mockActions.toast.error(error.message);
59 |             } else {
60 |                 mockActions.toast.error('íƒœê·¸ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
61 |             }
62 |         } finally {
63 |             setIsDeleting(false);
64 |             setTagToDelete(null);
65 |         }
66 |     };
67 | 
68 |     const handleDeleteCancel = () => {
69 |         setTagToDelete(null);
70 |     };
71 | 
72 |     if (tags.length === 0) {
73 |         return <div>ë“±ë¡ëœ íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>;
74 |     }
75 | 
76 |     const getTagById = (id: string) => tags.find(t => t.id === id);
77 | 
78 |     return (
79 |         <div>
80 |             {tags.map(tag => (
[TRUNCATED]
```

src/components/tags/test-utils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: test-utils.ts
3 |  * ëª©ì : íƒœê·¸ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ì˜ í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹°
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ëª¨í‚¹ê³¼ í—¬í¼ í•¨ìˆ˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-03
7 |  */
8 | 
9 | import { vi } from 'vitest';
10 | 
11 | // ëª¨í‚¹ëœ ì•¡ì…˜ ê°ì²´
12 | export const mockActions = {
13 |   createTag: vi.fn(),
14 |   deleteTag: vi.fn(),
15 |   reload: vi.fn(),
16 |   toast: {
17 |     success: vi.fn(),
18 |     error: vi.fn(),
19 |   },
20 | };
21 | 
22 | // Sonner í† ìŠ¤íŠ¸ ëª¨í‚¹
23 | vi.mock('sonner', () => ({
24 |   default: {
25 |     success: (...args: any[]) => mockActions.toast.success(...args),
26 |     error: (...args: any[]) => mockActions.toast.error(...args),
27 |   },
28 |   toast: {
29 |     success: (...args: any[]) => mockActions.toast.success(...args),
30 |     error: (...args: any[]) => mockActions.toast.error(...args),
31 |   },
32 | }));
33 | 
34 | // íƒœê·¸ í¼ í…ŒìŠ¤íŠ¸ ì„¤ì •
35 | export const setupTagFormTests = () => {
36 |   // ëª¨í‚¹ëœ ì•¡ì…˜ ì´ˆê¸°í™”
37 |   mockActions.createTag.mockReset();
38 |   mockActions.deleteTag.mockReset();
39 |   mockActions.reload.mockReset();
40 |   mockActions.toast.success.mockReset();
41 |   mockActions.toast.error.mockReset();
42 | 
43 |   // ê¸°ë³¸ ì„±ê³µ ì‘ë‹µìœ¼ë¡œ ëª¨í‚¹
44 |   mockActions.createTag.mockResolvedValue(new Response(JSON.stringify({}), {
45 |     status: 200,
46 |     headers: { 'Content-Type': 'application/json' },
47 |   }));
48 | };
49 | 
50 | // íƒœê·¸ í¼ í…ŒìŠ¤íŠ¸ ì •ë¦¬
51 | export const teardownTagFormTests = () => {
52 |   vi.resetModules();
53 |   vi.clearAllMocks();
54 | };
55 | 
56 | // íƒœê·¸ ë¦¬ìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸ ì„¤ì •
57 | export const setupTagListTests = () => {
58 |   // ëª¨í‚¹ëœ ì•¡ì…˜ ì´ˆê¸°í™”
59 |   mockActions.createTag.mockReset();
60 |   mockActions.deleteTag.mockReset();
61 |   mockActions.reload.mockReset();
62 |   mockActions.toast.success.mockReset();
63 |   mockActions.toast.error.mockReset();
64 | 
65 |   // ê¸°ë³¸ ì„±ê³µ ì‘ë‹µìœ¼ë¡œ ëª¨í‚¹
66 |   mockActions.deleteTag.mockResolvedValue(new Response(JSON.stringify({}), {
67 |     status: 200,
68 |     headers: { 'Content-Type': 'application/json' },
69 |   }));
70 | };
71 | 
72 | // íƒœê·¸ ë¦¬ìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸ ì •ë¦¬
73 | export const teardownTagListTests = () => {
74 |   vi.resetModules();
75 |   vi.clearAllMocks();
76 | };
77 | 
78 | /**
79 |  * waitForDomChanges: ë¹„ë™ê¸° ì‘ì—…ì˜ ì•ˆì „í•œ ì™„ë£Œë¥¼ ìœ„í•œ ë„ìš°ë¯¸ í•¨ìˆ˜
[TRUNCATED]
```

src/hooks/mocks/handlers.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/mocks/handlers.ts
3 |  * ëª©ì : MSW handler ì •ì˜
4 |  * ì—­í• : API ìš”ì²­ì„ ê°€ë¡œì±„ê¸° ìœ„í•œ MSW handler ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : ì¹´ë“œ ì—…ë°ì´íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : ë””ë²„ê¹…ìš© ë¡œê¹… ì¶”ê°€ ë° URL í˜•ì‹ ì¡°ì •
8 |  * ìˆ˜ì •ì¼: 2025-04-21 : ì‘ë‹µ ìƒíƒœ ì½”ë“œ ìˆ˜ì • ë° ë¡œê¹… í•¸ë“¤ëŸ¬ ì¶”ê°€
9 |  */
10 | 
11 | import { http, HttpResponse } from 'msw';
12 | import { Card, CreateCardInput, UpdateCardInput } from '../../types/card';
13 | 
14 | // í…ŒìŠ¤íŠ¸ìš© ëª¨í‚¹ ì¹´ë“œ ë°ì´í„°
15 | export const mockCards: Card[] = [{
16 |   id: 'test-card-123',
17 |   title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ',
18 |   content: 'í…ŒìŠ¤íŠ¸ ë‚´ìš©',
19 |   createdAt: new Date().toISOString(),
20 |   updatedAt: new Date().toISOString(),
21 |   userId: 'user-1',
22 |   cardTags: []
23 | }];
24 | 
25 | // í…ŒìŠ¤íŠ¸ìš© ì—…ë°ì´íŠ¸ëœ ì¹´ë“œ ë°ì´í„°
26 | export const mockUpdatedCard: Card = {
27 |   id: 'test-card-123',
28 |   title: 'ìˆ˜ì •ëœ ì¹´ë“œ',
29 |   content: 'ìˆ˜ì •ëœ ë‚´ìš©',
30 |   createdAt: mockCards[0].createdAt,
31 |   updatedAt: new Date().toISOString(),
32 |   userId: 'user-1',
33 |   cardTags: []
34 | };
35 | 
36 | // API ìš”ì²­ í•¸ë“¤ëŸ¬ ì •ì˜
37 | export const handlers = [
38 |   // ì¹´ë“œ ìƒì„± API (POST /api/cards)
39 |   http.post('/api/cards', async ({ request }) => {
40 |     console.log('ğŸ”µ MSWê°€ POST /api/cards ìš”ì²­ì„ ê°€ë¡œì±˜ìŠµë‹ˆë‹¤');
41 |     try {
42 |       // ìš”ì²­ ë°ì´í„° íŒŒì‹±
43 |       const input = await request.json() as CreateCardInput | CreateCardInput[];
44 |       const inputs = Array.isArray(input) ? input : [input];
45 |       
46 |       // í•„ìˆ˜ í•„ë“œ ê²€ì¦
47 |       if (inputs.some(card => !card.title)) {
48 |         return new HttpResponse(JSON.stringify({ error: 'ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤' }), {
49 |           status: 400,
50 |           headers: {
51 |             'Content-Type': 'application/json',
52 |           },
53 |         });
54 |       }
55 |       
56 |       // ìƒˆ ì¹´ë“œ ìƒì„± (ì‹¤ì œë¡œëŠ” ê³ ì •ëœ mockCards ë°˜í™˜)
57 |       return HttpResponse.json(mockCards, { status: 201 });
58 |     } catch (error) {
59 |       // ì˜ˆì™¸ ì²˜ë¦¬
60 |       return new HttpResponse(JSON.stringify({ error: 'ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤' }), {
61 |         status: 500,
62 |         headers: {
63 |           'Content-Type': 'application/json',
64 |         },
65 |       });
66 |     }
67 |   }),
68 |   
[TRUNCATED]
```

src/hooks/mocks/node.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/hooks/mocks/node.ts
3 |  * ëª©ì : MSW í…ŒìŠ¤íŠ¸ ì„œë²„ ì„¤ì •
4 |  * ì—­í• : Node.js í™˜ê²½ì—ì„œ API ìš”ì²­ì„ ëª¨í‚¹í•˜ê¸° ìœ„í•œ MSW ì„œë²„ ì„¤ì •
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : íƒ€ì… ì˜¤ë¥˜ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
8 |  */
9 | 
10 | import { setupServer } from 'msw/node';
11 | import { RequestHandler } from 'msw';
12 | import { beforeEach, afterEach, afterAll } from 'vitest';
13 | import { handlers } from './handlers';
14 | 
15 | // MSW ì„œë²„ ì„¤ì •
16 | export const server = setupServer(...handlers);
17 | 
18 | // ìš”ì²­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹ (ë””ë²„ê¹…ìš©)
19 | server.events.on('request:start', ({ request }) => {
20 |   console.log(`ğŸ”„ MSW ìš”ì²­ ê°ì§€: ${request.method} ${request.url}`);
21 | });
22 | 
23 | // ì‘ë‹µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹ (ë””ë²„ê¹…ìš©)
24 | server.events.on('response:mocked', ({ request, response }) => {
25 |   console.log(`âœ… MSW ì‘ë‹µ ìƒì„±: ${request.method} ${request.url} - ìƒíƒœ: ${response.status}`);
26 | });
27 | 
28 | // ì²˜ë¦¬ë˜ì§€ ì•Šì€ ìš”ì²­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹ (ë””ë²„ê¹…ìš©)
29 | server.events.on('request:unhandled', ({ request }) => {
30 |   console.log(`âŒ MSW ì²˜ë¦¬ë˜ì§€ ì•Šì€ ìš”ì²­: ${request.method} ${request.url}`);
31 | });
32 | 
33 | /**
34 |  * setupMSW: í…ŒìŠ¤íŠ¸ì—ì„œ MSW ì„œë²„ ì„¤ì •
35 |  * @returns MSW ì„œë²„ ì œì–´ ê°ì²´
36 |  */
37 | export function setupMSW() {
38 |   // í…ŒìŠ¤íŠ¸ ì „ ì„œë²„ ì‹œì‘
39 |   beforeEach(() => {
40 |     server.listen({ 
41 |       onUnhandledRequest: 'warn' // ì²˜ë¦¬ë˜ì§€ ì•Šì€ ìš”ì²­ì„ ê²½ê³ ë¡œ ì¶œë ¥
42 |     });
43 |     console.log('ğŸ“¡ MSW ì„œë²„ ì‹œì‘ë¨');
44 |   });
45 | 
46 |   // í…ŒìŠ¤íŠ¸ í›„ í•¸ë“¤ëŸ¬ ì´ˆê¸°í™”
47 |   afterEach(() => {
48 |     server.resetHandlers();
49 |     console.log('ğŸ”„ MSW í•¸ë“¤ëŸ¬ ì´ˆê¸°í™”ë¨');
50 |   });
51 | 
52 |   // ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ì„œë²„ ì¢…ë£Œ
53 |   afterAll(() => {
54 |     server.close();
55 |     console.log('ğŸ›‘ MSW ì„œë²„ ì¢…ë£Œë¨');
56 |   });
57 | 
58 |   return {
59 |     // ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ì ‘ê·¼
60 |     server,
61 |     // í•¸ë“¤ëŸ¬ ì¶”ê°€
62 |     use: (...additionalHandlers: RequestHandler[]) => {
63 |       server.use(...additionalHandlers);
64 |       console.log(`â• MSW ì¶”ê°€ í•¸ë“¤ëŸ¬ ë“±ë¡ë¨ (${additionalHandlers.length}ê°œ)`);
65 |     }
66 |   };
67 | } 
```

src/components/ui/alert-dialog.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"
6 | 
7 | import { buttonVariants } from "@/components/ui/button"
8 | import { cn } from "@/lib/utils"
9 | 
10 | function AlertDialog({
11 |   ...props
12 | }: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
13 |   return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />
14 | }
15 | 
16 | function AlertDialogTrigger({
17 |   ...props
18 | }: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
19 |   return (
20 |     <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
21 |   )
22 | }
23 | 
24 | function AlertDialogPortal({
25 |   ...props
26 | }: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
27 |   return (
28 |     <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
29 |   )
30 | }
31 | 
32 | function AlertDialogOverlay({
33 |   className,
34 |   ...props
35 | }: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
36 |   return (
37 |     <AlertDialogPrimitive.Overlay
38 |       data-slot="alert-dialog-overlay"
39 |       className={cn(
40 |         "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",
41 |         className
42 |       )}
43 |       {...props}
44 |     />
45 |   )
46 | }
47 | 
48 | function AlertDialogContent({
49 |   className,
50 |   ...props
51 | }: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
52 |   return (
53 |     <AlertDialogPortal>
54 |       <AlertDialogOverlay />
55 |       <AlertDialogPrimitive.Content
56 |         data-slot="alert-dialog-content"
57 |         className={cn(
58 |           "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
59 |           className
60 |         )}
61 |         {...props}
62 |       />
63 |     </AlertDialogPortal>
64 |   )
65 | }
66 | 
67 | function AlertDialogHeader({
68 |   className,
69 |   ...props
70 | }: React.ComponentProps<"div">) {
71 |   return (
72 |     <div
73 |       data-slot="alert-dialog-header"
[TRUNCATED]
```

src/components/ui/badge.tsx
```
1 | import * as React from "react"
2 | 
3 | import { cva, type VariantProps } from "class-variance-authority"
4 | 
5 | import { cn } from "@/lib/utils"
6 | 
7 | const badgeVariants = cva(
8 |   "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
9 |   {
10 |     variants: {
11 |       variant: {
12 |         default:
13 |           "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
14 |         secondary:
15 |           "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
16 |         destructive:
17 |           "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
18 |         outline: "text-foreground",
19 |       },
20 |     },
21 |     defaultVariants: {
22 |       variant: "default",
23 |     },
24 |   }
25 | )
26 | 
27 | export interface BadgeProps
28 |   extends React.HTMLAttributes<HTMLDivElement>,
29 |     VariantProps<typeof badgeVariants> {}
30 | 
31 | function Badge({ className, variant, ...props }: BadgeProps) {
32 |   return (
33 |     <div className={cn(badgeVariants({ variant }), className)} {...props} />
34 |   )
35 | }
36 | 
37 | export { Badge, badgeVariants } 
```

src/components/ui/button.tsx
```
1 | import * as React from "react"
2 | 
3 | import { Slot } from "@radix-ui/react-slot"
4 | import { cva, type VariantProps } from "class-variance-authority"
5 | 
6 | import { cn } from "@/lib/utils"
7 | 
8 | const buttonVariants = cva(
9 |   "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
10 |   {
11 |     variants: {
12 |       variant: {
13 |         default:
14 |           "bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",
15 |         destructive:
16 |           "bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",
17 |         outline:
18 |           "border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",
19 |         secondary:
20 |           "bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",
21 |         ghost: "hover:bg-accent hover:text-accent-foreground",
22 |         link: "text-primary underline-offset-4 hover:underline",
23 |       },
24 |       size: {
25 |         default: "h-9 px-4 py-2 has-[>svg]:px-3",
26 |         sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
27 |         lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
28 |         icon: "size-9",
29 |       },
30 |     },
31 |     defaultVariants: {
32 |       variant: "default",
33 |       size: "default",
34 |     },
35 |   }
36 | )
37 | 
38 | function Button({
39 |   className,
40 |   variant,
41 |   size,
42 |   asChild = false,
43 |   ...props
44 | }: React.ComponentProps<"button"> &
45 |   VariantProps<typeof buttonVariants> & {
46 |     asChild?: boolean
47 |   }) {
48 |   const Comp = asChild ? Slot : "button"
49 | 
50 |   return (
51 |     <Comp
52 |       data-slot="button"
53 |       className={cn(buttonVariants({ variant, size, className }))}
54 |       {...props}
55 |     />
56 |   )
57 | }
58 | 
59 | export { Button, buttonVariants }
```

src/components/ui/card.tsx
```
1 | import * as React from "react"
2 | 
3 | import { cn } from "@/lib/utils"
4 | 
5 | function Card({ className, ...props }: React.ComponentProps<"div">) {
6 |   return (
7 |     <div
8 |       data-slot="card"
9 |       className={cn(
10 |         "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
11 |         className
12 |       )}
13 |       {...props}
14 |     />
15 |   )
16 | }
17 | 
18 | function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
19 |   return (
20 |     <div
21 |       data-slot="card-header"
22 |       className={cn(
23 |         "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
24 |         className
25 |       )}
26 |       {...props}
27 |     />
28 |   )
29 | }
30 | 
31 | function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
32 |   return (
33 |     <div
34 |       data-slot="card-title"
35 |       className={cn("leading-none font-semibold", className)}
36 |       {...props}
37 |     />
38 |   )
39 | }
40 | 
41 | function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
42 |   return (
43 |     <div
44 |       data-slot="card-description"
45 |       className={cn("text-muted-foreground text-sm", className)}
46 |       {...props}
47 |     />
48 |   )
49 | }
50 | 
51 | function CardAction({ className, ...props }: React.ComponentProps<"div">) {
52 |   return (
53 |     <div
54 |       data-slot="card-action"
55 |       className={cn(
56 |         "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
57 |         className
58 |       )}
59 |       {...props}
60 |     />
61 |   )
62 | }
63 | 
64 | function CardContent({ className, ...props }: React.ComponentProps<"div">) {
65 |   return (
66 |     <div
67 |       data-slot="card-content"
68 |       className={cn("px-6", className)}
69 |       {...props}
70 |     />
71 |   )
72 | }
73 | 
74 | function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
75 |   return (
76 |     <div
77 |       data-slot="card-footer"
78 |       className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
79 |       {...props}
80 |     />
81 |   )
[TRUNCATED]
```

src/components/ui/checkbox.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
6 | import { CheckIcon } from "lucide-react"
7 | 
8 | import { cn } from "@/lib/utils"
9 | 
10 | function Checkbox({
11 |   className,
12 |   ...props
13 | }: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
14 |   return (
15 |     <CheckboxPrimitive.Root
16 |       data-slot="checkbox"
17 |       className={cn(
18 |         "peer border-input data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
19 |         className
20 |       )}
21 |       {...props}
22 |     >
23 |       <CheckboxPrimitive.Indicator
24 |         data-slot="checkbox-indicator"
25 |         className="flex items-center justify-center text-current transition-none"
26 |       >
27 |         <CheckIcon className="size-3.5" />
28 |       </CheckboxPrimitive.Indicator>
29 |     </CheckboxPrimitive.Root>
30 |   )
31 | }
32 | 
33 | export { Checkbox }
```

src/components/ui/command.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/ui/command.tsx
3 |  * ëª©ì : Command ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
4 |  * ì—­í• : í”„ë¡œì íŠ¸ ì„ íƒ ë° ëª…ë ¹ ì‹¤í–‰ì„ ìœ„í•œ UI ì»´í¬ë„ŒíŠ¸ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-07-12
6 |  */
7 | 
8 | "use client"
9 | 
10 | import * as React from "react"
11 | 
12 | import { type DialogProps } from "@radix-ui/react-dialog"
13 | import { Command as CommandPrimitive } from "cmdk"
14 | import { Search } from "lucide-react"
15 | 
16 | import { Dialog, DialogContent } from "@/components/ui/dialog"
17 | import { cn } from "@/lib/utils"
18 | 
19 | const Command = React.forwardRef<
20 |     React.ElementRef<typeof CommandPrimitive>,
21 |     React.ComponentPropsWithoutRef<typeof CommandPrimitive>
22 | >(({ className, ...props }, ref) => (
23 |     <CommandPrimitive
24 |         ref={ref}
25 |         className={cn(
26 |             "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
27 |             className
28 |         )}
29 |         {...props}
30 |     />
31 | ))
32 | Command.displayName = CommandPrimitive.displayName
33 | 
34 | const CommandDialog = ({ children, ...props }: DialogProps) => {
35 |     return (
36 |         <Dialog {...props}>
37 |             <DialogContent className="overflow-hidden p-0 shadow-lg">
38 |                 <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
39 |                     {children}
40 |                 </Command>
41 |             </DialogContent>
42 |         </Dialog>
43 |     )
44 | }
45 | 
46 | const CommandInput = React.forwardRef<
47 |     React.ElementRef<typeof CommandPrimitive.Input>,
48 |     React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
49 | >(({ className, ...props }, ref) => (
50 |     <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
51 |         <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
52 |         <CommandPrimitive.Input
53 |             ref={ref}
54 |             className={cn(
55 |                 "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
[TRUNCATED]
```

src/components/ui/dialog.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as DialogPrimitive from "@radix-ui/react-dialog"
6 | import { XIcon } from "lucide-react"
7 | 
8 | import { cn } from "@/lib/utils"
9 | 
10 | function Dialog({
11 |   ...props
12 | }: React.ComponentProps<typeof DialogPrimitive.Root>) {
13 |   return <DialogPrimitive.Root data-slot="dialog" {...props} />
14 | }
15 | 
16 | function DialogTrigger({
17 |   ...props
18 | }: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
19 |   return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
20 | }
21 | 
22 | function DialogPortal({
23 |   ...props
24 | }: React.ComponentProps<typeof DialogPrimitive.Portal>) {
25 |   return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
26 | }
27 | 
28 | function DialogClose({
29 |   ...props
30 | }: React.ComponentProps<typeof DialogPrimitive.Close>) {
31 |   return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
32 | }
33 | 
34 | function DialogOverlay({
35 |   className,
36 |   ...props
37 | }: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
38 |   return (
39 |     <DialogPrimitive.Overlay
40 |       data-slot="dialog-overlay"
41 |       className={cn(
42 |         "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
43 |         className
44 |       )}
45 |       {...props}
46 |     />
47 |   )
48 | }
49 | 
50 | function DialogContent({
51 |   className,
52 |   children,
53 |   ...props
54 | }: React.ComponentProps<typeof DialogPrimitive.Content>) {
55 |   return (
56 |     <DialogPortal data-slot="dialog-portal">
57 |       <DialogOverlay />
58 |       <DialogPrimitive.Content
59 |         data-slot="dialog-content"
60 |         className={cn(
61 |           "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
62 |           className
63 |         )}
64 |         {...props}
65 |       >
66 |         {children}
[TRUNCATED]
```

src/components/ui/dropdown-menu.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
6 | import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"
7 | 
8 | import { cn } from "@/lib/utils"
9 | 
10 | function DropdownMenu({
11 |   ...props
12 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
13 |   return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />
14 | }
15 | 
16 | function DropdownMenuPortal({
17 |   ...props
18 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
19 |   return (
20 |     <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
21 |   )
22 | }
23 | 
24 | function DropdownMenuTrigger({
25 |   ...props
26 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
27 |   return (
28 |     <DropdownMenuPrimitive.Trigger
29 |       data-slot="dropdown-menu-trigger"
30 |       {...props}
31 |     />
32 |   )
33 | }
34 | 
35 | function DropdownMenuContent({
36 |   className,
37 |   sideOffset = 4,
38 |   ...props
39 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
40 |   return (
41 |     <DropdownMenuPrimitive.Portal>
42 |       <DropdownMenuPrimitive.Content
43 |         data-slot="dropdown-menu-content"
44 |         sideOffset={sideOffset}
45 |         className={cn(
46 |           "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
47 |           className
48 |         )}
49 |         {...props}
50 |       />
51 |     </DropdownMenuPrimitive.Portal>
52 |   )
53 | }
54 | 
55 | function DropdownMenuGroup({
56 |   ...props
57 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
58 |   return (
59 |     <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
60 |   )
61 | }
62 | 
63 | function DropdownMenuItem({
64 |   className,
65 |   inset,
66 |   variant = "default",
67 |   ...props
68 | }: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
69 |   inset?: boolean
70 |   variant?: "default" | "destructive"
71 | }) {
72 |   return (
73 |     <DropdownMenuPrimitive.Item
[TRUNCATED]
```

src/components/ui/form.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as LabelPrimitive from "@radix-ui/react-label"
6 | import { Slot } from "@radix-ui/react-slot"
7 | import {
8 |   Controller,
9 |   ControllerProps,
10 |   FieldPath,
11 |   FieldValues,
12 |   FormProvider,
13 |   useFormContext,
14 |   useFormState,
15 | } from "react-hook-form"
16 | 
17 | import { Label } from "@/components/ui/label"
18 | import { cn } from "@/lib/utils"
19 | 
20 | const Form = FormProvider
21 | 
22 | type FormFieldContextValue<
23 |   TFieldValues extends FieldValues = FieldValues,
24 |   TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
25 | > = {
26 |   name: TName
27 | }
28 | 
29 | const FormFieldContext = React.createContext<FormFieldContextValue>(
30 |   {} as FormFieldContextValue
31 | )
32 | 
33 | const FormField = <
34 |   TFieldValues extends FieldValues = FieldValues,
35 |   TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
36 | >({
37 |   ...props
38 | }: ControllerProps<TFieldValues, TName>) => {
39 |   return (
40 |     <FormFieldContext.Provider value={{ name: props.name }}>
41 |       <Controller {...props} />
42 |     </FormFieldContext.Provider>
43 |   )
44 | }
45 | 
46 | const useFormField = () => {
47 |   const fieldContext = React.useContext(FormFieldContext)
48 |   const itemContext = React.useContext(FormItemContext)
49 |   const { getFieldState } = useFormContext()
50 |   const formState = useFormState({ name: fieldContext.name })
51 |   const fieldState = getFieldState(fieldContext.name, formState)
52 | 
53 |   if (!fieldContext) {
54 |     throw new Error("useFormField should be used within <FormField>")
55 |   }
56 | 
57 |   const { id } = itemContext
58 | 
59 |   return {
60 |     id,
61 |     name: fieldContext.name,
62 |     formItemId: `${id}-form-item`,
63 |     formDescriptionId: `${id}-form-item-description`,
64 |     formMessageId: `${id}-form-item-message`,
65 |     ...fieldState,
66 |   }
67 | }
68 | 
69 | type FormItemContextValue = {
70 |   id: string
71 | }
72 | 
73 | const FormItemContext = React.createContext<FormItemContextValue>(
74 |   {} as FormItemContextValue
75 | )
76 | 
77 | function FormItem({ className, ...props }: React.ComponentProps<"div">) {
78 |   const id = React.useId()
79 | 
80 |   return (
81 |     <FormItemContext.Provider value={{ id }}>
82 |       <div
83 |         data-slot="form-item"
[TRUNCATED]
```

src/components/ui/input.tsx
```
1 | import * as React from "react"
2 | 
3 | import { cn } from "@/lib/utils"
4 | 
5 | function Input({ className, type, ...props }: React.ComponentProps<"input">) {
6 |   return (
7 |     <input
8 |       type={type}
9 |       data-slot="input"
10 |       className={cn(
11 |         "border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
12 |         "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
13 |         "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
14 |         className
15 |       )}
16 |       {...props}
17 |     />
18 |   )
19 | }
20 | 
21 | export { Input }
```

src/components/ui/label.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as LabelPrimitive from "@radix-ui/react-label"
6 | 
7 | import { cn } from "@/lib/utils"
8 | 
9 | function Label({
10 |   className,
11 |   ...props
12 | }: React.ComponentProps<typeof LabelPrimitive.Root>) {
13 |   return (
14 |     <LabelPrimitive.Root
15 |       data-slot="label"
16 |       className={cn(
17 |         "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
18 |         className
19 |       )}
20 |       {...props}
21 |     />
22 |   )
23 | }
24 | 
25 | export { Label }
```

src/components/ui/modal.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: modal.tsx
3 |  * ëª©ì : ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ëª¨ë‹¬ UIë¥¼ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  */
7 | 
8 | "use client"
9 | 
10 | // import * as React from "react"
11 | 
12 | import {
13 |   Dialog,
14 |   DialogClose,
15 |   DialogContent,
16 |   DialogDescription,
17 |   DialogFooter,
18 |   DialogTitle,
19 |   DialogTrigger,
20 | } from "@/components/ui/dialog"
21 | 
22 | const Modal = {
23 |   Root: Dialog,
24 |   Trigger: DialogTrigger,
25 |   Content: DialogContent,
26 |   Title: DialogTitle,
27 |   Description: DialogDescription,
28 |   Footer: DialogFooter,
29 |   Close: DialogClose,
30 | }
31 | 
32 | export { Modal } 
```

src/components/ui/portal.tsx
```
1 | "use client";
2 | 
3 | import { useEffect, useState } from 'react'
4 | 
5 | import { createPortal } from 'react-dom'
6 | 
7 | interface PortalProps {
8 |   children: React.ReactNode
9 | }
10 | 
11 | export function Portal({ children }: PortalProps) {
12 |   const [mounted, setMounted] = useState(false)
13 | 
14 |   useEffect(() => {
15 |     setMounted(true)
16 |     return () => setMounted(false)
17 |   }, [])
18 | 
19 |   return mounted
20 |     ? createPortal(children, document.body)
21 |     : null
22 | } 
```

src/components/ui/radio-group.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
6 | import { CircleIcon } from "lucide-react"
7 | 
8 | import { cn } from "@/lib/utils"
9 | 
10 | function RadioGroup({
11 |   className,
12 |   ...props
13 | }: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
14 |   return (
15 |     <RadioGroupPrimitive.Root
16 |       data-slot="radio-group"
17 |       className={cn("grid gap-3", className)}
18 |       {...props}
19 |     />
20 |   )
21 | }
22 | 
23 | function RadioGroupItem({
24 |   className,
25 |   ...props
26 | }: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
27 |   return (
28 |     <RadioGroupPrimitive.Item
29 |       data-slot="radio-group-item"
30 |       className={cn(
31 |         "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
32 |         className
33 |       )}
34 |       {...props}
35 |     >
36 |       <RadioGroupPrimitive.Indicator
37 |         data-slot="radio-group-indicator"
38 |         className="relative flex items-center justify-center"
39 |       >
40 |         <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
41 |       </RadioGroupPrimitive.Indicator>
42 |     </RadioGroupPrimitive.Item>
43 |   )
44 | }
45 | 
46 | export { RadioGroup, RadioGroupItem }
```

src/components/ui/scroll-area.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"
6 | 
7 | import { cn } from "@/lib/utils"
8 | 
9 | function ScrollArea({
10 |   className,
11 |   children,
12 |   ...props
13 | }: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
14 |   return (
15 |     <ScrollAreaPrimitive.Root
16 |       data-slot="scroll-area"
17 |       className={cn("relative", className)}
18 |       {...props}
19 |     >
20 |       <ScrollAreaPrimitive.Viewport
21 |         data-slot="scroll-area-viewport"
22 |         className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
23 |       >
24 |         {children}
25 |       </ScrollAreaPrimitive.Viewport>
26 |       <ScrollBar />
27 |       <ScrollAreaPrimitive.Corner />
28 |     </ScrollAreaPrimitive.Root>
29 |   )
30 | }
31 | 
32 | function ScrollBar({
33 |   className,
34 |   orientation = "vertical",
35 |   ...props
36 | }: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
37 |   return (
38 |     <ScrollAreaPrimitive.ScrollAreaScrollbar
39 |       data-slot="scroll-area-scrollbar"
40 |       orientation={orientation}
41 |       className={cn(
42 |         "flex touch-none p-px transition-colors select-none",
43 |         orientation === "vertical" &&
44 |           "h-full w-2.5 border-l border-l-transparent",
45 |         orientation === "horizontal" &&
46 |           "h-2.5 flex-col border-t border-t-transparent",
47 |         className
48 |       )}
49 |       {...props}
50 |     >
51 |       <ScrollAreaPrimitive.ScrollAreaThumb
52 |         data-slot="scroll-area-thumb"
53 |         className="bg-border relative flex-1 rounded-full"
54 |       />
55 |     </ScrollAreaPrimitive.ScrollAreaScrollbar>
56 |   )
57 | }
58 | 
59 | export { ScrollArea, ScrollBar }
```

src/components/ui/separator.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as SeparatorPrimitive from "@radix-ui/react-separator"
6 | 
7 | import { cn } from "@/lib/utils"
8 | 
9 | function Separator({
10 |   className,
11 |   orientation = "horizontal",
12 |   decorative = true,
13 |   ...props
14 | }: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
15 |   return (
16 |     <SeparatorPrimitive.Root
17 |       data-slot="separator-root"
18 |       decorative={decorative}
19 |       orientation={orientation}
20 |       className={cn(
21 |         "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",
22 |         className
23 |       )}
24 |       {...props}
25 |     />
26 |   )
27 | }
28 | 
29 | export { Separator }
```

src/components/ui/skeleton.tsx
```
1 | import { cn } from "@/lib/utils"
2 | 
3 | function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
4 |   return (
5 |     <div
6 |       data-slot="skeleton"
7 |       className={cn("bg-primary/10 animate-pulse rounded-md", className)}
8 |       {...props}
9 |     />
10 |   )
11 | }
12 | 
13 | export { Skeleton }
```

src/components/ui/slider.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as SliderPrimitive from "@radix-ui/react-slider"
6 | 
7 | import { cn } from "@/lib/utils"
8 | 
9 | function Slider({
10 |   className,
11 |   defaultValue,
12 |   value,
13 |   min = 0,
14 |   max = 100,
15 |   ...props
16 | }: React.ComponentProps<typeof SliderPrimitive.Root>) {
17 |   const _values = React.useMemo(
18 |     () =>
19 |       Array.isArray(value)
20 |         ? value
21 |         : Array.isArray(defaultValue)
22 |           ? defaultValue
23 |           : [min, max],
24 |     [value, defaultValue, min, max]
25 |   )
26 | 
27 |   return (
28 |     <SliderPrimitive.Root
29 |       data-slot="slider"
30 |       defaultValue={defaultValue}
31 |       value={value}
32 |       min={min}
33 |       max={max}
34 |       className={cn(
35 |         "relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",
36 |         className
37 |       )}
38 |       {...props}
39 |     >
40 |       <SliderPrimitive.Track
41 |         data-slot="slider-track"
42 |         className={cn(
43 |           "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"
44 |         )}
45 |       >
46 |         <SliderPrimitive.Range
47 |           data-slot="slider-range"
48 |           className={cn(
49 |             "bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full"
50 |           )}
51 |         />
52 |       </SliderPrimitive.Track>
53 |       {Array.from({ length: _values.length }, (_, index) => (
54 |         <SliderPrimitive.Thumb
55 |           data-slot="slider-thumb"
56 |           key={index}
57 |           className="border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
58 |         />
59 |       ))}
60 |     </SliderPrimitive.Root>
61 |   )
62 | }
63 | 
64 | export { Slider }
```

src/components/ui/sonner.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/ui/sonner.tsx
3 |  * ëª©ì : í† ìŠ¤íŠ¸ ì•Œë¦¼ UI ì»´í¬ë„ŒíŠ¸ ì œê³µ
4 |  * ì—­í• : ì•± ì „ì²´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¼ê´€ëœ í† ìŠ¤íŠ¸ ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬í˜„
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : next-themesì˜ useTheme ëŒ€ì‹  useAppStore(themeSlice) ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
7 |  */
8 | 
9 | "use client"
10 | 
11 | import { Toaster as Sonner, ToasterProps } from "sonner"
12 | import { useAppStore } from "@/store/useAppStore"
13 | 
14 | const Toaster = ({ ...props }: ToasterProps) => {
15 |   // next-themesì˜ useTheme ëŒ€ì‹  Zustand ìŠ¤í† ì–´ì—ì„œ í…Œë§ˆ ëª¨ë“œ ê°€ì ¸ì˜¤ê¸°
16 |   const themeMode = useAppStore(state => state.themeMode)
17 |   // themeModeëŠ” 'light' | 'dark' | 'system'ì´ë©°, sonnerì˜ theme íƒ€ì…ê³¼ í˜¸í™˜ë¨
18 |   const theme = themeMode || "system"
19 | 
20 |   return (
21 |     <Sonner
22 |       theme={theme as ToasterProps["theme"]}
23 |       className="toaster group"
24 |       toastOptions={{
25 |         classNames: {
26 |           toast:
27 |             "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
28 |           description: "group-[.toast]:text-muted-foreground",
29 |           actionButton:
30 |             "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground font-medium",
31 |           cancelButton:
32 |             "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground font-medium",
33 |         },
34 |       }}
35 |       {...props}
36 |     />
37 |   )
38 | }
39 | 
40 | export { Toaster }
```

src/components/ui/spinner.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/ui/spinner.tsx
3 |  * ëª©ì : ë¡œë”© ìƒíƒœë¥¼ í‘œì‹œí•˜ëŠ” ìŠ¤í”¼ë„ˆ ì»´í¬ë„ŒíŠ¸ ì œê³µ
4 |  * ì—­í• : ë¹„ë™ê¸° ì‘ì—… ì¤‘ì— ì‚¬ìš©ìì—ê²Œ ë¡œë”© ìƒíƒœë¥¼ í‘œì‹œ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  */
7 | 
8 | import { cn } from '@/lib/utils';
9 | 
10 | interface SpinnerProps {
11 |   size?: 'sm' | 'md' | 'lg';
12 |   className?: string;
13 | }
14 | 
15 | /**
16 |  * Spinner: ë¡œë”© ìƒíƒœë¥¼ í‘œì‹œí•˜ëŠ” ìŠ¤í”¼ë„ˆ ì»´í¬ë„ŒíŠ¸
17 |  * @param size ìŠ¤í”¼ë„ˆ í¬ê¸° (sm, md, lg)
18 |  * @param className ì¶”ê°€ CSS í´ë˜ìŠ¤
19 |  * @returns {JSX.Element} ìŠ¤í”¼ë„ˆ ì»´í¬ë„ŒíŠ¸
20 |  */
21 | export function Spinner({ size = 'md', className }: SpinnerProps) {
22 |   const sizeClasses = {
23 |     sm: 'h-4 w-4 border-2',
24 |     md: 'h-8 w-8 border-2',
25 |     lg: 'h-12 w-12 border-3',
26 |   };
27 | 
28 |   return (
29 |     <div
30 |       className={cn(
31 |         'animate-spin rounded-full border-solid border-primary border-t-transparent',
32 |         sizeClasses[size],
33 |         className
34 |       )}
35 |       aria-label="ë¡œë”© ì¤‘"
36 |       role="status"
37 |     />
38 |   );
39 | } 
```

src/components/ui/table.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import { cn } from "@/lib/utils"
6 | 
7 | function Table({ className, ...props }: React.ComponentProps<"table">) {
8 |   return (
9 |     <div
10 |       data-slot="table-container"
11 |       className="relative w-full overflow-x-auto"
12 |     >
13 |       <table
14 |         data-slot="table"
15 |         className={cn("w-full caption-bottom text-sm", className)}
16 |         {...props}
17 |       />
18 |     </div>
19 |   )
20 | }
21 | 
22 | function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
23 |   return (
24 |     <thead
25 |       data-slot="table-header"
26 |       className={cn("[&_tr]:border-b", className)}
27 |       {...props}
28 |     />
29 |   )
30 | }
31 | 
32 | function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
33 |   return (
34 |     <tbody
35 |       data-slot="table-body"
36 |       className={cn("[&_tr:last-child]:border-0", className)}
37 |       {...props}
38 |     />
39 |   )
40 | }
41 | 
42 | function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
43 |   return (
44 |     <tfoot
45 |       data-slot="table-footer"
46 |       className={cn(
47 |         "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
48 |         className
49 |       )}
50 |       {...props}
51 |     />
52 |   )
53 | }
54 | 
55 | function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
56 |   return (
57 |     <tr
58 |       data-slot="table-row"
59 |       className={cn(
60 |         "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
61 |         className
62 |       )}
63 |       {...props}
64 |     />
65 |   )
66 | }
67 | 
68 | function TableHead({ className, ...props }: React.ComponentProps<"th">) {
69 |   return (
70 |     <th
71 |       data-slot="table-head"
72 |       className={cn(
73 |         "text-muted-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
74 |         className
75 |       )}
76 |       {...props}
77 |     />
78 |   )
79 | }
80 | 
81 | function TableCell({ className, ...props }: React.ComponentProps<"td">) {
82 |   return (
83 |     <td
84 |       data-slot="table-cell"
[TRUNCATED]
```

src/components/ui/tabs.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as TabsPrimitive from "@radix-ui/react-tabs"
6 | 
7 | import { cn } from "@/lib/utils"
8 | 
9 | function Tabs({
10 |   className,
11 |   ...props
12 | }: React.ComponentProps<typeof TabsPrimitive.Root>) {
13 |   return (
14 |     <TabsPrimitive.Root
15 |       data-slot="tabs"
16 |       className={cn("flex flex-col gap-2", className)}
17 |       {...props}
18 |     />
19 |   )
20 | }
21 | 
22 | function TabsList({
23 |   className,
24 |   ...props
25 | }: React.ComponentProps<typeof TabsPrimitive.List>) {
26 |   return (
27 |     <TabsPrimitive.List
28 |       data-slot="tabs-list"
29 |       className={cn(
30 |         "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",
31 |         className
32 |       )}
33 |       {...props}
34 |     />
35 |   )
36 | }
37 | 
38 | function TabsTrigger({
39 |   className,
40 |   ...props
41 | }: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
42 |   return (
43 |     <TabsPrimitive.Trigger
44 |       data-slot="tabs-trigger"
45 |       className={cn(
46 |         "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
47 |         className
48 |       )}
49 |       {...props}
50 |     />
51 |   )
52 | }
53 | 
54 | function TabsContent({
55 |   className,
56 |   ...props
57 | }: React.ComponentProps<typeof TabsPrimitive.Content>) {
58 |   return (
59 |     <TabsPrimitive.Content
60 |       data-slot="tabs-content"
61 |       className={cn("flex-1 outline-none", className)}
62 |       {...props}
63 |     />
64 |   )
65 | }
66 | 
67 | export { Tabs, TabsList, TabsTrigger, TabsContent }
```

src/components/ui/textarea.tsx
```
1 | import * as React from "react"
2 | 
3 | import { cn } from "@/lib/utils"
4 | 
5 | function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
6 |   return (
7 |     <textarea
8 |       data-slot="textarea"
9 |       className={cn(
10 |         "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
11 |         className
12 |       )}
13 |       {...props}
14 |     />
15 |   )
16 | }
17 | 
18 | export { Textarea }
```

src/components/ui/tooltip.tsx
```
1 | "use client"
2 | 
3 | import * as React from "react"
4 | 
5 | import * as TooltipPrimitive from "@radix-ui/react-tooltip"
6 | 
7 | import { cn } from "@/lib/utils"
8 | 
9 | function TooltipProvider({
10 |   delayDuration = 0,
11 |   ...props
12 | }: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
13 |   return (
14 |     <TooltipPrimitive.Provider
15 |       data-slot="tooltip-provider"
16 |       delayDuration={delayDuration}
17 |       {...props}
18 |     />
19 |   )
20 | }
21 | 
22 | function Tooltip({
23 |   ...props
24 | }: React.ComponentProps<typeof TooltipPrimitive.Root>) {
25 |   return (
26 |     <TooltipProvider>
27 |       <TooltipPrimitive.Root data-slot="tooltip" {...props} />
28 |     </TooltipProvider>
29 |   )
30 | }
31 | 
32 | function TooltipTrigger({
33 |   ...props
34 | }: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
35 |   return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />
36 | }
37 | 
38 | function TooltipContent({
39 |   className,
40 |   sideOffset = 0,
41 |   children,
42 |   ...props
43 | }: React.ComponentProps<typeof TooltipPrimitive.Content>) {
44 |   return (
45 |     <TooltipPrimitive.Portal>
46 |       <TooltipPrimitive.Content
47 |         data-slot="tooltip-content"
48 |         sideOffset={sideOffset}
49 |         className={cn(
50 |           "bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",
51 |           className
52 |         )}
53 |         {...props}
54 |       >
55 |         {children}
56 |         <TooltipPrimitive.Arrow className="bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
57 |       </TooltipPrimitive.Content>
58 |     </TooltipPrimitive.Portal>
59 |   )
60 | }
61 | 
62 | export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
```

src/lib/auth/server.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: /Users/wodory/Development/apps/backyard/src/lib/auth/server.ts
3 |  * ëª©ì : ì„œë²„ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ì¸ì¦ ê´€ë ¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì œê³µ
4 |  * ì—­í• : ì„œë²„ ì•¡ì…˜ì—ì„œ ì•ˆì „í•˜ê²Œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ì¸ì¦ ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-24
6 |  */
7 | 
8 | 'use server';
9 | 
10 | import createLogger from '@/lib/logger';
11 | import { createClient } from '@/lib/supabase/server';
12 | 
13 | // ë¡œê±° ìƒì„±
14 | const logger = createLogger('AuthServer');
15 | 
16 | /**
17 |  * serverSignInWithGoogle: ì„œë²„ì—ì„œ Google OAuth ë¡œê·¸ì¸ URL ìƒì„±
18 |  * @returns {Promise<{ success: boolean; url?: string; error?: string }>} ë¡œê·¸ì¸ ê²°ê³¼
19 |  */
20 | export async function serverSignInWithGoogle(): Promise<{ success: boolean; url?: string; error?: string }> {
21 |   try {
22 |     logger.info('ì„œë²„ì—ì„œ Google ë¡œê·¸ì¸ ì‹œì‘');
23 |     
24 |     // í˜„ì¬ í˜¸ìŠ¤íŠ¸ URL ì¶”ì¶œ (ì„œë²„ í™˜ê²½ì—ì„œëŠ” headers()ë¥¼ í†µí•´ ê°€ì ¸ì™€ì•¼ í•¨)
25 |     const headers = new Headers();
26 |     // ìš”ì²­ í—¤ë”ì—ì„œ í˜¸ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ í™˜ê²½ ë³€ìˆ˜ë‚˜ ì„¤ì •ì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤
27 |     const baseUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';
28 |     
29 |     // ë¦¬ë””ë ‰ì…˜ URL ì„¤ì •
30 |     const redirectUrl = `${baseUrl}/auth/callback`;
31 |     logger.info('ë¦¬ë””ë ‰ì…˜ URL ì„¤ì •', { redirectUrl });
32 |     
33 |     // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
34 |     const supabase = await createClient();
35 |     
36 |     // Google OAuth URL ìƒì„±
37 |     const { data, error } = await supabase.auth.signInWithOAuth({
38 |       provider: 'google',
39 |       options: {
40 |         redirectTo: redirectUrl,
41 |         queryParams: {
42 |           access_type: 'offline',
43 |           prompt: 'consent'
44 |         }
45 |       }
46 |     });
47 |     
48 |     if (error) {
49 |       logger.error('Google OAuth URL ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
50 |       throw error;
51 |     }
52 |     
53 |     if (!data.url) {
54 |       logger.error('OAuth URLì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
55 |       throw new Error('OAuth URLì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
56 |     }
57 |     
58 |     logger.info('ì„œë²„ì—ì„œ Google OAuth URL íšë“ ì„±ê³µ', { urlStart: data.url.substring(0, 30) + '...' });
59 |     return { success: true, url: data.url };
60 |     
61 |   } catch (error) {
62 |     const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
63 |     logger.error('ì„œë²„ì—ì„œ Google ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
64 |     return { success: false, error: errorMessage };
65 |   }
[TRUNCATED]
```

src/lib/supabase/client.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/lib/supabase/client.ts
3 |  * ëª©ì : í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ì œê³µ
4 |  * ì—­í• : í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ Supabaseì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©
5 |  * ì‘ì„±ì¼: 2025-04-09
6 |  * ìˆ˜ì •ì¼: 2024-05-08 : auth ì˜µì…˜ ë¸”ëŸ­ ì œê±°í•˜ì—¬ @supabase/ssr í‘œì¤€ ì¤€ìˆ˜
7 |  */
8 | 
9 | import { createBrowserClient } from '@supabase/ssr'
10 | 
11 | import { Database } from '@/types/supabase'
12 | 
13 | import createLogger from '../logger'
14 | 
15 | // ë¡œê±° ìƒì„±
16 | const logger = createLogger('SupabaseClient')
17 | 
18 | /**
19 |  * createClient: í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
20 |  * @returns Supabase í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤
21 |  */
22 | export function createClient() {
23 |   try {
24 |     const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
25 |     const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
26 |   
27 |     if (!supabaseUrl || !supabaseKey) {
28 |       logger.error('Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤')
29 |       throw new Error('Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤')
30 |     }
31 |   
32 |     // auth ì˜µì…˜ ì—†ì´ í˜¸ì¶œí•˜ì—¬ ë¯¸ë“¤ì›¨ì–´ ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬ ì‚¬ìš©
33 |     return createBrowserClient<Database>(
34 |       supabaseUrl,
35 |       supabaseKey
36 |     )
37 |   } catch (error) {
38 |     logger.error('í´ë¼ì´ì–¸íŠ¸ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì‹¤íŒ¨', error)
39 |     throw error
40 |   }
41 | } 
```

src/lib/supabase/middleware.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/lib/supabase/middleware.ts
3 |  * ëª©ì : Supabase ì¸ì¦ í† í° ìƒˆë¡œê³ ì¹¨ ì²˜ë¦¬
4 |  * ì—­í• : í† í° ë§Œë£Œ ì‹œ ìë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨í•˜ê³  ì¿ í‚¤ì— ì €ì¥
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-14 : íŒŒì¼ ê²½ë¡œ ë³€ê²½ (utils/supabase â†’ lib/supabase)
7 |  * ìˆ˜ì •ì¼: 2024-04-19 : ì¿ í‚¤ ì†ì„± ì¡°ì • - Vercel ë°°í¬ í™˜ê²½ í˜¸í™˜ì„± ê°œì„ 
8 |  * ìˆ˜ì •ì¼: 2024-04-19 : code_verifier ì¿ í‚¤ ê´€ë ¨ ì§„ë‹¨ ë¡œê·¸ ì¶”ê°€
9 |  */
10 | 
11 | import { NextResponse, type NextRequest } from 'next/server'
12 | 
13 | import { createServerClient, type CookieOptions } from '@supabase/ssr'
14 | 
15 | import { Database } from '@/types/supabase'
16 | 
17 | import createLogger from '../logger'
18 | 
19 | // ë¡œê±° ìƒì„±
20 | const logger = createLogger('SupabaseMiddleware')
21 | 
22 | /**
23 |  * updateSession: Supabase ì¸ì¦ í† í° ê°±ì‹  ë° ì¿ í‚¤ ì—…ë°ì´íŠ¸
24 |  * @param request NextRequest ê°ì²´
25 |  * @returns NextResponse ê°ì²´
26 |  */
27 | export async function updateSession(request: NextRequest) {
28 |   try {
29 |     // ì‘ë‹µ ê°ì²´ ìƒì„±
30 |     const response = NextResponse.next({
31 |       request: {
32 |         headers: request.headers,
33 |       },
34 |     })
35 | 
36 |     // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
37 |     const supabase = createServerClient<Database>(
38 |       process.env.NEXT_PUBLIC_SUPABASE_URL!,
39 |       process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
40 |       {
41 |         cookies: {
42 |           get(name: string) {
43 |             const value = request.cookies.get(name)?.value;
44 |             // code_verifier ì¿ í‚¤ ì§„ë‹¨ ë¡œê·¸
45 |             if (name.includes('code_verifier')) {
46 |               console.log('[Middleware Cookie Get] Getting code_verifier cookie:', { 
47 |                 name, 
48 |                 value: value ? value.substring(0, 10) + '...' : 'Not Found'
49 |               });
50 |             }
51 |             return value;
52 |           },
53 |           set(name: string, value: string, options: CookieOptions) {
54 |             // PKCE ì¸ì¦ íë¦„ì„ ìœ„í•œ code_verifier ì¿ í‚¤ ì²˜ë¦¬
55 |             if (name.includes('code_verifier')) {
56 |               logger.debug('ì½”ë“œ ê²€ì¦ê¸° ì¿ í‚¤ ì„¤ì •:', name.substring(0, 10) + '...')
57 |               // ì¿ í‚¤ ìˆ˜ëª…ì„ 10ë¶„ìœ¼ë¡œ ì„¤ì •
58 |               options.maxAge = 60 * 10
59 |               
60 |               // code_verifier ì¿ í‚¤ ì§„ë‹¨ ë¡œê·¸
61 |               console.log('[Middleware Cookie Set] Setting code_verifier cookie:', { 
62 |                 name, 
63 |                 value: value.substring(0, 10) + '...', 
64 |                 options 
65 |               });
66 |             }
67 |             
[TRUNCATED]
```

src/lib/supabase/server.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/lib/supabase/server.ts
3 |  * ëª©ì : ì„œë²„ í™˜ê²½ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ì œê³µ
4 |  * ì—­í• : ì„œë²„ ì»´í¬ë„ŒíŠ¸, ì„œë²„ ì•¡ì…˜, ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ Supabaseì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©
5 |  * ì‘ì„±ì¼: 2025-04-09
6 |  * ìˆ˜ì •ì¼: 2024-04-19 : ì¿ í‚¤ ì†ì„± ì¡°ì • - Vercel ë°°í¬ í™˜ê²½ í˜¸í™˜ì„± ê°œì„ 
7 |  * ìˆ˜ì •ì¼: 2024-04-19 : code_verifier ì¿ í‚¤ ê´€ë ¨ ì§„ë‹¨ ë¡œê·¸ ì¶”ê°€
8 |  */
9 | 
10 | import { cookies } from 'next/headers'
11 | 
12 | import { createServerClient, type CookieOptions } from '@supabase/ssr'
13 | 
14 | import { Database } from '@/types/supabase'
15 | 
16 | import createLogger from '../logger'
17 | 
18 | // ë¡œê±° ìƒì„±
19 | const logger = createLogger('SupabaseServer')
20 | 
21 | /**
22 |  * createClient: ì„œë²„ í™˜ê²½ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
23 |  * @returns Supabase í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤
24 |  */
25 | export async function createClient() {
26 |   try {
27 |     const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
28 |     const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
29 |   
30 |     if (!supabaseUrl || !supabaseKey) {
31 |       logger.error('Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤')
32 |       throw new Error('Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤')
33 |     }
34 |   
35 |     return createServerClient<Database>(
36 |       supabaseUrl,
37 |       supabaseKey,
38 |       {
39 |         cookies: {
40 |           async get(name: string) {
41 |             const cookieStore = await cookies()
42 |             const value = cookieStore.get(name)?.value;
43 |             // code_verifier ì¿ í‚¤ ì§„ë‹¨ ë¡œê·¸
44 |             if (name.includes('code_verifier')) {
45 |               console.log('[Server Cookie Get] Getting code_verifier cookie:', { 
46 |                 name, 
47 |                 value: value ? value.substring(0, 10) + '...' : 'Not Found' 
48 |               });
49 |             }
50 |             return value;
51 |           },
52 |           async set(name: string, value: string, options: CookieOptions) {
53 |             try {
54 |               const cookieStore = await cookies()
55 |               // PKCE ì¸ì¦ íë¦„ì„ ìœ„í•œ code_verifier ì¿ í‚¤ ì²˜ë¦¬
56 |               if (name.includes('code_verifier')) {
57 |                 logger.debug('ì„œë²„: ì½”ë“œ ê²€ì¦ê¸° ì¿ í‚¤ ì„¤ì •:', name.substring(0, 12) + '...')
58 |                 // ì¿ í‚¤ ìˆ˜ëª…ì„ 10ë¶„ìœ¼ë¡œ ì„¤ì •
59 |                 options.maxAge = 60 * 10
60 |                 
61 |                 // code_verifier ì¿ í‚¤ ì§„ë‹¨ ë¡œê·¸
62 |                 console.log('[Server Cookie Set] Setting code_verifier cookie:', { 
63 |                   name, 
64 |                   value: value.substring(0, 10) + '...', 
65 |                   options 
66 |                 });
[TRUNCATED]
```

src/tests/integration/auth-flow.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/tests/integration/auth-flow.test.tsx
3 |  * ëª©ì : Supabase ì¸ì¦ íë¦„ í†µí•© í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : OAuth ë¡œê·¸ì¸, ì½œë°± ì²˜ë¦¬, ë¡œê·¸ì•„ì›ƒ ê³¼ì • ê²€ì¦
5 |  * ì‘ì„±ì¼: 2024-05-01
6 |  * ìˆ˜ì •ì¼: 2024-05-01 : AuthContext ëª¨í‚¹ ë°©ì‹ ìˆ˜ì • ë° signInWithGoogle ë°˜í™˜ íƒ€ì… ì¡°ì •
7 |  * ìˆ˜ì •ì¼: 2024-06-05 : auth-flow.test.tsì™€ í†µí•©
8 |  */
9 | 
10 | import { useRouter, usePathname } from 'next/navigation'
11 | import type { AppRouterInstance } from 'next/dist/shared/lib/app-router-context.shared-runtime';
12 | 
13 | import { render, screen, waitFor } from '@testing-library/react'
14 | import userEvent from '@testing-library/user-event'
15 | import { describe, it, expect, vi, beforeEach } from 'vitest'
16 | 
17 | // ì‹¤ì œ ëª¨ë“ˆ ëª¨í‚¹
18 | vi.mock('next/navigation', () => ({
19 |     useRouter: vi.fn(),
20 |     usePathname: vi.fn()
21 | }))
22 | 
23 | // Auth ëª¨ë“ˆ ëª¨í‚¹
24 | const mockSignInWithGoogle = vi.fn()
25 | const mockSignOut = vi.fn()
26 | 
27 | vi.mock('@/lib/auth', () => ({
28 |     signInWithGoogle: () => mockSignInWithGoogle(),
29 |     signOut: () => mockSignOut()
30 | }))
31 | 
32 | // AuthContext íƒ€ì… ì •ì˜
33 | interface AuthContextType {
34 |     user: any;
35 |     loading: boolean;
36 |     session?: any;
37 |     signOut?: typeof mockSignOut;
38 |     codeVerifier?: string | null;
39 |     error?: any;
40 |     setCodeVerifier?: (code: string) => void;
41 | }
42 | 
43 | // useAuth mock í•¨ìˆ˜
44 | const useAuth = vi.fn();
45 | 
46 | // AuthContext ëª¨í‚¹
47 | vi.mock('@/context/AuthContext', () => {
48 |     return {
49 |         useAuth: vi.fn(),
50 |         AuthProvider: ({ children }: { children: React.ReactNode }) => <div>{children}</div>
51 |     }
52 | })
53 | 
54 | // STORAGE_KEYS ì •ì˜
55 | const STORAGE_KEYS = {
56 |     ACCESS_TOKEN: 'sb-access-token',
57 |     REFRESH_TOKEN: 'sb-refresh-token',
58 |     CODE_VERIFIER: 'code_verifier'
59 | };
60 | 
61 | // localStorage ëª¨í‚¹ í•¨ìˆ˜
62 | const getAuthData = (key: string) => localStorage.getItem(key);
63 | const setAuthData = (key: string, value: string) => localStorage.setItem(key, value);
64 | const clearTestEnvironment = () => {
65 |     localStorage.clear();
66 |     sessionStorage.clear();
67 | };
68 | 
69 | // íƒ€ì… ì •ì˜
70 | interface AuthOptions {
71 |     queryParams?: {
[TRUNCATED]
```

src/tests/integration/card-flow.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/tests/integration/card-flow.test.tsx
3 |  * ëª©ì : ì¹´ë“œ ê´€ë ¨ CRUD ê¸°ëŠ¥ í†µí•© í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì¹´ë“œ ìƒì„±/ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œ ê³¼ì • ê²€ì¦
5 |  * ì‘ì„±ì¼: 2024-05-01
6 |  */
7 | 
8 | import { render, screen, waitFor } from '@testing-library/react'
9 | import userEvent from '@testing-library/user-event'
10 | import { describe, it, expect, vi, beforeEach } from 'vitest'
11 | import { http, HttpResponse } from 'msw'
12 | 
13 | // MSW ì„œë²„ ê°€ì ¸ì˜¤ê¸°
14 | import { server } from '@/tests/msw/server'
15 | import { createMockCard } from '@/tests/msw/handlers'
16 | 
17 | // í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹°
18 | import { renderWithProviders } from '@/tests/test-utils'
19 | 
20 | // ì¹´ë“œ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
21 | import CardList from '@/components/cards/CardList'
22 | import CreateCardModal from '@/components/cards/CreateCardModal'
23 | import { Card } from '@/types'
24 | 
25 | // Zustand ìŠ¤í† ì–´ì™€ í›… ëª¨í‚¹
26 | vi.mock('@/hooks/useCards', () => ({
27 |     useCards: () => ({
28 |         data: [
29 |             createMockCard('card-1'),
30 |             createMockCard('card-2'),
31 |             { ...createMockCard('card-3'), title: 'ìˆ˜ì •ë  ì¹´ë“œ' }
32 |         ],
33 |         isLoading: false,
34 |         error: null
35 |     })
36 | }))
37 | 
38 | vi.mock('@/hooks/useCard', () => ({
39 |     useCard: (id: string) => ({
40 |         data: createMockCard(id),
41 |         isLoading: false,
42 |         error: null
43 |     })
44 | }))
45 | 
46 | vi.mock('@/hooks/useCreateCard', () => ({
47 |     useCreateCard: () => ({
48 |         mutate: vi.fn((newCard) => {
49 |             return Promise.resolve({
50 |                 id: 'new-card-id',
51 |                 ...newCard
52 |             })
53 |         }),
54 |         isLoading: false,
55 |         error: null,
56 |         isSuccess: true
57 |     })
58 | }))
59 | 
60 | vi.mock('@/hooks/useUpdateCard', () => ({
61 |     useUpdateCard: () => ({
62 |         mutate: vi.fn((updates) => {
63 |             return Promise.resolve({
64 |                 id: 'card-3',
65 |                 ...createMockCard('card-3'),
66 |                 ...updates
67 |             })
68 |         }),
69 |         isLoading: false,
70 |         error: null,
71 |         isSuccess: true
72 |     })
73 | }))
74 | 
75 | vi.mock('@/hooks/useDeleteCard', () => ({
76 |     useDeleteCard: () => ({
77 |         mutate: vi.fn(() => Promise.resolve()),
78 |         isLoading: false,
79 |         error: null,
80 |         isSuccess: true
81 |     })
82 | }))
83 | 
[TRUNCATED]
```

src/tests/integration/ideamap-flow.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/tests/integration/ideamap-flow.test.tsx
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ ê´€ë ¨ ì‚¬ìš©ì íë¦„ í†µí•© í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µì—ì„œ ì¹´ë“œ ì¶”ê°€ ë° ì‚­ì œ ì‹œ UIì™€ ë°ì´í„° ë™ê¸°í™” ê²€ì¦
5 |  * ì‘ì„±ì¼: 2024-06-03
6 |  * ìˆ˜ì •ì¼: 2024-06-03 : MSW v2 ë¬¸ë²• ì ìš© ë° íƒ€ì… ì˜¤ë¥˜ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2024-06-05 : í…ŒìŠ¤íŠ¸ ì½”ë“œ ìˆ˜ì • ë° íƒ€ì… ì˜¤ë¥˜ í•´ê²°
8 |  */
9 | 
10 | import { describe, test, expect, beforeAll, afterAll, afterEach, vi } from 'vitest';
11 | import { render, screen, fireEvent, waitFor } from '@testing-library/react';
12 | import userEvent from '@testing-library/user-event';
13 | import { http, HttpResponse } from 'msw';
14 | import { setupServer } from 'msw/node';
15 | import '@testing-library/jest-dom';
16 | 
17 | // ReactFlow ëª¨ì˜ ì»´í¬ë„ŒíŠ¸
18 | const MockReactFlow = ({ children }: { children: React.ReactNode }) => (
19 |     <div data-testid="idea-map-container">{children}</div>
20 | );
21 | 
22 | // ëª¨í‚¹ ì„¤ì •
23 | vi.mock('@xyflow/react', () => ({
24 |     Background: () => <div data-testid="background">Background</div>,
25 |     Controls: () => <div data-testid="controls">Controls</div>,
26 |     Handle: ({ type, position }: { type: string; position: string }) => (
27 |         <div data-testid={`handle-${type}-${position}`}></div>
28 |     ),
29 |     default: MockReactFlow
30 | }));
31 | 
32 | // RecoilRoot ëª¨ì˜ ì»´í¬ë„ŒíŠ¸
33 | const MockRecoilRoot = ({ children }: { children: React.ReactNode }) => (
34 |     <div data-testid="recoil-root">{children}</div>
35 | );
36 | 
37 | vi.mock('recoil', () => ({
38 |     RecoilRoot: ({ children }: { children: React.ReactNode }) => <MockRecoilRoot>{children}</MockRecoilRoot>,
39 |     atom: () => ({ key: 'mockAtom' }),
40 |     useRecoilState: () => [[], vi.fn()],
41 |     useRecoilValue: () => []
42 | }));
43 | 
44 | // íƒ€ì… ì •ì˜
45 | interface CardType {
46 |     id: string;
47 |     title: string;
48 |     content: string;
49 |     tags: string[];
50 |     createdAt: string;
51 | }
52 | 
53 | interface NodeType {
54 |     id: string;
55 |     type: string;
56 |     data: {
57 |         cardId: string;
58 |     };
59 |     position: {
60 |         x: number;
61 |         y: number;
62 |     };
63 | }
64 | 
65 | interface EdgeType {
66 |     id: string;
67 |     source: string;
68 |     target: string;
69 |     type: string;
70 | }
71 | 
[TRUNCATED]
```

src/tests/integration/tag-flow.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/tests/integration/tag-flow.test.tsx
3 |  * ëª©ì : íƒœê·¸ ê´€ë ¨ ê¸°ëŠ¥ í†µí•© í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : íƒœê·¸ ìƒì„±/ì‚­ì œ ë° íƒœê·¸ë³„ í•„í„°ë§ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2024-05-01
6 |  */
7 | 
8 | import { render, screen, waitFor } from '@testing-library/react'
9 | import userEvent from '@testing-library/user-event'
10 | import { describe, it, expect, vi, beforeEach } from 'vitest'
11 | import { http, HttpResponse } from 'msw'
12 | 
13 | // MSW ì„œë²„ ê°€ì ¸ì˜¤ê¸°
14 | import { server } from '@/tests/msw/server'
15 | 
16 | // ëª¨ì˜ ë Œë” í•¨ìˆ˜
17 | import { renderWithProviders } from '../test-utils'
18 | 
19 | // íƒœê·¸ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
20 | import TagList from '@/components/tags/TagList'
21 | import TagForm from '@/components/tags/TagForm'
22 | import TagFilter from '@/components/tags/TagFilter'
23 | 
24 | // ëª¨ì˜ íƒœê·¸ ë°ì´í„°
25 | const mockTags = [
26 |     { id: 'tag-1', name: 'ì¤‘ìš”' },
27 |     { id: 'tag-2', name: 'ì‘ì—…' },
28 |     { id: 'tag-3', name: 'ì•„ì´ë””ì–´' }
29 | ]
30 | 
31 | // Zustand ìŠ¤í† ì–´ì™€ í›… ëª¨í‚¹
32 | vi.mock('@/hooks/useTags', () => ({
33 |     useTags: () => ({
34 |         data: mockTags,
35 |         isLoading: false,
36 |         error: null
37 |     })
38 | }))
39 | 
40 | vi.mock('@/hooks/useCreateTag', () => {
41 |     const mockMutate = vi.fn((name) => {
42 |         return Promise.resolve({
43 |             id: `new-tag-${Date.now()}`,
44 |             name
45 |         })
46 |     })
47 | 
48 |     return {
49 |         useCreateTag: () => ({
50 |             mutate: mockMutate,
51 |             isLoading: false,
52 |             error: null,
53 |             isSuccess: true
54 |         })
55 |     }
56 | })
57 | 
58 | vi.mock('@/hooks/useDeleteTag', () => {
59 |     const mockMutate = vi.fn((id) => Promise.resolve())
60 | 
61 |     return {
62 |         useDeleteTag: () => ({
63 |             mutate: mockMutate,
64 |             isLoading: false,
65 |             error: null,
66 |             isSuccess: true
67 |         })
68 |     }
69 | })
70 | 
71 | // Next.js í›… ëª¨í‚¹
72 | vi.mock('next/navigation', () => ({
73 |     useRouter: () => ({
74 |         push: vi.fn(),
75 |         replace: vi.fn(),
76 |         prefetch: vi.fn()
77 |     }),
78 |     useSearchParams: () => ({
79 |         get: vi.fn((param) => param === 'tag' ? 'ì‘ì—…' : null),
[TRUNCATED]
```

src/tests/mocks/additional-mocks.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: additional-mocks.ts
3 |  * ëª©ì : í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ì¶”ê°€ ëª¨í‚¹ í•¨ìˆ˜ ì œê³µ
4 |  * ì—­í• : ê¸°ì¡´ ëª¨í‚¹ì— í¬í•¨ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë½ëœ ëª¨ë“ˆì„ ëª¨í‚¹
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-05 : ë¦°í„° ì˜¤ë¥˜ ìˆ˜ì • - Function íƒ€ì…ì„ êµ¬ì²´ì ì¸ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ë¡œ ë³€ê²½ ë° ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë³€ìˆ˜ ì œê±°
7 |  */
8 | 
9 | import { vi } from 'vitest';
10 | 
11 | /**
12 |  * mockEnvironment: í™˜ê²½ ê°ì§€ ê´€ë ¨ í•¨ìˆ˜ ëª¨í‚¹
13 |  * @returns ëª¨í‚¹ëœ í™˜ê²½ ê°ì§€ ìœ í‹¸ë¦¬í‹°
14 |  */
15 | export const mockEnvironment = () => {
16 |   const mock = {
17 |     isClient: vi.fn().mockReturnValue(true),
18 |     isServer: vi.fn().mockReturnValue(false),
19 |     executeOnClient: vi.fn((fn: () => void) => fn?.()),
20 |     executeOnServer: vi.fn(),
21 |     toggleEnvironment: (isClientEnvironment: boolean) => {
22 |       mock.isClient.mockReturnValue(isClientEnvironment);
23 |       mock.isServer.mockReturnValue(!isClientEnvironment);
24 |       
25 |       if (isClientEnvironment) {
26 |         mock.executeOnClient.mockImplementation((fn: () => void) => fn?.());
27 |         mock.executeOnServer.mockImplementation(() => {});
28 |       } else {
29 |         mock.executeOnClient.mockImplementation(() => {});
30 |         mock.executeOnServer.mockImplementation((fn: () => void) => fn?.());
31 |       }
32 |     }
33 |   };
34 |   
35 |   return mock;
36 | };
37 | 
38 | /**
39 |  * mockAuth: ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜ ëª¨í‚¹
40 |  * @returns ëª¨í‚¹ëœ ì¸ì¦ ìœ í‹¸ë¦¬í‹°
41 |  */
42 | export const mockAuth = () => {
43 |   return {
44 |     generateCodeVerifier: vi.fn().mockReturnValue('test-code-verifier'),
45 |     generateCodeChallenge: vi.fn().mockResolvedValue('test-code-challenge'),
46 |     googleLogin: vi.fn().mockImplementation(() => {
47 |       // URL ì—…ë°ì´íŠ¸ ëª¨í‚¹
48 |       window.location.href = 'https://accounts.google.com/o/oauth2/v2/auth?code_challenge=test-code-challenge&code_challenge_method=S256';
49 |       return Promise.resolve();
50 |     }),
51 |     exchangeCodeForSession: vi.fn().mockResolvedValue({
52 |       access_token: 'test-access-token',
53 |       refresh_token: 'test-refresh-token',
54 |       expires_in: 3600
55 |     })
56 |   };
57 | };
58 | 
59 | /**
60 |  * mockBase64: Base64 ì¸ì½”ë”© ìœ í‹¸ë¦¬í‹° ëª¨í‚¹
61 |  * @returns ëª¨í‚¹ëœ Base64 ìœ í‹¸ë¦¬í‹°
62 |  */
63 | export const mockBase64 = () => {
64 |   return {
65 |     base64UrlEncode: vi.fn().mockReturnValue('test-base64url-encoded-string')
66 |   };
67 | };
68 | 
69 | /**
70 |  * mockMiddleware: Next.js ë¯¸ë“¤ì›¨ì–´ ëª¨í‚¹
71 |  * @returns ëª¨í‚¹ëœ ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜
72 |  */
73 | export const mockMiddleware = () => {
[TRUNCATED]
```

src/tests/mocks/auth-mock.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: auth-mock.ts
3 |  * ëª©ì : ì¸ì¦ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ëª¨í‚¹ í•¨ìˆ˜ ì œê³µ
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ì¸ì¦ ê´€ë ¨ ëª¨í‚¹ ë°ì´í„° ë° ìœ í‹¸ë¦¬í‹° ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  */
7 | 
8 | /**
9 |  * generateMockCodeVerifier: PKCE ì½”ë“œ ê²€ì¦ê¸°ë¥¼ ëª¨ë°©í•˜ëŠ” ë¬¸ìì—´ ìƒì„±
10 |  * @returns {string} ëª¨ì˜ ì½”ë“œ ê²€ì¦ê¸° ë¬¸ìì—´
11 |  */
12 | export function generateMockCodeVerifier(): string {
13 |   const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';
14 |   let result = '';
15 |   
16 |   // 96ì ê¸¸ì´ì˜ ë¬´ì‘ìœ„ ë¬¸ìì—´ ìƒì„±
17 |   for (let i = 0; i < 96; i++) {
18 |     result += chars.charAt(Math.floor(Math.random() * chars.length));
19 |   }
20 |   
21 |   return result;
22 | }
23 | 
24 | /**
25 |  * generateMockAuthCode: OAuth ì¸ì¦ ì½”ë“œë¥¼ ëª¨ë°©í•˜ëŠ” ë¬¸ìì—´ ìƒì„±
26 |  * @returns {string} ëª¨ì˜ ì¸ì¦ ì½”ë“œ ë¬¸ìì—´
27 |  */
28 | export function generateMockAuthCode(): string {
29 |   return 'valid_code'; // í…ŒìŠ¤íŠ¸ì—ì„œ ìœ íš¨í•œ ì½”ë“œë¡œ ì¸ì‹ë˜ëŠ” íŠ¹ì • ë¬¸ìì—´
30 | }
31 | 
32 | /**
33 |  * mockSupabaseSession: Supabase ì„¸ì…˜ ê°ì²´ ëª¨í‚¹
34 |  * @param {string} userId ì‚¬ìš©ì ID
35 |  * @param {string} provider ì¸ì¦ ì œê³µì (ê¸°ë³¸ê°’: 'google')
36 |  * @returns {Object} ëª¨ì˜ ì„¸ì…˜ ê°ì²´
37 |  */
38 | export function mockSupabaseSession(
39 |   userId: string = 'test_user_id', 
40 |   provider: string = 'google'
41 | ): {
42 |   access_token: string;
43 |   refresh_token: string;
44 |   user: {
45 |     id: string;
46 |     app_metadata: {
47 |       provider: string;
48 |     };
49 |   };
50 | } {
51 |   return {
52 |     access_token: 'test_access_token',
53 |     refresh_token: 'test_refresh_token',
54 |     user: {
55 |       id: userId,
56 |       app_metadata: {
57 |         provider
58 |       }
59 |     }
60 |   };
61 | }
62 | 
63 | /**
64 |  * mockAuthError: ì¸ì¦ ì˜¤ë¥˜ ê°ì²´ ëª¨í‚¹
65 |  * @param {string} message ì˜¤ë¥˜ ë©”ì‹œì§€
66 |  * @param {number} status HTTP ìƒíƒœ ì½”ë“œ
67 |  * @returns {Object} ëª¨ì˜ ì˜¤ë¥˜ ê°ì²´
68 |  */
69 | export function mockAuthError(
70 |   message: string = 'Auth error',
71 |   status: number = 400
72 | ): {
73 |   message: string;
74 |   status: number;
75 | } {
76 |   return {
77 |     message,
78 |     status
79 |   };
80 | } 
```

src/tests/mocks/env-mock.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: env-mock.ts
3 |  * ëª©ì : í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í™˜ê²½ ëª¨í‚¹ ìœ í‹¸ë¦¬í‹°
4 |  * ì—­í• : ì„œë²„/í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ ê°ì§€ ê¸°ëŠ¥ ëª¨í‚¹
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  */
7 | 
8 | import { vi, MockInstance } from 'vitest';
9 | 
10 | /**
11 |  * window ê°ì²´ ëª¨í‚¹
12 |  * @returns ëª¨ì˜ window ê°ì²´
13 |  */
14 | export function mockWindow() {
15 |   return {
16 |     location: {
17 |       hostname: 'localhost',
18 |       protocol: 'http:',
19 |       port: '3000',
20 |       pathname: '/',
21 |       href: 'http://localhost:3000/',
22 |       origin: 'http://localhost:3000',
23 |       search: '',
24 |       hash: '',
25 |       assign: vi.fn(),
26 |       replace: vi.fn()
27 |     },
28 |     localStorage: {
29 |       getItem: vi.fn(),
30 |       setItem: vi.fn(),
31 |       removeItem: vi.fn(),
32 |       clear: vi.fn()
33 |     },
34 |     sessionStorage: {
35 |       getItem: vi.fn(),
36 |       setItem: vi.fn(),
37 |       removeItem: vi.fn(),
38 |       clear: vi.fn()
39 |     },
40 |     navigator: {
41 |       userAgent: 'Mozilla/5.0 (Test) Test/1.0',
42 |       language: 'ko-KR',
43 |     },
44 |     document: {
45 |       cookie: '',
46 |       createElement: vi.fn(),
47 |       querySelector: vi.fn(),
48 |       querySelectorAll: vi.fn(),
49 |       getElementById: vi.fn(),
50 |     },
51 |     fetch: vi.fn(),
52 |     addEventListener: vi.fn(),
53 |     removeEventListener: vi.fn(),
54 |     setTimeout: vi.fn(),
55 |     clearTimeout: vi.fn(),
56 |     crypto: {
57 |       getRandomValues: vi.fn(),
58 |       subtle: {
59 |         digest: vi.fn()
60 |       }
61 |     },
62 |     btoa: vi.fn((str: string) => Buffer.from(str).toString('base64')),
63 |     atob: vi.fn((str: string) => Buffer.from(str, 'base64').toString()),
64 |     __SUPABASE_AUTH_SET_ITEM: vi.fn(),
65 |     __SUPABASE_AUTH_GET_ITEM: vi.fn(),
66 |     __SUPABASE_AUTH_REMOVE_ITEM: vi.fn(),
67 |     __SUPABASE_AUTH_CODE_VERIFIER: null,
68 |   };
69 | }
70 | 
71 | /**
72 |  * process.env ëª¨í‚¹
73 |  * @returns ëª¨ì˜ process.env ê°ì²´
74 |  */
75 | export function mockProcessEnv(): Record<string, string> {
76 |   return {
77 |     NODE_ENV: 'test',
78 |     NEXT_PUBLIC_SUPABASE_URL: 'https://test-project.supabase.co',
79 |     NEXT_PUBLIC_SUPABASE_ANON_KEY: 'mock-anon-key',
80 |     NEXT_PUBLIC_OAUTH_REDIRECT_URL: 'http://localhost:3000',
81 |   };
[TRUNCATED]
```

src/tests/mocks/storage-mock.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: storage-mock.ts
3 |  * ëª©ì : ë¸Œë¼ìš°ì € ìŠ¤í† ë¦¬ì§€ API ëª¨í‚¹
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ìŠ¤í† ë¦¬ì§€ API ì‹œë®¬ë ˆì´ì…˜
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  */
7 | 
8 | import { vi } from 'vitest';
9 | 
10 | /**
11 |  * localStorage ëª¨í‚¹
12 |  * @returns ëª¨ì˜ localStorage ê°ì²´
13 |  */
14 | export function mockLocalStorage() {
15 |   const store: Record<string, string> = {};
16 | 
17 |   return {
18 |     getItem: vi.fn((key: string) => {
19 |       return store[key] || null;
20 |     }),
21 |     setItem: vi.fn((key: string, value: string) => {
22 |       store[key] = value;
23 |     }),
24 |     removeItem: vi.fn((key: string) => {
25 |       delete store[key];
26 |     }),
27 |     clear: vi.fn(() => {
28 |       Object.keys(store).forEach(key => {
29 |         delete store[key];
30 |       });
31 |     }),
32 |     key: vi.fn((index: number) => {
33 |       return Object.keys(store)[index] || null;
34 |     }),
35 |     length: vi.fn(() => {
36 |       return Object.keys(store).length;
37 |     }),
38 |     _getStore: () => ({ ...store }), // í…ŒìŠ¤íŠ¸ìš© ë‚´ë¶€ ë©”ì„œë“œ
39 |   };
40 | }
41 | 
42 | /**
43 |  * sessionStorage ëª¨í‚¹
44 |  * @returns ëª¨ì˜ sessionStorage ê°ì²´
45 |  */
46 | export function mockSessionStorage() {
47 |   return mockLocalStorage(); // ì¸í„°í˜ì´ìŠ¤ê°€ ë™ì¼í•˜ë¯€ë¡œ localStorage ëª¨í‚¹ ì¬ì‚¬ìš©
48 | }
49 | 
50 | /**
51 |  * ì¿ í‚¤ ëª¨í‚¹
52 |  * @returns ëª¨ì˜ document.cookie ì‘ì—…ì„ ìœ„í•œ ìœ í‹¸ë¦¬í‹°
53 |  */
54 | export function mockCookies() {
55 |   let cookies: Record<string, string> = {};
56 | 
57 |   return {
58 |     get: vi.fn((name: string) => {
59 |       return cookies[name] || null;
60 |     }),
61 |     getAll: vi.fn(() => {
62 |       return Object.entries(cookies).map(([name, value]) => ({ name, value }));
63 |     }),
64 |     set: vi.fn((name: string, value: string = {}) => {
65 |       cookies[name] = value;
66 |     }),
67 |     delete: vi.fn((name: string) => {
68 |       delete cookies[name];
69 |     }),
70 |     has: vi.fn((name: string) => {
71 |       return name in cookies;
72 |     }),
73 |     clear: vi.fn(() => {
74 |       cookies = {};
75 |     }),
76 |     _getAll: () => ({ ...cookies }), // í…ŒìŠ¤íŠ¸ìš© ë‚´ë¶€ ë©”ì„œë“œ
77 |   };
78 | }
79 | 
80 | /**
81 |  * Web Crypto API ëª¨í‚¹
[TRUNCATED]
```

src/tests/mocks/supabase-mock.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: supabase-mock.ts
3 |  * ëª©ì : Supabase í´ë¼ì´ì–¸íŠ¸ ëª¨í‚¹
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ Supabase ì¸ì¦ ë° API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : íƒ€ì… ì •ì˜ ê°œì„  - Function íƒ€ì…ì„ êµ¬ì²´ì ì¸ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ë¡œ ë³€ê²½
7 |  */
8 | 
9 | import { User, Session } from '@supabase/supabase-js';
10 | import { vi } from 'vitest';
11 | 
12 | /**
13 |  * ëª¨ì˜ Supabase ì„¸ì…˜ ìƒì„±
14 |  * @param userId ì‚¬ìš©ì ID
15 |  * @param provider ì¸ì¦ ê³µê¸‰ì
16 |  * @returns ëª¨ì˜ ì„¸ì…˜ ê°ì²´
17 |  */
18 | export function mockSupabaseSession(
19 |   userId: string = 'test_user_id', 
20 |   provider: string = 'google'
21 | ): Session {
22 |   return {
23 |     access_token: `mock_access_token_${userId}`,
24 |     refresh_token: `mock_refresh_token_${userId}`,
25 |     expires_in: 3600,
26 |     expires_at: Math.floor(Date.now() / 1000) + 3600,
27 |     token_type: 'bearer',
28 |     user: {
29 |       id: userId,
30 |       app_metadata: {
31 |         provider,
32 |         providers: [provider]
33 |       },
34 |       user_metadata: {
35 |         full_name: 'Test User',
36 |         avatar_url: 'https://example.com/avatar.png'
37 |       },
38 |       aud: 'authenticated',
39 |       created_at: new Date().toISOString(),
40 |       role: 'authenticated',
41 |       email: `${userId}@example.com`,
42 |     }
43 |   };
44 | }
45 | 
46 | /**
47 |  * ëª¨ì˜ Supabase ì‘ë‹µ ìƒì„±
48 |  * @param data ì‘ë‹µ ë°ì´í„°
49 |  * @param error ì‘ë‹µ ì˜¤ë¥˜
50 |  * @returns ëª¨ì˜ Supabase ì‘ë‹µ ê°ì²´
51 |  */
52 | export function mockSupabaseResponse<T>(data: T | null = null, error: Error | null = null) {
53 |   return { data, error };
54 | }
55 | 
56 | /**
57 |  * í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ Supabase ëª¨í‚¹
58 |  * @returns ëª¨ì˜ Supabase í´ë¼ì´ì–¸íŠ¸
59 |  */
60 | export function mockSupabaseBrowserClient() {
61 |   // ê¸°ë³¸ ì„¸ì…˜ ë° ì‚¬ìš©ì ìƒíƒœ
62 |   let currentSession: Session | null = null;
63 |   let currentUser: User | null = null;
64 |   let codeVerifier: string | null = null;
65 |   
66 |   // ìƒíƒœ ë³€ê²½ ì½œë°± ì €ì¥
67 |   // êµ¬ì²´ì ì¸ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ì •ì˜
68 |   const authStateChangeCallbacks: Array<(event: string, session: Session | null) => void> = [];
69 | 
70 |   return {
71 |     auth: {
72 |       getSession: vi.fn(() => {
[TRUNCATED]
```

src/components/editor/DocumentViewer.tsx
```
1 | 'use client';
2 | 
3 | import React, { useMemo, useEffect } from 'react';
4 | 
5 | import { Badge } from '@/components/ui/badge';
6 | import { Skeleton } from '@/components/ui/skeleton';
7 | 
8 | import TiptapViewer from './TiptapViewer';
9 | 
10 | // ì¹´ë“œ íƒ€ì… ì •ì˜
11 | interface CardData {
12 |   id: string;
13 |   title: string;
14 |   content: string;
15 |   createdAt?: string;
16 |   cardTags?: Array<{ id: string; tag: { id: string; name: string } }>;
17 | }
18 | 
19 | // ì»´í¬ë„ŒíŠ¸ props ì¸í„°í˜ì´ìŠ¤ ë‹¨ìˆœí™”
20 | interface DocumentViewerProps {
21 |   cards: CardData[];
22 |   isMultiSelection: boolean;
23 |   loading: boolean;
24 | }
25 | 
26 | export default function DocumentViewer({
27 |   cards,
28 |   isMultiSelection,
29 |   loading
30 | }: DocumentViewerProps) {
31 |   // ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€
32 |   useEffect(() => {
33 |     // ì¹´ë“œ ë‚´ìš©ì´ ë³€ê²½ë˜ë©´ ë¡œê·¸ ì¶œë ¥
34 |     if (cards && cards.length > 0) {
35 |       console.log('DocumentViewer ì¹´ë“œ ì—…ë°ì´íŠ¸ë¨:', {
36 |         ì¹´ë“œìˆ˜: cards.length,
37 |         ì²«ë²ˆì§¸ì¹´ë“œ: cards[0]?.id,
38 |         ë‚´ìš©ê¸¸ì´: cards[0]?.content?.length || 0,
39 |         ë‹¤ì¤‘ì„ íƒ: isMultiSelection
40 |       });
41 |     }
42 |   }, [cards, isMultiSelection]);
43 | 
44 |   // ë°ì´í„° ê°€ê³µ ë¡œì§ì„ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ë¡œ ì´ë™
45 |   const { content, tags } = useMemo(() => {
46 |     if (!cards || cards.length === 0) {
47 |       return { title: '', content: '', date: null, tags: [] };
48 |     }
49 | 
50 |     // ë‹¨ì¼ ì¹´ë“œ ì„ íƒ ëª¨ë“œ
51 |     if (!isMultiSelection || cards.length === 1) {
52 |       const card = cards[0];
53 |       return {
54 |         title: card.title || '',
55 |         content: card.content || '',
56 |         date: card.createdAt || null,
57 |         tags: card.cardTags ? card.cardTags.map(ct => ct.tag.name) : []
58 |       };
59 |     }
60 | 
61 |     // ë‹¤ì¤‘ ì¹´ë“œ ì„ íƒ ëª¨ë“œ - ì—¬ê¸°ì„œ ë³‘í•© ë¡œì§ ì²˜ë¦¬
62 |     const multiTitle = cards.map(card => card.title).join(', ');
63 |     // ì¹´ë“œ ë‚´ìš©ì„ HTMLë¡œ ë³‘í•©
64 |     const multiContent = cards.map(card => {
65 |       return card.content;
66 |     }).join('');
67 | 
68 |     return {
69 |       title: multiTitle,
70 |       content: multiContent,
71 |       date: null,
72 |       tags: []
73 |     };
74 |   }, [cards, isMultiSelection]);
75 | 
76 |   if (loading) {
77 |     return (
78 |       <div className="p-6 space-y-4">
[TRUNCATED]
```

src/components/editor/TiptapEditor.tsx
```
1 | "use client";
2 | 
3 | import React, { useCallback, useEffect } from 'react'
4 | 
5 | import Heading from '@tiptap/extension-heading'
6 | import Image from '@tiptap/extension-image'
7 | import Link from '@tiptap/extension-link'
8 | import Placeholder from '@tiptap/extension-placeholder'
9 | import { useEditor, EditorContent, BubbleMenu, FloatingMenu } from '@tiptap/react'
10 | import StarterKit from '@tiptap/starter-kit'
11 | import { 
12 |   Bold as BoldIcon,
13 |   Italic as ItalicIcon,
14 |   Link as LinkIcon,
15 |   Heading1 as H1Icon,
16 |   Heading2 as H2Icon,
17 |   List as ListIcon,
18 |   ListOrdered as OrderedListIcon,
19 |   Image as ImageIcon
20 | } from 'lucide-react'
21 | 
22 | import { Button } from '@/components/ui/button'
23 | 
24 | 
25 | interface TiptapEditorProps {
26 |   content: string
27 |   onChange: (content: string) => void
28 |   placeholder?: string
29 |   showToolbar?: boolean
30 |   id?: string
31 | }
32 | 
33 | export default function TiptapEditor({ 
34 |   content, 
35 |   onChange, 
36 |   placeholder = 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...', 
37 |   showToolbar = true,
38 |   id = 'tiptap-editor'
39 | }: TiptapEditorProps) {
40 |   const editor = useEditor({
41 |     extensions: [
42 |       StarterKit.configure({
43 |         bulletList: {
44 |           keepMarks: true,
45 |           keepAttributes: false,
46 |         },
47 |         orderedList: {
48 |           keepMarks: true,
49 |           keepAttributes: false,
50 |         },
51 |         heading: false,
52 |       }),
53 |       Link.configure({
54 |         openOnClick: false,
55 |       }),
56 |       Heading.configure({
57 |         levels: [1, 2, 3],
58 |       }),
59 |       Image,
60 |       Placeholder.configure({
61 |         placeholder: placeholder || 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...',
62 |       }),
63 |     ],
64 |     content: content,
65 |     immediatelyRender: false,
66 |     onUpdate: ({ editor }) => {
67 |       onChange(editor.getHTML());
68 |     },
69 |     editorProps: {
70 |       attributes: {
71 |         class: 'min-h-[150px] prose dark:prose-invert focus:outline-none max-w-none p-4 border rounded-md',
72 |       },
73 |     },
74 |   });
75 | 
76 |   useEffect(() => {
77 |     if (editor && content !== editor.getHTML()) {
78 |       editor.commands.setContent(content);
79 |     }
80 |   }, [content, editor]);
81 | 
82 |   const setLink = useCallback(() => {
83 |     if (!editor) return;
84 |     
85 |     const previousUrl = editor.getAttributes('link').href;
[TRUNCATED]
```

src/components/editor/TiptapViewer.tsx
```
1 | "use client";
2 | 
3 | import React from 'react';
4 | 
5 | import Heading from '@tiptap/extension-heading';
6 | import Image from '@tiptap/extension-image';
7 | import Link from '@tiptap/extension-link';
8 | import { useEditor, EditorContent } from '@tiptap/react';
9 | import StarterKit from '@tiptap/starter-kit';
10 | 
11 | interface TiptapViewerProps {
12 |   content: string;
13 | }
14 | 
15 | export default function TiptapViewer({ content }: TiptapViewerProps) {
16 |   const editor = useEditor({
17 |     extensions: [
18 |       StarterKit.configure({
19 |         heading: false,
20 |       }),
21 |       Link.configure({
22 |         openOnClick: true,
23 |       }),
24 |       Heading.configure({
25 |         levels: [1, 2],
26 |       }),
27 |       Image,
28 |     ],
29 |     content,
30 |     editable: false,
31 |     immediatelyRender: false,
32 |     editorProps: {
33 |       attributes: {
34 |         class: 'prose dark:prose-invert max-w-none',
35 |       },
36 |     },
37 |   });
38 | 
39 |   return <EditorContent editor={editor} />;
40 | } 
```

src/tests/msw/handlers.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: handlers.ts
3 |  * ëª©ì : MSW í•¸ë“¤ëŸ¬ ì •ì˜
4 |  * ì—­í• : API ìš”ì²­ì„ ê°€ë¡œì±„ê¸° ìœ„í•œ MSW í•¸ë“¤ëŸ¬ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-30
6 |  * ìˆ˜ì •ì¼: 2025-04-08
7 |  * ìˆ˜ì •ì¼: 2023-10-27 : ë¦°í„° ì˜¤ë¥˜ ìˆ˜ì • (ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±°)
8 |  * ìˆ˜ì •ì¼: 2024-05-01 : í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì¶”ê°€ í•¸ë“¤ëŸ¬ êµ¬í˜„
9 |  * ìˆ˜ì •ì¼: 2025-04-21 : ì¹´ë“œ ëŒ€ëŸ‰/ì¼ê´„ ì²˜ë¦¬ API í•¸ë“¤ëŸ¬ ì¶”ê°€
10 |  * ìˆ˜ì •ì¼: 2025-04-21 : íƒœê·¸ API í•¸ë“¤ëŸ¬ ëª¨ë“ˆí™” ë° í†µí•©
11 |  */
12 | 
13 | import { http, HttpResponse } from 'msw';
14 | import { tagHandlers } from './handlers/tagHandlers';
15 | 
16 | /**
17 |  * createMockSession: ëª¨ì˜ Supabase ì„¸ì…˜ ìƒì„±
18 |  * @param options - ì„¸ì…˜ ìƒì„± ì˜µì…˜
19 |  * @returns ëª¨ì˜ ì„¸ì…˜ ê°ì²´
20 |  */
21 | export function createMockSession(options: {
22 |   success?: boolean;
23 |   accessToken?: string;
24 |   refreshToken?: string;
25 |   userId?: string;
26 |   provider?: string;
27 |   errorMessage?: string;
28 | } = {}) {
29 |   const {
30 |     success = true,
31 |     accessToken = 'mock_access_token',
32 |     refreshToken = 'mock_refresh_token',
33 |     userId = 'mock_user_id',
34 |     provider = 'google',
35 |     errorMessage = 'ì¸ì¦ ì‹¤íŒ¨',
36 |   } = options;
37 | 
38 |   if (success) {
39 |     return {
40 |       data: {
41 |         session: {
42 |           access_token: accessToken,
43 |           refresh_token: refreshToken,
44 |           user: {
45 |             id: userId,
46 |             app_metadata: { provider }
47 |           }
48 |         }
49 |       },
50 |       error: null
51 |     };
52 |   } else {
53 |     return {
54 |       data: { session: null },
55 |       error: { message: errorMessage, status: 401 }
56 |     };
57 |   }
58 | }
59 | 
60 | /**
61 |  * ì¹´ë“œ ë°ì´í„° íƒ€ì…
62 |  */
63 | export interface CardData {
64 |   id: string;
65 |   title: string;
66 |   content: string;
67 |   cardTags: Array<{ id: string; name: string; }>;
68 | }
69 | 
70 | /**
71 |  * ì¹´ë“œ ë°ì´í„° ìƒì„± í•¨ìˆ˜
72 |  * @param id - ì¹´ë“œ ID
73 |  * @returns ì¹´ë“œ ë°ì´í„° ê°ì²´
74 |  */
75 | export function createMockCard(id: string = 'test-card-123'): CardData {
76 |   return {
77 |     id,
78 |     title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ',
79 |     content: 'í…ŒìŠ¤íŠ¸ ë‚´ìš©',
80 |     cardTags: []
81 |   };
82 | }
83 | 
84 | /**
85 |  * íƒœê·¸ ë°ì´í„° ìƒì„± í•¨ìˆ˜
[TRUNCATED]
```

src/tests/msw/server.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: server.ts
3 |  * ëª©ì : MSW í…ŒìŠ¤íŠ¸ ì„œë²„ ì„¤ì •
4 |  * ì—­í• : API ìš”ì²­ì„ ëª¨í‚¹í•˜ê¸° ìœ„í•œ MSW ì„œë²„ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-30
6 |  * ìˆ˜ì •ì¼: 2025-04-09
7 |  */
8 | 
9 | import { HttpResponse } from 'msw';
10 | import { setupServer } from 'msw/node';
11 | 
12 | import createLogger from '@/lib/logger';
13 | 
14 | import { handlers } from './handlers';
15 | 
16 | // ë¡œê±° ìƒì„±
17 | const logger = createLogger('MSWServer');
18 | 
19 | // MSW ì„œë²„ ì„¤ì •
20 | export const server = setupServer(...handlers);
21 | 
22 | // Node.js v20ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ìš”ì²­ì— ëŒ€í•œ ì¦‰ê° ì‘ë‹µ ì²˜ë¦¬
23 | server.events.on('request:start', ({ request }) => {
24 |   try {
25 |     // URL íŒ¨í„´ ê²€ì‚¬
26 |     const url = new URL(request.url);
27 |     
28 |     // ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” URL íŒ¨í„´ ì²˜ë¦¬
29 |     if (url.pathname.includes('problem-url')) {
30 |       logger.warn('ë¬¸ì œê°€ ìˆëŠ” URL ìš”ì²­ ê°ì§€, ì¦‰ì‹œ ì‘ë‹µ ì²˜ë¦¬', { url: url.toString() });
31 |       return HttpResponse.json({ error: 'Simulated error' }, { status: 500 });
32 |     }
33 |     
34 |     // auth ê´€ë ¨ ìš”ì²­ì€ ì¦‰ì‹œ ì‘ë‹µ ì²˜ë¦¬í•˜ì—¬ íƒ€ì„ì•„ì›ƒ ë°©ì§€
35 |     if (url.pathname.includes('/auth/v1/token')) {
36 |       logger.debug('ì¸ì¦ ê´€ë ¨ ìš”ì²­ ê°ì§€, ë¹ ë¥¸ ì‘ë‹µ ì²˜ë¦¬', { url: url.toString() });
37 |       return HttpResponse.json({
38 |         access_token: 'test_access_token',
39 |         refresh_token: 'test_refresh_token',
40 |         token_type: 'bearer',
41 |         expires_in: 3600,
42 |         user: {
43 |           id: 'test_user_id',
44 |           app_metadata: { provider: 'google' },
45 |           aud: 'authenticated',
46 |           email: 'test@example.com'
47 |         }
48 |       });
49 |     }
50 |     
51 |     return undefined;
52 |   } catch (error) {
53 |     logger.error('ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', { error });
54 |     return HttpResponse.json({ error: 'internal_error' }, { status: 500 });
55 |   }
56 | });
57 | 
58 | /**
59 |  * setupMSW: í…ŒìŠ¤íŠ¸ì—ì„œ MSW ì„œë²„ ì„¤ì •
60 |  * @returns ì •ë¦¬ í•¨ìˆ˜
61 |  */
62 | export function setupMSW() {
63 |   // í…ŒìŠ¤íŠ¸ ì „ ì„œë²„ ì‹œì‘
64 |   beforeEach(() => {
65 |     server.listen({ 
66 |       onUnhandledRequest: 'bypass' // warn ëŒ€ì‹  bypass ì‚¬ìš©
67 |     });
68 |     logger.info('MSW ì„œë²„ ì‹œì‘ë¨');
69 |   });
70 | 
71 |   // í…ŒìŠ¤íŠ¸ í›„ í•¸ë“¤ëŸ¬ ì´ˆê¸°í™”
72 |   afterEach(() => {
73 |     server.resetHandlers();
[TRUNCATED]
```

src/tests/theme/integration.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: integration.test.tsx
3 |  * ëª©ì : í…Œë§ˆ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ í†µí•© í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ThemeContextì™€ NodeSizeSettingsì˜ í†µí•© ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : ë¦°í„° ì˜¤ë¥˜ ìˆ˜ì • (ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±°)
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : ThemeContext ëŒ€ì‹  useAppStoreë¡œ ë³€ê²½
8 |  * ìˆ˜ì •ì¼: 2025-04-21 : useAppStore ëª¨í‚¹ ê²½ë¡œ ìˆ˜ì •
9 |  */
10 | 
11 | import React from 'react';
12 | 
13 | import { render, screen, fireEvent } from '@testing-library/react';
14 | import { describe, test, expect, vi, beforeEach, afterEach } from 'vitest';
15 | import '@testing-library/jest-dom/vitest';
16 | 
17 | // updateNodeSize ëª¨í‚¹ í•¨ìˆ˜
18 | const updateNodeSizeMock = vi.fn();
19 | const updateNodeInternalsMock = vi.fn();
20 | 
21 | // ReactFlow ëª¨í‚¹
22 | vi.mock('@xyflow/react', () => {
23 |   return {
24 |     useReactFlow: () => ({
25 |       getNodes: () => [{ id: 'node-1' }, { id: 'node-2' }],
26 |     }),
27 |     useUpdateNodeInternals: () => updateNodeInternalsMock,
28 |     ReactFlowProvider: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,
29 |   };
30 | });
31 | 
32 | // useAppStore ëª¨í‚¹
33 | vi.mock('@/store/useAppStore', () => {
34 |   return {
35 |     useAppStore: () => ({
36 |       themeMode: 'light',
37 |       ideaMapSettings: {
38 |         node: {
39 |           width: 220,
40 |           height: 48,
41 |           maxHeight: 180,
42 |           backgroundColor: '#ffffff',
43 |           borderColor: '#C1C1C1',
44 |           borderWidth: 1,
45 |           borderRadius: 8,
46 |           selectedBorderColor: '#0071e3',
47 |           font: {
48 |             family: 'Pretendard, sans-serif',
49 |             titleSize: 14,
50 |             contentSize: 12,
51 |             tagsSize: 10,
52 |           }
53 |         },
54 |         edge: {
55 |           color: '#C1C1C1',
56 |           width: 1,
57 |           selectedColor: '#0071e3',
58 |           animated: false,
59 |         },
60 |         handle: {
61 |           size: 8,
62 |           backgroundColor: '#ffffff',
63 |           borderColor: '#555555',
64 |           borderWidth: 1,
65 |         },
66 |         layout: {
67 |           spacing: {
68 |             horizontal: 30,
69 |             vertical: 30,
70 |           },
71 |           padding: 20,
72 |         },
73 |       },
74 |       toggleThemeMode: vi.fn(),
75 |       setThemeMode: vi.fn(),
76 |       updateNodeSize: updateNodeSizeMock,
77 |     }),
78 |   };
79 | });
80 | 
81 | // NodeSizeSettings ëª¨í‚¹
82 | vi.mock('../../components/settings/NodeSizeSettings', () => {
83 |   return {
84 |     NodeSizeSettings: () => {
85 |       React.useEffect(() => {
86 |         // ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„¤ì •
[TRUNCATED]
```

src/tests/utils/async-utils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: async-utils.ts
3 |  * ëª©ì : ë¹„ë™ê¸° í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° ì œê³µ
4 |  * ì—­í• : ë¹„ë™ê¸° í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-30
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : ESLint ì˜¤ë¥˜ ìˆ˜ì • (ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±°)
7 |  */
8 | 
9 | import { vi } from 'vitest';
10 | 
11 | /**
12 |  * flushPromises: ë¹„ë™ê¸° íì˜ ëª¨ë“  í”„ë¡œë¯¸ìŠ¤ë¥¼ í•´ê²°
13 |  * @returns {Promise<void>} ë¹„ë™ê¸° íê°€ ë¹„ì›Œì§ˆ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” í”„ë¡œë¯¸ìŠ¤
14 |  */
15 | export async function flushPromises(times = 1): Promise<void> {
16 |   for (let i = 0; i < times; i++) {
17 |     // í˜„ì¬ íì˜ ëª¨ë“  ë¹„ë™ê¸° ì‘ì—… ì‹¤í–‰
18 |     await new Promise(resolve => setTimeout(resolve, 0));
19 |   }
20 | }
21 | 
22 | /**
23 |  * runAllTimers: ëª¨ë“  íƒ€ì´ë¨¸ë¥¼ ì¦‰ì‹œ ì‹¤í–‰
24 |  * @returns {Promise<void>} íƒ€ì´ë¨¸ ì‹¤í–‰ ì™„ë£Œ ëŒ€ê¸°
25 |  */
26 | export async function runAllTimers(): Promise<void> {
27 |   // ëª¨ë“  íƒ€ì´ë¨¸ ì¦‰ì‹œ ì‹¤í–‰
28 |   vi.runAllTimers();
29 |   
30 |   // íƒ€ì´ë¨¸ ì´í›„ ë°œìƒí•œ ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬
31 |   await flushPromises();
32 | }
33 | 
34 | /**
35 |  * runTimersUntil: íŠ¹ì • ì¡°ê±´ì´ ì¶©ì¡±ë  ë•Œê¹Œì§€ íƒ€ì´ë¨¸ ì‹¤í–‰
36 |  * @param condition íƒ€ì´ë¨¸ ì¤‘ë‹¨ ì¡°ê±´
37 |  * @param options ì˜µì…˜ (ìµœëŒ€ íƒ€ì´ë¨¸, íƒ€ì„ì•„ì›ƒ)
38 |  */
39 | export async function runTimersUntil(
40 |   condition: () => boolean | Promise<boolean>,
41 |   options: { maxTimers?: number; timeout?: number } = {}
42 | ): Promise<void> {
43 |   const { maxTimers = 100, timeout = 5000 } = options;
44 |   const startTime = Date.now();
45 |   
46 |   for (let i = 0; i < maxTimers; i++) {
47 |     // íƒ€ì„ì•„ì›ƒ ì²´í¬
48 |     if (Date.now() - startTime > timeout) {
49 |       throw new Error(`íƒ€ì„ì•„ì›ƒ: ${timeout}ms ì•ˆì— ì¡°ê±´ì´ ì¶©ì¡±ë˜ì§€ ì•ŠìŒ`);
50 |     }
51 |     
52 |     // íƒ€ì´ë¨¸ ì‹¤í–‰ ë° ë¹„ë™ê¸° í ë¹„ìš°ê¸°
53 |     vi.advanceTimersByTime(100);
54 |     await flushPromises();
55 |     
56 |     // ì¡°ê±´ ì²´í¬
57 |     if (await condition()) {
58 |       return;
59 |     }
60 |   }
61 |   
62 |   throw new Error(`ìµœëŒ€ íƒ€ì´ë¨¸ ì‹¤í–‰(${maxTimers}) í›„ì—ë„ ì¡°ê±´ì´ ì¶©ì¡±ë˜ì§€ ì•ŠìŒ`);
63 | }
64 | 
65 | /**
66 |  * pollUntil: ì¡°ê±´ì´ ì¶©ì¡±ë  ë•Œê¹Œì§€ í´ë§
67 |  * @param condition í´ë§ ì¤‘ë‹¨ ì¡°ê±´
68 |  * @param options ì˜µì…˜ (ê°„ê²©, íƒ€ì„ì•„ì›ƒ, ìµœëŒ€ ì‹œë„ íšŸìˆ˜)
69 |  */
70 | export async function pollUntil<T>(
71 |   condition: () => T | Promise<T>,
[TRUNCATED]
```

src/tests/utils/react-flow-mock.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: react-flow-mock.ts
3 |  * ëª©ì : React Flow ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ëª¨í‚¹ ìœ í‹¸ë¦¬í‹°
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ React Flowì— í•„ìš”í•œ ë¸Œë¼ìš°ì € í™˜ê²½ API ëª¨í‚¹
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : any íƒ€ì…ì„ êµ¬ì²´ì ì¸ íƒ€ì…ìœ¼ë¡œ ë³€ê²½
7 |  */
8 | 
9 | // React Flow ê³µì‹ ë¬¸ì„œì—ì„œ ì œì‹œí•˜ëŠ” í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° êµ¬í˜„
10 | 
11 | /**
12 |  * ResizeObserver ëª¨ì˜ êµ¬í˜„
13 |  * ë¸Œë¼ìš°ì € í™˜ê²½ì´ ì•„ë‹Œ Jest/Vitestì—ì„œ ë™ì‘í•˜ê¸° ìœ„í•œ êµ¬í˜„ì²´
14 |  */
15 | class ResizeObserver {
16 |   callback: ResizeObserverCallback;
17 | 
18 |   constructor(callback: ResizeObserverCallback) {
19 |     this.callback = callback;
20 |   }
21 | 
22 |   observe(target: Element) {
23 |     this.callback([{ target } as ResizeObserverEntry], this);
24 |   }
25 | 
26 |   unobserve() {}
27 | 
28 |   disconnect() {}
29 | }
30 | 
31 | /**
32 |  * DOMMatrixReadOnly ëª¨ì˜ êµ¬í˜„
33 |  * ë¸Œë¼ìš°ì € í™˜ê²½ì´ ì•„ë‹Œ Jest/Vitestì—ì„œ ë™ì‘í•˜ê¸° ìœ„í•œ êµ¬í˜„ì²´
34 |  */
35 | class DOMMatrixReadOnly {
36 |   m22: number;
37 |   constructor(transform: string) {
38 |     const scale = transform?.match(/scale\(([1-9.])\)/)?.[1];
39 |     this.m22 = scale !== undefined ? +scale : 1;
40 |   }
41 | }
42 | 
43 | // ëª¨í‚¹ì´ í•œ ë²ˆë§Œ ì´ˆê¸°í™”ë˜ë„ë¡ í”Œë˜ê·¸ ê´€ë¦¬
44 | let init = false;
45 | 
46 | /**
47 |  * mockReactFlow: React Flowë¥¼ ëª¨í‚¹í•˜ëŠ” í•¨ìˆ˜
48 |  * Jest/Vitest í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ React Flow ì‚¬ìš© ì‹œ í•„ìš”í•œ ë¸Œë¼ìš°ì € API ëª¨í‚¹
49 |  */
50 | export const mockReactFlow = () => {
51 |   if (init) return;
52 |   init = true;
53 | 
54 |   // ì „ì—­ ê°ì²´ì— ResizeObserver ì¶”ê°€
55 |   global.ResizeObserver = ResizeObserver as unknown as typeof global.ResizeObserver;
56 | 
57 |   // ì „ì—­ ê°ì²´ì— DOMMatrixReadOnly ì¶”ê°€
58 |   global.DOMMatrixReadOnly = DOMMatrixReadOnly as unknown as typeof global.DOMMatrixReadOnly;
59 | 
60 |   // HTMLElementì— offsetHeight, offsetWidth ì†ì„± ì¶”ê°€
61 |   Object.defineProperties(global.HTMLElement.prototype, {
62 |     offsetHeight: {
63 |       get() {
64 |         return parseFloat(this.style.height) || 1;
65 |       },
66 |     },
67 |     offsetWidth: {
68 |       get() {
69 |         return parseFloat(this.style.width) || 1;
70 |       },
71 |     },
72 |   });
73 | 
74 |   // SVGElementì— getBBox ë©”ì„œë“œ ì¶”ê°€
75 |   (global.SVGElement.prototype as unknown as { getBBox: () => { x: number; y: number; width: number; height: number } }).getBBox = () => ({
76 |     x: 0,
[TRUNCATED]
```

src/app/api/cards/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/api/cards/route.ts
3 |  * ëª©ì : ì¹´ë“œ API ì—”ë“œí¬ì¸íŠ¸
4 |  * ì—­í• : ì¹´ë“œ ìƒì„± ë° ì¡°íšŒ ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-22
6 |  */
7 | 
8 | import { NextRequest, NextResponse } from 'next/server';
9 | 
10 | import { z } from 'zod';
11 | 
12 | import prisma from '@/lib/prisma';
13 | 
14 | // ì¹´ë“œ ìƒì„± ìŠ¤í‚¤ë§ˆ
15 | const createCardSchema = z.object({
16 |   title: z.string().min(1, 'ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.'),
17 |   content: z.string().optional(),
18 |   userId: z.string().uuid('ìœ íš¨í•œ ì‚¬ìš©ì IDê°€ í•„ìš”í•©ë‹ˆë‹¤.'),
19 |   tags: z.array(z.string()).optional()
20 | });
21 | 
22 | // íƒœê·¸ ì²˜ë¦¬ í•¨ìˆ˜
23 | async function processTagsForCard(cardId: string, tagNames: string[] = []) {
24 |   try {
25 |     // ì¤‘ë³µ íƒœê·¸ ì œê±° ë° ê³µë°± ì œê±°
26 |     const uniqueTags = [...new Set(tagNames.map(tag => tag.trim()))].filter(tag => tag.length > 0);
27 |     
28 |     // ì¹´ë“œì™€ ì—°ê²°ëœ ê¸°ì¡´ íƒœê·¸ ì‚­ì œ
29 |     await prisma.cardTag.deleteMany({
30 |       where: { cardId }
31 |     });
32 |     
33 |     // ê° íƒœê·¸ì— ëŒ€í•´ ì²˜ë¦¬
34 |     for (const tagName of uniqueTags) {
35 |       // íƒœê·¸ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê³ , ì—†ìœ¼ë©´ ìƒì„±
36 |       let tag = await prisma.tag.findUnique({
37 |         where: { name: tagName }
38 |       });
39 |       
40 |       if (!tag) {
41 |         tag = await prisma.tag.create({
42 |           data: { name: tagName }
43 |         });
44 |       }
45 |       
46 |       // ì¹´ë“œì™€ íƒœê·¸ ì—°ê²°
47 |       await prisma.cardTag.create({
48 |         data: {
49 |           cardId,
50 |           tagId: tag.id
51 |         }
52 |       });
53 |     }
54 |   } catch (error) {
55 |     console.error('íƒœê·¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
56 |     // íƒœê·¸ ì²˜ë¦¬ ì‹¤íŒ¨í•´ë„ íë¦„ ê³„ì† (íƒœê·¸ëŠ” í•„ìˆ˜ê°€ ì•„ë‹˜)
57 |   }
58 | }
59 | 
60 | // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì•ˆì „í•˜ê²Œ ìˆ˜í–‰í•˜ëŠ” ë˜í¼ í•¨ìˆ˜
61 | async function safeDbOperation<T>(operation: () => Promise<T>, errorMessage: string): Promise<{ data: T | null; error: string | null }> {
62 |   try {
63 |     const result = await operation();
64 |     return { data: result, error: null };
65 |   } catch (error) {
66 |     console.error(`${errorMessage}:`, error);
67 |     return { data: null, error: errorMessage };
68 |   }
69 | }
70 | 
71 | // ì¹´ë“œ ìƒì„± API
72 | export async function POST(request: NextRequest) {
73 |   try {
[TRUNCATED]
```

src/app/api/db-init/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/api/db-init/route.ts
3 |  * ëª©ì : ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ API ì—”ë“œí¬ì¸íŠ¸ ì œê³µ
4 |  * ì—­í• : ê°œë°œ í™˜ê²½ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” APIë¥¼ ì²˜ë¦¬
5 |  * ì‘ì„±ì¼: 2023-11-01
6 |  * ìˆ˜ì •ì¼: 2024-05-31 : ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” request ë§¤ê°œë³€ìˆ˜ ì œê±°
7 |  * ìˆ˜ì •ì¼: 2024-06-26 : ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” NextRequest import ì œê±°
8 |  */
9 | import { NextResponse } from 'next/server';
10 | 
11 | import { initDatabase } from '@/lib/db-init';
12 | 
13 | /**
14 |  * DB ì´ˆê¸°í™” API ì—”ë“œí¬ì¸íŠ¸
15 |  * ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
16 |  */
17 | export async function GET() {
18 |   // ê°œë°œ í™˜ê²½ì¸ì§€ í™•ì¸
19 |   if (process.env.NODE_ENV !== 'development') {
20 |     return NextResponse.json(
21 |       { error: 'ì´ APIëŠ” ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.' },
22 |       { status: 403 }
23 |     );
24 |   }
25 | 
26 |   try {
27 |     await initDatabase();
28 |     
29 |     return NextResponse.json(
30 |       { success: true, message: 'ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' },
31 |       { status: 200 }
32 |     );
33 |   } catch (error) {
34 |     console.error('DB ì´ˆê¸°í™” API ì˜¤ë¥˜:', error);
35 |     
36 |     return NextResponse.json(
37 |       { 
38 |         success: false, 
39 |         message: 'ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 
40 |         error: error instanceof Error ? error.message : String(error) 
41 |       },
42 |       { status: 500 }
43 |     );
44 |   }
45 | } 
```

src/app/api/health-check/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/api/health-check/route.ts
3 |  * ëª©ì : ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” í—¬ìŠ¤ ì²´í¬ API
4 |  * ì—­í• : ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„œë²„ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§
5 |  * ì‘ì„±ì¼: 2023-10-27
6 |  * ìˆ˜ì •ì¼: 2024-05-17 : ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” request ë§¤ê°œë³€ìˆ˜ ì œê±°
7 |  * ìˆ˜ì •ì¼: 2024-05-17 : ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” NextRequest ê°€ì ¸ì˜¤ê¸° ì œê±°
8 |  */
9 | import { NextResponse } from 'next/server';
10 | 
11 | import prisma from '@/lib/prisma';
12 | 
13 | /**
14 |  * DB ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” í—¬ìŠ¤ ì²´í¬ API
15 |  * HEAD ë˜ëŠ” GET ìš”ì²­ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥
16 |  */
17 | export async function HEAD() {
18 |   try {
19 |     // Prismaë¡œ ê°„ë‹¨í•œ ì¿¼ë¦¬ ì‹¤í–‰í•˜ì—¬ DB ì—°ê²° í™•ì¸
20 |     await prisma.$queryRaw`SELECT 1`;
21 |     
22 |     // ì‘ë‹µ ë³¸ë¬¸ ì—†ì´ 200 OKë§Œ ë°˜í™˜
23 |     return new NextResponse(null, { status: 200 });
24 |   } catch (error) {
25 |     console.error('DB ì—°ê²° ì‹¤íŒ¨:', error);
26 |     return new NextResponse(null, { status: 503 }); // Service Unavailable
27 |   }
28 | }
29 | 
30 | export async function GET() {
31 |   try {
32 |     // Prismaë¡œ ê°„ë‹¨í•œ ì¿¼ë¦¬ ì‹¤í–‰í•˜ì—¬ DB ì—°ê²° í™•ì¸
33 |     await prisma.$queryRaw`SELECT 1`;
34 |     
35 |     return NextResponse.json({ status: 'ok', message: 'Database connection successful' });
36 |   } catch (error) {
37 |     console.error('DB ì—°ê²° ì‹¤íŒ¨:', error);
38 |     
39 |     return NextResponse.json(
40 |       { status: 'error', message: 'Database connection failed' },
41 |       { status: 503 } // Service Unavailable
42 |     );
43 |   }
44 | } 
```

src/app/api/ideamap-settings/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/api/ideamap-settings/route.ts
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ ì„¤ì • ê´€ë¦¬ API
4 |  * ì—­í• : ì‚¬ìš©ìë³„ ì•„ì´ë””ì–´ë§µ ì„¤ì •ì˜ CRUD ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { NextRequest, NextResponse } from 'next/server';
9 | 
10 | import { z } from 'zod';
11 | 
12 | import prisma from '@/lib/prisma';
13 | 
14 | // ì•„ì´ë””ì–´ë§µ ì„¤ì • ìŠ¤í‚¤ë§ˆ
15 | const ideaMapSettingsSchema = z.object({
16 |   userId: z.string().uuid('ìœ íš¨í•œ ì‚¬ìš©ì IDê°€ í•„ìš”í•©ë‹ˆë‹¤.'),
17 |   settings: z.object({
18 |     snapToGrid: z.boolean(),
19 |     snapGrid: z.tuple([z.number(), z.number()]),
20 |     connectionLineType: z.string(),
21 |     markerEnd: z.string().nullable(),
22 |     strokeWidth: z.number(),
23 |     markerSize: z.number(),
24 |     edgeColor: z.string(),
25 |     selectedEdgeColor: z.string(),
26 |     animated: z.boolean()
27 |   })
28 | });
29 | 
30 | // ë¶€ë¶„ ì—…ë°ì´íŠ¸ìš© ì•„ì´ë””ì–´ë§µ ì„¤ì • ìŠ¤í‚¤ë§ˆ (ë” ìœ ì—°í•œ ê²€ì‚¬)
31 | const partialIdeaMapSettingsSchema = z.object({
32 |   userId: z.string(), // UUID ê²€ì‚¬ ì œê±°í•˜ì—¬ ë” ìœ ì—°í•˜ê²Œ í•¨
33 |   settings: z.object({
34 |     snapToGrid: z.boolean().optional(),
35 |     snapGrid: z.tuple([z.number(), z.number()]).optional(),
36 |     connectionLineType: z.string().optional(),
37 |     markerEnd: z.union([z.string(), z.null()]).optional(), // ë¬¸ìì—´ ë˜ëŠ” null í—ˆìš©
38 |     strokeWidth: z.number().optional(),
39 |     markerSize: z.number().optional(),
40 |     edgeColor: z.string().optional(),
41 |     selectedEdgeColor: z.string().optional(),
42 |     animated: z.boolean().optional()
43 |   }).partial()
44 | });
45 | 
46 | // ì•„ì´ë””ì–´ë§µ ì„¤ì • ì €ì¥ API
47 | export async function POST(request: NextRequest) {
48 |   try {
49 |     const body = await request.json();
50 |     const { userId, settings } = ideaMapSettingsSchema.parse(body);
51 | 
52 |     // ê¸°ì¡´ ì„¤ì •ì´ ìˆëŠ”ì§€ í™•ì¸
53 |     const existingSettings = await prisma.ideaMapSettings.findUnique({
54 |       where: { userId }
55 |     });
56 | 
57 |     // ì„¤ì • ì—…ë°ì´íŠ¸ ë˜ëŠ” ìƒì„±
58 |     if (existingSettings) {
59 |       await prisma.ideaMapSettings.update({
60 |         where: { userId },
61 |         data: {
62 |           settings: settings
63 |         }
64 |       });
65 |     } else {
66 |       await prisma.ideaMapSettings.create({
67 |         data: {
68 |           userId,
69 |           settings
70 |         }
71 |       });
72 |     }
73 | 
74 |     return NextResponse.json({ success: true }, { status: 200 });
75 |   } catch (error) {
[TRUNCATED]
```

src/app/api/tags/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/api/tags/route.ts
3 |  * ëª©ì : íƒœê·¸ ê´€ë ¨ API ì—”ë“œí¬ì¸íŠ¸ ì œê³µ
4 |  * ì—­í• : íƒœê·¸ ëª©ë¡ ì¡°íšŒ, íƒœê·¸ ì‚¬ìš© íšŸìˆ˜ ì§‘ê³„, íƒœê·¸ ìƒì„± ë“± ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-03-27
7 |  */
8 | 
9 | import { NextRequest, NextResponse } from 'next/server';
10 | 
11 | import { auth } from '@/lib/auth-server';
12 | import prisma from '@/lib/prisma';
13 | 
14 | /**
15 |  * GET: íƒœê·¸ ëª©ë¡ì„ ë°˜í™˜í•˜ëŠ” API
16 |  * @param request - ìš”ì²­ ê°ì²´
17 |  * @returns íƒœê·¸ ëª©ë¡ ë° ì‚¬ìš© íšŸìˆ˜
18 |  */
19 | export async function GET(request: NextRequest) {
20 |   try {
21 |     const searchParams = request.nextUrl.searchParams;
22 |     const includeCount = searchParams.get('includeCount') === 'true';
23 |     const searchQuery = searchParams.get('q') || '';
24 |     
25 |     if (includeCount) {
26 |       // ì‚¬ìš© íšŸìˆ˜ì™€ í•¨ê»˜ íƒœê·¸ ëª©ë¡ ë°˜í™˜
27 |       const tags = await prisma.tag.findMany({
28 |         where: {
29 |           name: {
30 |             contains: searchQuery,
31 |           },
32 |         },
33 |         include: {
34 |           _count: {
35 |             select: { cardTags: true },
36 |           },
37 |         },
38 |         orderBy: {
39 |           name: 'asc',
40 |         },
41 |       });
42 |       
43 |       // ì‘ë‹µ í˜•ì‹ ë³€í™˜
44 |       const formattedTags = tags.map(tag => ({
45 |         id: tag.id,
46 |         name: tag.name,
47 |         count: tag._count.cardTags,
48 |         createdAt: tag.createdAt,
49 |       }));
50 |       
51 |       return NextResponse.json(formattedTags);
52 |     } else {
53 |       // ê¸°ë³¸ íƒœê·¸ ëª©ë¡ë§Œ ë°˜í™˜
54 |       const tags = await prisma.tag.findMany({
55 |         where: searchQuery ? {
56 |           name: {
57 |             contains: searchQuery,
58 |           },
59 |         } : undefined,
60 |         orderBy: {
61 |           name: 'asc',
62 |         },
63 |       });
64 |       
65 |       return NextResponse.json(tags);
66 |     }
67 |   } catch (error) {
68 |     console.error('íƒœê·¸ ì¡°íšŒ ì˜¤ë¥˜:', error);
69 |     return NextResponse.json(
70 |       { error: 'íƒœê·¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' },
71 |       { status: 500 }
72 |     );
73 |   }
74 | }
75 | 
76 | /**
77 |  * POST: ìƒˆ íƒœê·¸ë¥¼ ìƒì„±í•˜ëŠ” API
78 |  * @param request - ìš”ì²­ ê°ì²´
79 |  * @returns ìƒì„±ëœ íƒœê·¸ ì •ë³´
80 |  */
81 | export async function POST(request: NextRequest) {
82 |   try {
83 |     // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
[TRUNCATED]
```

src/app/auth/callback/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/auth/callback/route.ts
3 |  * ëª©ì : OAuth ì½œë°± ì²˜ë¦¬
4 |  * ì—­í• : OAuth ì¸ì¦ ì™„ë£Œ í›„ ì‚¬ìš©ìë¥¼ ì ì ˆí•œ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-05 : ë¡œê·¸ ë©”ì‹œì§€ ê°•í™” ë° ì¶”ê°€
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : OAuth ì½œë°± ì²˜ë¦¬ ê°„ì†Œí™” ë° Supabase í—¬í¼ í™œìš©
8 |  */
9 | 
10 | import { NextResponse } from 'next/server'
11 | import { createClient } from '@/lib/supabase/server'
12 | 
13 | export async function GET(request: Request) {
14 |   const { searchParams } = new URL(request.url)
15 |   const code = searchParams.get('code')
16 |   
17 |   if (code) {
18 |     const supabase = await createClient()
19 |     await supabase.auth.exchangeCodeForSession(code)
20 |     return NextResponse.redirect(new URL('/', request.url))
21 |   }
22 |   
23 |   return NextResponse.redirect(new URL('/auth/error', request.url))
24 | } 
```

src/app/admin/logs/LogViewerPageMock.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: LogViewerPageMock.tsx
3 |  * ëª©ì : ë¡œê·¸ ë·°ì–´ í˜ì´ì§€ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ëª¨í‚¹ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ì„ ì‹œë®¬ë ˆì´ì…˜
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2024-05-21 : import ìˆœì„œ ìˆ˜ì •
7 |  */
8 | 
9 | import React, { useState } from 'react'
10 | 
11 | import { Log, mockLogs, mockModules } from '@/tests/msw/handlers/logs'
12 | 
13 | export const LogViewerPageMock: React.FC = () => {
14 |     const [selectedModule, setSelectedModule] = useState('')
15 |     const [selectedLevel, setSelectedLevel] = useState('')
16 |     const [logData, setLogData] = useState<Log[]>(mockLogs)
17 |     const [showError, setShowError] = useState(false)
18 |     const [showEmpty, setShowEmpty] = useState(false)
19 |     const [showDetail, setShowDetail] = useState(false)
20 |     const [selectedLog, setSelectedLog] = useState<Log | null>(null)
21 | 
22 |     const handleFilterApply = () => {
23 |         // ì—ëŸ¬ ì‹œë®¬ë ˆì´ì…˜
24 |         if (selectedModule === 'error-trigger') {
25 |             setShowError(true)
26 |             setShowEmpty(false)
27 |             setLogData([])
28 |             return
29 |         }
30 | 
31 |         // ë¹ˆ ê²°ê³¼ ì‹œë®¬ë ˆì´ì…˜
32 |         if (selectedModule === 'empty-trigger') {
33 |             setShowError(false)
34 |             setShowEmpty(true)
35 |             setLogData([])
36 |             return
37 |         }
38 | 
39 |         // ì¼ë°˜ í•„í„°ë§ ì‹œë®¬ë ˆì´ì…˜
40 |         setShowError(false)
41 |         setShowEmpty(false)
42 | 
43 |         let filtered = [...mockLogs]
44 |         if (selectedModule) {
45 |             filtered = filtered.filter(log => log.module === selectedModule)
46 |         }
47 |         if (selectedLevel) {
48 |             filtered = filtered.filter(log => log.level === selectedLevel)
49 |         }
50 | 
51 |         setLogData(filtered)
52 |     }
53 | 
54 |     const handleFilterReset = () => {
55 |         setSelectedModule('')
56 |         setSelectedLevel('')
57 |         setShowError(false)
58 |         setShowEmpty(false)
59 |         setLogData(mockLogs)
60 |     }
61 | 
62 |     const handleLogClick = (log: Log) => {
63 |         setSelectedLog(log)
64 |         setShowDetail(true)
65 |     }
66 | 
67 |     const handleCloseDetail = () => {
68 |         setShowDetail(false)
69 |         setSelectedLog(null)
70 |     }
71 | 
72 |     return (
73 |         <div>
74 |             <h1>ë¡œê·¸ ë·°ì–´</h1>
75 | 
76 |             {/* í•„í„° ì»¨íŠ¸ë¡¤ */}
77 |             <div>
78 |                 <label htmlFor="module">ëª¨ë“ˆ</label>
79 |                 <select
80 |                     id="module"
81 |                     value={selectedModule}
82 |                     onChange={(e) => setSelectedModule(e.target.value)}
83 |                     data-testid="module-select"
[TRUNCATED]
```

src/app/admin/logs/page.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/admin/logs/page.test.tsx
3 |  * ëª©ì : ë¡œê·¸ ë·°ì–´ ê´€ë¦¬ì í˜ì´ì§€ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ë¡œê·¸ ì¡°íšŒ ë° í•„í„°ë§ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-01
7 |  * ìˆ˜ì •ì¼: 2024-05-21 : import ìˆœì„œ ìˆ˜ì •
8 |  * ìˆ˜ì •ì¼: 2024-05-22 : import ìˆœì„œ ì˜¤ë¥˜ ìˆ˜ì •
9 |  * ìˆ˜ì •ì¼: 2024-05-23 : import ìˆœì„œ ë° ê·¸ë£¹í™” ì˜¤ë¥˜ ìˆ˜ì •
10 |  */
11 | 
12 | import { render, screen, fireEvent } from '@testing-library/react'
13 | import { describe, expect, it, vi, beforeEach, afterEach } from 'vitest'
14 | 
15 | import '@testing-library/jest-dom/vitest'
16 | 
17 | import { mockLogs } from '@/tests/msw/handlers/logs'
18 | 
19 | import { LogViewerPageMock } from './LogViewerPageMock'
20 | import { setupLogViewerTests, teardownLogViewerTests } from './test-utils'
21 | 
22 | // Next.js ëª¨í‚¹
23 | vi.mock('next/navigation', () => ({
24 |   useRouter: () => ({
25 |     push: vi.fn(),
26 |     replace: vi.fn(),
27 |     prefetch: vi.fn(),
28 |     back: vi.fn()
29 |   }),
30 |   useSearchParams: () => new URLSearchParams()
31 | }))
32 | 
33 | describe('LogViewerPage', () => {
34 |   beforeEach(() => {
35 |     setupLogViewerTests()
36 |   })
37 | 
38 |   afterEach(() => {
39 |     teardownLogViewerTests()
40 |   })
41 | 
42 |   describe('ê¸°ë³¸ UI ë Œë”ë§', () => {
43 |     it('í˜ì´ì§€ íƒ€ì´í‹€ê³¼ í•„í„° ì»¨íŠ¸ë¡¤ì´ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ì–´ì•¼ í•¨', () => {
44 |       render(<LogViewerPageMock />)
45 | 
46 |       // í˜ì´ì§€ íƒ€ì´í‹€ í™•ì¸
47 |       expect(screen.getByText('ë¡œê·¸ ë·°ì–´')).toBeInTheDocument()
48 | 
49 |       // í•„í„° ì»¨íŠ¸ë¡¤ í™•ì¸
50 |       expect(screen.getByLabelText('ëª¨ë“ˆ')).toBeInTheDocument()
51 |       expect(screen.getByLabelText('ë ˆë²¨')).toBeInTheDocument()
52 |       expect(screen.getByLabelText('ë¡œê·¸ ìˆ˜')).toBeInTheDocument()
53 |       expect(screen.getByText('í•„í„° ì ìš©')).toBeInTheDocument()
54 |       expect(screen.getByText('í•„í„° ì´ˆê¸°í™”')).toBeInTheDocument()
55 |     })
56 | 
57 |     it('ì´ˆê¸° ë¡œê·¸ ëª©ë¡ì´ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ì–´ì•¼ í•¨', () => {
58 |       render(<LogViewerPageMock />)
59 |       expect(screen.getByText(mockLogs[0].message)).toBeInTheDocument()
60 |     })
61 |   })
62 | 
63 |   describe('í•„í„° ê¸°ëŠ¥', () => {
64 |     it('ëª¨ë“ˆ í•„í„°ê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•´ì•¼ í•¨', () => {
65 |       render(<LogViewerPageMock />)
66 | 
67 |       const moduleSelect = screen.getByTestId('module-select')
68 |       fireEvent.change(moduleSelect, { target: { value: 'auth' } })
69 | 
70 |       const applyButton = screen.getByTestId('apply-filter')
71 |       fireEvent.click(applyButton)
[TRUNCATED]
```

src/app/admin/logs/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: page.tsx
3 |  * ëª©ì : ë¡œê·¸ ë·°ì–´ ê´€ë¦¬ì í˜ì´ì§€
4 |  * ì—­í• : ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ë¥¼ ì¡°íšŒí•˜ê³  í•„í„°ë§í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : ESLint ì˜¤ë¥˜ ìˆ˜ì • (any íƒ€ì… ì œê±°, useEffect ì˜ì¡´ì„± ë°°ì—´ ìˆ˜ì •)
7 |  * ìˆ˜ì •ì¼: 2023-10-27 : fetchLogsë¥¼ useCallbackìœ¼ë¡œ ê°ì‹¸ ë¬´í•œ ë Œë”ë§ ë°©ì§€
8 |  * ìˆ˜ì •ì¼: 2024-05-21 : import ìˆœì„œ ìˆ˜ì •
9 |  * ìˆ˜ì •ì¼: 2024-05-22 : import ìˆœì„œ ì˜¤ë¥˜ ìˆ˜ì •
10 |  */
11 | 
12 | 'use client';
13 | 
14 | import { useEffect, useState, useCallback } from 'react';
15 | 
16 | import { useRouter } from 'next/navigation';
17 | 
18 | interface LogEntry {
19 |   timestamp: string;
20 |   level: string;
21 |   module: string;
22 |   message: string;
23 |   data?: Record<string, unknown>;
24 |   sessionId?: string;
25 |   serverTimestamp?: string;
26 | }
27 | 
28 | export default function LogViewerPage() {
29 |   const router = useRouter();
30 |   const [logs, setLogs] = useState<LogEntry[]>([]);
31 |   const [loading, setLoading] = useState(true);
32 |   const [error, setError] = useState<string | null>(null);
33 |   const [modules, setModules] = useState<string[]>([]);
34 |   const [sessionIds, setSessionIds] = useState<string[]>([]);
35 | 
36 |   // í•„í„°ë§ ìƒíƒœ
37 |   const [selectedModule, setSelectedModule] = useState<string>('');
38 |   const [selectedLevel, setSelectedLevel] = useState<string>('');
39 |   const [selectedSessionId, setSelectedSessionId] = useState<string>('');
40 |   const [limit, setLimit] = useState(100);
41 | 
42 |   // ë¡œê·¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
43 |   const fetchLogs = useCallback(async () => {
44 |     try {
45 |       setLoading(true);
46 | 
47 |       // í•„í„° íŒŒë¼ë¯¸í„° êµ¬ì„±
48 |       const params = new URLSearchParams();
49 |       if (selectedModule) params.append('module', selectedModule);
50 |       if (selectedLevel) params.append('level', selectedLevel);
51 |       if (selectedSessionId) params.append('sessionId', selectedSessionId);
52 |       params.append('limit', limit.toString());
53 | 
54 |       const response = await fetch(`/api/logs/view?${params.toString()}`);
55 | 
56 |       if (!response.ok) {
57 |         throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
58 |       }
59 | 
60 |       const data = await response.json();
61 | 
62 |       setLogs(data.logs || []);
63 |       setModules(data.modules || []);
64 |       setSessionIds(data.sessionIds || []);
65 |       setError(null);
66 |     } catch (err: unknown) {
[TRUNCATED]
```

src/app/admin/logs/test-utils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/admin/logs/test-utils.ts
3 |  * ëª©ì : ë¡œê·¸ ë·°ì–´ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ ì„¤ì •ê³¼ í•´ì œë¥¼ ë‹´ë‹¹
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2024-05-21 : import ìˆœì„œ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2024-05-22 : import ìˆœì„œ ì˜¤ë¥˜ ìˆ˜ì •
8 |  * ìˆ˜ì •ì¼: 2024-05-23 : import ìˆœì„œ ë° ê·¸ë£¹í™” ì˜¤ë¥˜ ìˆ˜ì •
9 |  */
10 | 
11 | import { http, HttpResponse } from 'msw'
12 | import { vi } from 'vitest'
13 | 
14 | import { mockLogs, mockModules, mockSessionIds } from '@/tests/msw/handlers/logs'
15 | import { server } from '@/tests/msw/server'
16 | 
17 | // API ì‘ë‹µì— ì‚¬ìš©í•  ê¸°ë³¸ ë°ì´í„°
18 | const defaultApiResponse = {
19 |   logs: mockLogs,
20 |   modules: mockModules,
21 |   sessionIds: mockSessionIds,
22 |   levels: ['debug', 'info', 'warn', 'error'],
23 |   total: mockLogs.length,
24 |   filtered: mockLogs.length
25 | }
26 | 
27 | /**
28 |  * setupLogViewerTests: ë¡œê·¸ ë·°ì–´ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í™˜ê²½ì„ ì„¤ì •
29 |  */
30 | export const setupLogViewerTests = () => {
31 |   // API ì„±ê³µ ì‘ë‹µ ì„¤ì •
32 |   server.use(
33 |     http.get('/api/logs/view', () => {
34 |       return HttpResponse.json(defaultApiResponse)
35 |     })
36 |   )
37 | }
38 | 
39 | /**
40 |  * teardownLogViewerTests: ë¡œê·¸ ë·°ì–´ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ì •ë¦¬
41 |  */
42 | export const teardownLogViewerTests = () => {
43 |   server.resetHandlers()
44 |   vi.clearAllMocks()
45 | } 
```

src/app/auth/error/AuthErrorClient.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/auth/error/AuthErrorClient.tsx
3 |  * ëª©ì : ì¸ì¦ ì˜¤ë¥˜ ì •ë³´ë¥¼ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì²˜ë¦¬
4 |  * ì—­í• : useSearchParams í›…ì„ ì‚¬ìš©í•˜ì—¬ URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ ì˜¤ë¥˜ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ í‘œì‹œ
5 |  * ì‘ì„±ì¼: 2025-05-21
6 |  */
7 | 
8 | 'use client'
9 | 
10 | import { useSearchParams } from 'next/navigation'
11 | import Link from 'next/link'
12 | 
13 | export default function AuthErrorClient() {
14 |     const searchParams = useSearchParams()
15 |     const error = searchParams.get('error') || 'Unknown error'
16 | 
17 |     return (
18 |         <div className="flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4">
19 |             <div className="w-full max-w-md p-8 space-y-4 bg-white rounded-lg shadow-md">
20 |                 <div className="text-center">
21 |                     <h1 className="text-2xl font-bold text-red-600 mb-4">ì¸ì¦ ì˜¤ë¥˜</h1>
22 |                     <p className="text-gray-700 mb-6">ì¸ì¦ ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {error}</p>
23 | 
24 |                     <div className="flex flex-col space-y-3">
25 |                         <Link
26 |                             href="/login"
27 |                             className="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors"
28 |                         >
29 |                             ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
30 |                         </Link>
31 | 
32 |                         <Link
33 |                             href="/"
34 |                             className="w-full py-2 px-4 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded transition-colors"
35 |                         >
36 |                             í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
37 |                         </Link>
38 |                     </div>
39 |                 </div>
40 |             </div>
41 |         </div>
42 |     )
43 | } 
```

src/app/auth/error/page.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/auth/error/page.test.tsx
3 |  * ëª©ì : ì¸ì¦ ì˜¤ë¥˜ í˜ì´ì§€ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì¸ì¦ ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ì§€ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-03-30
7 |  * ìˆ˜ì •ì¼: 2024-09-28 : ì»´í¬ë„ŒíŠ¸ êµ¬ì¡° ë³€ê²½ì— ë”°ë¥¸ í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
8 |  * ìˆ˜ì •ì¼: 2025-04-21 : ì§ì ‘ useSearchParamsë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
9 |  */
10 | 
11 | import { render, screen } from '@testing-library/react';
12 | import { describe, expect, it, vi, beforeEach } from 'vitest';
13 | 
14 | import ErrorPage from './page';
15 | 
16 | // ëª¨í‚¹ ì„¤ì •
17 | const mockGet = vi.fn();
18 | 
19 | vi.mock('next/navigation', () => ({
20 |   useSearchParams: () => ({
21 |     get: mockGet
22 |   })
23 | }));
24 | 
25 | vi.mock('next/link', () => ({
26 |   default: ({ children, href }: { children: React.ReactNode; href: string }) => (
27 |     <a href={href}>{children}</a>
28 |   )
29 | }));
30 | 
31 | describe('ErrorPage', () => {
32 |   beforeEach(() => {
33 |     vi.clearAllMocks();
34 |   });
35 | 
36 |   it('ê¸°ë³¸ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤', () => {
37 |     mockGet.mockImplementation(() => null);
38 |     render(<ErrorPage />);
39 | 
40 |     expect(screen.getByRole('heading', { name: 'ì¸ì¦ ì˜¤ë¥˜' })).toBeInTheDocument();
41 |     expect(screen.getByText(/ì¸ì¦ ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:/)).toHaveTextContent('ì¸ì¦ ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: Unknown error');
42 |   });
43 | 
44 |   it('URLì—ì„œ ì „ë‹¬ëœ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤', () => {
45 |     mockGet.mockImplementation(() => 'Access Denied');
46 |     render(<ErrorPage />);
47 | 
48 |     expect(screen.getByText(/ì¸ì¦ ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:/)).toHaveTextContent('ì¸ì¦ ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: Access Denied');
49 |   });
50 | 
51 |   it('ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸° ë§í¬ê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤', async () => {
52 |     mockGet.mockImplementation(() => null);
53 |     render(<ErrorPage />);
54 | 
55 |     const loginLink = screen.getByRole('link', { name: 'ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°' });
56 |     expect(loginLink).toHaveAttribute('href', '/login');
57 |   });
58 | 
59 |   it('í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° ë§í¬ê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤', async () => {
60 |     mockGet.mockImplementation(() => null);
61 |     render(<ErrorPage />);
62 | 
63 |     const homeLink = screen.getByRole('link', { name: 'í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°' });
64 |     expect(homeLink).toHaveAttribute('href', '/');
65 |   });
66 | }); 
```

src/app/auth/error/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/auth/error/page.tsx
3 |  * ëª©ì : ì¸ì¦ ê³¼ì •ì—ì„œ ë°œìƒí•œ ì˜¤ë¥˜ í‘œì‹œ
4 |  * ì—­í• : ì‚¬ìš©ìì—ê²Œ ì¸ì¦ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì£¼ê³  í›„ì† ì¡°ì¹˜ ì•ˆë‚´
5 |  * ì‘ì„±ì¼: 2025-03-26
6 |  * ìˆ˜ì •ì¼: 2025-03-27
7 |  * ìˆ˜ì •ì¼: 2024-09-28 : ë™ì  ë Œë”ë§ ê°•ì œë¥¼ í†µí•œ useSearchParams ì˜¤ë¥˜ í•´ê²°
8 |  * ìˆ˜ì •ì¼: 2024-09-28 : Suspense ê²½ê³„ë¡œ useSearchParamsë¥¼ ê°ì‹¸ ë¹Œë“œ ì˜¤ë¥˜ í•´ê²°
9 |  * ìˆ˜ì •ì¼: 2025-04-21 : ì§ì ‘ useSearchParams í›…ì„ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•˜ê³  ì½”ë“œ ê°„ì†Œí™”
10 |  * ìˆ˜ì •ì¼: 2025-05-21 : ì„œë²„ ì»´í¬ë„ŒíŠ¸ì™€ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬ ë° Suspense ê²½ê³„ ì¶”ê°€
11 |  */
12 | 
13 | import { Suspense } from 'react'
14 | import AuthErrorClient from './AuthErrorClient'
15 | 
16 | function AuthErrorFallback() {
17 |   return (
18 |     <div className="flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4">
19 |       <div className="w-full max-w-md p-8 space-y-4 bg-white rounded-lg shadow-md">
20 |         <div className="text-center">
21 |           <h1 className="text-2xl font-bold mb-4">ë¡œë”© ì¤‘...</h1>
22 |           <p className="text-gray-700 mb-6">ì¸ì¦ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
23 |         </div>
24 |       </div>
25 |     </div>
26 |   )
27 | }
28 | 
29 | export default function AuthErrorPage() {
30 |   return (
31 |     <Suspense fallback={<AuthErrorFallback />}>
32 |       <AuthErrorClient />
33 |     </Suspense>
34 |   )
35 | } 
```

src/app/auth/login/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/auth/login/page.tsx
3 |  * ëª©ì : ì‚¬ìš©ì ë¡œê·¸ì¸ í˜ì´ì§€
4 |  * ì—­í• : ì†Œì…œ ë¡œê·¸ì¸ ë° ì´ë©”ì¼ ë¡œê·¸ì¸ ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-30
6 |  * ìˆ˜ì •ì¼: 2023-11-02 : NextAuth ì˜ì¡´ì„± ì œê±° ë° Supabase ì¸ì¦ìœ¼ë¡œ ì™„ì „íˆ ì „í™˜
7 |  */
8 | 
9 | 'use client';
10 | 
11 | import { useState } from 'react';
12 | 
13 | import { Button } from '@/components/ui/button';
14 | import { Card, CardContent, CardDescription, CardHeader } from '@/components/ui/card';
15 | import { signInWithGoogle } from '@/lib/auth';
16 | 
17 | export default function LoginPage() {
18 |   const [isLoading, setIsLoading] = useState(false);
19 | 
20 |   const handleGoogleLogin = async () => {
21 |     try {
22 |       setIsLoading(true);
23 |       const result = await signInWithGoogle();
24 | 
25 |       if (result.success && result.url) {
26 |         // Supabase OAuth íë¦„ì— ë”°ë¼ ë¦¬ë””ë ‰ì…˜
27 |         window.location.href = result.url;
28 |       } else {
29 |         console.error('ë¡œê·¸ì¸ URL ìƒì„± ì‹¤íŒ¨:', result.error);
30 |         alert('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
31 |       }
32 |     } catch (error) {
33 |       console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
34 |     } finally {
35 |       setIsLoading(false);
36 |     }
37 |   };
38 | 
39 |   return (
40 |     <div className="container mx-auto flex items-center justify-center min-h-screen py-8">
41 |       <Card className="w-full max-w-md">
42 |         <CardHeader className="@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6" data-slot="card-header">
43 |           <h1 className="leading-none font-semibold" data-slot="card-title">
44 |             ë¡œê·¸ì¸
45 |           </h1>
46 |           <CardDescription>
47 |             ì†Œì…œ ê³„ì •ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”.
48 |           </CardDescription>
49 |         </CardHeader>
50 |         <CardContent>
51 |           <div className="space-y-4">
52 |             <Button
53 |               variant="outline"
54 |               className="w-full"
55 |               onClick={handleGoogleLogin}
56 |               disabled={isLoading}
57 |             >
58 |               {isLoading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'Googleë¡œ ë¡œê·¸ì¸'}
59 |             </Button>
60 |           </div>
61 |         </CardContent>
62 |       </Card>
63 |     </div>
64 |   );
65 | } 
```

src/app/auth/test/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: auth/test/page.tsx
3 |  * ëª©ì : ì¸ì¦ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ í˜ì´ì§€
4 |  * ì—­í• : ë‹¤ì–‘í•œ ì¸ì¦ ìƒíƒœ ë° ìŠ¤í† ë¦¬ì§€ ê²€ì‚¬ ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-14 : NextAuth signIn ì œê±° ë° Supabase ì¸ì¦ ë°©ì‹ìœ¼ë¡œ ì™„ì „íˆ ì „í™˜
7 |  */
8 | 
9 | 'use client';
10 | 
11 | import { useState, useEffect } from 'react';
12 | 
13 | import { Button } from '@/components/ui/button';
14 | import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
15 | import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
16 | import { signOut, getCurrentUser, ExtendedUser, signInWithGoogle } from '@/lib/auth';
17 | 
18 | export default function AuthTestPage() {
19 |   const [user, setUser] = useState<ExtendedUser | null>(null);
20 |   const [loading, setLoading] = useState(true);
21 | 
22 |   useEffect(() => {
23 |     const fetchUser = async () => {
24 |       try {
25 |         const currentUser = await getCurrentUser();
26 |         setUser(currentUser);
27 |       } catch (e) {
28 |         console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', e);
29 |       } finally {
30 |         setLoading(false);
31 |       }
32 |     };
33 | 
34 |     fetchUser();
35 |   }, []);
36 | 
37 |   const handleGoogleLogin = async () => {
38 |     try {
39 |       const result = await signInWithGoogle();
40 |       if (result.success && result.url) {
41 |         window.location.href = result.url;
42 |       } else {
43 |         console.error('ë¡œê·¸ì¸ URL ìƒì„± ì‹¤íŒ¨:', result.error);
44 |         alert('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
45 |       }
46 |     } catch (e) {
47 |       console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', e);
48 |     }
49 |   };
50 | 
51 |   const handleLogout = async () => {
52 |     try {
53 |       await signOut();
54 |       setUser(null);
55 |       alert('ë¡œê·¸ì•„ì›ƒ ì„±ê³µ');
56 |     } catch (e) {
57 |       console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', e);
58 |     }
59 |   };
60 | 
61 |   const runAllTests = async () => {
62 |     setLoading(true);
63 |     try {
64 |       await fetch('/api/test/run-all', {
65 |         method: 'POST'
66 |       });
67 |     } finally {
68 |       setLoading(false);
69 |     }
70 |   };
71 | 
72 |   if (loading) {
73 |     return (
74 |       <div className="container mx-auto py-8">
75 |         <h1 className="text-3xl font-bold mb-8">ì¸ì¦ í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>
76 |         <p>ë¡œë”© ì¤‘...</p>
[TRUNCATED]
```

src/app/api/logs/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: route.ts
3 |  * ëª©ì : í´ë¼ì´ì–¸íŠ¸ ë¡œê·¸ë¥¼ ì„œë²„ì— ì €ì¥í•˜ëŠ” API ì—”ë“œí¬ì¸íŠ¸
4 |  * ì—­í• : ë¡œê·¸ ë°ì´í„°ë¥¼ ë°›ì•„ ì„œë²„ ë¡œê·¸ì— ê¸°ë¡í•˜ê³  í•„ìš”ì‹œ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2024-05-22 : import ìˆœì„œ ìˆ˜ì •, any íƒ€ì… êµ¬ì²´í™”
7 |  * ìˆ˜ì •ì¼: 2025-04-05 : Vercel í™˜ê²½ì—ì„œ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ì œí•œ ë¬¸ì œ í•´ê²°
8 |  */
9 | 
10 | import fs from 'fs';
11 | import path from 'path';
12 | 
13 | import { NextRequest, NextResponse } from 'next/server';
14 | 
15 | import { createClient } from '@supabase/supabase-js';
16 | // import { createBrowserSupabaseClient } from '@/lib/supabase-browser'; // í´ë¼ì´ì–¸íŠ¸ìš© í•¨ìˆ˜ ì œê±°
17 | 
18 | // ë¡œê·¸ íŒŒì¼ ê²½ë¡œ ì„¤ì •
19 | const LOG_DIR = process.env.LOG_DIR || 'logs';
20 | const LOG_FILE = path.join(process.cwd(), LOG_DIR, 'client-logs.json');
21 | // Vercel í™˜ê²½ í™•ì¸
22 | const IS_VERCEL = process.env.VERCEL === '1';
23 | 
24 | // ì„œë²„ ì „ìš© Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± í•¨ìˆ˜
25 | const createServerSupabaseClient = () => {
26 |   const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
27 |   const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
28 |   
29 |   if (!supabaseUrl || !supabaseServiceKey) {
30 |     console.error('Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
31 |     return null;
32 |   }
33 |   
34 |   return createClient(supabaseUrl, supabaseServiceKey);
35 | };
36 | 
37 | /**
38 |  * ensureLogDir: ë¡œê·¸ ë””ë ‰í† ë¦¬ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê³ , ì—†ìœ¼ë©´ ìƒì„±
39 |  */
40 | const ensureLogDir = () => {
41 |   // Vercel í™˜ê²½ì—ì„œëŠ” ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
42 |   if (IS_VERCEL) return;
43 |   
44 |   const logDirPath = path.join(process.cwd(), LOG_DIR);
45 |   if (!fs.existsSync(logDirPath)) {
46 |     fs.mkdirSync(logDirPath, { recursive: true });
47 |     console.log(`ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„±: ${logDirPath}`);
48 |   }
49 | };
50 | 
51 | /**
52 |  * saveLogToFile: ë¡œê·¸ ë°ì´í„°ë¥¼ íŒŒì¼ì— ì €ì¥
53 |  * @param logData ì €ì¥í•  ë¡œê·¸ ë°ì´í„°
54 |  */
55 | const saveLogToFile = (logData: {
56 |   module: string;
57 |   level: string;
58 |   message: string;
59 |   data?: Record<string, unknown>;
60 |   timestamp?: string;
61 | }) => {
62 |   try {
63 |     // ì„œë²„ ì½˜ì†”ì— ë¡œê·¸ ì¶œë ¥
[TRUNCATED]
```

src/app/cards/[id]/DeleteButton.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/cards/[id]/DeleteButton.test.tsx
3 |  * ëª©ì : ì¹´ë“œ ì‚­ì œ ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì¹´ë“œ ì‚­ì œ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-29
6 |  * ìˆ˜ì •ì¼: 2025-04-23 : React Query ë¦¬íŒ©í† ë§ìœ¼ë¡œ ì¸í•œ í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
7 |  */
8 | import React from 'react';
9 | 
10 | import { render, screen, fireEvent, waitFor } from '@testing-library/react';
11 | import userEvent from '@testing-library/user-event';
12 | // import { toast } from 'sonner';
13 | import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
14 | import '@testing-library/jest-dom/vitest';
15 | 
16 | import DeleteButton, { callIfExists } from './DeleteButton';
17 | import { useDeleteCard } from '@/hooks/useDeleteCard';
18 | 
19 | // ëª¨í‚¹ ì„¤ì •
20 | const mockPush = vi.fn();
21 | vi.mock('next/navigation', () => ({
22 |   useRouter: () => ({
23 |     push: mockPush
24 |   })
25 | }));
26 | 
27 | // vi.mock('sonner', () => ({
28 | //   toast: {
29 | //     success: vi.fn(),
30 | //     error: vi.fn()
31 | //   }
32 | // }));
33 | 
34 | // useDeleteCard í›… ëª¨í‚¹
35 | const mockMutate = vi.fn();
36 | let mockIsPending = false;
37 | let mockIsError = false;
38 | let mockIsSuccess = false;
39 | 
40 | vi.mock('@/hooks/useDeleteCard', () => ({
41 |   useDeleteCard: vi.fn()
42 | }));
43 | 
44 | // Dialog ì»´í¬ë„ŒíŠ¸ ëª¨í‚¹ ê°œì„ 
45 | vi.mock('@/components/ui/dialog', () => {
46 |   return {
47 |     Dialog: ({ children, open, onOpenChange }: { children: React.ReactNode, open?: boolean, onOpenChange?: (open: boolean) => void }) => (
48 |       <div data-testid="dialog" data-open={open}>{children}</div>
49 |     ),
50 |     DialogTrigger: ({ children, asChild }: { children: React.ReactNode, asChild?: boolean }) => (
51 |       <div data-testid="dialog-trigger" onClick={() => document.dispatchEvent(new Event('dialog-open'))}>
52 |         {children}
53 |       </div>
54 |     ),
55 |     DialogContent: ({ children }: { children: React.ReactNode }) => (
56 |       <div data-testid="dialog-content">{children}</div>
57 |     ),
58 |     DialogHeader: ({ children }: { children: React.ReactNode }) => (
59 |       <div data-testid="dialog-header">{children}</div>
60 |     ),
61 |     DialogTitle: ({ children }: { children: React.ReactNode }) => (
62 |       <div data-testid="dialog-title">{children}</div>
63 |     ),
64 |     DialogDescription: ({ children }: { children: React.ReactNode }) => (
[TRUNCATED]
```

src/app/cards/[id]/DeleteButton.tsx
```
1 | "use client";
2 | 
3 | import { useState } from "react";
4 | 
5 | import { useRouter } from "next/navigation";
6 | 
7 | import { Trash2 } from "lucide-react";
8 | import { toast } from "sonner";
9 | 
10 | import { Button } from "@/components/ui/button";
11 | import {
12 |   Dialog,
13 |   DialogContent,
14 |   DialogHeader,
15 |   DialogTitle,
16 |   DialogDescription,
17 |   DialogFooter,
18 |   DialogTrigger,
19 |   DialogClose,
20 | } from "@/components/ui/dialog";
21 | import { useDeleteCard } from "@/hooks/useDeleteCard";
22 | 
23 | interface DeleteButtonProps {
24 |   cardId: string;
25 |   // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í”„ë¡œí¼í‹° ì¶”ê°€ (ì„ íƒì )
26 |   onSuccessfulDelete?: () => void;
27 | }
28 | 
29 | // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í•¨ìˆ˜ë¥¼ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ë¡œ ë¶„ë¦¬
30 | export function callIfExists(callback?: () => void): void {
31 |   if (callback) {
32 |     callback();
33 |   }
34 | }
35 | 
36 | export default function DeleteButton({
37 |   cardId,
38 |   onSuccessfulDelete
39 | }: DeleteButtonProps) {
40 |   const [open, setOpen] = useState(false);
41 |   const router = useRouter();
42 |   const { mutate: deleteCard, isPending: isLoading } = useDeleteCard(cardId);
43 | 
44 |   const handleDelete = () => {
45 |     deleteCard(undefined, {
46 |       onSuccess: () => {
47 |         // ì„±ê³µ ì‹œ ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸°
48 |         setOpen(false);
49 | 
50 |         // ì„±ê³µì ì¸ ì‚­ì œ í›„ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
51 |         toast.success("ì¹´ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
52 | 
53 |         // ì„±ê³µ ì‹œì—ë§Œ ë¦¬ë””ë ‰ì…˜ ìˆ˜í–‰
54 |         router.push("/cards");
55 | 
56 |         // ì„±ê³µ ì‹œì—ë§Œ ì½œë°± í˜¸ì¶œ
57 |         if (onSuccessfulDelete) {
58 |           onSuccessfulDelete();
59 |         }
60 |       },
61 |       onError: (error) => {
62 |         // ëª¨ë“  ì¢…ë¥˜ì˜ ì˜¤ë¥˜ ì²˜ë¦¬ (ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, ì‘ë‹µ ì˜¤ë¥˜ ë“±)
63 |         console.error("Error deleting card:", error);
64 | 
65 |         // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
66 |         toast.error(error instanceof Error ? error.message : "ì¹´ë“œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
67 | 
68 |         // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë‹¤ì´ì–¼ë¡œê·¸ë§Œ ë‹«ìŒ (ë¦¬ë””ë ‰ì…˜ ì—†ìŒ)
69 |         setOpen(false);
70 |       }
71 |     });
72 |   };
73 | 
74 |   return (
75 |     <Dialog open={open} onOpenChange={setOpen}>
76 |       <DialogTrigger asChild>
77 |         <Button variant="destructive" size="sm">
78 |           <Trash2 className="mr-2 h-4 w-4" />
79 |           ì¹´ë“œ ì‚­ì œ
80 |         </Button>
81 |       </DialogTrigger>
82 |       <DialogContent>
83 |         <DialogHeader>
84 |           <DialogTitle>ì¹´ë“œ ì‚­ì œ</DialogTitle>
85 |           <DialogDescription>
[TRUNCATED]
```

src/app/cards/[id]/page.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/cards/[id]/page.test.tsx
3 |  * ëª©ì : ì¹´ë“œ ìƒì„¸ í˜ì´ì§€ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì¹´ë“œ ìƒì„¸ í˜ì´ì§€ ë Œë”ë§ ë° ê¸°ëŠ¥ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-02-15
6 |  * ìˆ˜ì •ì¼: 2024-05-16 : Triple-slash ì°¸ì¡° ì œê±° ë° import ë¬¸ìœ¼ë¡œ ë³€ê²½
7 |  */
8 | 
9 | import React from 'react';
10 | 
11 | import { render, screen, cleanup } from '@testing-library/react';
12 | import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
13 | import '@testing-library/jest-dom/vitest';
14 | 
15 | import CardPage, { generateMetadata } from './page';
16 | 
17 | // next/navigation ëª¨í‚¹
18 | vi.mock('next/navigation', () => ({
19 |   notFound: vi.fn(),
20 |   useRouter: vi.fn(() => ({
21 |     push: vi.fn()
22 |   }))
23 | }));
24 | 
25 | // Prisma ëª¨í‚¹ - í•¨ìˆ˜ë¥¼ inlineìœ¼ë¡œ ì •ì˜
26 | vi.mock('@/lib/prisma', () => {
27 |   return {
28 |     default: {
29 |       card: {
30 |         findUnique: vi.fn()
31 |       }
32 |     }
33 |   }
34 | });
35 | 
36 | // formatDate ëª¨í‚¹
37 | vi.mock('@/lib/utils', () => ({
38 |   formatDate: vi.fn(() => '2023ë…„ 1ì›” 1ì¼'),
39 |   cn: vi.fn((...args: any[]) => args.join(' '))
40 | }));
41 | 
42 | // EditCardContent ì»´í¬ë„ŒíŠ¸ ëª¨í‚¹
43 | vi.mock('@/components/cards/EditCardContent', () => {
44 |   return {
45 |     default: vi.fn(({ initialContent }: { initialContent: string }) => (
46 |       <div data-testid="edit-card-content">{initialContent}</div>
47 |     ))
48 |   };
49 | });
50 | 
51 | describe('CardPage', () => {
52 |   const params = { id: 'card123' };
53 | 
54 |   // ê°€ì§œ ì¹´ë“œ ë°ì´í„°
55 |   const mockCard = {
56 |     id: 'card123',
57 |     title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ',
58 |     content: 'í…ŒìŠ¤íŠ¸ ë‚´ìš©ì…ë‹ˆë‹¤.',
59 |     createdAt: new Date(),
60 |     updatedAt: new Date(),
61 |     user: {
62 |       id: 'user123',
63 |       name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
64 |       email: 'test@example.com'
65 |     },
66 |     cardTags: [
67 |       {
68 |         id: 'ct1',
69 |         cardId: 'card123',
70 |         tagId: 'tag1',
71 |         tag: {
72 |           id: 'tag1',
73 |           name: 'íƒœê·¸1'
74 |         }
75 |       },
76 |       {
77 |         id: 'ct2',
78 |         cardId: 'card123',
79 |         tagId: 'tag2',
80 |         tag: {
81 |           id: 'tag2',
82 |           name: 'íƒœê·¸2'
83 |         }
84 |       }
85 |     ]
[TRUNCATED]
```

src/app/cards/[id]/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/cards/[id]/page.tsx
3 |  * ëª©ì : íŠ¹ì • ì¹´ë“œì˜ ìƒì„¸ ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” í˜ì´ì§€
4 |  * ì—­í• : ì¹´ë“œ IDë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„¸ ì •ë³´ ì¡°íšŒ ë° í‘œì‹œ
5 |  * ì‘ì„±ì¼: 2024-05-28
6 |  */
7 | 
8 | import Link from "next/link";
9 | import { notFound } from "next/navigation";
10 | 
11 | import { ArrowLeft } from "lucide-react";
12 | import { Metadata } from "next";
13 | 
14 | import EditCardContent from "@/components/cards/EditCardContent";
15 | import { Button } from "@/components/ui/button";
16 | import prisma from "@/lib/prisma";
17 | 
18 | import DeleteButton from "./DeleteButton";
19 | 
20 | interface PageProps {
21 |   params: {
22 |     id: string;
23 |   };
24 | }
25 | 
26 | export async function generateMetadata({ params }: PageProps): Promise<Metadata> {
27 |   const cardId = String(params.id);
28 |   const card = await getCard(cardId);
29 | 
30 |   if (!card) {
31 |     return {
32 |       title: "ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ",
33 |     };
34 |   }
35 | 
36 |   return {
37 |     title: `${card.title} | Backyard`,
38 |   };
39 | }
40 | 
41 | async function getCard(id: string) {
42 |   try {
43 |     // @ts-expect-error - Prisma ìŠ¤í‚¤ë§ˆì™€ TypeScript íƒ€ì… ê°„ì˜ ë¶ˆì¼ì¹˜. CardTag ê´€ê³„ íƒ€ì… ë¬¸ì œ í•´ê²° í•„ìš”
44 |     const card = await prisma.card.findUnique({
45 |       where: { id },
46 |       include: {
47 |         user: true,
48 |         // @ts-expect-error - Prisma ìŠ¤í‚¤ë§ˆì—ì„œ CardTag ëª¨ë¸ì˜ ê´€ê³„ íƒ€ì…ê³¼ TypeScript íƒ€ì… ì •ì˜ ë¶ˆì¼ì¹˜
49 |         cardTags: {
50 |           include: {
51 |             tag: true,
52 |           },
53 |         },
54 |       },
55 |     });
56 |     return card;
57 |   } catch (error) {
58 |     console.error("ì¹´ë“œ ì¡°íšŒ ì˜¤ë¥˜:", error);
59 |     return null;
60 |   }
61 | }
62 | 
63 | export default async function CardPage({ params }: PageProps) {
64 |   const cardId = String(params.id);
65 |   const card = await getCard(cardId);
66 | 
67 |   if (!card) {
68 |     notFound();
69 |     // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë¹ˆ ì»´í¬ë„ŒíŠ¸ ë°˜í™˜ (notFound ì´í›„ì—ë„ ì½”ë“œê°€ ì‹¤í–‰ë  ìˆ˜ ìˆìŒ)
70 |     return <div data-testid="not-found"></div>;
71 |   }
72 | 
73 |   return (
74 |     <div className="container max-w-4xl py-6 space-y-8">
75 |       <div className="flex justify-between items-center">
[TRUNCATED]
```

src/components/ideamap/components/IdeaMap.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: IdeaMap.test.tsx
3 |  * ëª©ì : IdeaMap ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : IdeaMap ì»´í¬ë„ŒíŠ¸ì˜ ê¸°ëŠ¥ì„ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-01
7 |  * ìˆ˜ì •ì¼: 2024-05-17 : ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” importì™€ ë³€ìˆ˜ ì œê±°
8 |  */
9 | 
10 | import React from 'react';
11 | 
12 | import { render, screen, fireEvent } from '@testing-library/react';
13 | import { toast } from 'sonner';
14 | import { vi, describe, it, expect, beforeEach } from 'vitest';
15 | 
16 | import '@testing-library/jest-dom';
17 | import { mockReactFlow } from '@/tests/utils/react-flow-mock';
18 | 
19 | import IdeaMap from './IdeaMap';
20 | 
21 | // React Flow ëª¨í‚¹
22 | mockReactFlow();
23 | 
24 | // window ê°ì²´ ëª¨í‚¹ - addEventListener ë¬¸ì œ í•´ê²°
25 | Object.defineProperty(global, 'window', {
26 |   value: {
27 |     ...global.window,
28 |     addEventListener: vi.fn(),
29 |     removeEventListener: vi.fn(),
30 |   },
31 |   writable: true,
32 | });
33 | 
34 | // document.body ì„¤ì • - waitFor ë¬¸ì œ í•´ê²°
35 | document.body.innerHTML = '<div id="root"></div>';
36 | 
37 | // ëª¨ë“ˆ ëª¨í‚¹
38 | vi.mock('@xyflow/react', async () => {
39 |   const actual = await vi.importActual('@xyflow/react');
40 |   return {
41 |     ...actual,
42 |     useReactFlow: vi.fn(() => ({
43 |       screenToFlowPosition: vi.fn(({ x, y }) => ({ x, y })),
44 |       fitView: vi.fn(),
45 |       getNodes: vi.fn(() => []),
46 |       getEdges: vi.fn(() => []),
47 |       setNodes: vi.fn(),
48 |       setEdges: vi.fn(),
49 |     })),
50 |     useUpdateNodeInternals: vi.fn(() => vi.fn()),
51 |     Background: () => <div data-testid="react-flow-background" />,
52 |     Controls: () => <div data-testid="react-flow-controls" />,
53 |     Panel: ({ children, position }: any) => <div data-testid={`panel-${position}`}>{children}</div>,
54 |     ReactFlow: ({ children, nodes, edges }: any) => (
55 |       <div data-testid="react-flow-container">
56 |         <div data-testid="react-flow-nodes">{JSON.stringify(nodes)}</div>
57 |         <div data-testid="react-flow-edges">{JSON.stringify(edges)}</div>
58 |         {children}
59 |       </div>
60 |     ),
61 |   };
62 | });
63 | 
64 | // IdeaMap ì»´í¬ë„ŒíŠ¸ ìì²´ ëª¨í‚¹ìœ¼ë¡œ ë³€ê²½
65 | vi.mock('./IdeaMap', () => ({
[TRUNCATED]
```

src/components/ideamap/components/IdeaMap.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/ideamap/components/IdeaMap.tsx
3 |  * ëª©ì : ë³´ë“œ ë©”ì¸ ì»¨í…Œì´ë„ˆ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ë³´ë“œ ê¸°ëŠ¥ì˜ ë©”ì¸ UI ì»´í¬ë„ŒíŠ¸ë¡œ, React Flowì™€ ê´€ë ¨ í›…ì„ ì¡°í•©í•˜ì—¬ ì™„ì „í•œ ë³´ë“œ í™˜ê²½ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-17 : ë Œë”ë§ ìµœì í™” (ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€)
7 |  * ìˆ˜ì •ì¼: 2025-04-19 : ë¡œê·¸ ìµœì í™” - ê³¼ë„í•œ ì½˜ì†” ë¡œê·¸ ì œê±° ë° logger.debugë¡œ ë³€ê²½
8 |  */
9 | 
10 | 'use client';
11 | 
12 | import React, { useState, useEffect, useRef, useCallback, memo } from 'react';
13 | import { toast } from 'sonner';
14 | 
15 | import { useReactFlow } from '@xyflow/react';
16 | 
17 | import CreateCardModal from '@/components/cards/CreateCardModal';
18 | import { useAuth } from '@/hooks/useAuth';
19 | import { useAddNodeOnEdgeDrop } from '@/hooks/useAddNodeOnEdgeDrop';
20 | import { useAppStore } from '@/store/useAppStore';
21 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
22 | import createLogger from '@/lib/logger';
23 | 
24 | // ë³´ë“œ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ ì„í¬íŠ¸
25 | import IdeaMapCanvas from './IdeaMapCanvas';
26 | // ë³´ë“œ ê´€ë ¨ í›… ì„í¬íŠ¸
27 | import { useEdges } from '../hooks/useEdges';
28 | import { useIdeaMapData } from '../hooks/useIdeaMapData';
29 | import { useIdeaMapHandlers } from '../hooks/useIdeaMapHandlers';
30 | import { useNodeClickHandlers } from '../hooks/useNodes';
31 | // íƒ€ì… ì„í¬íŠ¸
32 | import { NodeInspector } from '../nodes/NodeInspector';
33 | import {
34 |   IdeaMapComponentProps,
35 |   XYPosition,
36 |   SafeRef,
37 |   IdeaMapSettings,
38 |   NodeChange
39 | } from '../types/ideamap-types';
40 | import { IDEAMAP_EDGES_STORAGE_KEY } from '@/lib/ideamap-constants';
41 | import { Node } from '@xyflow/react';
42 | 
43 | // ë¡œê±° ìƒì„±
44 | const logger = createLogger('IdeaMap');
45 | 
46 | /**
47 |  * IdeaMap: ì•„ì´ë””ì–´ë§µ ë©”ì¸ ì»¨í…Œì´ë„ˆ ì»´í¬ë„ŒíŠ¸
48 |  * @param onSelectCard ì¹´ë“œ ì„ íƒ ì‹œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜
49 |  * @param className ì¶”ê°€ CSS í´ë˜ìŠ¤
50 |  * @param showControls ì»¨íŠ¸ë¡¤ í‘œì‹œ ì—¬ë¶€
51 |  */
52 | function IdeaMap({
53 |   onSelectCard,
54 |   className = "",
55 |   showControls = true
56 | }: IdeaMapComponentProps) {
57 |   // logger.debug('ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì‹œì‘', { showControls });
58 | 
59 |   // ìƒíƒœ ê´€ë¦¬
60 |   const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);
61 | 
62 |   // ì—£ì§€ ë“œë¡­ ê´€ë ¨ ìƒíƒœ
63 |   const [isEdgeDropModalOpen, setIsEdgeDropModalOpen] = useState(false);
64 |   const [edgeDropPosition, setEdgeDropPosition] = useState<XYPosition | null>(null);
65 |   const [edgeDropNodeId, setEdgeDropNodeId] = useState<string | null>(null);
[TRUNCATED]
```

src/components/ideamap/components/IdeaMapCanvas.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: IdeaMapCanvas.test.tsx
3 |  * ëª©ì : IdeaMapCanvas ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : IdeaMapCanvas ì»´í¬ë„ŒíŠ¸ì˜ ë Œë”ë§ê³¼ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-01
7 |  * ìˆ˜ì •ì¼: 2023-10-27 : import ìˆœì„œ ë° ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±°
8 |  * ìˆ˜ì •ì¼: 2023-10-27 : ë¶ˆí•„ìš”í•œ props ì œê±° ë° í…ŒìŠ¤íŠ¸ í™˜ê²½ ìˆ˜ì •
9 |  */
10 | 
11 | import React from 'react';
12 | import { ReactNode } from 'react';
13 | 
14 | import { render, screen, fireEvent } from '@testing-library/react';
15 | 
16 | import '@testing-library/jest-dom';
17 | 
18 | import { MarkerType, ConnectionLineType, Node, Edge } from '@xyflow/react';
19 | import { vi, describe, it, expect, beforeEach } from 'vitest';
20 | 
21 | import { createTestNode, createTestEdge } from '@/tests/test-utils';
22 | 
23 | import IdeaMapCanvas from './IdeaMapCanvas';
24 | 
25 | // React Flow ëª¨í‚¹
26 | vi.mock('@xyflow/react', async () => {
27 |   const actual = await vi.importActual('@xyflow/react');
28 |   return {
29 |     ...actual,
30 |     Panel: ({
31 |       children,
32 |       className,
33 |       position = 'top-right',
34 |       ...props
35 |     }: {
36 |       children: ReactNode;
37 |       className?: string;
38 |       position?: string;
39 |       [key: string]: any;
40 |     }) => (
41 |       <div data-testid={`panel-${position}`} className={className} {...props}>
42 |         {children}
43 |       </div>
44 |     ),
45 |     ReactFlow: ({ children, onNodeClick, onPaneClick, defaultEdgeOptions, ...props }: {
46 |       children?: ReactNode;
47 |       onNodeClick?: (event: any, node: any) => void;
48 |       onPaneClick?: (event: any) => void;
49 |       defaultEdgeOptions?: any;
50 |       [key: string]: any;
51 |     }) => (
52 |       <div
53 |         className="react-flow"
54 |         data-testid="react-flow-container"
55 |         onClick={(e) => onPaneClick?.(e)}
56 |       >
57 |         <div data-testid="react-flow-nodes">
58 |           {props.nodes?.map((node: any) => (
59 |             <div
60 |               key={node.id}
61 |               data-testid={`node-${node.id}`}
62 |               onClick={(e) => onNodeClick?.(e, node)}
63 |             >
64 |               {JSON.stringify(node)}
65 |             </div>
66 |           ))}
67 |         </div>
68 |         <div data-testid="react-flow-edges">
69 |           {JSON.stringify(props.edges)}
70 |         </div>
71 |         <div data-testid="default-edge-options">
[TRUNCATED]
```

src/components/ideamap/components/IdeaMapCanvas.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/ideamap/components/IdeaMapCanvas.tsx
3 |  * ëª©ì : ReactFlow ìº”ë²„ìŠ¤ ë Œë”ë§ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : Board ì»´í¬ë„ŒíŠ¸ì—ì„œ ReactFlow ìº”ë²„ìŠ¤ ê´€ë ¨ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ë Œë”ë§ì„ ë‹´ë‹¹
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-03-30
7 |  * ìˆ˜ì •ì¼: 2023-10-27 : ESLint ì˜¤ë¥˜ ìˆ˜ì • (ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±°, any íƒ€ì… ìˆ˜ì •)
8 |  * ìˆ˜ì •ì¼: 2023-10-27 : wrapperRef íƒ€ì…ì„ SafeRefë¡œ ìˆ˜ì •
9 |  * ìˆ˜ì •ì¼: 2023-10-27 : import ìˆœì„œ ìˆ˜ì • ë° ë¯¸ì‚¬ìš© ë³€ìˆ˜(ConnectionLineType) ì œê±°
10 |  * ìˆ˜ì •ì¼: 2023-10-27 : connectionLineType íƒ€ì…ì„ ConnectionLineTypeìœ¼ë¡œ ìˆ˜ì •
11 |  * ìˆ˜ì •ì¼: 2024-05-30 : fitView ì˜µì…˜ì„ ê°œì„ í•˜ì—¬ ë…¸ë“œê°€ í•­ìƒ ë³´ì´ë„ë¡ ìˆ˜ì •
12 |  * ìˆ˜ì •ì¼: 2024-06-27 : fitView ì˜µì…˜ ê°œì„  ë° defaultViewport ì„¤ì • ê°•í™”
13 |  * ìˆ˜ì •ì¼: 2024-06-27 : ë·°í¬íŠ¸ ê´€ë¦¬ ë¡œì§ ì¶”ê°€ ë° ìë™ fitView ê¸°ëŠ¥ ê°œì„ 
14 |  * ìˆ˜ì •ì¼: 2024-06-28 : ë””ë²„ê¹…ì„ ìœ„í•œ console.log ì¶”ê°€
15 |  * ìˆ˜ì •ì¼: 2024-07-18 : ì—£ì§€ ê´€ë ¨ ë””ë²„ê¹… ë¡œê·¸ í™œì„±í™” ë° ë°ì´í„° í™•ì¸ ë¡œì§ ì¶”ê°€
16 |  */
17 | 
18 | 'use client';
19 | import React, { useMemo, useRef, useCallback, useEffect } from 'react';
20 | 
21 | import {
22 |   ReactFlow,
23 |   Controls,
24 |   Background,
25 |   ConnectionMode,
26 |   Node,
27 |   Edge,
28 |   NodeChange,
29 |   EdgeChange,
30 |   Connection,
31 |   OnConnectStart,
32 |   OnConnectEnd,
33 |   MarkerType,
34 |   Viewport,
35 |   ConnectionLineType,
36 |   ReactFlowInstance
37 | } from '@xyflow/react';
38 | 
39 | import { SafeRef } from '@/components/ideamap/types/ideamap-types';
40 | import { NODE_TYPES, EDGE_TYPES } from '@/lib/flow-constants';
41 | import { IdeaMapSettings, applyIdeaMapEdgeSettings } from '@/lib/ideamap-utils';
42 | // ë…¸ë“œ íƒ€ì…ê³¼ ì—£ì§€ íƒ€ì… ì»´í¬ë„ŒíŠ¸ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°
43 | // import CardNode from '@/components/ideamap/nodes/CardNode';
44 | // import CustomEdge from '@/components/ideamap/nodes/CustomEdge';
45 | // ë…¸ë“œ íƒ€ì… ì§ì ‘ ê°€ì ¸ì˜¤ê¸° ëŒ€ì‹  flow-constantsì—ì„œ ê°€ì ¸ì˜¤ê¸°
46 | import { cn } from '@/lib/utils';
47 | // ì‚­ì œ 3/29
48 | // import BoardControls from './BoardControls';
49 | 
50 | interface IdeaMapCanvasProps {
51 |   /** ReactFlow ë…¸ë“œ ë°°ì—´ */
52 |   nodes: Node[];
53 |   /** ReactFlow ì—£ì§€ ë°°ì—´ */
54 |   edges: Edge[];
55 |   /** ë…¸ë“œ ë³€ê²½ í•¸ë“¤ëŸ¬ */
56 |   onNodesChange: (changes: NodeChange[]) => void;
57 |   /** ì—£ì§€ ë³€ê²½ í•¸ë“¤ëŸ¬ */
58 |   onEdgesChange: (changes: EdgeChange[]) => void;
59 |   /** ì—°ê²° ìƒì„± í•¸ë“¤ëŸ¬ */
60 |   onConnect: (connection: Connection) => void;
61 |   /** ì—°ê²° ì‹œì‘ í•¸ë“¤ëŸ¬ */
[TRUNCATED]
```

src/components/ideamap/hooks/test-utils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: test-utils.ts
3 |  * ëª©ì : ë³´ë“œ í•¸ë“¤ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ë° ëª¨í‚¹ ê°ì²´ ì œê³µ
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ ì„¤ì •, ì •ë¦¬, ëª¨í‚¹ëœ ì•¡ì…˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  */
7 | 
8 | import { ReactNode } from 'react';
9 | 
10 | import { renderHook } from '@testing-library/react';
11 | import { Node, Edge, XYPosition } from '@xyflow/react';
12 | import { vi } from 'vitest';
13 | import { create } from 'zustand';
14 | 
15 | 
16 | 
17 | // ì¹´ë“œ ë°ì´í„° íƒ€ì… ì •ì˜
18 | export interface CardData extends Record<string, unknown> {
19 |   id: string;
20 |   title: string;
21 |   content: string;
22 | }
23 | 
24 | // Zustand ìŠ¤í† ì–´ íƒ€ì… ì •ì˜
25 | interface AppStore {
26 |   selectedCardIds: string[];
27 |   selectCards: (cardIds: string[]) => void;
28 | }
29 | 
30 | // í…ŒìŠ¤íŠ¸ ë…¸ë“œ ë°ì´í„°
31 | const TEST_NODES: Node<CardData>[] = [
32 |   {
33 |     id: 'node1',
34 |     position: { x: 0, y: 0 },
35 |     data: { id: 'card1', title: 'ì¹´ë“œ 1', content: 'ë‚´ìš© 1' },
36 |     type: 'card',
37 |   },
38 |   {
39 |     id: 'node2',
40 |     position: { x: 100, y: 100 },
41 |     data: { id: 'card2', title: 'ì¹´ë“œ 2', content: 'ë‚´ìš© 2' },
42 |     type: 'card',
43 |   },
44 | ];
45 | 
46 | // Zustand ìŠ¤í† ì–´ ëª¨í‚¹
47 | export const mockStore = create<AppStore>((set) => ({
48 |   selectedCardIds: [],
49 |   selectCards: (cardIds: string[]) => {
50 |     console.log('[AppStore] ì¹´ë“œ ì„ íƒ ë³€ê²½:', cardIds);
51 |     set({ selectedCardIds: cardIds });
52 |   },
53 | }));
54 | 
55 | // ëª¨í‚¹ëœ ì•¡ì…˜ë“¤
56 | export const mockActions = {
57 |   store: {
58 |     saveLayout: vi.fn((nodesToSave?: Node<CardData>[]) => true),
59 |     setNodes: vi.fn((updater: ((nodes: Node<CardData>[]) => Node<CardData>[]) | Node<CardData>[]) => void {}),
60 |     fetchCards: vi.fn(async () => ({ nodes: TEST_NODES, edges: [] })),
61 |   },
62 |   selection: {
63 |     handleSelectionChange: vi.fn(({ nodes }: { nodes: Node[]; edges: Edge[] }) => void {}),
64 |   },
65 | };
66 | 
67 | /**
68 |  * createTestNodes: í…ŒìŠ¤íŠ¸ìš© ë…¸ë“œ ìƒì„±
69 |  * @returns {Node<CardData>[]} í…ŒìŠ¤íŠ¸ìš© ë…¸ë“œ ë°°ì—´
70 |  */
71 | export const createTestNodes = (): Node<CardData>[] => TEST_NODES;
72 | 
73 | /**
74 |  * createReactFlowWrapper: ReactFlow ë˜í¼ ìš”ì†Œ ìƒì„±
75 |  * @returns {React.RefObject<HTMLDivElement>} ReactFlow ë˜í¼ ìš”ì†Œì˜ ref ê°ì²´
76 |  */
77 | export const createReactFlowWrapper = () => {
[TRUNCATED]
```

src/components/ideamap/hooks/useEdges.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: useEdges.test.tsx
3 |  * ëª©ì : useEdges ì»¤ìŠ¤í…€ í›… í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì—£ì§€ ê´€ë ¨ í›…ì´ useIdeaMapStore ì•¡ì…˜ì„ ì˜¬ë°”ë¥´ê²Œ í˜¸ì¶œí•˜ëŠ”ì§€ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-11 (ë¦¬íŒ©í† ë§)
7 |  */
8 | 
9 | import { renderHook, act } from '@testing-library/react';
10 | import { Edge, Connection, Node, MarkerType, ConnectionLineType, Position, EdgeChange } from '@xyflow/react';
11 | import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
12 | 
13 | import { IdeaMapSettings } from '@/lib/ideamap-utils';
14 | 
15 | // ëª¨ë“  ëª¨í‚¹ì€ íŒŒì¼ ìµœìƒë‹¨ì— ìœ„ì¹˜
16 | vi.mock('sonner', () => ({
17 |   toast: {
18 |     success: vi.fn(),
19 |     info: vi.fn(),
20 |     error: vi.fn(),
21 |   }
22 | }));
23 | 
24 | // useIdeaMapStore ëª¨í‚¹
25 | vi.mock('@/store/useIdeaMapStore', () => {
26 |   const mockApplyEdgeChangesAction = vi.fn();
27 |   const mockConnectNodesAction = vi.fn();
28 |   const mockSaveEdgesAction = vi.fn().mockReturnValue(true);
29 |   const mockUpdateAllEdgeStylesAction = vi.fn();
30 |   const mockCreateEdgeOnDropAction = vi.fn();
31 |   const mockSetEdges = vi.fn();
32 | 
33 |   const edges = [{
34 |     id: 'edge-1',
35 |     source: 'node-1',
36 |     target: 'node-2',
37 |     type: 'custom',
38 |   }];
39 | 
40 |   return {
41 |     useIdeaMapStore: (selector: ((state: any) => any) | undefined) => {
42 |       if (typeof selector === 'function') {
43 |         const state = {
44 |           edges,
45 |           setEdges: mockSetEdges,
46 |           applyEdgeChangesAction: mockApplyEdgeChangesAction,
47 |           connectNodesAction: mockConnectNodesAction,
48 |           saveEdgesAction: mockSaveEdgesAction,
49 |           updateAllEdgeStylesAction: mockUpdateAllEdgeStylesAction,
50 |           createEdgeOnDropAction: mockCreateEdgeOnDropAction,
51 |           hasUnsavedChanges: false
52 |         };
53 |         return selector(state);
54 |       }
55 |       return {
56 |         edges,
57 |         setEdges: mockSetEdges,
58 |         applyEdgeChangesAction: mockApplyEdgeChangesAction,
59 |         connectNodesAction: mockConnectNodesAction,
60 |         saveEdgesAction: mockSaveEdgesAction,
61 |         updateAllEdgeStylesAction: mockUpdateAllEdgeStylesAction,
62 |         createEdgeOnDropAction: mockCreateEdgeOnDropAction,
63 |         hasUnsavedChanges: false
64 |       };
65 |     }
66 |   };
67 | });
68 | 
69 | // React Flow ëª¨í‚¹
70 | vi.mock('@xyflow/react', async () => {
71 |   const actual = await vi.importActual('@xyflow/react');
72 |   return {
73 |     ...actual,
74 |   };
75 | });
76 | 
77 | // í…ŒìŠ¤íŠ¸í•  í›… ì„í¬íŠ¸
78 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
79 | 
80 | import { useEdges } from './useEdges';
81 | 
82 | // í…ŒìŠ¤íŠ¸ìš© ë³´ë“œ ì„¤ì •
[TRUNCATED]
```

src/components/ideamap/hooks/useEdges.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: useEdges.ts
3 |  * ëª©ì : ì—£ì§€ ê´€ë ¨ ìƒíƒœ ë° ë¡œì§ ê´€ë¦¬
4 |  * ì—­í• : useIdeaMapStoreì˜ ì—£ì§€ ê´€ë ¨ ì•¡ì…˜ë“¤ì„ ì‚¬ìš©í•˜ëŠ” ë˜í¼ í›…
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-11
7 |  */
8 | 
9 | import { useCallback } from 'react';
10 | 
11 | import { Edge, Connection, Node, EdgeChange } from '@xyflow/react';
12 | 
13 | import { IdeaMapSettings } from '@/lib/ideamap-utils';
14 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
15 | 
16 | /**
17 |  * useEdges: useIdeaMapStoreì˜ ì—£ì§€ ê´€ë ¨ ì•¡ì…˜ë“¤ì„ ì‚¬ìš©í•˜ëŠ” ë˜í¼ í›…
18 |  * @param ideaMapSettings ì•„ì´ë””ì–´ë§µ ì„¤ì • ê°ì²´
19 |  * @param nodes ë…¸ë“œ ë°°ì—´
20 |  * @param initialEdges ì´ˆê¸° ì—£ì§€ ë°ì´í„° (ì˜µì…˜)
21 |  * @returns ì—£ì§€ ê´€ë ¨ ìƒíƒœ ë° í•¨ìˆ˜ë“¤
22 |  */
23 | export function useEdges({
24 |   ideaMapSettings,
25 |   nodes,
26 |   initialEdges = []
27 | }: {
28 |   ideaMapSettings: IdeaMapSettings;
29 |   nodes: Node[];
30 |   initialEdges?: Edge[];
31 | }) {
32 |   // useIdeaMapStoreì—ì„œ ì—£ì§€ ê´€ë ¨ ìƒíƒœ ë° ì•¡ì…˜ ê°€ì ¸ì˜¤ê¸°
33 |   const edges = useIdeaMapStore(state => state.edges);
34 |   const setEdges = useIdeaMapStore(state => state.setEdges);
35 |   const applyEdgeChangesAction = useIdeaMapStore(state => state.applyEdgeChangesAction);
36 |   const connectNodesAction = useIdeaMapStore(state => state.connectNodesAction);
37 |   const saveEdgesAction = useIdeaMapStore(state => state.saveEdgesAction);
38 |   const updateAllEdgeStylesAction = useIdeaMapStore(state => state.updateAllEdgeStylesAction);
39 |   const createEdgeOnDropAction = useIdeaMapStore(state => state.createEdgeOnDropAction);
40 |   const hasUnsavedChanges = useIdeaMapStore(state => state.hasUnsavedChanges);
41 | 
42 |   // ì—£ì§€ ë³€ê²½ í•¸ë“¤ëŸ¬ (ë‹¨ìˆœíˆ useIdeaMapStore ì•¡ì…˜ í˜¸ì¶œ)
43 |   const handleEdgesChange = useCallback((changes: EdgeChange[]) => {
44 |     applyEdgeChangesAction(changes);
45 |   }, [applyEdgeChangesAction]);
46 | 
47 |   // ë…¸ë“œ ì—°ê²° í•¸ë“¤ëŸ¬ (ë‹¨ìˆœíˆ useIdeaMapStore ì•¡ì…˜ í˜¸ì¶œ)
48 |   const onConnect = useCallback((params: Connection) => {
49 |     connectNodesAction(params);
50 |   }, [connectNodesAction]);
51 | 
52 |   // ì—£ì§€ ì €ì¥ í•¨ìˆ˜ (ë‹¨ìˆœíˆ useIdeaMapStore ì•¡ì…˜ í˜¸ì¶œ)
53 |   const saveEdges = useCallback((edgesToSave?: Edge[]) => {
54 |     // íŠ¹ì • ì—£ì§€ ëª©ë¡ì´ ì œê³µë˜ë©´ ë¨¼ì € ìƒíƒœ ì—…ë°ì´íŠ¸
55 |     if (edgesToSave) {
56 |       setEdges(edgesToSave);
57 |     }
58 |     return saveEdgesAction();
59 |   }, [setEdges, saveEdgesAction]);
60 | 
61 |   // ì—£ì§€ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ë‹¨ìˆœíˆ useIdeaMapStore ì•¡ì…˜ í˜¸ì¶œ)
62 |   const updateEdgeStyles = useCallback(() => {
63 |     updateAllEdgeStylesAction();
64 |   }, [updateAllEdgeStylesAction]);
65 | 
66 |   // ì—£ì§€ ìƒì„± í•¨ìˆ˜ (ë‹¨ìˆœíˆ useIdeaMapStore ì•¡ì…˜ í˜¸ì¶œ)
[TRUNCATED]
```

src/components/ideamap/hooks/useIdeaMapData.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/components/ideamap/hooks/useIdeaMapData.test.tsx
3 |  * ëª©ì : useIdeaMapData í›…ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µ ë°ì´í„° ë¡œë”© ë° ë¡œë”© ìƒíƒœ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2023-04-10
6 |  * ìˆ˜ì •ì¼: 2025-05-05
7 |  * ìˆ˜ì •ì¼: 2025-05-06 : ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±° ë° ESLint ì˜¤ë¥˜ ìˆ˜ì •
8 |  * ìˆ˜ì •ì¼: 2025-05-07 : IdeaMapState ì¸í„°í˜ì´ìŠ¤ì— ëˆ„ë½ëœ ì†ì„± ì¶”ê°€
9 |  * ìˆ˜ì •ì¼: 2025-05-07 : ë‚¨ì•„ìˆëŠ” ESLint ì˜¤ë¥˜ ìˆ˜ì •
10 |  */
11 | 
12 | import { renderHook, act } from '@testing-library/react';
13 | import { ConnectionLineType, MarkerType } from '@xyflow/react';
14 | import { http, HttpResponse } from 'msw';
15 | import { describe, it, expect, beforeEach, vi, afterEach, afterAll, beforeAll } from 'vitest';
16 | 
17 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
18 | import { mockLocalStorage } from '@/tests/mocks/storage-mock';
19 | import { server } from '@/tests/msw/server';
20 | 
21 | import { useIdeaMapData } from './useIdeaMapData';
22 | 
23 | // ëª¨ë“  ëª¨í‚¹ì€ íŒŒì¼ ìƒë‹¨ì— ê·¸ë£¹í™”
24 | // ì™¸ë¶€ ëª¨ë“ˆë¶€í„° ëª¨í‚¹ (í˜¸ì´ìŠ¤íŒ… ê³ ë ¤)
25 | // @xyflow/react ëª¨í‚¹
26 | const mockFitView = vi.fn().mockResolvedValue(undefined);
27 | const mockSetViewport = vi.fn().mockResolvedValue(undefined);
28 | const mockGetZoom = vi.fn().mockReturnValue(1);
29 | const mockGetViewport = vi.fn().mockReturnValue({ x: 0, y: 0, zoom: 1 });
30 | 
31 | vi.mock('@xyflow/react', async () => {
32 |   const actual = await vi.importActual('@xyflow/react');
33 |   return {
34 |     ...actual,
35 |     useReactFlow: () => ({
36 |       fitView: mockFitView,
37 |       setViewport: mockSetViewport,
38 |       getZoom: mockGetZoom,
39 |       getViewport: mockGetViewport
40 |     })
41 |   };
42 | });
43 | 
44 | // loadIdeaMapData ëª¨í‚¹ì„ ìœ„í•œ í•¨ìˆ˜
45 | const mockLoadIdeaMapData = vi.fn().mockResolvedValue(undefined);
46 | 
47 | // ê¸°ë³¸ ìƒíƒœ ê°ì²´ ì •ì˜ - IdeaMapState ì¸í„°í˜ì´ìŠ¤ì— ë§ì¶° ëª¨ë“  í•„ìˆ˜ ì†ì„± í¬í•¨
48 | const createMockState = (overrides = {}) => ({
49 |   // ë…¸ë“œ ê´€ë ¨
50 |   nodes: [{
51 |     id: 'node-1',
52 |     position: { x: 0, y: 0 },
53 |     data: {
54 |       id: 'card-1',
55 |       title: 'ì¹´ë“œ 1',
56 |       content: 'ì¹´ë“œ 1 ë‚´ìš©',
57 |       tags: []
58 |     }
59 |   }],
60 |   setNodes: vi.fn(),
61 |   onNodesChange: vi.fn(),
62 | 
63 |   // ì—£ì§€ ê´€ë ¨
64 |   edges: [{ id: 'edge-1', source: 'node-1', target: 'node-2' }],
65 |   setEdges: vi.fn(),
[TRUNCATED]
```

src/components/ideamap/hooks/useIdeaMapData.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: useIdeaMapData.ts
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ ë°ì´í„° ë¡œë“œ ë° ê´€ë¦¬ë¥¼ ìœ„í•œ ì»¤ìŠ¤í…€ í›…
4 |  * ì—­í• : useIdeaMapStoreì—ì„œ ì•„ì´ë””ì–´ë§µ ë°ì´í„°ì™€ ë¡œë”© ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” ë˜í¼ í›…
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-10
7 |  * ìˆ˜ì •ì¼: 2025-04-17 : ë Œë”ë§ ìµœì í™” (ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€)
8 |  * ìˆ˜ì •ì¼: 2025-04-19 : ë¡œê·¸ ìµœì í™” - ê³¼ë„í•œ ì½˜ì†” ë¡œê·¸ ì œê±° ë° logger.debugë¡œ ë³€ê²½
9 |  * ìˆ˜ì •ì¼: 2025-04-19 : ê°œë°œ í™˜ê²½ì—ì„œ useEffect ì´ì¤‘ ì‹¤í–‰ ë°©ì§€ ë¡œì§ ì¶”ê°€
10 |  * ìˆ˜ì •ì¼: 2025-05-07 : setCards í˜¸ì¶œ ì‹œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ë„ë¡ ìˆ˜ì •
11 |  */
12 | 
13 | import { Edge } from '@xyflow/react';
14 | import { useState, useCallback, useEffect, useRef } from 'react';
15 | import { Node } from '@xyflow/react';
16 | import { useAppStore } from '@/store/useAppStore';
17 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
18 | import createLogger from '@/lib/logger';
19 | 
20 | import { Node as NodeType, CardData } from '../types/ideamap-types';
21 | 
22 | // ë¡œê±° ìƒì„±
23 | const logger = createLogger('useIdeaMapData');
24 | 
25 | /**
26 |  * useIdeaMapData: ì•„ì´ë””ì–´ë§µ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ê´€ë¦¬í•˜ëŠ” í›…
27 |  * @param onSelectCard ì¹´ë“œ ì„ íƒ ì‹œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜
28 |  * @returns {Object} ì•„ì´ë””ì–´ë§µ ë°ì´í„° ê´€ë ¨ ìƒíƒœì™€ í•¨ìˆ˜ë“¤
29 |  */
30 | export function useIdeaMapData(onSelectCard: (cardId: string) => void) {
31 |   // logger.debug('í›… ì´ˆê¸°í™”');
32 |   
33 |   // ìƒíƒœ ê´€ë¦¬
34 |   const [isLoading, setIsLoading] = useState(true);
35 |   const [error, setError] = useState<Error | null>(null);
36 |   
37 |   // ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì™„ë£Œ ì—¬ë¶€ ì¶”ì 
38 |   const initialLoadCompleteRef = useRef(false);
39 |   // ê°œë°œ í™˜ê²½ì—ì„œ Strict Modeë¡œ ì¸í•œ ì´ì¤‘ ì‹¤í–‰ ë°©ì§€ë¥¼ ìœ„í•œ ref
40 |   const didFetch = useRef(false);
41 |   
42 |   // ì•„ì´ë””ì–´ë§µ ìŠ¤í† ì–´ì—ì„œ í•„ìš”í•œ ìƒíƒœì™€ ì•¡ì…˜ë§Œ ì„ íƒì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
43 |   const nodes = useIdeaMapStore(state => state.nodes);
44 |   const edges = useIdeaMapStore(state => state.edges);
45 |   const isIdeaMapLoading = useIdeaMapStore(state => state.isIdeaMapLoading);
46 |   const ideaMapError = useIdeaMapStore(state => state.ideaMapError);
47 |   const loadIdeaMapData = useIdeaMapStore(state => state.loadIdeaMapData);
48 |   const loadedViewport = useIdeaMapStore(state => state.loadedViewport);
49 |   const needsFitView = useIdeaMapStore(state => state.needsFitView);
50 |   
51 |   // ì•± ìŠ¤í† ì–´ì—ì„œ í•„ìš”í•œ ì•¡ì…˜ë§Œ ì„ íƒì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
52 |   const setCards = useAppStore(state => state.setCards);
53 |   
54 |   /**
[TRUNCATED]
```

src/components/ideamap/hooks/useIdeaMapHandlers.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: useIdeaMapHandlers.test.tsx
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ í•¸ë“¤ëŸ¬ í›…ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì„ íƒ, ë“œë˜ê·¸ ì•¤ ë“œë¡­, ì¹´ë“œ ìƒì„± í•¸ë“¤ëŸ¬ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-11
7 |  */
8 | 
9 | import { act } from '@testing-library/react';
10 | import { renderHook } from '@testing-library/react';
11 | import { Node, Edge } from '@xyflow/react';
12 | import { vi, describe, it, expect, beforeEach, afterEach } from 'vitest';
13 | 
14 | import { useAppStore } from '@/store/useAppStore';
15 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
16 | import {
17 |   createTestNode,
18 |   createDragEvent,
19 |   createMouseEvent,
20 |   mockReactFlow
21 | } from '@/tests/test-utils';
22 | 
23 | import { useIdeaMapHandlers } from './useIdeaMapHandlers';
24 | import { CardData } from '../types/ideamap-types';
25 | 
26 | // Zustand ìŠ¤í† ì–´ ëª¨í‚¹
27 | const mockSelectCards = vi.fn();
28 | vi.mock('@/store/useAppStore', () => ({
29 |   useAppStore: vi.fn((selector) => {
30 |     const state = {
31 |       selectedCardIds: [],
32 |       selectCards: mockSelectCards,
33 |     };
34 |     return selector ? selector(state) : state;
35 |   }),
36 | }));
37 | 
38 | // useIdeaMapStore ëª¨í‚¹
39 | const mockAddNodeAtPosition = vi.fn().mockResolvedValue({ id: 'new-node', data: { title: 'ìƒˆ ë…¸ë“œ' } });
40 | const mockAddCardAtCenterPosition = vi.fn().mockResolvedValue({ id: 'new-card', data: { title: 'ìƒˆ ì¹´ë“œ' } });
41 | const mockCreateEdgeAndNodeOnDrop = vi.fn().mockResolvedValue({ id: 'edge-node', data: { title: 'ì—°ê²° ë…¸ë“œ' } });
42 | 
43 | vi.mock('@/store/useIdeaMapStore', () => ({
44 |   useIdeaMapStore: vi.fn((selector) => {
45 |     const state = {
46 |       addNodeAtPosition: mockAddNodeAtPosition,
47 |       addCardAtCenterPosition: mockAddCardAtCenterPosition,
48 |       createEdgeAndNodeOnDrop: mockCreateEdgeAndNodeOnDrop,
49 |     };
50 |     return selector ? selector(state) : state;
51 |   }),
52 | }));
53 | 
54 | describe('useIdeaMapHandlers', () => {
55 |   // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¤€ë¹„
56 |   const testNodes = [
57 |     createTestNode('card1'),
58 |     createTestNode('card2'),
59 |   ];
60 | 
61 |   // HTMLDivElement ìƒì„±
62 |   const divElement = document.createElement('div');
63 |   Object.defineProperties(divElement, {
64 |     getBoundingClientRect: {
65 |       value: () => ({
66 |         left: 0,
67 |         top: 0,
68 |         right: 800,
69 |         bottom: 600,
70 |         width: 800,
71 |         height: 600,
72 |       }),
73 |     },
74 |   });
75 | 
76 |   const mockProps = {
77 |     reactFlowWrapper: { current: divElement } as React.RefObject<HTMLDivElement>,
78 |     reactFlowInstance: mockReactFlow,
[TRUNCATED]
```

src/components/ideamap/hooks/useIdeaMapHandlers.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: useBoardHandlers.ts
3 |  * ëª©ì : ë³´ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ê´€ë ¨ ë¡œì§ ë¶„ë¦¬
4 |  * ì—­í• : ë³´ë“œ ë“œë˜ê·¸, ë“œë¡­, ì„ íƒ ë“± ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ì„ ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-11
7 |  */
8 | 
9 | import { useCallback } from 'react';
10 | 
11 | import { Node, Edge, XYPosition } from '@xyflow/react';
12 | 
13 | import { useAppStore } from '@/store/useAppStore';
14 | import { useIdeaMapStore } from '@/store/useIdeaMapStore';
15 | 
16 | import { CardData } from '../types/ideamap-types';
17 | 
18 | /**
19 |  * useIdeaMapHandlers: ì•„ì´ë””ì–´ë§µ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ê´€ë ¨ ë¡œì§ì„ ê´€ë¦¬í•˜ëŠ” í›…
20 |  * @param reactFlowWrapper ReactFlow ë˜í¼ ì°¸ì¡°
21 |  * @param reactFlowInstance ReactFlow ì¸ìŠ¤í„´ìŠ¤
22 |  * @param fetchCards ì¹´ë“œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
23 |  * @returns ì•„ì´ë””ì–´ë§µ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
24 |  */
25 | export function useIdeaMapHandlers({
26 |   reactFlowWrapper,
27 |   reactFlowInstance,
28 |   fetchCards
29 | }: {
30 |   reactFlowWrapper: React.RefObject<HTMLDivElement>;
31 |   reactFlowInstance: any;
32 |   fetchCards: () => Promise<{ nodes: Node<CardData>[]; edges: Edge[] }>;
33 | }) {
34 |   // ì „ì—­ ìƒíƒœì—ì„œ ì„ íƒëœ ì¹´ë“œ ì •ë³´ ë° ì•¡ì…˜ ê°€ì ¸ì˜¤ê¸°
35 |   const { selectCards } = useAppStore();
36 |   
37 |   // ì•„ì´ë””ì–´ë§µ ìŠ¤í† ì–´ì—ì„œ ë…¸ë“œ ì¶”ê°€ ê´€ë ¨ ì•¡ì…˜ ê°€ì ¸ì˜¤ê¸°
38 |   const addNodeAtPosition = useIdeaMapStore(state => state.addNodeAtPosition);
39 |   const addCardAtCenterPosition = useIdeaMapStore(state => state.addCardAtCenterPosition);
40 |   const createEdgeAndNodeOnDrop = useIdeaMapStore(state => state.createEdgeAndNodeOnDrop);
41 | 
42 |   /**
43 |    * ReactFlow ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
44 |    * @param selection í˜„ì¬ ì„ íƒëœ ë…¸ë“œì™€ ì—£ì§€ ì •ë³´
45 |    */
46 |   const handleSelectionChange = useCallback(({ nodes }: { nodes: Node<CardData>[]; edges: Edge[] }) => {
47 |     console.log('[IdeaMapComponent] ì„ íƒ ë³€ê²½ ê°ì§€:', { 
48 |       ì„ íƒëœ_ë…¸ë“œ_ìˆ˜: nodes.length,
49 |       ì„ íƒëœ_ë…¸ë“œ_ID: nodes.map(node => node.data.id)
50 |     });
51 | 
52 |     // ì„ íƒëœ ë…¸ë“œ ID ë°°ì—´ ì¶”ì¶œ
53 |     const selectedNodeIds = nodes.map(node => node.data.id);
54 |     
55 |     // ì „ì—­ ìƒíƒœ ì—…ë°ì´íŠ¸
56 |     selectCards(selectedNodeIds);
57 |   }, [selectCards]);
58 | 
59 |   /**
60 |    * ë“œë˜ê·¸ ì˜¤ë²„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
61 |    * @param event ë“œë˜ê·¸ ì´ë²¤íŠ¸
62 |    */
63 |   const onDragOver = useCallback((event: React.DragEvent) => {
64 |     event.preventDefault();
65 |     event.dataTransfer.dropEffect = 'move';
66 |   }, []);
67 | 
68 |   /**
69 |    * ë“œë¡­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
70 |    * @param event ë“œë¡­ ì´ë²¤íŠ¸
71 |    */
[TRUNCATED]
```

src/components/ideamap/hooks/useIdeaMapUtils.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: useIdeaMapUtils.test.tsx
3 |  * ëª©ì : useIdeaMapUtils í›…ì„ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ê´€ë ¨ ê¸°ëŠ¥ì„ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-01
7 |  */
8 | 
9 | import { renderHook, act } from '@testing-library/react';
10 | import { ConnectionLineType, MarkerType, Node, Edge, Viewport } from '@xyflow/react';
11 | import { http, HttpResponse } from 'msw';
12 | import { toast } from 'sonner';
13 | import { vi, expect, beforeEach, afterEach, beforeAll, afterAll } from 'vitest';
14 | 
15 | import { IDEAMAP_TRANSFORM_KEY } from '@/lib/ideamap-constants';
16 | import { IdeaMapSettings, saveIdeaMapSettingsToServer, loadIdeaMapSettingsFromServer } from '@/lib/ideamap-utils';
17 | import { getGridLayout, getLayoutedElements } from '@/lib/layout-utils';
18 | import { useAppStore } from '@/store/useAppStore';
19 | import { AppState } from '@/store/useAppStore';
20 | import { server } from '@/tests/msw/server';
21 | import { mockReactFlow } from '@/tests/utils/react-flow-mock';
22 | 
23 | import { useIdeaMapUtils } from './useIdeaMapUtils';
24 | 
25 | // MSW ì„œë²„ ì„¤ì •
26 | beforeAll(() => server.listen());
27 | afterEach(() => server.resetHandlers());
28 | afterAll(() => server.close());
29 | 
30 | // ê¸°ë³¸ ëª¨ì˜ ì—£ì§€ ë°°ì—´ ìƒì„±
31 | const defaultMockEdges = [
32 |   { id: 'edge-mock-1', source: 'node1', target: 'node2' },
33 | ];
34 | 
35 | // ê¸°ë³¸ ëª¨ì˜ ë…¸ë“œ ë°°ì—´ ìƒì„±
36 | const defaultLayoutedNodes = [
37 |   { id: 'node1', position: { x: 0, y: 0 }, data: { title: 'ì¹´ë“œ 1', content: 'ë‚´ìš© 1' } },
38 |   { id: 'node2', position: { x: 100, y: 100 }, data: { title: 'ì¹´ë“œ 2', content: 'ë‚´ìš© 2' } },
39 | ];
40 | 
41 | // ëª¨ë“  vi.mock í˜¸ì¶œì„ ë¨¼ì € ìˆ˜í–‰
42 | vi.mock('@xyflow/react', async () => {
43 |   const actual = await vi.importActual('@xyflow/react');
44 |   return {
45 |     ...actual,
46 |     useReactFlow: () => ({
47 |       ...mockReactFlow,
48 |       getViewport: () => ({ x: 100, y: 200, zoom: 2 }),
49 |     }),
50 |     MarkerType: {
51 |       ArrowClosed: 'arrowclosed',
52 |     },
53 |     ConnectionLineType: {
54 |       Bezier: 'bezier',
55 |       Step: 'step',
56 |       SmoothStep: 'smoothstep',
57 |       Straight: 'straight',
58 |     }
59 |   };
60 | });
61 | 
62 | // Zustand ìŠ¤í† ì–´ ëª¨í‚¹
63 | vi.mock('@/store/useAppStore', () => {
64 |   const setIdeaMapSettingsMock = vi.fn();
65 | 
66 |   return {
67 |     useAppStore: (selector: ((state: Partial<AppState>) => any) | undefined) => {
68 |       if (typeof selector === 'function') {
[TRUNCATED]
```

src/components/ideamap/hooks/useIdeaMapUtils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: useIdeaMapUtils.ts
3 |  * ëª©ì : ì•„ì´ë””ì–´ë§µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ê´€ë ¨ ë¡œì§ ë¶„ë¦¬
4 |  * ì—­í• : ì•„ì´ë””ì–´ë§µ ë ˆì´ì•„ì›ƒ, ì €ì¥, ì´ˆê¸°í™” ë“± ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë¥¼ ê´€ë¦¬
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : ë¯¸ì‚¬ìš© import ë° ë³€ìˆ˜ ì œê±°, useCallback ì˜ì¡´ì„± ë°°ì—´ ìˆ˜ì •
7 |  */
8 | 
9 | import { useCallback, useRef } from 'react';
10 | 
11 | import { Node, Edge, useReactFlow } from '@xyflow/react';
12 | import { toast } from 'sonner';
13 | 
14 | import { IDEAMAP_TRANSFORM_STORAGE_KEY } from '@/lib/ideamap-constants';
15 | import {
16 |   IdeaMapSettings,
17 |   loadIdeaMapSettingsFromServer,
18 |   saveIdeaMapSettingsToServer
19 | } from '@/lib/ideamap-utils';
20 | import { getGridLayout, getLayoutedElements } from '@/lib/layout-utils';
21 | import { useAppStore } from '@/store/useAppStore';
22 | 
23 | import { CardData } from '../types/ideamap-types';
24 | 
25 | /**
26 |  * useIdeaMapUtils: ì•„ì´ë””ì–´ë§µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ê´€ë ¨ ë¡œì§ì„ ê´€ë¦¬í•˜ëŠ” í›…
27 |  * @param reactFlowWrapper ReactFlow ë˜í¼ ì°¸ì¡°
28 |  * @param saveLayout ë ˆì´ì•„ì›ƒ ì €ì¥ í•¨ìˆ˜
29 |  * @param saveEdges ì—£ì§€ ì €ì¥ í•¨ìˆ˜
30 |  * @param nodes í˜„ì¬ ë…¸ë“œ ë°°ì—´
31 |  * @param edges í˜„ì¬ ì—£ì§€ ë°°ì—´
32 |  * @param setNodes ë…¸ë“œ ìƒíƒœ ì„¤ì • í•¨ìˆ˜
33 |  * @param setEdges ì—£ì§€ ìƒíƒœ ì„¤ì • í•¨ìˆ˜
34 |  * @returns ì•„ì´ë””ì–´ë§µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
35 |  */
36 | export function useIdeaMapUtils({
37 |   reactFlowWrapper,
38 |   saveLayout,
39 |   saveEdges,
40 |   nodes,
41 |   edges,
42 |   setNodes,
43 |   setEdges
44 | }: {
45 |   reactFlowWrapper: React.RefObject<HTMLDivElement | null>;
46 |   updateNodeInternals?: (nodeId: string) => void;
47 |   saveLayout: (nodesToSave?: Node<CardData>[]) => boolean;
48 |   saveEdges: (edgesToSave?: Edge[]) => boolean;
49 |   nodes: Node<CardData>[];
50 |   edges: Edge[];
51 |   setNodes: (updater: ((nodes: Node<CardData>[]) => Node<CardData>[]) | Node<CardData>[]) => void;
52 |   setEdges: (updater: ((edges: Edge[]) => Edge[]) | Edge[]) => void;
53 | }) {
54 |   // ì „ì—­ ìƒíƒœì—ì„œ ì•„ì´ë””ì–´ë§µ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
55 |   const { setIdeaMapSettings } = useAppStore();
56 |   
57 |   // ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ í”Œë˜ê·¸
58 |   const hasUnsavedChanges = useRef(false);
59 |   
60 |   // ReactFlow ì¸ìŠ¤í„´ìŠ¤
61 |   const reactFlowInstance = useReactFlow();
62 | 
63 |   /**
64 |    * ì—£ì§€ ì„¤ì • ì ìš© í—¬í¼ í•¨ìˆ˜
65 |    * @param currentEdges í˜„ì¬ ì—£ì§€ ë°°ì—´
66 |    * @param settings ì ìš©í•  ì„¤ì •
67 |    * @returns ì„¤ì •ì´ ì ìš©ëœ ì—£ì§€ ë°°ì—´
68 |    */
69 |   const applyIdeaMapEdgeSettings = useCallback((currentEdges: Edge[], settings: IdeaMapSettings) => {
[TRUNCATED]
```

src/components/ideamap/hooks/useNodes.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: useNodes.test.tsx
3 |  * ëª©ì : useNodeClickHandlers ì»¤ìŠ¤í…€ í›… í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ë…¸ë“œ í´ë¦­ í•¸ë“¤ëŸ¬ ê¸°ëŠ¥ì˜ ì •ìƒ ì‘ë™ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-11
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : ì°¸ì¡° ê²½ë¡œ ìˆ˜ì • (board-types -> ideamap-types)
8 |  */
9 | 
10 | import { renderHook, act } from '@testing-library/react';
11 | import { Node } from '@xyflow/react';
12 | import { describe, it, expect, vi, beforeEach, afterEach, beforeAll, afterAll } from 'vitest';
13 | 
14 | 
15 | // ëª¨ë“  ëª¨í‚¹ì€ íŒŒì¼ ìƒë‹¨ì— ë°°ì¹˜ (í˜¸ì´ìŠ¤íŒ… ë¬¸ì œ ë°©ì§€)
16 | // React Flow ëª¨í‚¹
17 | vi.mock('@/tests/utils/react-flow-mock', () => ({
18 |   mockReactFlow: vi.fn()
19 | }));
20 | 
21 | // useAppStore ëª¨í‚¹
22 | const clearSelectedCardsMock = vi.fn();
23 | const selectCardMock = vi.fn();
24 | const toggleSelectedCardMock = vi.fn();
25 | 
26 | vi.mock('@/store/useAppStore', () => ({
27 |   useAppStore: vi.fn(() => ({
28 |     selectedCardIds: ['test-node-1'],
29 |     toggleSelectedCard: toggleSelectedCardMock,
30 |     selectCard: selectCardMock,
31 |     clearSelectedCards: clearSelectedCardsMock,
32 |   }))
33 | }));
34 | 
35 | // í† ìŠ¤íŠ¸ ëª¨í‚¹
36 | vi.mock('sonner', () => ({
37 |   toast: {
38 |     success: vi.fn(),
39 |     info: vi.fn(),
40 |     error: vi.fn()
41 |   }
42 | }));
43 | 
44 | // ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ ë° ìœ í‹¸ë¦¬í‹° ì„í¬íŠ¸ (ëª¨í‚¹ í›„ ì„í¬íŠ¸)
45 | import { mockReactFlow } from '@/tests/utils/react-flow-mock';
46 | 
47 | import { useNodeClickHandlers } from './useNodes';
48 | import { CardData } from '../types/ideamap-types';
49 | 
50 | describe('useNodeClickHandlers', () => {
51 |   // í…ŒìŠ¤íŠ¸ ì „ ì „ì—­ ì„¤ì •
52 |   beforeAll(() => {
53 |     mockReactFlow();
54 |   });
55 | 
56 |   // ê° í…ŒìŠ¤íŠ¸ ì „ ì´ˆê¸°í™”
57 |   beforeEach(() => {
58 |     // ëª¨ë“  ëª¨ì˜ í•¨ìˆ˜ ì´ˆê¸°í™”
59 |     vi.clearAllMocks();
60 |   });
61 | 
62 |   // ê° í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬
63 |   afterEach(() => {
64 |     vi.resetAllMocks();
65 |   });
66 | 
67 |   // ëª¨ë“  í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬
68 |   afterAll(() => {
69 |     vi.restoreAllMocks();
70 |   });
71 | 
72 |   it('ì´ˆê¸° ìƒíƒœê°€ ì˜¬ë°”ë¥´ê²Œ ë°˜í™˜ë˜ì–´ì•¼ í•¨', () => {
73 |     const { result } = renderHook(() => useNodeClickHandlers({}));
74 | 
75 |     expect(typeof result.current.handleNodeClick).toBe('function');
76 |     expect(typeof result.current.handlePaneClick).toBe('function');
77 |   });
78 | 
[TRUNCATED]
```

src/components/ideamap/hooks/useNodes.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: useNodes.ts
3 |  * ëª©ì : ë…¸ë“œ í´ë¦­ í•¸ë“¤ëŸ¬ ë¡œì§ ê´€ë¦¬
4 |  * ì—­í• : ë…¸ë“œ í´ë¦­ ë° íŒ¨ë„ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ë§ ë¡œì§ ìº¡ìŠí™”
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-11
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : ì°¸ì¡° ê²½ë¡œ ìˆ˜ì • (board-types -> ideamap-types)
8 |  */
9 | 
10 | import { useCallback } from 'react';
11 | 
12 | import { 
13 |   NodeMouseHandler,
14 |   Node
15 | } from '@xyflow/react';
16 | import { toast } from 'sonner';
17 | 
18 | import { useAppStore } from '@/store/useAppStore';
19 | import { CardData } from '../types/ideamap-types';
20 | 
21 | /**
22 |  * useNodeClickHandlers: ë…¸ë“œ í´ë¦­ ê´€ë ¨ í•¸ë“¤ëŸ¬ë¥¼ ì œê³µí•˜ëŠ” í›…
23 |  * @param onSelectCard ì¹´ë“œ ì„ íƒ ì‹œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜ (ì˜µì…˜)
24 |  * @param onNodeDoubleClick ë…¸ë“œ ë”ë¸” í´ë¦­ ì‹œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜ (ì˜µì…˜)
25 |  * @returns ë…¸ë“œ í´ë¦­ ê´€ë ¨ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
26 |  */
27 | export function useNodeClickHandlers({
28 |   onSelectCard,
29 |   onNodeDoubleClick
30 | }: {
31 |   onSelectCard?: (cardId: string | null) => void;
32 |   onNodeDoubleClick?: (node: Node<CardData>) => void;
33 | }) {
34 |   // ì „ì—­ ìƒíƒœì—ì„œ ì„ íƒëœ ì¹´ë“œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
35 |   const { selectedCardIds, toggleSelectedCard, selectCard, clearSelectedCards } = useAppStore();
36 |   
37 |   /**
38 |    * ë…¸ë“œ í´ë¦­ í•¸ë“¤ëŸ¬: ë…¸ë“œ ì„ íƒ ì²˜ë¦¬
39 |    * @param event ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
40 |    * @param node í´ë¦­ëœ ë…¸ë“œ
41 |    */
42 |   const handleNodeClick = useCallback<NodeMouseHandler>((event, node) => {
43 |     // ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€ëŠ” í•­ìƒ ìˆ˜í–‰
44 |     event.stopPropagation();
45 | 
46 |     // ë…¸ë“œê°€ undefinedì¸ ê²½ìš° ì²˜ë¦¬
47 |     if (!node) {
48 |       console.warn('í´ë¦­ëœ ë…¸ë“œê°€ undefinedì…ë‹ˆë‹¤.');
49 |       return;
50 |     }
51 |     
52 |     // ë…¸ë“œ íƒ€ì… ì•ˆì „í•˜ê²Œ ë³€í™˜
53 |     const typedNode = node as Node<CardData>;
54 |     
55 |     // ë”ë¸” í´ë¦­ ì²˜ë¦¬
56 |     if (event.detail === 2 && onNodeDoubleClick) {
57 |       onNodeDoubleClick(typedNode);
58 |       return;
59 |     }
60 |     
61 |     // ë‹¤ì¤‘ ì„ íƒ ëª¨ë“œ (Ctrl/Cmd í‚¤ ëˆ„ë¥¸ ìƒíƒœ)
62 |     const isMultiSelectMode = event.ctrlKey || event.metaKey;
63 |     
64 |     // ë…¸ë“œ id ê°€ì ¸ì˜¤ê¸°
65 |     const nodeId = typedNode.id;
66 |     
67 |     // ê¸°ë³¸ ì´ë²¤íŠ¸ ê´€ë¦¬
68 |     event.stopPropagation();
69 |     
70 |     if (isMultiSelectMode) {
71 |       // ë‹¤ì¤‘ ì„ íƒ ëª¨ë“œ: ì„ íƒëœ ì¹´ë“œ ëª©ë¡ì— ì¶”ê°€/ì œê±°
72 |       console.log('ë‹¤ì¤‘ ì„ íƒ ëª¨ë“œë¡œ ë…¸ë“œ í´ë¦­:', nodeId);
73 |       
[TRUNCATED]
```

src/components/ideamap/nodes/CardNode.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: CardNode.test.tsx
3 |  * ëª©ì : CardNode ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì¹´ë“œ ë…¸ë“œ ì»´í¬ë„ŒíŠ¸ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-21 : ThemeContext ëŒ€ì‹  useAppStore ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
7 |  */
8 | 
9 | import { render, screen, fireEvent, waitFor } from '@testing-library/react';
10 | import { ReactFlowProvider, Node, NodeProps } from '@xyflow/react';
11 | import { describe, it, expect, vi, beforeEach, beforeAll } from 'vitest';
12 | 
13 | import { DEFAULT_IDEAMAP_SETTINGS } from '@/lib/ideamap-utils';
14 | 
15 | // TiptapViewer ëª¨í‚¹
16 | vi.mock('@/components/editor/TiptapViewer', () => ({
17 |     default: ({ content }: { content: string }) => (
18 |         <div data-testid="tiptap-viewer">{content}</div>
19 |     )
20 | }));
21 | 
22 | // EditCardModal ëª¨í‚¹
23 | vi.mock('@/components/cards/EditCardModal', () => ({
24 |     EditCardModal: vi.fn(({ onClose }) => (
25 |         <div data-testid="edit-card-modal">
26 |             <button onClick={onClose} data-testid="close-modal-button">ë‹«ê¸°</button>
27 |         </div>
28 |     ))
29 | }));
30 | 
31 | // ThemeContext ëª¨í‚¹ ì œê±° - useAppStoreë¡œ ëŒ€ì²´ë˜ì—ˆìŒ
32 | 
33 | // AppStore ëª¨í‚¹
34 | vi.mock('@/store/useAppStore', () => ({
35 |     useAppStore: vi.fn((selector) => selector({
36 |         // ì„ íƒ ê´€ë ¨ ìƒíƒœ
37 |         selectedCardIds: [],
38 |         selectedCardId: null,
39 |         expandedCardId: null,
40 | 
41 |         // ì„ íƒ ê´€ë ¨ ì•¡ì…˜
42 |         selectCard: vi.fn(),
43 |         selectCards: vi.fn(),
44 |         toggleSelectedCard: vi.fn(),
45 |         clearSelectedCards: vi.fn(),
46 |         toggleExpandCard: vi.fn(),
47 | 
48 |         // ì¹´ë“œ ë°ì´í„° ìƒíƒœ
49 |         cards: [],
50 |         setCards: vi.fn(),
51 |         updateCard: vi.fn(),
52 | 
53 |         // ì‚¬ì´ë“œë°” ìƒíƒœ
54 |         isSidebarOpen: false,
55 |         setSidebarOpen: vi.fn(),
56 |         toggleSidebar: vi.fn(),
57 | 
58 |         // ë ˆì´ì•„ì›ƒ ì˜µì…˜
59 |         layoutDirection: 'auto' as const,
60 |         setLayoutDirection: vi.fn(),
61 | 
62 |         // ì‚¬ì´ë“œë°” ë„ˆë¹„
63 |         sidebarWidth: 300,
64 |         setSidebarWidth: vi.fn(),
65 | 
66 |         // ì•„ì´ë””ì–´ë§µ ì„¤ì •
67 |         ideaMapSettings: {
68 |             ...DEFAULT_IDEAMAP_SETTINGS,
69 |             nodeWidth: 200,
70 |             nodeSpacing: 30,
71 |             nodeBorderRadius: 6,
72 |             nodeFontSize: 14,
73 |             maxNodeHeight: 200,
74 |             edgeType: 'bezier' as const,
75 |             edgeWidth: 1,
76 |             strokeWidth: 2,
77 |             strokeColor: '#a1a1aa',
78 |             backgroundColor: '#ffffff',
79 |             selectedBackgroundColor: '#f0f9ff'
80 |         },
[TRUNCATED]
```

src/components/ideamap/nodes/CardNode.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: CardNode.tsx
3 |  * ëª©ì : ë³´ë“œì— í‘œì‹œë˜ëŠ” ì¹´ë“œ ë…¸ë“œ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : React Flowì˜ ë…¸ë“œë¡œ ì‚¬ìš©ë˜ëŠ” ì¹´ë“œ UI ì»´í¬ë„ŒíŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-05
6 |  * ìˆ˜ì •ì¼: 2025-03-31
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : ThemeContext ëŒ€ì‹  useAppStore(themeSlice) ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
8 |  */
9 | 
10 | import React, { useMemo, useState, useCallback, useEffect, useRef } from 'react';
11 | import { CSSProperties } from 'react';
12 | 
13 | import { Handle, Position, NodeProps, useReactFlow, useUpdateNodeInternals } from '@xyflow/react';
14 | import { ChevronRight, ChevronUp } from 'lucide-react';
15 | import { createPortal } from 'react-dom';
16 | 
17 | import { EditCardModal } from '@/components/cards/EditCardModal';
18 | import TiptapViewer from '@/components/editor/TiptapViewer';
19 | import { loadDefaultIdeaMapUIConfig } from '@/lib/ideamap-ui-config';
20 | import { cn } from '@/lib/utils';
21 | import { useAppStore } from '@/store/useAppStore';
22 | 
23 | // ê³ ìœ  ì‹ë³„ì ì¶”ê°€ - ì´ ì»´í¬ë„ŒíŠ¸ê°€ ì •í™•íˆ ì–´ëŠ íŒŒì¼ì—ì„œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
24 | const COMPONENT_ID = 'CardNode_from_nodes_directory';
25 | 
26 | // ë””ë²„ê¹…ìš© ë¡œê·¸ - ìˆœí™˜ ì°¸ì¡° ë°©ì§€ë¥¼ ìœ„í•´ NODE_TYPES ì ‘ê·¼ ì œê±°
27 | // console.log(`[${COMPONENT_ID}] ëª¨ë“ˆì´ ë¡œë“œë¨ - ê²½ë¡œ: @/components/ideamap/nodes/CardNode`);
28 | 
29 | // ë…¸ë“œ ë°ì´í„° íƒ€ì… ì •ì˜
30 | export interface NodeData {
31 |   id: string;
32 |   title: string;
33 |   content: string;
34 |   type?: string;
35 |   width?: number;
36 |   height?: number;
37 |   color?: string;
38 |   backgroundColor?: string;
39 |   tags?: string[];
40 |   position?: {
41 |     x: number;
42 |     y: number;
43 |   };
44 |   // ì¶”ê°€ ì†ì„±ë“¤
45 |   [key: string]: any;
46 | }
47 | 
48 | // Portal ì»´í¬ë„ŒíŠ¸ - ë‚´ë¶€ ì •ì˜
49 | const Portal: React.FC<{ children: React.ReactNode }> = ({ children }) => {
50 |   const [mounted, setMounted] = useState(false);
51 | 
52 |   useEffect(() => {
53 |     setMounted(true);
54 |     return () => setMounted(false);
55 |   }, []);
56 | 
57 |   return mounted ? createPortal(children, document.body) : null;
58 | };
59 | 
60 | // ì¹´ë“œ ë…¸ë“œ ì»´í¬ë„ŒíŠ¸ ì •ì˜
61 | export default function CardNode({ data, isConnectable, selected, id }: NodeProps) {
62 |   const [isHovered, setIsHovered] = useState(false);
63 |   const { setNodes } = useReactFlow();
64 |   const nodeRef = useRef<HTMLDivElement>(null);
65 |   const updateNodeInternals = useUpdateNodeInternals();
66 |   const [isEditModalOpen, setIsEditModalOpen] = useState(false);
[TRUNCATED]
```

src/components/ideamap/nodes/CustomEdge.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: CustomEdge.test.tsx
3 |  * ëª©ì : CustomEdge ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : ì—£ì§€ ì»´í¬ë„ŒíŠ¸ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-01
7 |  * ìˆ˜ì •ì¼: 2023-10-27 : ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” import ì œê±°
8 |  */
9 | 
10 | import { render, screen } from '@testing-library/react';
11 | import { ReactFlowProvider, EdgeProps, Position, ConnectionLineType } from '@xyflow/react';
12 | import type * as XyflowReact from '@xyflow/react';
13 | import { describe, it, expect, vi, beforeEach } from 'vitest';
14 | 
15 | // AppStore ëª¨í‚¹
16 | vi.mock('@/store/useAppStore', () => ({
17 |   useAppStore: () => ({
18 |     boardSettings: {
19 |       edgeColor: '#000000',
20 |       selectedEdgeColor: '#ff0000',
21 |       strokeWidth: 2,
22 |       selectedStrokeWidth: 3,
23 |       animated: false,
24 |       markerEnd: true,
25 |       connectionLineType: 'bezier'
26 |     }
27 |   })
28 | }));
29 | 
30 | vi.mock('@xyflow/react', async (importOriginal) => {
31 |   const actual = (await importOriginal()) as typeof XyflowReact;
32 |   const getBezierPathMock = vi.fn().mockReturnValue(['M0 0 C100 0 100 100 200 100']);
33 |   const getStraightPathMock = vi.fn().mockReturnValue(['M0 0 L200 100']);
34 |   const getSmoothStepPathMock = vi.fn().mockReturnValue(['M0 0 Q100 0 100 50 Q100 100 200 100']);
35 | 
36 |   return {
37 |     ...actual,
38 |     getBezierPath: getBezierPathMock,
39 |     getStraightPath: getStraightPathMock,
40 |     getSmoothStepPath: getSmoothStepPathMock,
41 |     useStore: vi.fn(() => ({
42 |       selectedEdgeColor: '#ff0000',
43 |     })),
44 |     ReactFlowProvider: ({ children }: { children: React.ReactNode }) => <>{children}</>,
45 |     BaseEdge: ({ path, markerEnd, style, className, 'data-selected': selected, 'data-component-id': componentId }: any) => (
46 |       <g data-testid="base-edge" className={className} style={style} data-selected={selected} data-component-id={componentId}>
47 |         <path data-testid="edge-path" d={path} markerEnd={markerEnd} />
48 |       </g>
49 |     ),
50 |   };
51 | });
52 | 
53 | // CustomEdge ì»´í¬ë„ŒíŠ¸ ì„í¬íŠ¸
54 | import CustomEdge from './CustomEdge';
55 | 
56 | describe('CustomEdge', () => {
57 |   const mockEdgeProps: Partial<EdgeProps> = {
58 |     id: 'test-edge-id',
59 |     source: 'source-node',
60 |     target: 'target-node',
61 |     sourceX: 100,
62 |     sourceY: 100,
63 |     targetX: 200,
64 |     targetY: 200,
65 |     sourcePosition: Position.Right,
66 |     targetPosition: Position.Left,
67 |     style: { strokeWidth: 2, stroke: '#000000' },
[TRUNCATED]
```

src/components/ideamap/nodes/CustomEdge.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: CustomEdge.tsx
3 |  * ëª©ì : React Flowì—ì„œ ì‚¬ìš©í•  ì»¤ìŠ¤í…€ ì—£ì§€ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ë…¸ë“œ ê°„ ì—°ê²°ì„ ì„ ì‹œê°í™”í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-08
6 |  * ìˆ˜ì •ì¼: 2025-03-31
7 |  * ìˆ˜ì •ì¼: 2023-10-27 : ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” import/ë³€ìˆ˜ ì œê±° ë° any íƒ€ì… ê°œì„ 
8 |  */
9 | 
10 | import React, { useMemo } from 'react';
11 | 
12 | import { BaseEdge, EdgeProps, getBezierPath, getSmoothStepPath, getStraightPath, ConnectionLineType } from '@xyflow/react';
13 | 
14 | import { useAppStore } from '@/store/useAppStore';
15 | 
16 | // ê³ ìœ  ì‹ë³„ì ì¶”ê°€ - ì´ ì»´í¬ë„ŒíŠ¸ê°€ ì •í™•íˆ ì–´ëŠ íŒŒì¼ì—ì„œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
17 | const COMPONENT_ID = 'CustomEdge_from_nodes_directory';
18 | 
19 | // ë””ë²„ê¹…ìš© ë¡œê·¸ - ìˆœí™˜ ì°¸ì¡° ë°©ì§€ë¥¼ ìœ„í•´ EDGE_TYPES ì ‘ê·¼ ì œê±°
20 | // console.log(`[${COMPONENT_ID}] ëª¨ë“ˆì´ ë¡œë“œë¨ - ê²½ë¡œ: @/components/board/nodes/CustomEdge`);
21 | 
22 | // í™•ì¥ëœ ì—£ì§€ Props ì¸í„°í˜ì´ìŠ¤
23 | interface CustomEdgeProps extends EdgeProps {
24 |   type?: string;
25 |   animated?: boolean;
26 |   data?: {
27 |     edgeType?: ConnectionLineType;
28 |     settings?: Record<string, unknown>;
29 |   };
30 | }
31 | 
32 | /**
33 |  * ì»¤ìŠ¤í…€ ì—£ì§€ ì»´í¬ë„ŒíŠ¸
34 |  * - ReactFlowì˜ ê¸°ë³¸ ë™ì‘ì„ ìµœëŒ€í•œ í™œìš©í•˜ê³ , ìµœì†Œí•œì˜ ì¡°ì •ë§Œ ì ìš©
35 |  */
36 | // ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© ì‹œì  ë””ë²„ê¹…
37 | console.log('[CustomEdge] ì»´í¬ë„ŒíŠ¸ ì •ì˜ ì „: í•¨ìˆ˜ í˜•íƒœì˜ ì»´í¬ë„ŒíŠ¸ ìƒì„±');
38 | 
39 | function CustomEdge({
40 |   sourceX,
41 |   sourceY,
42 |   targetX,
43 |   targetY,
44 |   sourcePosition,
45 |   targetPosition,
46 |   style = {},
47 |   markerEnd,
48 |   selected,
49 |   animated,
50 |   data,
51 |   ...restProps
52 | }: CustomEdgeProps) {
53 |   // Zustand ìŠ¤í† ì–´ì—ì„œ ideaMapSettings ê°€ì ¸ì˜¤ê¸°
54 |   const { ideaMapSettings } = useAppStore();
55 | 
56 |   // ê¸€ë¡œë²Œ ì„¤ì •ê³¼ ë¡œì»¬ ì„¤ì • ê²°í•©
57 |   const effectiveSettings = useMemo(() => {
58 |     // ë¡œì»¬ ì„¤ì •ì´ ìˆìœ¼ë©´ ìš°ì„ ì ìœ¼ë¡œ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸€ë¡œë²Œ ì„¤ì • ì‚¬ìš©
59 |     const localSettings = data?.settings;
60 |     return localSettings ? { ...ideaMapSettings, ...localSettings } : ideaMapSettings;
61 |   }, [ideaMapSettings, data?.settings]);
62 | 
63 |   // ì—£ì§€ ì—°ê²° ì¢Œí‘œ ê³„ì‚° (useMemoë¡œ ìµœì í™”)
64 |   const edgeParams = useMemo(() => ({
65 |     sourceX,
66 |     sourceY,
67 |     sourcePosition,
68 |     targetX,
69 |     targetY,
70 |     targetPosition,
71 |   }), [sourceX, sourceY, sourcePosition, targetX, targetY, targetPosition]);
72 | 
73 |   // ì—£ì§€ íƒ€ì… ê²°ì •: data.edgeType > ideaMapSettings.connectionLineType > ê¸°ë³¸ê°’
74 |   const effectiveEdgeType = useMemo(() => {
[TRUNCATED]
```

src/components/ideamap/nodes/NodeInspect.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: NodeInspect.tsx
3 |  * ëª©ì : React Flow ë…¸ë“œ ê²€ì‚¬ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ë…¸ë“œ ì •ë³´ë¥¼ í‘œì‹œí•´ì£¼ëŠ” ë””ë²„ê¹…ìš© ì»´í¬ë„ŒíŠ¸
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  */
7 | 
8 | import { useEffect, useState } from 'react';
9 | 
10 | import { useReactFlow, NodeProps, NodeToolbar, Position } from '@xyflow/react';
11 | 
12 | /**
13 |  * NodeInspect ì»´í¬ë„ŒíŠ¸ëŠ” ê° ë…¸ë“œì— ì¶”ê°€ë˜ì–´ ë…¸ë“œì˜ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
14 |  * ì‹¤ì‹œê°„ìœ¼ë¡œ ë…¸ë“œ ìƒíƒœë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.
15 |  */
16 | export default function NodeInspect(props: NodeProps) {
17 |   const { data, id, type } = props;
18 |   const { getNode } = useReactFlow();
19 |   // ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ìƒíƒœ
20 |   const [nodeState, setNodeState] = useState({ selected: false });
21 |   const [isVisible, setIsVisible] = useState(false);
22 |   
23 |   // ë Œë”ë§ ì „ì— isVisible ìƒíƒœë¥¼ ì„¤ì •
24 |   useEffect(() => {
25 |     setIsVisible(!!data?.isInspected);
26 |   }, [data?.isInspected]);
27 | 
28 |   // ì‹¤ì‹œê°„ ë…¸ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸
29 |   useEffect(() => {
30 |     // ë…¸ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
31 |     const updateNodeState = () => {
32 |       const currentNode = getNode(id);
33 |       if (currentNode) {
34 |         setNodeState({
35 |           selected: !!currentNode.selected,
36 |         });
37 |       }
38 |     };
39 | 
40 |     // ì´ˆê¸° ìƒíƒœ ì„¤ì •
41 |     updateNodeState();
42 | 
43 |     // ì£¼ê¸°ì ìœ¼ë¡œ ë…¸ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„ì„± ë³´ì¥)
44 |     const intervalId = setInterval(updateNodeState, 100);
45 | 
46 |     return () => {
47 |       clearInterval(intervalId);
48 |     };
49 |   }, [id, getNode]);
50 | 
51 |   // í•¸ë“¤ ìœ„ì¹˜ ì •ë³´
52 |   const handleInfo = {
53 |     leftTop: { position: Position.Left, top: '0%' },
54 |     leftBottom: { position: Position.Left, top: '100%' },
55 |     rightTop: { position: Position.Right, top: '0%' },
56 |     rightBottom: { position: Position.Right, top: '100%' },
57 |   };
58 | 
59 |   if (!isVisible) return null;
60 | 
61 |   return (
62 |     <NodeToolbar 
63 |       position={Position.Bottom}
64 |       className="nodrag bg-card shadow-md rounded p-2 text-xs max-w-xs" 
65 |       isVisible={true}
66 |     >
67 |       <div className="space-y-1">
68 |         <div><span className="font-medium">ì œëª©:</span> {data?.title || data?.label || 'ì œëª© ì—†ìŒ'}</div>
69 |         <div><span className="font-medium">ID:</span> {id}</div>
70 |         <div><span className="font-medium">íƒ€ì…:</span> {type || 'ê¸°ë³¸'}</div>
[TRUNCATED]
```

src/components/ideamap/nodes/NodeInspector.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: NodeInspector.tsx
3 |  * ëª©ì : ë…¸ë“œ ìƒì„¸ ì •ë³´ë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì„ íƒëœ ë…¸ë“œì˜ ì •ë³´ë¥¼ ê²€ì‚¬í•˜ê³  í‘œì‹œ
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-04-15
7 |  * ìˆ˜ì •ì¼: 2025-04-21 : useNodeStore ì œê±° ë° useAppStore(cardStateSlice) ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
8 |  */
9 | 
10 | import { useEffect, useMemo } from 'react';
11 | 
12 | import { Node } from '@xyflow/react';
13 | 
14 | import TiptapViewer from '@/components/editor/TiptapViewer';
15 | import { Badge } from '@/components/ui/badge';
16 | import { Modal } from '@/components/ui/modal';
17 | import { useAppStore } from '@/store/useAppStore';
18 | 
19 | interface NodeInspectorProps {
20 |   nodes: Node[];
21 | }
22 | 
23 | // ë…¸ë“œ ë°ì´í„° íƒ€ì… ì •ì˜
24 | interface NodeData {
25 |   title?: string;
26 |   content?: string;
27 |   tags?: string[];
28 |   [key: string]: any;
29 | }
30 | 
31 | /**
32 |  * NodeInspector: ë…¸ë“œì˜ ìƒì„¸ ì •ë³´ë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸
33 |  * @param {NodeInspectorProps} props - ì»´í¬ë„ŒíŠ¸ ì†ì„±
34 |  * @returns {JSX.Element} ë…¸ë“œ ì¸ìŠ¤í™í„° ì»´í¬ë„ŒíŠ¸
35 |  */
36 | export function NodeInspector({ nodes }: NodeInspectorProps) {
37 |   const expandedCardId = useAppStore((state) => state.expandedCardId);
38 |   const toggleExpandCard = useAppStore((state) => state.toggleExpandCard);
39 | 
40 |   // í™•ì¥ëœ ë…¸ë“œ ì°¾ê¸°
41 |   const inspectedNode = useMemo(() => {
42 |     if (!expandedCardId) return null;
43 |     return nodes.find(node => node.id === expandedCardId) || null;
44 |   }, [nodes, expandedCardId]);
45 | 
46 |   // ëª¨ë‹¬ì´ ë‹«í ë•Œ expandedCardId ì´ˆê¸°í™”
47 |   const handleCloseModal = () => {
48 |     if (expandedCardId) {
49 |       toggleExpandCard(expandedCardId);
50 |     }
51 |   };
52 | 
53 |   // ë…¸ë“œ ì •ë³´ê°€ ì—†ê±°ë‚˜ ëª¨ë‹¬ì´ ë‹«í˜€ìˆìœ¼ë©´ ì—´ë¦° ìƒíƒœë¡œ ë Œë”ë§í•˜ì§€ë§Œ ë³´ì´ì§€ ì•Šê²Œ í•¨
54 |   const shouldShowContent = Boolean(expandedCardId && inspectedNode);
55 | 
56 |   // íƒ€ì… ì•ˆì „ì„ ìœ„í•œ ë°ì´í„° ì ‘ê·¼
57 |   const nodeData = inspectedNode?.data as NodeData | undefined;
58 | 
59 |   return (
60 |     <Modal.Root open={shouldShowContent} onOpenChange={handleCloseModal}>
61 |       <Modal.Content>
62 |         {shouldShowContent && inspectedNode && (
63 |           <>
64 |             <Modal.Title>
65 |               {nodeData?.title || 'ì œëª© ì—†ìŒ'}
66 |             </Modal.Title>
67 | 
68 |             <div className="py-4">
69 |               {/* ë…¸ë“œ ID ì •ë³´ */}
70 |               <div className="mb-4">
71 |                 <h3 className="text-sm font-semibold mb-1">ID</h3>
[TRUNCATED]
```

src/components/ideamap/types/ideamap-types.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: ideamap-types.ts
3 |  * ëª©ì : IdeaMapComponent ë° ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” íƒ€ì… ì •ì˜
4 |  * ì—­í• : íƒ€ì… ì •ì˜ë¥¼ ì¤‘ì•™í™”í•˜ì—¬ ì½”ë“œ ì¤‘ë³µì„ ë°©ì§€í•˜ê³  íƒ€ì… ì•ˆì •ì„± ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2023-10-27 : ConnectionLineType íƒ€ì… ì¶”ê°€ ë° RefObject íƒ€ì… ë¬¸ì œ í•´ê²°
7 |  */
8 | 
9 | import React from 'react';
10 | 
11 | import { 
12 |   Node, 
13 |   Edge as ReactFlowEdge, 
14 |   Connection, 
15 |   XYPosition, 
16 |   NodeChange, 
17 |   EdgeChange, 
18 |   Position, 
19 |   ConnectionMode,
20 |   Viewport,
21 |   MarkerType,
22 |   ConnectionLineType
23 | } from '@xyflow/react';
24 | 
25 | // lib/ideamap-utils.tsì—ì„œ ì •ì˜ëœ IdeaMapSettings íƒ€ì… ê°€ì ¸ì˜¤ê¸°
26 | import { IdeaMapSettings as OriginalIdeaMapSettings } from '@/lib/ideamap-utils';
27 | 
28 | /**
29 |  * IdeaMapComponentì˜ Props ì¸í„°í˜ì´ìŠ¤
30 |  * @interface IdeaMapComponentProps
31 |  */
32 | export interface IdeaMapComponentProps {
33 |   /** ì¹´ë“œ ì„ íƒ ì‹œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜ */
34 |   onSelectCard?: (cardId: string | null) => void;
35 |   /** ì»´í¬ë„ŒíŠ¸ì— ì ìš©í•  ì¶”ê°€ CSS í´ë˜ìŠ¤ */
36 |   className?: string;
37 |   /** ì»¨íŠ¸ë¡¤ í‘œì‹œ ì—¬ë¶€ */
38 |   showControls?: boolean;
39 | }
40 | 
41 | /**
42 |  * ì¹´ë“œ(ë…¸ë“œ) ë°ì´í„° ì¸í„°í˜ì´ìŠ¤
43 |  * @interface CardData
44 |  */
45 | export interface CardData {
46 |   id: string;
47 |   title: string;
48 |   content: string | null;
49 |   tags?: string[];
50 |   cardTags?: Array<{tag: {name: string}}>;
51 |   [key: string]: any;
52 | }
53 | 
54 | /**
55 |  * lib/ideamap-utils.tsì—ì„œ ê°€ì ¸ì˜¨ IdeaMapSettings íƒ€ì…ì„ ì¬ë‚´ë³´ëƒ…ë‹ˆë‹¤.
56 |  * ì´ë¥¼ í†µí•´ IdeaMap ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” íƒ€ì…ì´ lib/ideamap-utils.tsì˜ íƒ€ì…ê³¼ ì¼ì¹˜í•˜ê²Œ ë©ë‹ˆë‹¤.
57 |  */
58 | export type IdeaMapSettings = OriginalIdeaMapSettings;
59 | 
60 | /**
61 |  * ì•ˆì „í•œ HTMLElement RefObject íƒ€ì…
62 |  * - TypeScript íƒ€ì… ì²´í¬ë¥¼ ìœ„í•œ RefObject íƒ€ì… í™•ì¥
63 |  */
64 | export type SafeRef<T extends HTMLElement = HTMLDivElement> = React.RefObject<T>;
65 | 
66 | /**
67 |  * ì•„ì´ë””ì–´ë§µ ë…¸ë“œ íƒ€ì…
68 |  * @type IdeaMapNode
69 |  */
70 | export type IdeaMapNode = Node<CardData>;
71 | 
72 | /**
73 |  * ì•„ì´ë””ì–´ë§µ ì—£ì§€ íƒ€ì…
74 |  * @type IdeaMapEdge
75 |  */
76 | export type IdeaMapEdge = ReactFlowEdge;
77 | 
78 | /**
79 |  * Edge ë°°ì—´ íƒ€ì… - íƒ€ì… í˜¸í™˜ì„±ì„ ìœ„í•œ íƒ€ì… ì •ì˜
80 |  */
81 | export type Edges = ReactFlowEdge[];
82 | 
83 | /**
[TRUNCATED]
```

src/components/ideamap/utils/ideamap-constants.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: constants.ts
3 |  * ëª©ì : ë³´ë“œ ì»´í¬ë„ŒíŠ¸ ê´€ë ¨ ìƒìˆ˜ ì •ì˜
4 |  * ì—­í• : ë³´ë“œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ìƒìˆ˜ê°’ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  * ìˆ˜ì •ì¼: 2025-03-30
7 |  */
8 | 
9 | import { ConnectionLineType, Position } from '@xyflow/react';
10 | 
11 | // ë ˆì´ì•„ì›ƒ ë°©í–¥
12 | export const LAYOUT_DIRECTION = {
13 |   HORIZONTAL: 'LR',
14 |   VERTICAL: 'TB'
15 | };
16 | 
17 | // ë…¸ë“œ íƒ€ì…
18 | export const NODE_TYPES = {
19 |   CARD: 'card'
20 | };
21 | 
22 | // ì—£ì§€ íƒ€ì…
23 | export const EDGE_TYPES = {
24 |   CUSTOM: 'custom'
25 | };
26 | 
27 | // í•¸ë“¤ ìœ„ì¹˜ ì •ë³´
28 | export const HANDLE_POSITIONS = {
29 |   TOP: Position.Top,
30 |   RIGHT: Position.Right,
31 |   BOTTOM: Position.Bottom,
32 |   LEFT: Position.Left
33 | };
34 | 
35 | // ì—°ê²°ì„  íƒ€ì…
36 | export const CONNECTION_LINE_TYPES = {
37 |   BEZIER: ConnectionLineType.Bezier,
38 |   STEP: ConnectionLineType.Step,
39 |   SMOOTHSTEP: ConnectionLineType.SmoothStep,
40 |   STRAIGHT: ConnectionLineType.Straight
41 | };
42 | 
43 | // ê¸°ë³¸ ë…¸ë“œ í¬ê¸°
44 | export const DEFAULT_NODE_DIMENSIONS = {
45 |   WIDTH: 300,
46 |   MIN_HEIGHT: 100
47 | };
48 | 
49 | // ìë™ ì €ì¥ ë”œë ˆì´ (ë°€ë¦¬ì´ˆ)
50 | export const AUTO_SAVE_DELAY = 1000;
51 | 
52 | // ë…¸ë“œ ê¸°ë³¸ ê°„ê²© ê°’
53 | export const NODE_SPACING = {
54 |   HORIZONTAL: 100,
55 |   VERTICAL: 80
56 | };
57 | 
58 | // ìƒˆ ë…¸ë“œ ê¸°ë³¸ ë°ì´í„°
59 | export const DEFAULT_NEW_CARD = {
60 |   title: 'ìƒˆ ì¹´ë“œ',
61 |   content: '',
62 |   tags: []
63 | };
64 | 
65 | // ë³´ë“œ ì¤Œ ì„¤ì •
66 | export const ZOOM_SETTINGS = {
67 |   MIN: 0.5,
68 |   MAX: 2,
69 |   STEP: 0.1
70 | };
71 | 
72 | // íˆ´íŒ í‘œì‹œ ì§€ì—° (ë°€ë¦¬ì´ˆ)
73 | export const TOOLTIP_DELAY = 500; 
```

src/components/ideamap/utils/ideamap-graphUtils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: graphUtils.ts
3 |  * ëª©ì : ê·¸ë˜í”„ ê´€ë ¨ ìˆœìˆ˜ í•¨ìˆ˜ ëª¨ìŒ
4 |  * ì—­í• : ë…¸ë“œ, ì—£ì§€ ì²˜ë¦¬ë¥¼ ìœ„í•œ ìˆœìˆ˜ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-28
6 |  */
7 | 
8 | import { Node, Edge, XYPosition, Position, MarkerType } from '@xyflow/react';
9 | 
10 | import { IDEAMAP_LAYOUT_STORAGE_KEY, IDEAMAP_EDGES_STORAGE_KEY } from '@/lib/ideamap-constants';
11 | import { IdeaMapSettings } from '@/lib/ideamap-utils';
12 | 
13 | /**
14 |  * ë ˆì´ì•„ì›ƒì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
15 |  * @param nodes ì €ì¥í•  ë…¸ë“œ ë°°ì—´
16 |  * @returns ì„±ê³µ ì—¬ë¶€
17 |  */
18 | export const saveLayout = (nodes: Node[]): boolean => {
19 |   try {
20 |     // ë…¸ë“œ IDì™€ ìœ„ì¹˜ë§Œ ì €ì¥
21 |     const nodePositions = nodes.reduce((acc: Record<string, { position: XYPosition }>, node: Node) => {
22 |       acc[node.id] = { position: node.position };
23 |       return acc;
24 |     }, {});
25 |     
26 |     localStorage.setItem(IDEAMAP_LAYOUT_STORAGE_KEY, JSON.stringify(nodePositions));
27 |     return true;
28 |   } catch (err) {
29 |     console.error('ë ˆì´ì•„ì›ƒ ì €ì¥ ì‹¤íŒ¨:', err);
30 |     return false;
31 |   }
32 | };
33 | 
34 | /**
35 |  * ì—£ì§€ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
36 |  * @param edges ì €ì¥í•  ì—£ì§€ ë°°ì—´
37 |  * @returns ì„±ê³µ ì—¬ë¶€
38 |  */
39 | export const saveEdges = (edges: Edge[]): boolean => {
40 |   try {
41 |     localStorage.setItem(IDEAMAP_EDGES_STORAGE_KEY, JSON.stringify(edges));
42 |     return true;
43 |   } catch (err) {
44 |     console.error('ì—£ì§€ ì €ì¥ ì‹¤íŒ¨:', err);
45 |     return false;
46 |   }
47 | };
48 | 
49 | /**
50 |  * ëª¨ë“  ë ˆì´ì•„ì›ƒ ë°ì´í„° ì €ì¥ (ë…¸ë“œì™€ ì—£ì§€)
51 |  * @param nodes ì €ì¥í•  ë…¸ë“œ ë°°ì—´
52 |  * @param edges ì €ì¥í•  ì—£ì§€ ë°°ì—´
53 |  * @returns ì„±ê³µ ì—¬ë¶€
54 |  */
55 | export const saveAllLayoutData = (nodes: Node[], edges: Edge[]): boolean => {
56 |   const layoutSaved = saveLayout(nodes);
57 |   const edgesSaved = saveEdges(edges);
58 |   
59 |   return layoutSaved && edgesSaved;
60 | };
61 | 
62 | /**
63 |  * ì‚­ì œëœ ë…¸ë“œë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì œê±°
64 |  * @param deletedNodeIds ì‚­ì œëœ ë…¸ë“œ ID ë°°ì—´
65 |  */
66 | export const removeDeletedNodesFromStorage = (deletedNodeIds: string[]): void => {
67 |   try {
68 |     // ë…¸ë“œ ìœ„ì¹˜ ì •ë³´ ì²˜ë¦¬
69 |     const savedPositionsStr = localStorage.getItem(IDEAMAP_LAYOUT_STORAGE_KEY);
70 |     if (savedPositionsStr) {
[TRUNCATED]
```

src/tests/msw/handlers/logs.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: logs.ts
3 |  * ëª©ì : ë¡œê·¸ ë·°ì–´ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ëª©ì—… ë°ì´í„°
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•  ë¡œê·¸ ë°ì´í„° ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  */
7 | 
8 | export interface Log {
9 |   timestamp: string
10 |   module: string
11 |   level: string
12 |   message: string
13 |   sessionId: string
14 |   data?: Record<string, unknown>
15 | }
16 | 
17 | export const mockModules = ['auth', 'database', 'api', 'system'] as const
18 | 
19 | export const mockSessionIds = [
20 |   'sess_123456',
21 |   'sess_789012',
22 |   'sess_345678',
23 |   'sess_901234'
24 | ]
25 | 
26 | export const mockLogs: Log[] = [
27 |   {
28 |     timestamp: '2024-03-31T10:00:00Z',
29 |     module: 'auth',
30 |     level: 'info',
31 |     message: 'ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ',
32 |     sessionId: 'sess_123456',
33 |     data: {
34 |       userId: 'user_123',
35 |       loginMethod: 'password'
36 |     }
37 |   },
38 |   {
39 |     timestamp: '2024-03-31T10:01:00Z',
40 |     module: 'database',
41 |     level: 'error',
42 |     message: 'ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨',
43 |     sessionId: 'sess_789012',
44 |     data: {
45 |       errorCode: 'DB_001',
46 |       retryCount: 3
47 |     }
48 |   },
49 |   {
50 |     timestamp: '2024-03-31T10:02:00Z',
51 |     module: 'api',
52 |     level: 'warn',
53 |     message: 'API ì‘ë‹µ ì§€ì—°',
54 |     sessionId: 'sess_345678',
55 |     data: {
56 |       endpoint: '/api/users',
57 |       responseTime: 5000
58 |     }
59 |   },
60 |   {
61 |     timestamp: '2024-03-31T10:03:00Z',
62 |     module: 'system',
63 |     level: 'debug',
64 |     message: 'ì‹œìŠ¤í…œ ìƒíƒœ ì ê²€',
65 |     sessionId: 'sess_901234',
66 |     data: {
67 |       cpuUsage: 45,
68 |       memoryUsage: 60
69 |     }
70 |   }
71 | ] 
```

src/tests/msw/handlers/tagHandlers.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/tests/msw/handlers/tagHandlers.ts
3 |  * ëª©ì : íƒœê·¸ API ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ MSW í•¸ë“¤ëŸ¬ ì œê³µ
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ ì‹œ íƒœê·¸ ê´€ë ¨ API ìš”ì²­ì„ ì¸í„°ì…‰íŠ¸í•˜ì—¬ ëª¨í‚¹ëœ ì‘ë‹µ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-21
6 |  */
7 | 
8 | import { http, HttpResponse, delay } from 'msw';
9 | import { Tag, TagInput } from '@/services/tagService';
10 | 
11 | // Mock íƒœê·¸ ë°ì´í„°
12 | export const mockTags: Tag[] = [
13 |   { id: '1', name: 'ê°œë°œ', count: 5, createdAt: '2025-04-01T00:00:00Z' },
14 |   { id: '2', name: 'ì•„ì´ë””ì–´', count: 3, createdAt: '2025-04-02T00:00:00Z' },
15 |   { id: '3', name: 'í”„ë¡œì íŠ¸', count: 2, createdAt: '2025-04-03T00:00:00Z' }
16 | ];
17 | 
18 | // íƒœê·¸ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ë³€ìˆ˜
19 | let tags = [...mockTags];
20 | 
21 | // íƒœê·¸ ê´€ë ¨ í•¸ë“¤ëŸ¬
22 | export const tagHandlers = [
23 |   // íƒœê·¸ ëª©ë¡ ì¡°íšŒ
24 |   http.get('/api/tags', async () => {
25 |     await delay(100);
26 |     return HttpResponse.json(tags);
27 |   }),
28 | 
29 |   // íŠ¹ì • íƒœê·¸ ì¡°íšŒ
30 |   http.get('/api/tags/:id', async ({ params }) => {
31 |     const { id } = params;
32 |     await delay(100);
33 |     
34 |     const tag = tags.find(tag => tag.id === id);
35 |     
36 |     if (!tag) {
37 |       return new HttpResponse(null, {
38 |         status: 404,
39 |         statusText: 'í•´ë‹¹ IDì˜ íƒœê·¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
40 |       });
41 |     }
42 |     
43 |     return HttpResponse.json(tag);
44 |   }),
45 | 
46 |   // íƒœê·¸ ìƒì„±
47 |   http.post('/api/tags', async ({ request }) => {
48 |     const data = await request.json() as TagInput;
49 |     await delay(150);
50 |     
51 |     // ì´ë¦„ ê²€ì¦
52 |     if (!data.name || typeof data.name !== 'string' || data.name.trim() === '') {
53 |       return new HttpResponse(JSON.stringify({ error: 'ìœ íš¨í•œ íƒœê·¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' }), {
54 |         status: 400,
55 |         headers: {
56 |           'Content-Type': 'application/json'
57 |         }
58 |       });
59 |     }
60 |     
61 |     // ì¤‘ë³µ íƒœê·¸ ê²€ì‚¬
62 |     if (tags.some(tag => tag.name.toLowerCase() === data.name.toLowerCase())) {
63 |       return new HttpResponse(JSON.stringify({ error: 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íƒœê·¸ ì´ë¦„ì…ë‹ˆë‹¤.' }), {
64 |         status: 409,
65 |         headers: {
66 |           'Content-Type': 'application/json'
[TRUNCATED]
```

src/app/api/auth/status/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: route.ts
3 |  * ëª©ì : ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ API
4 |  * ì—­í• : í˜„ì¬ ë¡œê·¸ì¸ ìƒíƒœì™€ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2024-05-21 : import ìˆœì„œ ìˆ˜ì •
7 |  * ìˆ˜ì •ì¼: 2024-05-22 : import ìˆœì„œ ì˜¤ë¥˜ ìˆ˜ì •
8 |  */
9 | 
10 | import { NextResponse } from 'next/server'
11 | 
12 | import { createClient } from '@/lib/supabase/server'
13 | 
14 | export async function GET() {
15 |   try {
16 |     const supabase = await createClient()
17 |     const { data, error } = await supabase.auth.getUser()
18 |     
19 |     if (error) {
20 |       return NextResponse.json({ 
21 |         loggedIn: false, 
22 |         error: error.message 
23 |       })
24 |     }
25 |     
26 |     return NextResponse.json({ 
27 |       loggedIn: !!data?.user,
28 |       user: data.user ? {
29 |         id: data.user.id,
30 |         email: data.user.email,
31 |         provider: data.user.app_metadata?.provider || 'unknown'
32 |       } : null
33 |     })
34 |   } catch (error) {
35 |     console.error('ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error)
36 |     return NextResponse.json({ 
37 |       loggedIn: false, 
38 |       error: 'ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤' 
39 |     }, { status: 500 })
40 |   }
41 | } 
```

src/app/api/cards/[id]/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/api/cards/[id]/route.ts
3 |  * ëª©ì : ê°œë³„ ì¹´ë“œ API ì—”ë“œí¬ì¸íŠ¸
4 |  * ì—­í• : ì¹´ë“œ ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-21
6 |  * ìˆ˜ì •ì¼: 2025-04-16 : paramsë¥¼ awaitë¡œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì ‘ê·¼í•˜ë„ë¡ ìˆ˜ì • (Next.js 15 ê·œì¹™ì— ë§ê²Œ)
7 |  */
8 | 
9 | import { NextRequest, NextResponse } from 'next/server';
10 | 
11 | import { PrismaClient } from '@prisma/client';
12 | import { z } from 'zod';
13 | 
14 | import prisma from '@/lib/prisma';
15 | 
16 | // ì¹´ë“œ ìˆ˜ì • ìŠ¤í‚¤ë§ˆ
17 | const updateCardSchema = z.object({
18 |   title: z.string().min(1, 'ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.').optional(),
19 |   content: z.string().optional(),
20 |   userId: z.string().optional(),
21 |   tags: z.array(z.string()).optional(),
22 | });
23 | 
24 | // ì¹´ë“œ ë‚´ìš© ë¶€ë¶„ ì—…ë°ì´íŠ¸ ìŠ¤í‚¤ë§ˆ
25 | const patchCardSchema = z.object({
26 |   content: z.string().optional(),
27 | });
28 | 
29 | // ê°œë³„ ì¹´ë“œ ì¡°íšŒ API
30 | export async function GET(
31 |   request: NextRequest,
32 |   context: { params: { id: string } }
33 | ) {
34 |   try {
35 |     // params ê°ì²´ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì ‘ê·¼
36 |     const params = await context.params;
37 |     const { id } = params;
38 |     console.log(`ì¹´ë“œ ìƒì„¸ ì¡°íšŒ ìš”ì²­: ID=${id}`);
39 |     
40 |     // ì¹´ë“œ ì¡°íšŒ (íƒœê·¸ ì •ë³´ í¬í•¨)
41 |     const card = await prisma.card.findUnique({
42 |       where: { id },
43 |       include: {
44 |         user: {
45 |           select: {
46 |             id: true,
47 |             name: true
48 |           }
49 |         },
50 |         cardTags: {
51 |           include: {
52 |             tag: true
53 |           }
54 |         }
55 |       }
56 |     });
57 |     
58 |     if (!card) {
59 |       console.log(`ì¹´ë“œ ì°¾ì„ ìˆ˜ ì—†ìŒ: ID=${id}`);
60 |       return NextResponse.json(
61 |         { error: 'ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
62 |         { status: 404 }
63 |       );
64 |     }
65 |     
66 |     console.log(`ì¹´ë“œ ì¡°íšŒ ì„±ê³µ: ID=${id}`);
67 |     return NextResponse.json(card);
68 |   } catch (error) {
69 |     // ì˜¤ë¥˜ ë¡œê¹… ë¶€ë¶„ë„ ì•ˆì „í•˜ê²Œ ì ‘ê·¼
70 |     const params = await context.params;
71 |     console.error(`ì¹´ë“œ ì¡°íšŒ ì˜¤ë¥˜ (ID=${params?.id || 'ì•Œ ìˆ˜ ì—†ìŒ'}):`, error);
72 |     return NextResponse.json(
73 |       { error: 'ì¹´ë“œë¥¼ ì¡°íšŒí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' },
74 |       { status: 500 }
[TRUNCATED]
```

src/app/api/tags/[id]/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/api/tags/[id]/route.ts
3 |  * ëª©ì : ê°œë³„ íƒœê·¸ API ì—”ë“œí¬ì¸íŠ¸
4 |  * ì—­í• : íƒœê·¸ ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ ê¸°ëŠ¥ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-22
6 |  */
7 | 
8 | import { NextRequest, NextResponse } from 'next/server';
9 | 
10 | import { z } from 'zod';
11 | 
12 | import prisma from '@/lib/prisma';
13 | 
14 | // íƒœê·¸ ìˆ˜ì • ìŠ¤í‚¤ë§ˆ
15 | const updateTagSchema = z.object({
16 |   name: z.string().min(1, 'íƒœê·¸ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.'),
17 |   color: z.string().optional(),
18 | });
19 | 
20 | // ê°œë³„ íƒœê·¸ ì¡°íšŒ API
21 | export async function GET(
22 |   request: NextRequest,
23 |   context: { params: { id: string } }
24 | ) {
25 |   try {
26 |     const id = context.params.id;
27 |     
28 |     // íƒœê·¸ ì¡°íšŒ
29 |     const tag = await prisma.tag.findUnique({
30 |       where: { id }
31 |     });
32 |     
33 |     if (!tag) {
34 |       return NextResponse.json(
35 |         { error: 'íƒœê·¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
36 |         { status: 404 }
37 |       );
38 |     }
39 |     
40 |     return NextResponse.json(tag);
41 |   } catch (error) {
42 |     console.error('íƒœê·¸ ì¡°íšŒ ì˜¤ë¥˜:', error);
43 |     return NextResponse.json(
44 |       { error: 'íƒœê·¸ë¥¼ ì¡°íšŒí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' },
45 |       { status: 500 }
46 |     );
47 |   }
48 | }
49 | 
50 | // íƒœê·¸ ìˆ˜ì • API
51 | export async function PUT(
52 |   request: NextRequest,
53 |   context: { params: { id: string } }
54 | ) {
55 |   try {
56 |     const id = context.params.id;
57 |     const body = await request.json();
58 |     
59 |     // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
60 |     const validation = updateTagSchema.safeParse(body);
61 |     if (!validation.success) {
62 |       return NextResponse.json(
63 |         { error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„°ì…ë‹ˆë‹¤.', details: validation.error.format() },
64 |         { status: 400 }
65 |       );
66 |     }
67 |     
68 |     // íƒœê·¸ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
69 |     const existingTag = await prisma.tag.findUnique({
70 |       where: { id }
71 |     });
72 |     
73 |     if (!existingTag) {
74 |       return NextResponse.json(
75 |         { error: 'íƒœê·¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
76 |         { status: 404 }
77 |       );
78 |     }
79 |     
80 |     // ê°™ì€ ì´ë¦„ì˜ íƒœê·¸ê°€ ìˆëŠ”ì§€ í™•ì¸ (ë‹¤ë¥¸ ID)
81 |     const duplicateTag = await prisma.tag.findFirst({
82 |       where: {
[TRUNCATED]
```

src/app/api/user/[id]/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: ./src/app/api/user/[id]/route.ts
3 |  * ëª©ì : ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ API ì—”ë“œí¬ì¸íŠ¸
4 |  * ì—­í• : ì‚¬ìš©ì IDë¡œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³  ì‘ë‹µì„ ë°˜í™˜
5 |  * ì‘ì„±ì¼: 2024-05-29
6 |  */
7 | 
8 | import { NextResponse } from 'next/server';
9 | 
10 | import prisma from '@/lib/prisma';
11 | 
12 | export async function GET(
13 |   request: Request,
14 |   { params }: { params: { id: string } }
15 | ) {
16 |   try {
17 |     // Next.js 15ì—ì„œëŠ” paramsê°€ Promiseì´ë¯€ë¡œ await ì‚¬ìš©
18 |     const paramsResolved = await params;
19 |     const id = paramsResolved.id;
20 |     
21 |     if (!id) {
22 |       return NextResponse.json(
23 |         { error: 'ì‚¬ìš©ì IDê°€ í•„ìš”í•©ë‹ˆë‹¤.' },
24 |         { status: 400 }
25 |       );
26 |     }
27 |     
28 |     try {
29 |       // ì‚¬ìš©ì ì¡°íšŒ
30 |       const user = await prisma.user.findUnique({
31 |         where: { id },
32 |       });
33 |       
34 |       if (!user) {
35 |         return NextResponse.json(
36 |           { error: 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
37 |           { status: 404 }
38 |         );
39 |       }
40 |       
41 |       return NextResponse.json({ user });
42 |     } catch (dbError: Error | unknown) {
43 |       console.error('DB ì¡°íšŒ ì˜¤ë¥˜:', dbError);
44 |       
45 |       // DB ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ë”ë¯¸ ì‚¬ìš©ì ë°ì´í„° ë°˜í™˜
46 |       // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì ì ˆí•œ ì˜¤ë¥˜ ì²˜ë¦¬ í•„ìš”
47 |       return NextResponse.json({
48 |         user: {
49 |           id,
50 |           email: 'user@example.com',
51 |           name: 'ì‚¬ìš©ì',
52 |           createdAt: new Date().toISOString(),
53 |           updatedAt: new Date().toISOString(),
54 |         }
55 |       });
56 |     }
57 |   } catch (error: Error | unknown) {
58 |     console.error('ì‚¬ìš©ì ì¡°íšŒ API ì˜¤ë¥˜:', error);
59 |     const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
60 |     return NextResponse.json(
61 |       { error: `ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨: ${errorMessage}` },
62 |       { status: 500 }
63 |     );
64 |   }
65 | } 
```

src/app/api/users/first/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/api/users/first/route.ts
3 |  * ëª©ì : ì²« ë²ˆì§¸ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•˜ëŠ” API
4 |  * ì—­í• : ì‹œìŠ¤í…œì— ë“±ë¡ëœ ê°€ì¥ ì˜¤ë˜ëœ(ì²« ë²ˆì§¸) ì‚¬ìš©ì ì •ë³´ ì œê³µ
5 |  * ì‘ì„±ì¼: 2024-05-28
6 |  */
7 | 
8 | import { NextResponse } from 'next/server';
9 | 
10 | import prisma from '@/lib/prisma';
11 | 
12 | /**
13 |  * ì²« ë²ˆì§¸ ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ëŠ” API ì—”ë“œí¬ì¸íŠ¸
14 |  */
15 | export async function GET() {
16 |   try {
17 |     // ì²« ë²ˆì§¸ ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜´ (ê°€ì¥ ë¨¼ì € ìƒì„±ëœ ì‚¬ìš©ì)
18 |     const firstUser = await prisma.user.findFirst({
19 |       orderBy: {
20 |         createdAt: 'asc'
21 |       },
22 |       select: {
23 |         id: true,
24 |         name: true,
25 |         email: true
26 |       }
27 |     });
28 |     
29 |     if (!firstUser) {
30 |       return NextResponse.json(
31 |         { error: 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
32 |         { status: 404 }
33 |       );
34 |     }
35 |     
36 |     return NextResponse.json(firstUser);
37 |   } catch (error) {
38 |     console.error('ì‚¬ìš©ì ì¡°íšŒ ì˜¤ë¥˜:', error);
39 |     
40 |     return NextResponse.json(
41 |       { error: 'ì‚¬ìš©ì ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' },
42 |       { status: 500 }
43 |     );
44 |   }
45 | } 
```

src/app/api/logs/view/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: route.ts
3 |  * ëª©ì : ì €ì¥ëœ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” API ì—”ë“œí¬ì¸íŠ¸
4 |  * ì—­í• : ì„œë²„ì— ì €ì¥ëœ ë¡œê·¸ë¥¼ ì¡°íšŒí•˜ê³  í•„í„°ë§í•˜ì—¬ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-09
7 |  * ìˆ˜ì •ì¼: 2024-05-28 : module ë³€ìˆ˜ëª…ì„ logModuleë¡œ ë³€ê²½í•˜ì—¬ Next.js ì˜¤ë¥˜ í•´ê²°
8 |  * ìˆ˜ì •ì¼: 2024-05-28 : any íƒ€ì…ì„ êµ¬ì²´ì ì¸ íƒ€ì…ìœ¼ë¡œ ë³€ê²½
9 |  */
10 | 
11 | import fs from 'fs';
12 | import path from 'path';
13 | 
14 | import { NextRequest, NextResponse } from 'next/server';
15 | 
16 | import { createClient } from '@/lib/supabase/server';
17 | 
18 | // ë¡œê·¸ í•­ëª© ì¸í„°í˜ì´ìŠ¤ ì •ì˜
19 | interface LogEntry {
20 |   module: string;
21 |   level: string;
22 |   message: string;
23 |   timestamp: string;
24 |   sessionId?: string;
25 |   details?: Record<string, unknown>;
26 | }
27 | 
28 | // ë¡œê·¸ íŒŒì¼ ê²½ë¡œ
29 | const LOG_DIR = process.env.LOG_DIR || 'logs';
30 | const LOG_FILE = path.join(process.cwd(), LOG_DIR, 'client-logs.json');
31 | 
32 | /**
33 |  * ë¡œê·¸ ì¡°íšŒ API í•¸ë“¤ëŸ¬
34 |  */
35 | export async function GET(request: NextRequest) {
36 |   try {
37 |     // ì¸ì¦ í™•ì¸ (ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •)
38 |     const supabase = await createClient();
39 |     const { data: sessionData } = await supabase.auth.getSession();
40 |     
41 |     // ê°œë°œ í™˜ê²½ì´ ì•„ë‹ˆê³  ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš° ì ‘ê·¼ ê±°ë¶€
42 |     if (process.env.NODE_ENV !== 'development' && !sessionData.session) {
43 |       return NextResponse.json(
44 |         { error: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.' },
45 |         { status: 401 }
46 |       );
47 |     }
48 |     
49 |     // ë¡œê·¸ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°
50 |     if (!fs.existsSync(LOG_FILE)) {
51 |       return NextResponse.json(
52 |         { error: 'ë¡œê·¸ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.' },
53 |         { status: 404 }
54 |       );
55 |     }
56 |     
57 |     // ë¡œê·¸ íŒŒì¼ ì½ê¸°
58 |     const fileContent = fs.readFileSync(LOG_FILE, 'utf-8');
59 |     const logs = JSON.parse(fileContent) as LogEntry[];
60 |     
61 |     // URL íŒŒë¼ë¯¸í„°ë¡œ í•„í„°ë§
62 |     const searchParams = request.nextUrl.searchParams;
63 |     const logModule = searchParams.get('module');
64 |     const level = searchParams.get('level');
65 |     const limit = parseInt(searchParams.get('limit') || '100', 10);
66 |     const sessionId = searchParams.get('sessionId');
67 |     
68 |     // í•„í„°ë§ ì ìš©
[TRUNCATED]
```

src/app/api/user/register/route.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: ./src/app/api/user/register/route.ts
3 |  * ëª©ì : ì‚¬ìš©ì ë“±ë¡ API ì—”ë“œí¬ì¸íŠ¸
4 |  * ì—­í• : ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ë“±ë¡í•˜ê±°ë‚˜ ê¸°ì¡´ ì‚¬ìš©ìë¥¼ í™•ì¸í•˜ëŠ” API
5 |  * ì‘ì„±ì¼: 2024-05-29
6 |  */
7 | 
8 | import { NextResponse } from 'next/server';
9 | 
10 | import prisma from '@/lib/prisma';
11 | 
12 | export async function POST(request: Request) {
13 |   try {
14 |     const body = await request.json();
15 |     const { id, email, name } = body;
16 |     
17 |     // í•„ìˆ˜ í•„ë“œ í™•ì¸
18 |     if (!id || !email) {
19 |       return NextResponse.json(
20 |         { error: 'ì‚¬ìš©ì IDì™€ ì´ë©”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.' },
21 |         { status: 400 }
22 |       );
23 |     }
24 |     
25 |     try {
26 |       // ì´ë¯¸ ë“±ë¡ëœ ì‚¬ìš©ìì¸ì§€ í™•ì¸
27 |       const existingUser = await prisma.user.findUnique({
28 |         where: { id },
29 |       });
30 |       
31 |       if (existingUser) {
32 |         // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìì´ë©´ ì—…ë°ì´íŠ¸ (í•„ìš”ì‹œ)
33 |         console.log('ê¸°ì¡´ ì‚¬ìš©ì í™•ì¸:', existingUser.email);
34 |         return NextResponse.json({ message: 'ê¸°ì¡´ ì‚¬ìš©ì í™•ì¸ë¨', user: existingUser });
35 |       }
36 |       
37 |       // ìƒˆ ì‚¬ìš©ì ìƒì„±
38 |       const newUser = await prisma.user.create({
39 |         data: {
40 |           id,
41 |           email,
42 |           name: name || email.split('@')[0],
43 |         },
44 |       });
45 |       
46 |       console.log('ìƒˆ ì‚¬ìš©ì ìƒì„±ë¨:', newUser.email);
47 |       
48 |       return NextResponse.json({ message: 'ì‚¬ìš©ì ë“±ë¡ ì„±ê³µ', user: newUser });
49 |     } catch (dbError: Error | unknown) {
50 |       console.error('ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜:', dbError);
51 |       
52 |       // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜ ì‹œ ë”ë¯¸ ë°ì´í„° ë°˜í™˜
53 |       const dummyUser = {
54 |         id,
55 |         email,
56 |         name: name || email.split('@')[0],
57 |         createdAt: new Date().toISOString(),
58 |         updatedAt: new Date().toISOString(),
59 |       };
60 |       
61 |       return NextResponse.json({ 
62 |         message: 'ì‚¬ìš©ì ë“±ë¡ì€ ì„±ê³µí–ˆìœ¼ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨', 
63 |         user: dummyUser 
64 |       });
65 |     }
66 |   } catch (error: Error | unknown) {
67 |     console.error('ì‚¬ìš©ì ë“±ë¡ ì˜¤ë¥˜:', error);
68 |     const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
69 |     return NextResponse.json(
70 |       { error: `ì‚¬ìš©ì ë“±ë¡ ì‹¤íŒ¨: ${errorMessage}` },
71 |       { status: 500 }
72 |     );
73 |   }
74 | } 
```

src/app/cards/[id]/edit/EditCardPageMock.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: EditCardPageMock.tsx
3 |  * ëª©ì : ì¹´ë“œ í¸ì§‘ í˜ì´ì§€ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ëª¨í‚¹ ì»´í¬ë„ŒíŠ¸
4 |  * ì—­í• : ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ì„ ì‹œë®¬ë ˆì´ì…˜
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-03
7 |  */
8 | 
9 | import React, { useEffect, useState } from 'react';
10 | 
11 | import { mockActions } from './test-utils';
12 | 
13 | interface Card {
14 |     id: string;
15 |     title: string;
16 |     content: string;
17 |     cardTags: Array<{ id: string; name: string; }>;
18 | }
19 | 
20 | export const EditCardPageMock: React.FC = () => {
21 |     const [card, setCard] = useState<Card | null>(null);
22 |     const [error, setError] = useState<string | null>(null);
23 |     const [isLoading, setIsLoading] = useState(true);
24 | 
25 |     // ê°„ì†Œí™”ëœ useEffect - ë¹„ë™ê¸° ë¡œì§ ë‹¨ìˆœí™”
26 |     useEffect(() => {
27 |         const fetchCard = async () => {
28 |             try {
29 |                 const id = 'test-card-123';
30 | 
31 |                 // API í˜¸ì¶œ - ë™ê¸°ì‹ìœ¼ë¡œ ì²˜ë¦¬ (í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” ì¦‰ì‹œ í•´ê²°ë˜ëŠ” í”„ë¡œë¯¸ìŠ¤ ì‚¬ìš©)
32 |                 const response = await mockActions.getCard(id);
33 | 
34 |                 // ì‘ë‹µ ì²˜ë¦¬
35 |                 if (!response.ok) {
36 |                     if (response.status === 404) {
37 |                         setError('ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
38 |                     } else {
39 |                         setError('ì¹´ë“œ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
40 |                     }
41 |                     setIsLoading(false);
42 |                     return;
43 |                 }
44 | 
45 |                 // ì‘ë‹µ ë°ì´í„° ì²˜ë¦¬
46 |                 const data = await response.json();
47 | 
48 |                 // ë°ì´í„°ì— ì—ëŸ¬ê°€ ìˆëŠ” ê²½ìš°
49 |                 if ('error' in data) {
50 |                     setError(data.error);
51 |                 } else {
52 |                     // ì¹´ë“œ ë°ì´í„° ì„¤ì •
53 |                     setCard(data);
54 |                 }
55 | 
56 |                 // ë¡œë”© ìƒíƒœ ì¢…ë£Œ
57 |                 setIsLoading(false);
58 |             } catch (err) {
59 |                 // ì—ëŸ¬ ì²˜ë¦¬
60 |                 setError(err instanceof Error ? err.message : 'ì¹´ë“œ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
61 |                 setIsLoading(false);
62 |             }
63 |         };
64 | 
65 |         // ì¦‰ì‹œ í•¨ìˆ˜ í˜¸ì¶œ
66 |         fetchCard();
67 |     }, []);
68 | 
69 |     // ë¡œë”© ì¤‘ UI
70 |     if (isLoading) {
71 |         return <div data-testid="loading-state">ë¡œë”© ì¤‘...</div>;
72 |     }
73 | 
74 |     // ì—ëŸ¬ UI
75 |     if (error) {
76 |         return (
77 |             <div data-testid="error-state">
78 |                 <p>{error}</p>
79 |                 <button onClick={() => mockActions.router.back()}>ëŒì•„ê°€ê¸°</button>
[TRUNCATED]
```

src/app/cards/[id]/edit/page.test.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/cards/[id]/edit/page.test.tsx
3 |  * ëª©ì : ì¹´ë“œ í¸ì§‘ í˜ì´ì§€ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
4 |  * ì—­í• : í˜ì´ì§€ ë¡œë”©, ë„¤ë¹„ê²Œì´ì…˜, API ìš”ì²­, ì—ëŸ¬ ì²˜ë¦¬ ë“±ì˜ ê¸°ëŠ¥ ê²€ì¦
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-04-03
7 |  * ìˆ˜ì •ì¼: 2025-05-19 : ë¦°í„° ì˜¤ë¥˜ ìˆ˜ì • (import ìˆœì„œ ë³€ê²½)
8 |  */
9 | 
10 | import { render } from '@testing-library/react';
11 | import '@testing-library/jest-dom';
12 | import userEvent from '@testing-library/user-event';
13 | import { http, HttpResponse } from 'msw';
14 | import { setupServer } from 'msw/node';
15 | import { act } from 'react-dom/test-utils';
16 | import { describe, test, expect, vi, beforeAll, afterAll, beforeEach, afterEach } from 'vitest';
17 | 
18 | /**
19 |  * ì°¸ê³ : Next.js ê³µì‹ ë¬¸ì„œì— ë”°ë¥´ë©´, async/awaitë¥¼ ì‚¬ìš©í•˜ëŠ” Client ComponentsëŠ”
20 |  * ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë³´ë‹¤ E2E í…ŒìŠ¤íŠ¸ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
21 |  * 
22 |  * "Since async Server Components are new to the React ecosystem, Jest currently does not support them.
23 |  * While you can still run unit tests for synchronous Server and Client Components,
24 |  * we recommend using an E2E tests for async components."
25 |  * 
26 |  * ì¶œì²˜: https://nextjs.org/docs/app/building-your-application/testing/jest
27 |  */
28 | 
29 | // vi.mockì€ íŒŒì¼ ìƒë‹¨ìœ¼ë¡œ í˜¸ì´ìŠ¤íŒ…ë˜ë¯€ë¡œ ìµœìƒë‹¨ì— ë°°ì¹˜ (Vitest ë¬¸ì„œ ì°¸ì¡°)
30 | vi.mock('./test-utils', () => ({
31 |   mockActions: {
32 |     getCard: vi.fn().mockResolvedValue({
33 |       ok: true,
34 |       status: 200,
35 |       json: () => Promise.resolve({
36 |         id: '1',
37 |         title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ',
38 |         content: 'í…ŒìŠ¤íŠ¸ ë‚´ìš©',
39 |         cardTags: []
40 |       })
41 |     }),
42 |     router: {
43 |       back: vi.fn(),
44 |       push: vi.fn()
45 |     }
46 |   }
47 | }));
48 | 
49 | // ëª¨í‚¹ ëª¨ë“ˆ importëŠ” mock ì„ ì–¸ í›„ì— ìœ„ì¹˜í•´ì•¼ í•¨
50 | import { EditCardPageMock } from './EditCardPageMock';
51 | import { mockActions } from './test-utils';
52 | 
53 | // í…ŒìŠ¤íŠ¸ íƒ€ì„ì•„ì›ƒ ì„¤ì •
54 | vi.setConfig({ testTimeout: 10000 });
55 | 
56 | // MSW ì„œë²„ ì„¤ì •
57 | const server = setupServer(
58 |   http.get('*/api/cards/:id', () => {
59 |     return HttpResponse.json({
60 |       id: '1',
61 |       title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ',
62 |       content: 'í…ŒìŠ¤íŠ¸ ë‚´ìš©',
63 |       cardTags: []
64 |     });
65 |   })
66 | );
67 | 
[TRUNCATED]
```

src/app/cards/[id]/edit/page.tsx
```
1 | /**
2 |  * íŒŒì¼ëª…: src/app/cards/[id]/edit/page.tsx
3 |  * ëª©ì : ì¹´ë“œ í¸ì§‘ í˜ì´ì§€
4 |  * ì—­í• : ê¸°ì¡´ ì¹´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ í¸ì§‘í•  ìˆ˜ ìˆëŠ” UI ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-03-27
6 |  * ìˆ˜ì •ì¼: 2025-05-17 : any íƒ€ì…ì„ êµ¬ì²´ì ì¸ íƒ€ì…ìœ¼ë¡œ ë³€ê²½
7 |  */
8 | 
9 | 'use client';
10 | 
11 | import { useEffect, useState } from 'react';
12 | 
13 | import { useRouter } from 'next/navigation';
14 | import { useParams } from 'next/navigation';
15 | 
16 | import { ArrowLeft } from 'lucide-react';
17 | 
18 | import EditCardForm from '@/components/cards/EditCardForm';
19 | import { Button } from '@/components/ui/button';
20 | import { Card, CardContent } from '@/components/ui/card';
21 | 
22 | // ì¹´ë“œ ë°ì´í„° ì¸í„°í˜ì´ìŠ¤ ì •ì˜
23 | interface CardData {
24 |   id: string;
25 |   title: string;
26 |   content: string;
27 |   cardTags?: { id: string; tag: { id: string; name: string } }[];
28 |   [key: string]: unknown;
29 | }
30 | 
31 | export default function EditCardPage() {
32 |   const router = useRouter();
33 |   const params = useParams();
34 |   const [loading, setLoading] = useState(true);
35 |   const [card, setCard] = useState<CardData | null>(null);
36 |   const [error, setError] = useState<string | null>(null);
37 | 
38 |   useEffect(() => {
39 |     const fetchCard = async () => {
40 |       try {
41 |         setLoading(true);
42 |         const response = await fetch(`/api/cards/${params.id}`);
43 | 
44 |         if (!response.ok) {
45 |           throw new Error('ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
46 |         }
47 | 
48 |         const data = await response.json();
49 |         setCard(data);
50 |       } catch (err) {
51 |         setError(err instanceof Error ? err.message : 'ì¹´ë“œ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
52 |       } finally {
53 |         setLoading(false);
54 |       }
55 |     };
56 | 
57 |     if (params.id) {
58 |       fetchCard();
59 |     }
60 |   }, [params.id]);
61 | 
62 |   const handleBack = () => {
63 |     router.back();
64 |   };
65 | 
66 |   return (
67 |     <div className="container mx-auto py-6 max-w-4xl">
68 |       <Button
69 |         variant="ghost"
70 |         className="mb-4 flex items-center"
71 |         onClick={handleBack}
72 |       >
73 |         <ArrowLeft className="mr-2 h-4 w-4" />
74 |         ë’¤ë¡œ ê°€ê¸°
[TRUNCATED]
```

src/app/cards/[id]/edit/test-utils.ts
```
1 | /**
2 |  * íŒŒì¼ëª…: test-utils.ts
3 |  * ëª©ì : ì¹´ë“œ í¸ì§‘ í˜ì´ì§€ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ë° ëª¨í‚¹ ê°ì²´ ì œê³µ
4 |  * ì—­í• : í…ŒìŠ¤íŠ¸ ì„¤ì •, ì •ë¦¬, ëª¨í‚¹ëœ ì•¡ì…˜ ì œê³µ
5 |  * ì‘ì„±ì¼: 2025-04-01
6 |  * ìˆ˜ì •ì¼: 2025-04-03
7 |  */
8 | 
9 | import { vi } from 'vitest';
10 | 
11 | interface CardResponse {
12 |   id: string;
13 |   title: string;
14 |   content: string;
15 |   cardTags: Array<{ id: string; name: string; }>;
16 | }
17 | 
18 | interface ErrorResponse {
19 |   error: string;
20 | }
21 | 
22 | type ApiResponse = CardResponse | ErrorResponse;
23 | 
24 | // API ì‘ë‹µ ê°ì²´ íƒ€ì…
25 | export interface MockApiResponse {
26 |   ok: boolean;
27 |   status: number;
28 |   json: () => Promise<ApiResponse>;
29 | }
30 | 
31 | // ëª¨í‚¹ëœ ì•¡ì…˜ë“¤
32 | export const mockActions = {
33 |   getCard: vi.fn().mockImplementation((): Promise<MockApiResponse> => {
34 |     return Promise.resolve({
35 |       ok: true,
36 |       status: 200,
37 |       json: () => Promise.resolve({
38 |         id: 'test-card-123',
39 |         title: 'í…ŒìŠ¤íŠ¸ ì¹´ë“œ',
40 |         content: 'í…ŒìŠ¤íŠ¸ ë‚´ìš©',
41 |         cardTags: []
42 |       } as CardResponse)
43 |     });
44 |   }),
45 |   router: {
46 |     back: vi.fn(),
47 |     push: vi.fn()
48 |   },
49 |   toast: {
50 |     success: vi.fn(),
51 |     error: vi.fn()
52 |   }
53 | };
54 | 
55 | /**
56 |  * setupEditCardPageTests: ì¹´ë“œ í¸ì§‘ í˜ì´ì§€ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í™˜ê²½ì„ ì„¤ì •
57 |  */
58 | export const setupEditCardPageTests = () => {
59 |   // ëª¨ë“  ëª¨í‚¹ëœ í•¨ìˆ˜ ì´ˆê¸°í™”
60 |   vi.clearAllMocks();
61 | 
62 |   // Sonner í† ìŠ¤íŠ¸ ëª¨í‚¹
63 |   vi.mock('sonner', () => ({
64 |     toast: {
65 |       success: vi.fn(),
66 |       error: vi.fn()
67 |     }
68 |   }));
69 | 
70 |   // next/navigation ëª¨í‚¹
71 |   vi.mock('next/navigation', () => ({
72 |     useRouter: () => mockActions.router,
73 |     useParams: () => ({ id: 'test-card-123' })
74 |   }));
75 | };
76 | 
77 | /**
78 |  * teardownEditCardPageTests: ì¹´ë“œ í¸ì§‘ í˜ì´ì§€ í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬ ì‘ì—… ìˆ˜í–‰
79 |  */
80 | export const teardownEditCardPageTests = () => {
81 |   vi.clearAllMocks();
82 |   vi.resetModules();
83 | };
84 | 
85 | /**
86 |  * waitForDomChanges: ë¹„ë™ê¸° ì‘ì—…ì˜ ì•ˆì „í•œ ì™„ë£Œë¥¼ ìœ„í•œ ë„ìš°ë¯¸ í•¨ìˆ˜
87 |  */
[TRUNCATED]
```
